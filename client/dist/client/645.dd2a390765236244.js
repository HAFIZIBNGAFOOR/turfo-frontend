(self.webpackChunkclient=self.webpackChunkclient||[]).push([[645],{6002:(zn,Pi,Ne)=>{"use strict";Ne.d(Pi,{o:()=>T});const T=mt=>mt.value&&""===mt.value.trim()?{onlySpaces:!0}:null},5233:(zn,Pi,Ne)=>{"use strict";Ne.d(Pi,{G:()=>Tt});var T=Ne(5879),mt=Ne(6223),ai=Ne(6002),s=Ne(6814),M=Ne(3814),wt=Ne(2032),nt=Ne(4170),Fe=Ne(2296),dt=Ne(5195),zt=Ne(1274),Ht=Ne(4190);function ti(Qe,Pe){1&Qe&&(T.TgZ(0,"mat-error"),T._uU(1,"Phone number is required"),T.qZA())}function lt(Qe,Pe){1&Qe&&(T.TgZ(0,"mat-error"),T._uU(1,"Enter a valid Phone number"),T.qZA())}function Bt(Qe,Pe){1&Qe&&(T.TgZ(0,"mat-error"),T._uU(1,"Password is required"),T.qZA())}function Jt(Qe,Pe){1&Qe&&(T.TgZ(0,"mat-error"),T._uU(1," Only spaces cannot be allowed"),T.qZA())}function Xt(Qe,Pe){1&Qe&&(T.TgZ(0,"mat-error"),T._uU(1,"Password must be 8 chaarcaters and atleast one number "),T.qZA())}function ft(Qe,Pe){if(1&Qe&&(T.TgZ(0,"mat-error",12),T._uU(1),T.qZA()),2&Qe){const ui=T.oxw();T.xp6(1),T.Oqu(ui.error)}}function bt(Qe,Pe){1&Qe&&(T.ynx(0),T.TgZ(1,"div",13),T._uU(2," Don't have an account "),T.TgZ(3,"a",14),T._uU(4," Register "),T.qZA(),T._uU(5," here. "),T.qZA(),T.TgZ(6,"div",15),T._uU(7," You're TurfAdmin "),T.TgZ(8,"a",16),T._uU(9," Login"),T.qZA(),T._uU(10,"here. "),T.qZA(),T.BQk())}function Gt(Qe,Pe){1&Qe&&(T.TgZ(0,"div",17),T._uU(1," Don't have an account "),T.TgZ(2,"a",18),T._uU(3," Register"),T.qZA(),T._uU(4," here. "),T.qZA(),T.TgZ(5,"div",15),T._uU(6," If you're a user "),T.TgZ(7,"a",19),T._uU(8,"Login "),T.qZA(),T._uU(9,"here. "),T.qZA())}let Tt=(()=>{var Qe;class Pe{constructor(rt){this.formBuilder=rt,this.loginData=new T.vpe,this.role="",this.error=""}ngOnInit(){this.loginForm=this.formBuilder.group({phone:["",[mt.kI.required,mt.kI.pattern(/^\d{10}$/),ai.o]],password:["",[mt.kI.required,mt.kI.pattern(/^(?=.*[a-zA-Z])(?=.*\d)[A-Za-z\d@$!%*?&]{8,}$/),ai.o]]})}onSubmit(){if(this.loginForm.valid){const rt={phone:this.loginForm.get("phone")?.value,password:this.loginForm.get("password")?.value};this.loginData.emit(rt)}}}return(Qe=Pe).\u0275fac=function(rt){return new(rt||Qe)(T.Y36(mt.qu))},Qe.\u0275cmp=T.Xpm({type:Qe,selectors:[["app-login"]],inputs:{role:"role",error:"error",isLoggedIn:"isLoggedIn"},outputs:{loginData:"loginData"},decls:20,vars:10,consts:[["fxLayoutAlign","center center","fxFlexFill","",1,"main-div"],["fxFlex","45",1,"container","box-shadow","mt-5","mb-5"],[1,"text-white","toolbar","mt-5","mb-5"],["fxLayoutAlign","stretch","fxLayout","column",1,"login-form",3,"formGroup","submit"],["appearance","fill"],["matInput","","formControlName","phone","placeholder","Phone"],[4,"ngIf"],["type","password","matInput","","formControlName","password","placeholder","Password"],["class","text-center mb-3",4,"ngIf"],["type","submit","mat-raised-button",""],[4,"ngIf","ngIfElse"],["elseTemplate",""],[1,"text-center","mb-3"],[1,"mt-3","mb-2","text-center","sign-up"],["routerLink","/signup"],[1,"mb-5","text-center","sign-up"],["routerLink","/turf-owner/login"],[1,"mt-3","mb-2","text-center"],["routerLink","/turf-owner/signup"],["routerLink","/login"]],template:function(rt,De){if(1&rt&&(T.TgZ(0,"div",0)(1,"mat-card",1)(2,"mat-toolbar",2),T._uU(3),T.qZA(),T.TgZ(4,"form",3),T.NdJ("submit",function(){return De.onSubmit()}),T.TgZ(5,"mat-form-field",4),T._UZ(6,"input",5),T.YNc(7,ti,2,0,"mat-error",6),T.YNc(8,lt,2,0,"mat-error",6),T.qZA(),T.TgZ(9,"mat-form-field",4),T._UZ(10,"input",7),T.YNc(11,Bt,2,0,"mat-error",6),T.YNc(12,Jt,2,0,"mat-error",6),T.YNc(13,Xt,2,0,"mat-error",6),T.qZA(),T.YNc(14,ft,2,1,"mat-error",8),T.TgZ(15,"button",9),T._uU(16," Submit "),T.qZA()(),T.YNc(17,bt,11,0,"ng-container",10),T.YNc(18,Gt,10,0,"ng-template",null,11,T.W1O),T.qZA()()),2&rt){const at=T.MAs(19);let Ie,Je,Ce,Ue,Ee;T.xp6(3),T.hij(" ",De.role," LOGIN "),T.xp6(1),T.Q6J("formGroup",De.loginForm),T.xp6(3),T.Q6J("ngIf",null==(Ie=De.loginForm.get("phone"))?null:Ie.hasError("required")),T.xp6(1),T.Q6J("ngIf",null==(Je=De.loginForm.get("phone"))?null:Je.hasError("pattern")),T.xp6(3),T.Q6J("ngIf",null==(Ce=De.loginForm.get("password"))?null:Ce.hasError("required")),T.xp6(1),T.Q6J("ngIf",null==(Ue=De.loginForm.get("password"))?null:Ue.hasError("onlySpaces")),T.xp6(1),T.Q6J("ngIf",null==(Ee=De.loginForm.get("password"))?null:Ee.hasError("pattern")),T.xp6(1),T.Q6J("ngIf",De.error),T.xp6(3),T.Q6J("ngIf","USER"==De.role)("ngIfElse",at)}},dependencies:[s.O5,M.xw,M.Wh,M.s9,M.yH,wt.Nt,nt.KE,nt.TO,Fe.lW,dt.a8,zt.Ye,mt._Y,mt.Fj,mt.JJ,mt.JL,mt.sg,mt.u,Ht.rH],styles:[".main-div[_ngcontent-%COMP%]   mat-card[_ngcontent-%COMP%]{padding:0}.login-form[_ngcontent-%COMP%]{padding:20px}.toolbar[_ngcontent-%COMP%]{border-radius:5px;background:#000000;justify-content:center}.box-shadow[_ngcontent-%COMP%]{background-color:#aeeac5;border-radius:5px;border:1px solid #ccc;box-shadow:#0006 -5px 5px,}.green-theme[_ngcontent-%COMP%]{background-color:#7fe2a5}"]}),Pe})()},3434:(zn,Pi,Ne)=>{"use strict";Ne.d(Pi,{S:()=>rt});var T=Ne(5879),mt=Ne(1088),ai=Ne(7398),s=Ne(7081),M=Ne(9827),nt=Ne(6814),Fe=Ne(3814),dt=Ne(7509),zt=Ne(2296),Ht=Ne(1274),ti=Ne(4190),lt=Ne(617),Bt=Ne(2651),Jt=Ne(9038),Xt=Ne(6380);function ft(De,at){if(1&De&&(T.TgZ(0,"button",20)(1,"mat-icon",21),T._uU(2,"account_circle"),T.qZA()()),2&De){T.oxw();const Ie=T.MAs(22);T.Q6J("matMenuTriggerFor",Ie)}}function bt(De,at){if(1&De&&(T.TgZ(0,"button",22),T._uU(1," LOGIN "),T.qZA()),2&De){const Ie=T.oxw();T.Q6J("routerLink",Ie.isAdmin?"turf-owner/login":"login")}}function Gt(De,at){if(1&De){const Ie=T.EpF();T.TgZ(0,"button",23),T.NdJ("click",function(){T.CHM(Ie),T.oxw();const Ce=T.MAs(2);return T.KtG(Ce.toggle())}),T.TgZ(1,"mat-icon",24),T._uU(2,"menu"),T.qZA()()}}function Tt(De,at){if(1&De&&(T.TgZ(0,"button",20)(1,"mat-icon",21),T._uU(2,"account_circle"),T.qZA()()),2&De){T.oxw();const Ie=T.MAs(22);T.Q6J("matMenuTriggerFor",Ie)}}function Qe(De,at){if(1&De&&(T.TgZ(0,"button",25),T._uU(1," LOGIN "),T.qZA()),2&De){const Ie=T.oxw();T.Q6J("routerLink",Ie.isAdmin?"turf-owner/login":"login")}}const Pe=function(De){return{hidden:De}},ui=["*"];let rt=(()=>{var De;class at{constructor(){this.breakpointObserver=(0,T.f3M)(mt.Yg),this.isLogout=new T.vpe,this.isHandset$=this.breakpointObserver.observe(mt.u3.HandsetPortrait).pipe((0,ai.U)(Je=>Je.matches),(0,s.d)())}ngOnInit(){console.log(this.isLoggedIn," this is isLogged in")}logoutClicked(){M.confirm("Logout","Are you sure ?",()=>{this.isAdmin?(this.isLogout.emit("turf-admin"),M.success("Turf admin Logged out ")):(this.isLogout.emit("user"),M.success(" user Logged out "))},()=>{M.error("cancelled")}).set({transiton:"slide",labels:{ok:"Proceed",cancel:"Cancel"}})}}return(De=at).\u0275fac=function(Je){return new(Je||De)},De.\u0275cmp=T.Xpm({type:De,selectors:[["app-navbar"]],inputs:{isAdmin:"isAdmin",isLoggedIn:"isLoggedIn"},outputs:{isLogout:"isLogout"},ngContentSelectors:ui,decls:62,vars:40,consts:[[1,"sidenav-container"],["fixedInViewport","false",1,"sidenav",3,"ngClass","mode","opened"],["drawer",""],["mat-list-item",""],["routerLinkActive","active","mat-button","",1,"nav-caption",3,"routerLink"],["routerLinkActive","active","class","nav-caption","mat-button","",3,"matMenuTriggerFor",4,"ngIf"],["menu","matMenu"],["mat-menu-item","",3,"routerLink"],["mat-button",""],["mat-menu-item",""],["mat-button","",3,"click"],["class","nav-caption","mat-button","",3,"routerLink",4,"ngIf"],[1,"mat-elevation-z5"],["type","button","aria-label","Toggle sidenav","mat-icon-button","",3,"click",4,"ngIf"],["routerLink","",1,"play-icon"],[1,"spacer"],[3,"ngClass"],["fxLayout","","fxLayoutGap","15px",1,"navigation-items"],["mat-button","","routerLinkActive","active",3,"routerLink"],["mat-button","",3,"routerLink",4,"ngIf"],["routerLinkActive","active","mat-button","",1,"nav-caption",3,"matMenuTriggerFor"],[1,"icon-size"],["mat-button","",1,"nav-caption",3,"routerLink"],["type","button","aria-label","Toggle sidenav","mat-icon-button","",3,"click"],["aria-label","Side nav toggle icon"],["mat-button","",3,"routerLink"]],template:function(Je,Ce){1&Je&&(T.F$t(),T.TgZ(0,"mat-sidenav-container",0)(1,"mat-sidenav",1,2),T.ALo(3,"async"),T.ALo(4,"async"),T.ALo(5,"async"),T.ALo(6,"async"),T.TgZ(7,"mat-toolbar"),T._uU(8,"Menu"),T.qZA(),T.TgZ(9,"mat-nav-list")(10,"a",3)(11,"button",4),T._uU(12),T.qZA()(),T.TgZ(13,"a",3)(14,"button",4),T._uU(15),T.qZA()(),T.TgZ(16,"a",3)(17,"button",4),T._uU(18),T.qZA()(),T.TgZ(19,"a",3),T.YNc(20,ft,3,1,"button",5),T.TgZ(21,"mat-menu",null,6)(23,"div",7)(24,"button",8),T._uU(25," Profile"),T.qZA()(),T.TgZ(26,"div",9)(27,"button",10),T.NdJ("click",function(){return Ce.logoutClicked()}),T._uU(28," Logout "),T.qZA()()(),T.YNc(29,bt,2,1,"button",11),T.qZA()()(),T.TgZ(30,"mat-sidenav-content")(31,"mat-toolbar",12),T.YNc(32,Gt,3,0,"button",13),T.ALo(33,"async"),T.TgZ(34,"a",14)(35,"b"),T._uU(36," TURFO "),T.qZA()(),T._UZ(37,"div",15),T.TgZ(38,"div",16),T.ALo(39,"async"),T.TgZ(40,"ul",17)(41,"li")(42,"button",18),T._uU(43),T.qZA()(),T.TgZ(44,"li")(45,"button",18),T._uU(46),T.qZA()(),T.TgZ(47,"li")(48,"button",18),T._uU(49),T.qZA()(),T.TgZ(50,"li"),T.YNc(51,Tt,3,1,"button",5),T.TgZ(52,"mat-menu",null,6)(54,"div",7)(55,"button",8),T._uU(56," Profile"),T.qZA()(),T.TgZ(57,"div",9)(58,"button",10),T.NdJ("click",function(){return Ce.logoutClicked()}),T._uU(59," Logout "),T.qZA()()(),T.YNc(60,Qe,2,1,"button",19),T.qZA()()()(),T.Hsn(61),T.qZA()()),2&Je&&(T.xp6(1),T.Q6J("ngClass",T.VKq(36,Pe,!1===T.lcZ(3,24,Ce.isHandset$)))("mode",T.lcZ(5,28,Ce.isHandset$)?"over":"side")("opened",!1===T.lcZ(6,30,Ce.isHandset$)),T.uIk("role",T.lcZ(4,26,Ce.isHandset$)?"dialog":"navigation"),T.xp6(10),T.Q6J("routerLink",Ce.isAdmin?"/turf-owner/turf-management":"/turf-list"),T.xp6(1),T.hij(" ",Ce.isAdmin?"ADD TURF":"SHOW TURFS"," "),T.xp6(2),T.Q6J("routerLink",Ce.isAdmin?"/turf-owner/manage-slots":"/user-profile/bookings"),T.xp6(1),T.hij(" ",Ce.isAdmin?"ADD SLOT":"MY BOOKINGS"," "),T.xp6(2),T.Q6J("routerLink",Ce.isAdmin?"turf-owner/wallet":"/user-profile/walllet"),T.xp6(1),T.hij(" ","WALLET"," "),T.xp6(2),T.Q6J("ngIf",Ce.isLoggedIn),T.xp6(3),T.Q6J("routerLink",Ce.isAdmin?"profile":"user-profile/user-details"),T.xp6(6),T.Q6J("ngIf",!Ce.isLoggedIn),T.xp6(3),T.Q6J("ngIf",T.lcZ(33,32,Ce.isHandset$)),T.xp6(6),T.Q6J("ngClass",T.VKq(38,Pe,!0===T.lcZ(39,34,Ce.isHandset$))),T.xp6(4),T.Q6J("routerLink",Ce.isAdmin?"/turf-owner/turf-management":"/turf-list"),T.xp6(1),T.hij(" ",Ce.isAdmin?"MANAGE TURF":"SHOW TURFS"," "),T.xp6(2),T.Q6J("routerLink",Ce.isAdmin?"/turf-owner/manage-slots":"/user-profile/bookings"),T.xp6(1),T.hij(" ",Ce.isAdmin?"ADD SLOT":"MY BOOKINGS"," "),T.xp6(2),T.Q6J("routerLink",Ce.isAdmin?"/turf-owner/wallet":"/user-profile/wallet"),T.xp6(1),T.hij(" ","WALLET"," "),T.xp6(2),T.Q6J("ngIf",Ce.isLoggedIn),T.xp6(3),T.Q6J("routerLink",Ce.isAdmin?"turf-owner/profile":"user-profile/user-details"),T.xp6(6),T.Q6J("ngIf",!Ce.isLoggedIn))},dependencies:[nt.mk,nt.O5,Fe.xw,Fe.SQ,dt.oO,zt.lW,zt.RK,Ht.Ye,ti.rH,ti.Od,lt.Hw,Bt.JX,Bt.TM,Bt.Rh,Jt.Hk,Jt.Tg,Xt.VK,Xt.OP,Xt.p6,nt.Ov],styles:[".sidenav-container[_ngcontent-%COMP%]{height:100%}.sidenav[_ngcontent-%COMP%]{width:200px}.sidenav[_ngcontent-%COMP%]   .mat-toolbar[_ngcontent-%COMP%]{background:inherit}mat-toolbar[_ngcontent-%COMP%]{position:sticky;top:0;z-index:1}.hidden[_ngcontent-%COMP%]{display:none}.spacer[_ngcontent-%COMP%]{flex:1 1 auto}.icon-size[_ngcontent-%COMP%]{transform:scale(2);color:#374957}button[_ngcontent-%COMP%]{text-decoration:none;color:#fff}.navigation-items[_ngcontent-%COMP%]{list-style-type:none;padding:0;margin:0}mat-toolbar[_ngcontent-%COMP%]{border-radius:3px}li[_ngcontent-%COMP%]:hover{border-radius:3px;background:#2FB563;color:#fff}.play-icon[_ngcontent-%COMP%]{color:#2fb563}.play-icon[_ngcontent-%COMP%]:hover, .menu-icon[_ngcontent-%COMP%]{color:#000}a[_ngcontent-%COMP%]{text-decoration:none;color:#fff}a[_ngcontent-%COMP%]:hover, a[_ngcontent-%COMP%]:active{color:#d3d3d3}.active[_ngcontent-%COMP%]{color:#fff;background-color:#2fb563}"]}),at})()},3361:(zn,Pi,Ne)=>{"use strict";Ne.d(Pi,{D:()=>lt});var T=Ne(5879),mt=Ne(7700),ai=Ne(6814),s=Ne(4170),M=Ne(2296),wt=Ne(5195),nt=Ne(6223);function Fe(Bt,Jt){1&Bt&&(T.TgZ(0,"mat-error"),T._uU(1," Name is required. "),T.qZA())}function dt(Bt,Jt){1&Bt&&(T.TgZ(0,"mat-error",21),T._uU(1," Enter a valid Name "),T.qZA())}function zt(Bt,Jt){1&Bt&&(T.TgZ(0,"div",21),T._uU(1," Email is required. "),T.qZA())}function Ht(Bt,Jt){1&Bt&&(T.TgZ(0,"div",21),T._uU(1," Enter a valid with 10 digits. "),T.qZA())}function ti(Bt,Jt){1&Bt&&(T.TgZ(0,"div",21),T._uU(1," Enter a valid age. "),T.qZA())}let lt=(()=>{var Bt;class Jt{constructor(ft){this.data=ft,this.cancelClicked=new T.vpe,this.saveProfile=new T.vpe}onCancel(){this.cancelClicked.emit()}onlySpacesValidator(ft){return""===ft.trim()?{onlySpaces:!0}:null}onSubmit(ft){ft.valid&&this.saveProfile.emit(ft.value)}}return(Bt=Jt).\u0275fac=function(ft){return new(ft||Bt)(T.Y36(mt.WI))},Bt.\u0275cmp=T.Xpm({type:Bt,selectors:[["app-profile-edit"]],outputs:{cancelClicked:"cancelClicked",saveProfile:"saveProfile"},decls:35,vars:10,consts:[[1,"container"],[1,"row"],[1,"col-md-6","col-lg-10","m-5","card-div"],[1,"example-card"],[1,"text-center"],[3,"ngSubmit"],["profileForm","ngForm"],[1,"form-control"],["for","name"],["type","text","id","name","name","name","required","","pattern","^\\S.{2,14}\\S$",3,"ngModel","ngModelChange"],[4,"ngIf"],["class","error-message",4,"ngIf"],["for","email"],["type","text","id","email","name","email","required","","email","",3,"ngModel","ngModelChange"],["for","Phone"],["type","text","id","Phone","name","Phone","required","","pattern","[0-9]{10}","onlySpaces","",3,"ngModel","ngModelChange"],["for","Age"],["type","text","id","Age","name","Age","required","","min","0","max","99","pattern","\\d{1,2}","onlySpaces","",3,"ngModel","ngModelChange"],["hidden","","type","text","id","id","name","id","required","",3,"ngModel","ngModelChange"],["type","submit","mat-raised-button","",1,"edit-button"],["type","button","mat-raised-button","",1,"cancel-button",3,"click"],[1,"error-message"]],template:function(ft,bt){if(1&ft){const Gt=T.EpF();T.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"mat-card",3)(4,"h2",4),T._uU(5," PROFILE "),T.qZA(),T.TgZ(6,"form",5,6),T.NdJ("ngSubmit",function(){T.CHM(Gt);const Qe=T.MAs(7);return T.KtG(bt.onSubmit(Qe))}),T.TgZ(8,"div",7)(9,"label",8),T._uU(10,"Name:"),T.qZA(),T.TgZ(11,"input",9),T.NdJ("ngModelChange",function(Qe){return bt.data.name=Qe}),T.qZA()(),T.YNc(12,Fe,2,0,"mat-error",10),T.YNc(13,dt,2,0,"mat-error",11),T.TgZ(14,"div",7)(15,"label",12),T._uU(16,"Email:"),T.qZA(),T.TgZ(17,"input",13),T.NdJ("ngModelChange",function(Qe){return bt.data.email=Qe}),T.qZA()(),T.YNc(18,zt,2,0,"div",11),T.TgZ(19,"div",7)(20,"label",14),T._uU(21,"Phone:"),T.qZA(),T.TgZ(22,"input",15),T.NdJ("ngModelChange",function(Qe){return bt.data.phone=Qe}),T.qZA()(),T.YNc(23,Ht,2,0,"div",11),T.TgZ(24,"div",7)(25,"label",16),T._uU(26,"Age:"),T.qZA(),T.TgZ(27,"input",17),T.NdJ("ngModelChange",function(Qe){return bt.data.age=Qe}),T.qZA()(),T.YNc(28,ti,2,0,"div",11),T.TgZ(29,"input",18),T.NdJ("ngModelChange",function(Qe){return bt.data._id=Qe}),T.qZA(),T.TgZ(30,"mat-card-actions")(31,"button",19),T._uU(32," SAVE "),T.qZA(),T.TgZ(33,"button",20),T.NdJ("click",function(){return bt.onCancel()}),T._uU(34," CANCEL "),T.qZA()()()()()()()}if(2&ft){const Gt=T.MAs(7);T.xp6(11),T.Q6J("ngModel",bt.data.name),T.xp6(1),T.Q6J("ngIf",null==Gt.controls.name.errors?null:Gt.controls.name.errors.required),T.xp6(1),T.Q6J("ngIf",null==Gt.controls.name.errors?null:Gt.controls.name.errors.pattern),T.xp6(4),T.Q6J("ngModel",bt.data.email),T.xp6(1),T.Q6J("ngIf",Gt.controls.email.invalid),T.xp6(4),T.Q6J("ngModel",bt.data.phone),T.xp6(1),T.Q6J("ngIf",Gt.controls.Phone.invalid),T.xp6(4),T.Q6J("ngModel",bt.data.age),T.xp6(1),T.Q6J("ngIf",Gt.controls.Age.touched&&Gt.controls.Age.invalid),T.xp6(1),T.Q6J("ngModel",bt.data._id)}},dependencies:[ai.O5,s.TO,M.lW,wt.a8,wt.hq,nt._Y,nt.Fj,nt.JJ,nt.JL,nt.Q7,nt.c5,nt.on,nt.On,nt.F],styles:[".edit-button[_ngcontent-%COMP%]{width:50%;color:#fff;background-color:green;margin-right:1rem}.cancel-button[_ngcontent-%COMP%]{width:50%;background-color:red;color:#fff}.form-control[_ngcontent-%COMP%]{width:100%;display:flex}label[_ngcontent-%COMP%]{width:25%}input[_ngcontent-%COMP%]{border-radius:5px;color:#000}.error-message[_ngcontent-%COMP%]{color:red;text-align:center}"]}),Jt})()},3236:(zn,Pi,Ne)=>{"use strict";Ne.d(Pi,{d:()=>wt});var T=Ne(5879),mt=Ne(4170),ai=Ne(2296),s=Ne(5195),M=Ne(4190);let wt=(()=>{var nt;class Fe{constructor(){this.Edit=new T.vpe,this.profileData={name:"",age:0,phone:"",email:"",location:{address:"",long:"",lat:""},_id:"",wallet:0}}onEditUser(zt){this.Edit.emit(zt)}}return(nt=Fe).\u0275fac=function(zt){return new(zt||nt)},nt.\u0275cmp=T.Xpm({type:nt,selectors:[["app-profile"]],inputs:{profileData:"profileData"},outputs:{Edit:"Edit"},decls:27,vars:4,consts:[[1,"container"],[1,"row","ml-5"],[1,"col-md-10","col-lg-10","m-5","card-div"],[1,"example-card"],[1,"text-center"],["mat-button","","disabled","",1,"full-width"],["routerLink","/book-turf",1,"text-primary"],["mat-raised-button","",1,"edit-button","text-center",3,"click"]],template:function(zt,Ht){1&zt&&(T.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"mat-card",3)(4,"mat-card-title",4),T._uU(5," PROFILE "),T.qZA(),T.TgZ(6,"mat-label"),T._uU(7," Name : "),T.TgZ(8,"button",5),T._uU(9),T.qZA()(),T.TgZ(10,"mat-label"),T._uU(11," Phone : "),T.TgZ(12,"button",5),T._uU(13),T.qZA()(),T.TgZ(14,"mat-label"),T._uU(15,"Email : "),T.TgZ(16,"button",5),T._uU(17),T.qZA(),T.TgZ(18,"a",6),T._uU(19,"Verify"),T.qZA()(),T.TgZ(20,"mat-label"),T._uU(21,"Age : "),T.TgZ(22,"button",5),T._uU(23),T.qZA()(),T.TgZ(24,"mat-card-actions")(25,"button",7),T.NdJ("click",function(){return Ht.onEditUser(Ht.profileData)}),T._uU(26,"EDIT"),T.qZA()()()()()()),2&zt&&(T.xp6(9),T.hij(" ",Ht.profileData.name,""),T.xp6(4),T.Oqu(Ht.profileData.phone),T.xp6(4),T.Oqu(Ht.profileData.email),T.xp6(6),T.hij("",Ht.profileData.age," "))},dependencies:[mt.hX,ai.lW,s.a8,s.hq,s.n5,M.rH],styles:[".example-card[_ngcontent-%COMP%]{justify-content:center;text-align:justify;padding:3rem;width:90%;box-shadow:0 0 10px #2fb56380}.card-div[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center}.full-width[_ngcontent-%COMP%]{color:#000!important;-webkit-text-decoration:wavy!important;text-decoration:wavy!important}.edit-button[_ngcontent-%COMP%]{width:100%;padding-left:25%;padding-right:25%;background-color:#2fb563!important;color:#fff!important}[_ngcontent-%COMP%]:hover.edit-button{background-color:#fff!important;color:#2fb563!important}"]}),Fe})()},1277:(zn,Pi,Ne)=>{"use strict";Ne.d(Pi,{X:()=>Je});var T=Ne(5879),mt=Ne(6223),ai=Ne(6002),s=Ne(8440),M=Ne(6814),wt=Ne(3814),nt=Ne(2032),Fe=Ne(4170),dt=Ne(2296),zt=Ne(5195),Ht=Ne(1274),ti=Ne(4190);function lt(Ce,Ue){1&Ce&&(T.TgZ(0,"mat-error"),T._uU(1,"Name is required"),T.qZA())}function Bt(Ce,Ue){1&Ce&&(T.TgZ(0,"mat-error"),T._uU(1,"Name is required"),T.qZA())}function Jt(Ce,Ue){1&Ce&&(T.TgZ(0,"mat-error"),T._uU(1," Only spaces cannot be allowed "),T.qZA())}function Xt(Ce,Ue){1&Ce&&(T.TgZ(0,"mat-error"),T._uU(1," Email is required "),T.qZA())}function ft(Ce,Ue){1&Ce&&(T.TgZ(0,"mat-error"),T._uU(1," Enter a valid email "),T.qZA())}function bt(Ce,Ue){1&Ce&&(T.TgZ(0,"mat-error"),T._uU(1," Only spaces cannot be allowed "),T.qZA())}function Gt(Ce,Ue){1&Ce&&(T.TgZ(0,"mat-error"),T._uU(1,"Phone is required"),T.qZA())}function Tt(Ce,Ue){1&Ce&&(T.TgZ(0,"mat-error"),T._uU(1,"Enter a valid phone number "),T.qZA())}function Qe(Ce,Ue){1&Ce&&(T.TgZ(0,"mat-error"),T._uU(1,"Only spaces cannot be allowed "),T.qZA())}function Pe(Ce,Ue){1&Ce&&(T.TgZ(0,"mat-error"),T._uU(1," Password is required "),T.qZA())}function ui(Ce,Ue){1&Ce&&(T.TgZ(0,"mat-error"),T._uU(1,"Password should be atlesat 8 characters long"),T.qZA())}function rt(Ce,Ue){1&Ce&&(T.TgZ(0,"mat-error"),T._uU(1,"Only spaces cannot be allowed "),T.qZA())}function De(Ce,Ue){if(1&Ce&&(T.TgZ(0,"mat-error")(1,"p"),T._uU(2),T.qZA()()),2&Ce){const Ee=T.oxw();T.xp6(2),T.Oqu(Ee.errorMessage)}}function at(Ce,Ue){1&Ce&&(T.ynx(0),T.TgZ(1,"div",14),T._uU(2," Already have an account "),T.TgZ(3,"a",15),T._uU(4," Login "),T.qZA(),T._uU(5," here. "),T.qZA(),T.TgZ(6,"div",16),T._uU(7," You're TurfAdmin "),T.TgZ(8,"a",17),T._uU(9," Login"),T.qZA(),T._uU(10,"here. "),T.qZA(),T.BQk())}function Ie(Ce,Ue){1&Ce&&(T.TgZ(0,"div",18),T._uU(1," Already have an account "),T.TgZ(2,"a",17),T._uU(3,"Login"),T.qZA(),T._uU(4," here. "),T.qZA(),T.TgZ(5,"div",16),T._uU(6," If you're a user "),T.TgZ(7,"a",15),T._uU(8,"Login "),T.qZA(),T._uU(9,"here. "),T.qZA())}let Je=(()=>{var Ce;class Ue{constructor(Me,st){this.formBuilder=Me,this.firebaseService=st,this.formData=new T.vpe}ngOnInit(){this.signupForm=this.formBuilder.group({userName:["",[mt.kI.required,mt.kI.minLength(4),ai.o]],email:["",[mt.kI.required,mt.kI.email,ai.o]],phone:["",[mt.kI.required,mt.kI.pattern(/^\d{10}$/),ai.o]],password:["",[mt.kI.required,mt.kI.minLength(8),ai.o]]})}onSubmit(){if(this.signupForm.valid){const Me={userName:this.signupForm.get("userName")?.value,email:this.signupForm.get("email")?.value,phone:this.signupForm.get("phone")?.value,password:this.signupForm.get("password")?.value,age:null};this.formData.emit(Me)}}}return(Ce=Ue).\u0275fac=function(Me){return new(Me||Ce)(T.Y36(mt.qu),T.Y36(s.O))},Ce.\u0275cmp=T.Xpm({type:Ce,selectors:[["app-signup"]],inputs:{errorMessage:"errorMessage",typeofUser:"typeofUser"},outputs:{formData:"formData"},decls:40,vars:17,consts:[["fxLayoutAlign","center center","fxFlexFill","",1,"main-div"],["fxFlex","45",1,"container","box-shadow","mt-5","mb-5"],[1,"text-center","toolbar","mt-5","mb-5"],[1,"text-white"],["fxLayoutAlign","stretch","fxLayout","column",1,"login-form",3,"formGroup","submit"],["appearance","fill"],["matInput","","placeholder","Name","formControlName","userName"],[4,"ngIf"],["matInput","","placeholder","Email","formControlName","email"],["matInput","","placeholder","Phone","formControlName","phone"],["type","password","matInput","","placeholder","Password","formControlName","password"],["type","submit","mat-raised-button",""],[4,"ngIf","ngIfElse"],["elseTemplate",""],[1,"mt-3","text-center","sign-up"],["routerLink","/login"],[1,"mb-5","text-center","sign-up"],["routerLink","/turf-owner/login"],[1,"mt-3","text-center"]],template:function(Me,st){if(1&Me&&(T.TgZ(0,"div",0)(1,"mat-card",1)(2,"mat-toolbar",2)(3,"span",3),T._uU(4),T.qZA()(),T.TgZ(5,"form",4),T.NdJ("submit",function(){return st.onSubmit()}),T.TgZ(6,"mat-form-field",5)(7,"mat-label"),T._uU(8,"Name"),T.qZA(),T._UZ(9,"input",6),T.YNc(10,lt,2,0,"mat-error",7),T.YNc(11,Bt,2,0,"mat-error",7),T.YNc(12,Jt,2,0,"mat-error",7),T.qZA(),T.TgZ(13,"mat-form-field",5)(14,"mat-label"),T._uU(15,"Email"),T.qZA(),T._UZ(16,"input",8),T.YNc(17,Xt,2,0,"mat-error",7),T.YNc(18,ft,2,0,"mat-error",7),T.YNc(19,bt,2,0,"mat-error",7),T.qZA(),T.TgZ(20,"mat-form-field",5)(21,"mat-label"),T._uU(22,"Phone"),T.qZA(),T._UZ(23,"input",9),T.YNc(24,Gt,2,0,"mat-error",7),T.YNc(25,Tt,2,0,"mat-error",7),T.YNc(26,Qe,2,0,"mat-error",7),T.qZA(),T.TgZ(27,"mat-form-field",5)(28,"mat-label"),T._uU(29,"Password"),T.qZA(),T._UZ(30,"input",10),T.YNc(31,Pe,2,0,"mat-error",7),T.YNc(32,ui,2,0,"mat-error",7),T.YNc(33,rt,2,0,"mat-error",7),T.qZA(),T.YNc(34,De,3,1,"mat-error",7),T.TgZ(35,"button",11),T._uU(36," Submit "),T.qZA()(),T.YNc(37,at,11,0,"ng-container",12),T.YNc(38,Ie,10,0,"ng-template",null,13,T.W1O),T.qZA()()),2&Me){const jt=T.MAs(39);let Pt,Mt,Dt,Qt,zi,ji,Ln,hn,$t,yt,en,Di;T.xp6(4),T.hij(" ",st.typeofUser," SIGN UP "),T.xp6(1),T.Q6J("formGroup",st.signupForm),T.xp6(5),T.Q6J("ngIf",null==(Pt=st.signupForm.get("userName"))?null:Pt.hasError("required")),T.xp6(1),T.Q6J("ngIf",null==(Mt=st.signupForm.get("userName"))?null:Mt.hasError("minlLength")),T.xp6(1),T.Q6J("ngIf",null==(Dt=st.signupForm.get("userName"))?null:Dt.hasError("onlySpaces")),T.xp6(5),T.Q6J("ngIf",null==(Qt=st.signupForm.get("email"))?null:Qt.hasError("required")),T.xp6(1),T.Q6J("ngIf",null==(zi=st.signupForm.get("email"))?null:zi.hasError("email")),T.xp6(1),T.Q6J("ngIf",null==(ji=st.signupForm.get("email"))?null:ji.hasError("onlySpaces")),T.xp6(5),T.Q6J("ngIf",null==(Ln=st.signupForm.get("phone"))?null:Ln.hasError("required")),T.xp6(1),T.Q6J("ngIf",null==(hn=st.signupForm.get("phone"))?null:hn.hasError("pattern")),T.xp6(1),T.Q6J("ngIf",null==($t=st.signupForm.get("phone"))?null:$t.hasError("onlySpaces")),T.xp6(5),T.Q6J("ngIf",null==(yt=st.signupForm.get("password"))?null:yt.hasError("required")),T.xp6(1),T.Q6J("ngIf",null==(en=st.signupForm.get("passsword"))?null:en.hasError("minLength")),T.xp6(1),T.Q6J("ngIf",null==(Di=st.signupForm.get("passsword"))?null:Di.hasError("onlySpaces")),T.xp6(1),T.Q6J("ngIf",st.errorMessage),T.xp6(3),T.Q6J("ngIf","User"==st.typeofUser)("ngIfElse",jt)}},dependencies:[M.O5,wt.xw,wt.Wh,wt.s9,wt.yH,nt.Nt,Fe.KE,Fe.hX,Fe.TO,dt.lW,zt.a8,Ht.Ye,mt._Y,mt.Fj,mt.JJ,mt.JL,mt.sg,mt.u,ti.rH],styles:[".toolbar[_ngcontent-%COMP%]{border-radius:5px;background:#0f0f0f}.box-shadow[_ngcontent-%COMP%]{background-color:#aeeac5;border-radius:5px;border:1px solid #ccc;box-shadow:#0006 -5px 5px,}"]}),Ue})()},339:(zn,Pi,Ne)=>{"use strict";Ne.d(Pi,{c:()=>lt});var T=Ne(5879),s=(Ne(1718),Ne(15),Ne(6814)),M=Ne(3814),wt=Ne(2296),nt=Ne(5195),Fe=Ne(1274),dt=Ne(6223),zt=Ne(6642);function Ht(Bt,Jt){if(1&Bt&&(T.ynx(0),T.TgZ(1,"p",8),T._uU(2),T.qZA(),T.BQk()),2&Bt){const Xt=T.oxw();T.xp6(2),T.Oqu(Xt.getError)}}const ti=function(){return{length:6,allowNumbersOnly:!0}};let lt=(()=>{var Bt;class Jt{constructor(){this.OTP=new T.vpe}onOtpChange(ft){this.otpCode=ft}onSubmit(ft){ft.preventDefault(),this.OTP.emit(this.otpCode),console.log(this.getError)}}return(Bt=Jt).\u0275fac=function(ft){return new(ft||Bt)},Bt.\u0275cmp=T.Xpm({type:Bt,selectors:[["app-verify-otp"]],inputs:{getError:"getError"},outputs:{OTP:"OTP"},decls:12,vars:3,consts:[["fxLayoutAlign","center center","fxFlexFill","",1,"main-div"],["fxFlex","48"],["color","primary",1,"flex-center"],["fxLayoutAlign","stretch","fxLayout","column",1,"login-form",3,"submit"],[1,"mat-body-1","text-center"],[1,"text-center",3,"config","onInputChange"],["type","submit","mat-raised-button","","color","accent"],[4,"ngIf"],[1,"text-center","text-danger","mt-3"]],template:function(ft,bt){1&ft&&(T.TgZ(0,"div",0)(1,"mat-card",1)(2,"mat-toolbar",2)(3,"p"),T._uU(4,"Verify OTP "),T.qZA()(),T.TgZ(5,"form",3),T.NdJ("submit",function(Tt){return bt.onSubmit(Tt)}),T.TgZ(6,"p",4),T._uU(7,"Please enter the OTP sent to your Phone "),T.qZA(),T.TgZ(8,"ng-otp-input",5),T.NdJ("onInputChange",function(Tt){return bt.onOtpChange(Tt)}),T.qZA(),T.TgZ(9,"button",6),T._uU(10," Verify "),T.qZA()(),T.YNc(11,Ht,3,1,"ng-container",7),T.qZA()()),2&ft&&(T.xp6(8),T.Q6J("config",T.DdM(2,ti)),T.xp6(3),T.Q6J("ngIf",bt.getError))},dependencies:[s.O5,M.xw,M.Wh,M.s9,M.yH,wt.lW,nt.a8,Fe.Ye,dt._Y,dt.JL,zt.df,dt.F],styles:[".text-center[_ngcontent-%COMP%]{text-align:center;margin-bottom:1rem}.flex-center[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;border-radius:5px}.main-div[_ngcontent-%COMP%]{background:#000000}"]}),Jt})()},9020:(zn,Pi,Ne)=>{"use strict";Ne.d(Pi,{f:()=>ai});var T=Ne(5879),mt=Ne(9862);let ai=(()=>{var s;class M{constructor(nt){this.http=nt}getDirection(nt,Fe){return console.log(nt,Fe),this.http.get(`https://api.mapbox.com/directions/v5/mapbox/driving/${nt};${Fe}?access_token=pk.eyJ1IjoiaGFmaXphaG1lZCIsImEiOiJjbHA3dTR6aHcyZnFiMmlubDl5Nmk4czg0In0.ovDRjWjrKqgwPu7tMeZq9w`)}getAdress(nt,Fe){return this.http.get(`https://api.mapbox.com/geocoding/v5/mapbox.places/${nt}, ${Fe}.json?types=address&access_token=pk.eyJ1IjoiaGFmaXphaG1lZCIsImEiOiJjbHA3dTR6aHcyZnFiMmlubDl5Nmk4czg0In0.ovDRjWjrKqgwPu7tMeZq9w`)}}return(s=M).\u0275fac=function(nt){return new(nt||s)(T.LFG(mt.eN))},s.\u0275prov=T.Yz7({token:s,factory:s.\u0275fac,providedIn:"root"}),M})()},9827:function(zn,Pi){var T;!function(mt){"use strict";var ai=":not(:disabled):not(.ajs-reset)",M={autoReset:!0,basic:!1,closable:!0,closableByDimmer:!0,invokeOnCloseOff:!1,frameless:!1,defaultFocusOff:!1,maintainFocus:!0,maximizable:!0,modal:!0,movable:!0,moveBounded:!1,overflow:!0,padding:!0,pinnable:!0,pinned:!0,preventBodyShift:!1,resizable:!0,startMaximized:!1,transition:"pulse",transitionOff:!1,tabbable:["button","[href]","input","select","textarea",'[tabindex]:not([tabindex^="-"])'+ai].join(ai+","),notifier:{delay:5,position:"bottom-right",closeButton:!1,classes:{base:"alertify-notifier",prefix:"ajs-",message:"ajs-message",top:"ajs-top",right:"ajs-right",bottom:"ajs-bottom",left:"ajs-left",center:"ajs-center",visible:"ajs-visible",hidden:"ajs-hidden",close:"ajs-close"}},glossary:{title:"AlertifyJS",ok:"OK",cancel:"Cancel",acccpt:"Accept",deny:"Deny",confirm:"Confirm",decline:"Decline",close:"Close",maximize:"Maximize",restore:"Restore"},theme:{input:"ajs-input",ok:"ajs-ok",cancel:"ajs-cancel"},hooks:{preinit:function(){},postinit:function(){}}},wt=[];function nt(Ie,Je){Ie.className+=" "+Je}function Fe(Ie,Je){for(var Ce=Ie.className.split(" "),Ue=Je.split(" "),Ee=0;Ee<Ue.length;Ee+=1){var Me=Ce.indexOf(Ue[Ee]);Me>-1&&Ce.splice(Me,1)}Ie.className=Ce.join(" ")}function dt(){return"rtl"===mt.getComputedStyle(document.body).direction}function zt(){return document.documentElement&&document.documentElement.scrollTop||document.body.scrollTop}function Ht(){return document.documentElement&&document.documentElement.scrollLeft||document.body.scrollLeft}function ti(Ie){for(;Ie.lastChild;)Ie.removeChild(Ie.lastChild)}function lt(Ie){if(null===Ie)return Ie;var Je;if(Array.isArray(Ie)){Je=[];for(var Ce=0;Ce<Ie.length;Ce+=1)Je.push(lt(Ie[Ce]));return Je}if(Ie instanceof Date)return new Date(Ie.getTime());if(Ie instanceof RegExp)return(Je=new RegExp(Ie.source)).global=Ie.global,Je.ignoreCase=Ie.ignoreCase,Je.multiline=Ie.multiline,Je.lastIndex=Ie.lastIndex,Je;if("object"==typeof Ie){for(var Ue in Je={},Ie)Ie.hasOwnProperty(Ue)&&(Je[Ue]=lt(Ie[Ue]));return Je}return Ie}function Bt(Ie,Je){if(Ie.elements){var Ce=Ie.elements.root;Ce.parentNode.removeChild(Ce),delete Ie.elements,Ie.settings=lt(Ie.__settings),Ie.__init=Je,delete Ie.__internal}}var Jt=!1;try{var Xt=Object.defineProperty({},"passive",{get:function(){Jt=!0}});mt.addEventListener("test",Xt,Xt),mt.removeEventListener("test",Xt,Xt)}catch{}var ft=function(Ie,Je,Ce,Ue,Ee){Ie.addEventListener(Je,Ce,Jt?{capture:Ue,passive:Ee}:!0===Ue)},bt=function(Ie,Je,Ce,Ue,Ee){Ie.removeEventListener(Je,Ce,Jt?{capture:Ue,passive:Ee}:!0===Ue)},Gt=function(){var Ie,Je,Ce=!1,Ue={animation:"animationend",OAnimation:"oAnimationEnd oanimationend",msAnimation:"MSAnimationEnd",MozAnimation:"animationend",WebkitAnimation:"webkitAnimationEnd"};for(Ie in Ue)if(void 0!==document.documentElement.style[Ie]){Je=Ue[Ie],Ce=!0;break}return{type:Je,supported:Ce}}();function Tt(Ie,Je){return function(){if(arguments.length>0){for(var Ce=[],Ue=0;Ue<arguments.length;Ue+=1)Ce.push(arguments[Ue]);return Ce.push(Ie),Je.apply(Ie,Ce)}return Je.apply(Ie,[null,Ie])}}function Qe(Ie,Je){return{index:Ie,button:Je,cancel:!1}}function Pe(Ie,Je){if("function"==typeof Je.get(Ie))return Je.get(Ie).call(Je)}var ui=function(){var jt,Pt,Ie=[],Ce=!1,Ue=mt.navigator.userAgent.indexOf("Safari")>-1&&mt.navigator.userAgent.indexOf("Chrome")<0,Ee_reset='<button class="ajs-reset"></button>',Ee_buttons_primary='<div class="ajs-primary ajs-buttons"></div>',Ee_buttons_auxiliary='<div class="ajs-auxiliary ajs-buttons"></div>',Me={animationIn:"ajs-in",animationOut:"ajs-out",base:"alertify",basic:"ajs-basic",capture:"ajs-capture",closable:"ajs-closable",fixed:"ajs-fixed",frameless:"ajs-frameless",hidden:"ajs-hidden",maximize:"ajs-maximize",maximized:"ajs-maximized",maximizable:"ajs-maximizable",modeless:"ajs-modeless",movable:"ajs-movable",noSelection:"ajs-no-selection",noOverflow:"ajs-no-overflow",noPadding:"ajs-no-padding",pin:"ajs-pin",pinnable:"ajs-pinnable",prefix:"ajs-",resizable:"ajs-resizable",restore:"ajs-restore",shake:"ajs-shake",unpinned:"ajs-unpinned",noTransition:"ajs-no-transition"};function st(F){if(!F.__internal){var R;at.defaults.hooks.preinit(F),delete F.__init,F.__settings||(F.__settings=lt(F.settings)),"function"==typeof F.setup?((R=F.setup()).options=R.options||{},R.focus=R.focus||{}):R={buttons:[],focus:{element:null,select:!1},options:{}},"object"!=typeof F.hooks&&(F.hooks={});var ie=[];if(Array.isArray(R.buttons))for(var q=0;q<R.buttons.length;q+=1){var b=R.buttons[q],I={};for(var z in b)b.hasOwnProperty(z)&&(I[z]=b[z]);ie.push(I)}var W=F.__internal={isOpen:!1,activeElement:document.body,timerIn:void 0,timerOut:void 0,buttons:ie,focus:R.focus,options:{title:void 0,modal:void 0,basic:void 0,frameless:void 0,defaultFocusOff:void 0,pinned:void 0,movable:void 0,moveBounded:void 0,resizable:void 0,autoReset:void 0,closable:void 0,closableByDimmer:void 0,invokeOnCloseOff:void 0,maximizable:void 0,startMaximized:void 0,pinnable:void 0,transition:void 0,transitionOff:void 0,padding:void 0,overflow:void 0,onshow:void 0,onclosing:void 0,onclose:void 0,onfocus:void 0,onmove:void 0,onmoved:void 0,onresize:void 0,onresized:void 0,onmaximize:void 0,onmaximized:void 0,onrestore:void 0,onrestored:void 0},resetHandler:void 0,beginMoveHandler:void 0,beginResizeHandler:void 0,bringToFrontHandler:void 0,modalClickHandler:void 0,buttonsClickHandler:void 0,commandsClickHandler:void 0,transitionInHandler:void 0,transitionOutHandler:void 0,destroy:void 0},se={};se.root=document.createElement("div"),se.root.style.display="none",se.root.className=Me.base+" "+Me.hidden+" ",se.root.innerHTML='<div class="ajs-dimmer"></div><div class="ajs-modal" tabindex="0"></div>',se.dimmer=se.root.firstChild,se.modal=se.root.lastChild,se.modal.innerHTML='<div class="ajs-dialog" tabindex="0"></div>',se.dialog=se.modal.firstChild,se.dialog.innerHTML=Ee_reset+'<div class="ajs-commands"><button class="ajs-pin"></button><button class="ajs-maximize"></button><button class="ajs-close"></button></div><div class="ajs-header"></div><div class="ajs-body"></div><div class="ajs-footer"></div><div class="ajs-handle"></div>'+Ee_reset,se.reset=[],se.reset.push(se.dialog.firstChild),se.reset.push(se.dialog.lastChild),se.commands={},se.commands.container=se.reset[0].nextSibling,se.commands.pin=se.commands.container.firstChild,se.commands.maximize=se.commands.pin.nextSibling,se.commands.close=se.commands.maximize.nextSibling,se.header=se.commands.container.nextSibling,se.body=se.header.nextSibling,se.body.innerHTML='<div class="ajs-content"></div>',se.content=se.body.firstChild,se.footer=se.body.nextSibling,se.footer.innerHTML=Ee_buttons_auxiliary+Ee_buttons_primary,se.resizeHandle=se.footer.nextSibling,se.buttons={},se.buttons.auxiliary=se.footer.firstChild,se.buttons.primary=se.buttons.auxiliary.nextSibling,se.buttons.primary.innerHTML='<button class="ajs-button"></button>',se.buttonTemplate=se.buttons.primary.firstChild,se.buttons.primary.removeChild(se.buttonTemplate);for(var _t=0;_t<F.__internal.buttons.length;_t+=1){var Kt=F.__internal.buttons[_t];for(var At in Ie.indexOf(Kt.key)<0&&Ie.push(Kt.key),Kt.element=se.buttonTemplate.cloneNode(),Kt.element.innerHTML=Kt.text,"string"==typeof Kt.className&&""!==Kt.className&&nt(Kt.element,Kt.className),Kt.attrs)"className"!==At&&Kt.attrs.hasOwnProperty(At)&&Kt.element.setAttribute(At,Kt.attrs[At]);"auxiliary"===Kt.scope?se.buttons.auxiliary.appendChild(Kt.element):se.buttons.primary.appendChild(Kt.element)}for(var mi in F.elements=se,W.resetHandler=Tt(F,O),W.beginMoveHandler=Tt(F,Ut),W.beginResizeHandler=Tt(F,Ja),W.bringToFrontHandler=Tt(F,lr),W.modalClickHandler=Tt(F,$n),W.buttonsClickHandler=Tt(F,Un),W.commandsClickHandler=Tt(F,wn),W.transitionInHandler=Tt(F,re),W.transitionOutHandler=Tt(F,ue),W.options)void 0!==R.options[mi]?F.set(mi,R.options[mi]):at.defaults.hasOwnProperty(mi)?F.set(mi,at.defaults[mi]):"title"===mi&&F.set(mi,at.defaults.glossary[mi]);"function"==typeof F.build&&F.build(),at.defaults.hooks.postinit(F)}document.body.appendChild(F.elements.root)}function Dt(){mt.scrollTo(jt,Pt)}function Qt(){for(var F=0,R=0;R<wt.length;R+=1){var ie=wt[R];(ie.isModal()||ie.isMaximized())&&(F+=1)}0===F&&document.body.className.indexOf(Me.noOverflow)>=0?(Fe(document.body,Me.noOverflow),Ln(!1)):F>0&&document.body.className.indexOf(Me.noOverflow)<0&&(Ln(!0),nt(document.body,Me.noOverflow))}var zi="",ji=0;function Ln(F){at.defaults.preventBodyShift&&(F&&document.documentElement.scrollHeight>document.documentElement.clientHeight?(ji=Pt,zi=mt.getComputedStyle(document.body).top,nt(document.body,Me.fixed),document.body.style.top=-Pt+"px"):F||(Pt=ji,document.body.style.top=zi,Fe(document.body,Me.fixed),Dt()))}function lr(F,R){for(var q=wt.indexOf(R)+1;q<wt.length;q+=1)if(wt[q].isModal())return;return document.body.lastChild!==R.elements.root&&(document.body.appendChild(R.elements.root),wt.splice(wt.indexOf(R),1),wt.push(R),Q(R)),!1}function qi(F,R,ie,q,b){var z,I={op:void 0,items:[]};if(typeof b>"u"&&"string"==typeof q)I.op="get",R.hasOwnProperty(q)?(I.found=!0,I.value=R[q]):(I.found=!1,I.value=void 0);else if(I.op="set","object"==typeof q){var W=q;for(var se in W)R.hasOwnProperty(se)?(R[se]!==W[se]&&(z=R[se],R[se]=W[se],ie.call(F,se,z,W[se])),I.items.push({key:se,value:W[se],found:!0})):I.items.push({key:se,value:W[se],found:!1})}else{if("string"!=typeof q)throw new Error("args must be a string or object");R.hasOwnProperty(q)?(R[q]!==b&&(z=R[q],R[q]=b,ie.call(F,q,z,b)),I.items.push({key:q,value:b,found:!0})):I.items.push({key:q,value:b,found:!1})}return I}function bn(F){var R;Fn(F,function(ie){return R=!0!==F.get("invokeOnCloseOff")&&!0===ie.invokeOnClose}),!R&&F.isOpen()&&F.close()}function wn(F,R){switch(F.srcElement||F.target){case R.elements.commands.pin:R.isPinned()?Gn(R):tn(R);break;case R.elements.commands.maximize:R.isMaximized()?En(R):Rn(R);break;case R.elements.commands.close:bn(R)}return!1}function tn(F){F.set("pinned",!0)}function Gn(F){F.set("pinned",!1)}function Rn(F){Pe("onmaximize",F),nt(F.elements.root,Me.maximized),F.isOpen()&&Qt(),Pe("onmaximized",F)}function En(F){Pe("onrestore",F),Fe(F.elements.root,Me.maximized),F.isOpen()&&Qt(),Pe("onrestored",F)}function Li(F){var R=Ht();F.elements.modal.style.marginTop=zt()+"px",F.elements.modal.style.marginLeft=R+"px",F.elements.modal.style.marginRight=-R+"px"}function mn(F){var R=parseInt(F.elements.modal.style.marginTop,10),ie=parseInt(F.elements.modal.style.marginLeft,10);if(F.elements.modal.style.marginTop="",F.elements.modal.style.marginLeft="",F.elements.modal.style.marginRight="",F.isOpen()){var q=0,b=0;""!==F.elements.dialog.style.top&&(q=parseInt(F.elements.dialog.style.top,10)),F.elements.dialog.style.top=q+(R-zt())+"px",""!==F.elements.dialog.style.left&&(b=parseInt(F.elements.dialog.style.left,10)),F.elements.dialog.style.left=b+(ie-Ht())+"px"}}function fr(F){F.get("modal")||F.get("pinned")?mn(F):Li(F)}var Bn=!1,gr=0;function $n(F,R){if(F.timeStamp-gr>200&&(gr=F.timeStamp)&&!Bn){var ie=F.srcElement||F.target;!0===R.get("closableByDimmer")&&ie===R.elements.modal&&bn(R)}Bn=!1}var Wn=0,_n=!1;function Fn(F,R){if(Date.now()-Wn>200&&(Wn=Date.now()))for(var ie=0;ie<F.__internal.buttons.length;ie+=1){var q=F.__internal.buttons[ie];if(!q.element.disabled&&R(q)){var b=Qe(ie,q);"function"==typeof F.callback&&F.callback.apply(F,[b]),!1===b.cancel&&F.close();break}}}function Un(F,R){var ie=F.srcElement||F.target;Fn(R,function(q){return q.element===ie&&(_n=!0)})}function Hn(F){if(!_n){var R=wt[wt.length-1],ie=F.keyCode;return 0===R.__internal.buttons.length&&27===ie&&!0===R.get("closable")?(bn(R),!1):Ie.indexOf(ie)>-1?(Fn(R,function(q){return q.key===ie}),!1):void 0}_n=!1}function $i(F){var R=wt[wt.length-1],ie=F.keyCode;if(37===ie||39===ie){for(var q=R.__internal.buttons,b=0;b<q.length;b+=1)if(document.activeElement===q[b].element)switch(ie){case 37:return void q[(b||q.length)-1].element.focus();case 39:return void q[(b+1)%q.length].element.focus()}}else if(ie<124&&ie>111&&Ie.indexOf(ie)>-1)return F.preventDefault(),F.stopPropagation(),Fn(R,function(I){return I.key===ie}),!1}function Q(F,R){if(R)R.focus();else{var ie=F.__internal.focus,q=ie.element;switch(typeof ie.element){case"number":F.__internal.buttons.length>ie.element&&(q=!0===F.get("basic")?F.elements.reset[0]:F.__internal.buttons[ie.element].element);break;case"string":q=F.elements.body.querySelector(ie.element);break;case"function":q=ie.element.call(F)}(!0===F.get("defaultFocusOff")||(typeof q>"u"||null===q)&&0===F.__internal.buttons.length)&&(q=F.elements.reset[0]),q&&q.focus&&(q.focus(),ie.select&&q.select&&q.select())}}function O(F,R){if(!R)for(var ie=wt.length-1;ie>-1;ie-=1)if(wt[ie].isModal()){R=wt[ie];break}if(R&&R.isModal()){var se,q=R.elements.reset[0],b=R.elements.reset[1],I=F.relatedTarget,z=R.elements.root.contains(I),W=F.srcElement||F.target;if(W===q&&!z||W===b&&I===q)return;W===b||W===document.body?se=q:W===q&&I===b?se=B(R):W===q&&z&&(se=B(R,!0)),Q(R,se)}}function B(F,R){var ie=[].slice.call(F.elements.dialog.querySelectorAll(M.tabbable));R&&ie.reverse();for(var q=0;q<ie.length;q+=1){var b=ie[q];if(b.offsetParent||b.offsetWidth||b.offsetHeight||b.getClientRects().length)return b}}function K(F){var R=wt[wt.length-1];R&&F.shiftKey&&9===F.keyCode&&R.elements.reset[1].focus()}function re(F,R){clearTimeout(R.__internal.timerIn),Q(R),_n=!1,Pe("onfocus",R),bt(R.elements.dialog,Gt.type,R.__internal.transitionInHandler),Fe(R.elements.root,Me.animationIn)}function ue(F,R){clearTimeout(R.__internal.timerOut),bt(R.elements.dialog,Gt.type,R.__internal.transitionOutHandler),pi(R),Yn(R),R.isMaximized()&&!R.get("startMaximized")&&En(R),"function"==typeof R.__internal.destroy&&R.__internal.destroy.apply(R)}var me=null,fe=0,he=0,xe="pageX",Ge="pageY",Ke=null,je=!1,Ct=null;function Ft(F,R){var q=F[Ge]-he;je&&(q-=document.body.scrollTop),R.style.left=F[xe]-fe+"px",R.style.top=q+"px"}function It(F,R){var q=F[Ge]-he;je&&(q-=document.body.scrollTop),R.style.left=Math.min(Ke.maxLeft,Math.max(Ke.minLeft,F[xe]-fe))+"px",R.style.top=je?Math.min(Ke.maxTop,Math.max(Ke.minTop,q))+"px":Math.max(Ke.minTop,q)+"px"}function Ut(F,R){if(null===ci&&!R.isMaximized()&&R.get("movable")){var ie,q=0,b=0;if("touchstart"===F.type?(F.preventDefault(),ie=F.targetTouches[0],xe="clientX",Ge="clientY"):0===F.button&&(ie=F),ie){var I=R.elements.dialog;if(nt(I,Me.capture),I.style.left&&(q=parseInt(I.style.left,10)),I.style.top&&(b=parseInt(I.style.top,10)),fe=ie[xe]-q,he=ie[Ge]-b,R.isModal()?he+=R.elements.modal.scrollTop:R.isPinned()&&(he-=document.body.scrollTop),R.get("moveBounded")){var z=I,W=-q,se=-b;do{W+=z.offsetLeft,se+=z.offsetTop}while(z=z.offsetParent);Ke={maxLeft:W,minLeft:-W,maxTop:document.documentElement.clientHeight-I.clientHeight-se,minTop:-se},Ct=It}else Ke=null,Ct=Ft;return Pe("onmove",R),je=!R.isModal()&&R.isPinned(),me=R,Ct(ie,I),nt(document.body,Me.noSelection),!1}}}function Zt(F){var R;me&&("touchmove"===F.type?(F.preventDefault(),R=F.targetTouches[0]):0===F.button&&(R=F),R&&Ct(R,me.elements.dialog))}function di(){if(me){var F=me;me=Ke=null,Fe(document.body,Me.noSelection),Fe(F.elements.dialog,Me.capture),Pe("onmoved",F)}}function pi(F){me=null;var R=F.elements.dialog;R.style.left=R.style.top=""}var ci=null,an=Number.Nan,Ri=0,Bi=0,Vn=0;function Ja(F,R){var ie;if(!R.isMaximized()&&("touchstart"===F.type?(F.preventDefault(),ie=F.targetTouches[0]):0===F.button&&(ie=F),ie)){Pe("onresize",R),ci=R,Vn=R.elements.resizeHandle.offsetHeight/2;var q=R.elements.dialog;return nt(q,Me.capture),an=parseInt(q.style.left,10),q.style.height=q.offsetHeight+"px",q.style.minHeight=R.elements.header.offsetHeight+R.elements.footer.offsetHeight+"px",q.style.width=(Ri=q.offsetWidth)+"px","none"!==q.style.maxWidth&&(q.style.minWidth=(Bi=q.offsetWidth)+"px"),q.style.maxWidth="none",nt(document.body,Me.noSelection),!1}}function Yt(F){var R;ci&&("touchmove"===F.type?(F.preventDefault(),R=F.targetTouches[0]):0===F.button&&(R=F),R&&function Ka(F,R,ie){var z,W,q=R,b=0,I=0;do{b+=q.offsetLeft,I+=q.offsetTop}while(q=q.offsetParent);!0===ie?(z=F.pageX,W=F.pageY):(z=F.clientX,W=F.clientY);var se=dt();if(se&&(z=document.body.offsetWidth-z,isNaN(an)||(b=document.body.offsetWidth-b-R.offsetWidth)),R.style.height=W-I+Vn+"px",R.style.width=z-b+Vn+"px",!isNaN(an)){var _t=.5*Math.abs(R.offsetWidth-Ri);se&&(_t*=-1),R.offsetWidth>Ri?R.style.left=an+_t+"px":R.offsetWidth>=Bi&&(R.style.left=an-_t+"px")}}(R,ci.elements.dialog,!ci.get("modal")&&!ci.get("pinned")))}function Ar(){if(ci){var F=ci;ci=null,Fe(document.body,Me.noSelection),Fe(F.elements.dialog,Me.capture),Bn=!0,Pe("onresized",F)}}function Yn(F){ci=null;var R=F.elements.dialog;"none"===R.style.maxWidth&&(R.style.maxWidth=R.style.minWidth=R.style.width=R.style.height=R.style.minHeight=R.style.left="",an=Number.Nan,Ri=Bi=Vn=0)}function Wr(){for(var F=0;F<wt.length;F+=1){var R=wt[F];R.get("autoReset")&&(pi(R),Yn(R))}}function aa(F){ft(F.elements.dialog,"focus",F.__internal.bringToFrontHandler,!0)}function oa(F){bt(F.elements.dialog,"focus",F.__internal.bringToFrontHandler,!0)}function cr(F){ft(F.elements.header,"mousedown",F.__internal.beginMoveHandler),ft(F.elements.header,"touchstart",F.__internal.beginMoveHandler,!1,!1)}function jn(F){bt(F.elements.header,"mousedown",F.__internal.beginMoveHandler),bt(F.elements.header,"touchstart",F.__internal.beginMoveHandler,!1,!1)}function Mr(F){ft(F.elements.resizeHandle,"mousedown",F.__internal.beginResizeHandler),ft(F.elements.resizeHandle,"touchstart",F.__internal.beginResizeHandler,!1,!1)}function ke(F){bt(F.elements.resizeHandle,"mousedown",F.__internal.beginResizeHandler),bt(F.elements.resizeHandle,"touchstart",F.__internal.beginResizeHandler,!1,!1)}return{__init:st,isOpen:function(){return this.__internal.isOpen},isModal:function(){return this.elements.root.className.indexOf(Me.modeless)<0},isMaximized:function(){return this.elements.root.className.indexOf(Me.maximized)>-1},isPinned:function(){return this.elements.root.className.indexOf(Me.unpinned)<0},maximize:function(){return this.isMaximized()||Rn(this),this},restore:function(){return this.isMaximized()&&En(this),this},pin:function(){return this.isPinned()||tn(this),this},unpin:function(){return this.isPinned()&&Gn(this),this},bringToFront:function(){return lr(0,this),this},moveTo:function(F,R){if(!isNaN(F)&&!isNaN(R)){Pe("onmove",this);var ie=this.elements.dialog,q=ie,b=0,I=0;ie.style.left&&(b-=parseInt(ie.style.left,10)),ie.style.top&&(I-=parseInt(ie.style.top,10));do{b+=q.offsetLeft,I+=q.offsetTop}while(q=q.offsetParent);var z=F-b,W=R-I;dt()&&(z*=-1),ie.style.left=z+"px",ie.style.top=W+"px",Pe("onmoved",this)}return this},resizeTo:function(F,R){var ie=parseFloat(F),q=parseFloat(R),b=/(\d*\.\d+|\d+)%/;if(!isNaN(ie)&&!isNaN(q)&&!0===this.get("resizable")){Pe("onresize",this),(""+F).match(b)&&(ie=ie/100*document.documentElement.clientWidth),(""+R).match(b)&&(q=q/100*document.documentElement.clientHeight);var I=this.elements.dialog;"none"!==I.style.maxWidth&&(I.style.minWidth=(Bi=I.offsetWidth)+"px"),I.style.maxWidth="none",I.style.minHeight=this.elements.header.offsetHeight+this.elements.footer.offsetHeight+"px",I.style.width=ie+"px",I.style.height=q+"px",Pe("onresized",this)}return this},setting:function(F,R){var ie=this,q=qi(this,this.__internal.options,function(W,se,_t){!function ii(F,R,ie,q){switch(R){case"title":F.setHeader(q);break;case"modal":!function yt(F){F.get("modal")?(Fe(F.elements.root,Me.modeless),F.isOpen()&&(oa(F),fr(F),Qt())):(nt(F.elements.root,Me.modeless),F.isOpen()&&(aa(F),fr(F),Qt()))}(F);break;case"basic":!function en(F){F.get("basic")?nt(F.elements.root,Me.basic):Fe(F.elements.root,Me.basic)}(F);break;case"frameless":!function Di(F){F.get("frameless")?nt(F.elements.root,Me.frameless):Fe(F.elements.root,Me.frameless)}(F);break;case"pinned":!function fn(F){F.get("pinned")?(Fe(F.elements.root,Me.unpinned),F.isOpen()&&mn(F)):(nt(F.elements.root,Me.unpinned),F.isOpen()&&!F.isModal()&&Li(F))}(F);break;case"closable":!function _r(F){F.get("closable")?(nt(F.elements.root,Me.closable),function Kn(F){ft(F.elements.modal,"click",F.__internal.modalClickHandler)}(F)):(Fe(F.elements.root,Me.closable),function Fi(F){bt(F.elements.modal,"click",F.__internal.modalClickHandler)}(F))}(F);break;case"maximizable":!function qn(F){F.get("maximizable")?nt(F.elements.root,Me.maximizable):Fe(F.elements.root,Me.maximizable)}(F);break;case"pinnable":!function On(F){F.get("pinnable")?nt(F.elements.root,Me.pinnable):Fe(F.elements.root,Me.pinnable)}(F);break;case"movable":!function nn(F){F.get("movable")?(nt(F.elements.root,Me.movable),F.isOpen()&&cr(F)):(pi(F),Fe(F.elements.root,Me.movable),F.isOpen()&&jn(F))}(F);break;case"resizable":!function Cr(F){F.get("resizable")?(nt(F.elements.root,Me.resizable),F.isOpen()&&Mr(F)):(Yn(F),Fe(F.elements.root,Me.resizable),F.isOpen()&&ke(F))}(F);break;case"padding":q?Fe(F.elements.root,Me.noPadding):F.elements.root.className.indexOf(Me.noPadding)<0&&nt(F.elements.root,Me.noPadding);break;case"overflow":q?Fe(F.elements.root,Me.noOverflow):F.elements.root.className.indexOf(Me.noOverflow)<0&&nt(F.elements.root,Me.noOverflow);break;case"transition":!function hn(F,R,ie){"string"==typeof ie&&Fe(F.elements.root,Me.prefix+ie),nt(F.elements.root,Me.prefix+R)}(F,q,ie);break;case"transitionOff":!function $t(F){F.get("transitionOff")?nt(F.elements.root,Me.noTransition):Fe(F.elements.root,Me.noTransition)}(F)}"function"==typeof F.hooks.onupdate&&F.hooks.onupdate.call(F,R,ie,q)}(ie,W,se,_t)},F,R);if("get"===q.op)return q.found?q.value:typeof this.settings<"u"?qi(this,this.settings,this.settingUpdated||function(){},F,R).value:void 0;if("set"===q.op){if(q.items.length>0)for(var b=this.settingUpdated||function(){},I=0;I<q.items.length;I+=1){var z=q.items[I];!z.found&&typeof this.settings<"u"&&qi(this,this.settings,b,z.key,z.value)}return this}},set:function(F,R){return this.setting(F,R),this},get:function(F){return this.setting(F)},setHeader:function(F){return"string"==typeof F?(ti(this.elements.header),this.elements.header.innerHTML=F):F instanceof mt.HTMLElement&&this.elements.header.firstChild!==F&&(ti(this.elements.header),this.elements.header.appendChild(F)),this},setContent:function(F){return"string"==typeof F?(ti(this.elements.content),this.elements.content.innerHTML=F):F instanceof mt.HTMLElement&&this.elements.content.firstChild!==F&&(ti(this.elements.content),this.elements.content.appendChild(F)),this},showModal:function(F){return this.show(!0,F)},show:function(F,R){if(st(this),this.__internal.isOpen){pi(this),Yn(this),nt(this.elements.dialog,Me.shake);var q=this;setTimeout(function(){Fe(q.elements.dialog,Me.shake)},200)}else{if(this.__internal.isOpen=!0,wt.push(this),at.defaults.maintainFocus&&(this.__internal.activeElement=document.activeElement),document.body.hasAttribute("tabindex")||document.body.setAttribute("tabindex",Ce="0"),"function"==typeof this.prepare&&this.prepare(),function Nn(F){1===wt.length&&(ft(mt,"resize",Wr),ft(document.body,"keyup",Hn),ft(document.body,"keydown",$i),ft(document.body,"focus",O),ft(document.documentElement,"mousemove",Zt),ft(document.documentElement,"touchmove",Zt,!1,!1),ft(document.documentElement,"mouseup",di),ft(document.documentElement,"touchend",di),ft(document.documentElement,"mousemove",Yt),ft(document.documentElement,"touchmove",Yt,!1,!1),ft(document.documentElement,"mouseup",Ar),ft(document.documentElement,"touchend",Ar)),ft(F.elements.commands.container,"click",F.__internal.commandsClickHandler),ft(F.elements.footer,"click",F.__internal.buttonsClickHandler),ft(F.elements.reset[0],"focusin",F.__internal.resetHandler),ft(F.elements.reset[0],"keydown",K),ft(F.elements.reset[1],"focusin",F.__internal.resetHandler),_n=!0,ft(F.elements.dialog,Gt.type,F.__internal.transitionInHandler),F.get("modal")||aa(F),F.get("resizable")&&Mr(F),F.get("movable")&&cr(F)}(this),void 0!==F&&this.set("modal",F),function Mt(){jt=Ht(),Pt=zt()}(),Qt(),"string"==typeof R&&""!==R&&(this.__internal.className=R,nt(this.elements.root,R)),this.get("startMaximized")?this.maximize():this.isMaximized()&&En(this),fr(this),this.elements.root.removeAttribute("style"),Fe(this.elements.root,Me.animationOut),nt(this.elements.root,Me.animationIn),clearTimeout(this.__internal.timerIn),this.__internal.timerIn=setTimeout(this.__internal.transitionInHandler,Gt.supported?1e3:100),Ue){var ie=this.elements.root;ie.style.display="none",setTimeout(function(){ie.style.display="block"},0)}Fe(this.elements.root,Me.hidden),Dt(),"function"==typeof this.hooks.onshow&&this.hooks.onshow.call(this),Pe("onshow",this)}return this},close:function(){return this.__internal.isOpen&&!1!==Pe("onclosing",this)&&(function Xn(F){1===wt.length&&(bt(mt,"resize",Wr),bt(document.body,"keyup",Hn),bt(document.body,"keydown",$i),bt(document.body,"focus",O),bt(document.documentElement,"mousemove",Zt),bt(document.documentElement,"mouseup",di),bt(document.documentElement,"mousemove",Yt),bt(document.documentElement,"mouseup",Ar)),bt(F.elements.commands.container,"click",F.__internal.commandsClickHandler),bt(F.elements.footer,"click",F.__internal.buttonsClickHandler),bt(F.elements.reset[0],"focusin",F.__internal.resetHandler),bt(F.elements.reset[0],"keydown",K),bt(F.elements.reset[1],"focusin",F.__internal.resetHandler),ft(F.elements.dialog,Gt.type,F.__internal.transitionOutHandler),F.get("modal")||oa(F),F.get("movable")&&jn(F),F.get("resizable")&&ke(F)}(this),Fe(this.elements.root,Me.animationIn),nt(this.elements.root,Me.animationOut),clearTimeout(this.__internal.timerOut),this.__internal.timerOut=setTimeout(this.__internal.transitionOutHandler,Gt.supported?1e3:100),nt(this.elements.root,Me.hidden),at.defaults.maintainFocus&&this.__internal.activeElement&&(this.__internal.activeElement.focus(),this.__internal.activeElement=null),typeof this.__internal.className<"u"&&""!==this.__internal.className&&Fe(this.elements.root,this.__internal.className),"function"==typeof this.hooks.onclose&&this.hooks.onclose.call(this),Pe("onclose",this),wt.splice(wt.indexOf(this),1),this.__internal.isOpen=!1,Qt()),!wt.length&&"0"===Ce&&document.body.removeAttribute("tabindex"),this},closeOthers:function(){return at.closeAll(this),this},destroy:function(){return this.__internal&&(this.__internal.isOpen?(this.__internal.destroy=function(){Bt(this,st)},this.close()):this.__internal.destroy||Bt(this,st)),this}}}(),rt=function(){var Je,Ce=[],Ue=M.notifier.classes,Ee=Ue.base;function Me(Dt){Dt.__internal||(Dt.__internal={position:at.defaults.notifier.position,delay:at.defaults.notifier.delay},Je=document.createElement("DIV"),("transitionOff"in M.notifier?M.notifier.transitionOff:M.transitionOff)&&(Ee=Ue.base+" ajs-no-transition"),Pt(Dt)),Je.parentNode!==document.body&&document.body.appendChild(Je)}function Pt(Dt){switch(Je.className=Ee,Dt.__internal.position){case"top-right":nt(Je,Ue.top+" "+Ue.right);break;case"top-left":nt(Je,Ue.top+" "+Ue.left);break;case"top-center":nt(Je,Ue.top+" "+Ue.center);break;case"bottom-left":nt(Je,Ue.bottom+" "+Ue.left);break;case"bottom-center":nt(Je,Ue.bottom+" "+Ue.center);break;default:nt(Je,Ue.bottom+" "+Ue.right)}}return{setting:function(Dt,Qt){if(Me(this),typeof Qt>"u")return this.__internal[Dt];switch(Dt){case"position":this.__internal.position=Qt,Pt(this);break;case"delay":this.__internal.delay=Qt}return this},set:function(Dt,Qt){return this.setting(Dt,Qt),this},get:function(Dt){return this.setting(Dt)},create:function(Dt,Qt){Me(this);var zi=document.createElement("div");return zi.className=Ue.message+("string"==typeof Dt&&""!==Dt?" "+Ue.prefix+Dt:""),function Mt(Dt,Qt){function zi($t,yt){(!yt.__internal.closeButton||"true"===$t.target.getAttribute("data-close"))&&yt.dismiss(!0)}function ji($t,yt){bt(yt.element,Gt.type,ji),Je.removeChild(yt.element)}function hn($t){clearTimeout($t.__internal.timer),clearTimeout($t.__internal.transitionTimeout)}return function Ln($t){return $t.__internal||($t.__internal={pushed:!1,delay:void 0,timer:void 0,clickHandler:void 0,transitionEndHandler:void 0,transitionTimeout:void 0},$t.__internal.clickHandler=Tt($t,zi),$t.__internal.transitionEndHandler=Tt($t,ji)),$t}({element:Dt,push:function($t,yt){if(!this.__internal.pushed){var en,Di;switch(function st(Dt){Dt.__internal.pushed=!0,Ce.push(Dt)}(this),hn(this),arguments.length){case 0:Di=this.__internal.delay;break;case 1:"number"==typeof $t?Di=$t:(en=$t,Di=this.__internal.delay);break;case 2:en=$t,Di=yt}return this.__internal.closeButton=at.defaults.notifier.closeButton,typeof en<"u"&&this.setContent(en),rt.__internal.position.indexOf("top")<0?Je.appendChild(this.element):Je.insertBefore(this.element,Je.firstChild),nt(this.element,Ue.visible),ft(this.element,"click",this.__internal.clickHandler),this.delay(Di)}return this},ondismiss:function(){},callback:Qt,dismiss:function($t){return this.__internal.pushed&&(hn(this),"function"==typeof this.ondismiss&&!1===this.ondismiss.call(this)||(bt(this.element,"click",this.__internal.clickHandler),typeof this.element<"u"&&this.element.parentNode===Je&&(this.__internal.transitionTimeout=setTimeout(this.__internal.transitionEndHandler,Gt.supported?1e3:100),Fe(this.element,Ue.visible),"function"==typeof this.callback&&this.callback.call(this,$t)),function jt(Dt){Ce.splice(Ce.indexOf(Dt),1),Dt.__internal.pushed=!1}(this))),this},delay:function($t){if(hn(this),this.__internal.delay=typeof $t<"u"&&!isNaN(+$t)?+$t:rt.__internal.delay,this.__internal.delay>0){var yt=this;this.__internal.timer=setTimeout(function(){yt.dismiss()},1e3*this.__internal.delay)}return this},setContent:function($t){if("string"==typeof $t?(ti(this.element),this.element.innerHTML=$t):$t instanceof mt.HTMLElement&&this.element.firstChild!==$t&&(ti(this.element),this.element.appendChild($t)),this.__internal.closeButton){var yt=document.createElement("span");nt(yt,Ue.close),yt.setAttribute("data-close",!0),this.element.appendChild(yt)}return this},dismissOthers:function(){return rt.dismissAll(this),this}})}(zi,Qt)},dismissAll:function(Dt){for(var Qt=Ce.slice(0),zi=0;zi<Qt.length;zi+=1){var ji=Qt[zi];(void 0===Dt||Dt!==ji)&&ji.dismiss()}}}}(),at=new function De(){var Ie={};function Je(Ee,Me){for(var st in Me)Me.hasOwnProperty(st)&&(Ee[st]=Me[st]);return Ee}function Ce(Ee){var Me=Ie[Ee].dialog;return Me&&"function"==typeof Me.__init&&Me.__init(Me),Me}return{defaults:M,dialog:function(Ee,Me,st,jt){if("function"!=typeof Me)return Ce(Ee);if(this.hasOwnProperty(Ee))throw new Error("alertify.dialog: name already exists");var Pt=function Ue(Ee,Me,st,jt){var Pt={dialog:null,factory:Me};return void 0!==jt&&(Pt.factory=function(){return Je(new Ie[jt].factory,new Me)}),st||(Pt.dialog=Je(new Pt.factory,ui)),Ie[Ee]=Pt}(Ee,Me,st,jt);this[Ee]=st?function(){if(0===arguments.length)return Pt.dialog;var Mt=Je(new Pt.factory,ui);return Mt&&"function"==typeof Mt.__init&&Mt.__init(Mt),Mt.main.apply(Mt,arguments),Mt.show.apply(Mt)}:function(){if(Pt.dialog&&"function"==typeof Pt.dialog.__init&&Pt.dialog.__init(Pt.dialog),0===arguments.length)return Pt.dialog;var Mt=Pt.dialog;return Mt.main.apply(Pt.dialog,arguments),Mt.show.apply(Pt.dialog)}},closeAll:function(Ee){for(var Me=wt.slice(0),st=0;st<Me.length;st+=1){var jt=Me[st];(void 0===Ee||Ee!==jt)&&jt.close()}},setting:function(Ee,Me,st){if("notifier"===Ee)return rt.setting(Me,st);var jt=Ce(Ee);return jt?jt.setting(Me,st):void 0},set:function(Ee,Me,st){return this.setting(Ee,Me,st)},get:function(Ee,Me){return this.setting(Ee,Me)},notify:function(Ee,Me,st,jt){return rt.create(Me,jt).push(Ee,st)},message:function(Ee,Me,st){return rt.create(null,st).push(Ee,Me)},success:function(Ee,Me,st){return rt.create("success",st).push(Ee,Me)},error:function(Ee,Me,st){return rt.create("error",st).push(Ee,Me)},warning:function(Ee,Me,st){return rt.create("warning",st).push(Ee,Me)},dismissAll:function(){rt.dismissAll()}}};at.dialog("alert",function(){return{main:function(Ie,Je,Ce){var Ue,Ee,Me;switch(arguments.length){case 1:Ee=Ie;break;case 2:"function"==typeof Je?(Ee=Ie,Me=Je):(Ue=Ie,Ee=Je);break;case 3:Ue=Ie,Ee=Je,Me=Ce}return this.set("title",Ue),this.set("message",Ee),this.set("onok",Me),this},setup:function(){return{buttons:[{text:at.defaults.glossary.ok,key:27,invokeOnClose:!0,className:at.defaults.theme.ok}],focus:{element:0,select:!1},options:{maximizable:!1,resizable:!1}}},build:function(){},prepare:function(){},setMessage:function(Ie){this.setContent(Ie)},settings:{message:void 0,onok:void 0,label:void 0},settingUpdated:function(Ie,Je,Ce){switch(Ie){case"message":this.setMessage(Ce);break;case"label":this.__internal.buttons[0].element&&(this.__internal.buttons[0].element.innerHTML=Ce)}},callback:function(Ie){if("function"==typeof this.get("onok")){var Je=this.get("onok").call(this,Ie);typeof Je<"u"&&(Ie.cancel=!Je)}}}}),at.dialog("confirm",function(){var Ie={timer:null,index:null,text:null,duration:null,task:function(Ue,Ee){if(Ee.isOpen()){if(Ee.__internal.buttons[Ie.index].element.innerHTML=Ie.text+" (&#8207;"+Ie.duration+"&#8207;) ",Ie.duration-=1,-1===Ie.duration){Je(Ee);var st=Qe(Ie.index,Ee.__internal.buttons[Ie.index]);"function"==typeof Ee.callback&&Ee.callback.apply(Ee,[st]),!1!==st.close&&Ee.close()}}else Je(Ee)}};function Je(Ue){null!==Ie.timer&&(clearInterval(Ie.timer),Ie.timer=null,Ue.__internal.buttons[Ie.index].element.innerHTML=Ie.text)}function Ce(Ue,Ee,Me){Je(Ue),Ie.duration=Me,Ie.index=Ee,Ie.text=Ue.__internal.buttons[Ee].element.innerHTML,Ie.timer=setInterval(Tt(Ue,Ie.task),1e3),Ie.task(null,Ue)}return{main:function(Ue,Ee,Me,st){var jt,Pt,Mt,Dt;switch(arguments.length){case 1:Pt=Ue;break;case 2:Pt=Ue,Mt=Ee;break;case 3:Pt=Ue,Mt=Ee,Dt=Me;break;case 4:jt=Ue,Pt=Ee,Mt=Me,Dt=st}return this.set("title",jt),this.set("message",Pt),this.set("onok",Mt),this.set("oncancel",Dt),this},setup:function(){return{buttons:[{text:at.defaults.glossary.ok,key:13,className:at.defaults.theme.ok},{text:at.defaults.glossary.cancel,key:27,invokeOnClose:!0,className:at.defaults.theme.cancel}],focus:{element:0,select:!1},options:{maximizable:!1,resizable:!1}}},build:function(){},prepare:function(){},setMessage:function(Ue){this.setContent(Ue)},settings:{message:null,labels:null,onok:null,oncancel:null,defaultFocus:null,reverseButtons:null},settingUpdated:function(Ue,Ee,Me){switch(Ue){case"message":this.setMessage(Me);break;case"labels":"ok"in Me&&this.__internal.buttons[0].element&&(this.__internal.buttons[0].text=Me.ok,this.__internal.buttons[0].element.innerHTML=Me.ok),"cancel"in Me&&this.__internal.buttons[1].element&&(this.__internal.buttons[1].text=Me.cancel,this.__internal.buttons[1].element.innerHTML=Me.cancel);break;case"reverseButtons":this.elements.buttons.primary.appendChild(!0===Me?this.__internal.buttons[0].element:this.__internal.buttons[1].element);break;case"defaultFocus":this.__internal.focus.element="ok"===Me?0:1}},callback:function(Ue){var Ee;switch(Je(this),Ue.index){case 0:"function"==typeof this.get("onok")&&typeof(Ee=this.get("onok").call(this,Ue))<"u"&&(Ue.cancel=!Ee);break;case 1:"function"==typeof this.get("oncancel")&&typeof(Ee=this.get("oncancel").call(this,Ue))<"u"&&(Ue.cancel=!Ee)}},autoOk:function(Ue){return Ce(this,0,Ue),this},autoCancel:function(Ue){return Ce(this,1,Ue),this}}}),at.dialog("prompt",function(){var Ie=document.createElement("INPUT"),Je=document.createElement("P");return{main:function(Ce,Ue,Ee,Me,st){var jt,Pt,Mt,Dt,Qt;switch(arguments.length){case 1:Pt=Ce;break;case 2:Pt=Ce,Mt=Ue;break;case 3:Pt=Ce,Mt=Ue,Dt=Ee;break;case 4:Pt=Ce,Mt=Ue,Dt=Ee,Qt=Me;break;case 5:jt=Ce,Pt=Ue,Mt=Ee,Dt=Me,Qt=st}return this.set("title",jt),this.set("message",Pt),this.set("value",Mt),this.set("onok",Dt),this.set("oncancel",Qt),this},setup:function(){return{buttons:[{text:at.defaults.glossary.ok,key:13,className:at.defaults.theme.ok},{text:at.defaults.glossary.cancel,key:27,invokeOnClose:!0,className:at.defaults.theme.cancel}],focus:{element:Ie,select:!0},options:{maximizable:!1,resizable:!1}}},build:function(){Ie.className=at.defaults.theme.input,Ie.setAttribute("type","text"),Ie.value=this.get("value"),this.elements.content.appendChild(Je),this.elements.content.appendChild(Ie)},prepare:function(){},setMessage:function(Ce){"string"==typeof Ce?(ti(Je),Je.innerHTML=Ce):Ce instanceof mt.HTMLElement&&Je.firstChild!==Ce&&(ti(Je),Je.appendChild(Ce))},settings:{message:void 0,labels:void 0,onok:void 0,oncancel:void 0,value:"",type:"text",reverseButtons:void 0},settingUpdated:function(Ce,Ue,Ee){switch(Ce){case"message":this.setMessage(Ee);break;case"value":Ie.value=Ee;break;case"type":switch(Ee){case"text":case"color":case"date":case"datetime-local":case"email":case"month":case"number":case"password":case"search":case"tel":case"time":case"week":Ie.type=Ee;break;default:Ie.type="text"}break;case"labels":Ee.ok&&this.__internal.buttons[0].element&&(this.__internal.buttons[0].element.innerHTML=Ee.ok),Ee.cancel&&this.__internal.buttons[1].element&&(this.__internal.buttons[1].element.innerHTML=Ee.cancel);break;case"reverseButtons":this.elements.buttons.primary.appendChild(!0===Ee?this.__internal.buttons[0].element:this.__internal.buttons[1].element)}},callback:function(Ce){var Ue;switch(Ce.index){case 0:this.settings.value=Ie.value,"function"==typeof this.get("onok")&&typeof(Ue=this.get("onok").call(this,Ce,this.settings.value))<"u"&&(Ce.cancel=!Ue);break;case 1:"function"==typeof this.get("oncancel")&&typeof(Ue=this.get("oncancel").call(this,Ce))<"u"&&(Ce.cancel=!Ue),Ce.cancel||(Ie.value=this.settings.value)}}}}),"object"==typeof zn.exports?zn.exports=at:void 0!==(T=function(){return at}.apply(Pi,[]))&&(zn.exports=T)}(typeof window<"u"?window:this)},2574:function(zn){zn.exports=function(){"use strict";var Pi,Ne,T;function mt(s,M){if(Pi)if(Ne){var wt="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+Pi+")(sharedChunk); ("+Ne+")(sharedChunk); self.onerror = null;",nt={};Pi(nt),T=M(nt),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(T.workerUrl=window.URL.createObjectURL(new Blob([wt],{type:"text/javascript"})))}else Ne=M;else Pi=M}return mt(0,function(s){var M=typeof self<"u"?self:{},wt="2.15.0";let nt;const Fe={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(null==nt){const t=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{nt=null!=process.env.API_URL_REGEX?new RegExp(process.env.API_URL_REGEX):t}catch{nt=t}}return nt},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!Fe.API_URL)return null;try{const t=new URL(Fe.API_URL);return"api.mapbox.cn"===t.hostname?"https://events.mapbox.cn/events/v2":"api.mapbox.com"===t.hostname?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},dt={supported:!1,testSupport:function(t){!ti&&Ht&&(lt?Bt(t):zt=t)}};let zt,Ht,ti=!1,lt=!1;function Bt(t){const e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,Ht),t.isContextLost())return;dt.supported=!0}catch{}t.deleteTexture(e),ti=!0}M.document&&(Ht=M.document.createElement("img"),Ht.onload=function(){zt&&Bt(zt),zt=null,lt=!0},Ht.onerror=function(){ti=!0,zt=null},Ht.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Jt="01";function Xt(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var ft=bt;function bt(t,e,i,r){this.cx=3*t,this.bx=3*(i-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(r-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=e,this.p2x=i,this.p2y=r}bt.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,e){if(void 0===e&&(e=1e-6),t<0)return 0;if(t>1)return 1;for(var i=t,r=0;r<8;r++){var o=this.sampleCurveX(i)-t;if(Math.abs(o)<e)return i;var c=this.sampleCurveDerivativeX(i);if(Math.abs(c)<1e-6)break;i-=o/c}var u=0,p=1;for(i=t,r=0;r<20&&(o=this.sampleCurveX(i),!(Math.abs(o-t)<e));r++)t>o?u=i:p=i,i=.5*(p-u)+u;return i},solve:function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))}};var Gt=Xt(ft),Tt=Qe;function Qe(t,e){this.x=t,this.y=e}Qe.prototype={clone:function(){return new Qe(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,i=t.y-this.y;return e*e+i*i},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=e,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),i=Math.sin(t),r=i*this.x+e*this.y;return this.x=e*this.x-i*this.y,this.y=r,this},_rotateAround:function(t,e){var i=Math.cos(t),r=Math.sin(t),o=e.y+r*(this.x-e.x)+i*(this.y-e.y);return this.x=e.x+i*(this.x-e.x)-r*(this.y-e.y),this.y=o,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Qe.convert=function(t){return t instanceof Qe?t:Array.isArray(t)?new Qe(t[0],t[1]):t};var Pe=Xt(Tt);const ui=Math.PI/180,rt=180/Math.PI;function De(t){return t*ui}function at(t){return t*rt}const Ie=[[0,0],[1,0],[1,1],[0,1]];function Je(t){if(t<=0)return 0;if(t>=1)return 1;const e=t*t,i=e*t;return 4*(t<.5?i:3*(t-e)+i-.75)}function Ce(t,e,i,r){const o=new Gt(t,e,i,r);return function(c){return o.solve(c)}}const Ue=Ce(.25,.1,.25,1);function Ee(t,e,i){return Math.min(i,Math.max(e,t))}function Me(t,e,i){return(i=Ee((i-t)/(e-t),0,1))*i*(3-2*i)}function st(t,e,i){const r=i-e,o=((t-e)%r+r)%r+e;return o===e?i:o}function jt(t,e,i){if(!t.length)return i(null,[]);let r=t.length;const o=new Array(t.length);let c=null;t.forEach((u,p)=>{e(u,(f,_)=>{f&&(c=f),o[p]=_,0==--r&&i(c,o)})})}function Pt(t){const e=[];for(const i in t)e.push(t[i]);return e}function Mt(t,...e){for(const i of e)for(const r in i)t[r]=i[r];return t}let Dt=1;function Qt(){return Dt++}function zi(){return function t(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,t)}()}function ji(t){return t<=1?1:Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}function Ln(t){return!!t&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t)}function hn(t,e){t.forEach(i=>{e[i]&&(e[i]=e[i].bind(e))})}function $t(t,e){return-1!==t.indexOf(e,t.length-e.length)}function yt(t,e,i){const r={};for(const o in t)r[o]=e.call(i||this,t[o],o,t);return r}function en(t,e,i){const r={};for(const o in t)e.call(i||this,t[o],o,t)&&(r[o]=t[o]);return r}function Di(t){return Array.isArray(t)?t.map(Di):"object"==typeof t&&t?yt(t,Di):t}const lr={};function ii(t){lr[t]||(typeof console<"u"&&console.warn(t),lr[t]=!0)}function qi(t,e,i){return(i.y-t.y)*(e.x-t.x)>(e.y-t.y)*(i.x-t.x)}function bn(t){let e=0;for(let i,r,o=0,c=t.length,u=c-1;o<c;u=o++)i=t[o],r=t[u],e+=(r.x-i.x)*(i.y+r.y);return e}function wn(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function tn(t){const e={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(i,r,o,c)=>{const u=o||c;return e[r]=!u||u.toLowerCase(),""}),e["max-age"]){const i=parseInt(e["max-age"],10);isNaN(i)?delete e["max-age"]:e["max-age"]=i}return e}let Gn=null;function Rn(t){if(null==Gn){const e=t.navigator?t.navigator.userAgent:null;Gn=!!t.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return Gn}function En(t){try{const e=M[t];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}}function On(t,e){return[t[4*e],t[4*e+1],t[4*e+2],t[4*e+3]]}const Li="mapbox-tiles";let fn,qn,mn=500,fr=50;function _r(){try{return M.caches}catch{}}function Bn(){_r()&&!fn&&(fn=M.caches.open(Li))}function gr(t){const e=t.indexOf("?");if(e<0)return t;const r=function(o){const c=o.indexOf("?");return c>0?o.slice(c+1).split("&"):[]}(t).filter(o=>{const c=o.split("=");return"language"===c[0]||"worldview"===c[0]});return r.length?`${t.slice(0,e)}?${r.join("&")}`:t.slice(0,e)}let $n=1/0;const Wn={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(Wn);class _n extends Error{constructor(e,i,r){401===i&&me(r)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=i,this.url=r}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Fn=wn()?()=>self.worker&&self.worker.referrer:()=>("blob:"===M.location.protocol?M.parent:M).location.href,Un=function(t,e){if(!(/^file:/.test(i=t.url)||/^file:/.test(Fn())&&!/^\w+:/.test(i))){if(M.fetch&&M.Request&&M.AbortController&&M.Request.prototype.hasOwnProperty("signal"))return function(r,o){const c=new M.AbortController,u=new M.Request(r.url,{method:r.method||"GET",body:r.body,credentials:r.credentials,headers:r.headers,referrer:Fn(),referrerPolicy:r.referrerPolicy,signal:c.signal});let p=!1,f=!1;const _=(x=u.url).indexOf("sku=")>0&&me(x);var x;"json"===r.type&&u.headers.set("Accept","application/json");const w=(C,D,L)=>{if(f)return;if(C&&"SecurityError"!==C.message&&ii(C.toString()),D&&L)return E(D);const V=Date.now();M.fetch(u).then(H=>{if(H.ok){const te=_?H.clone():null;return E(H,te,V)}return o(new _n(H.statusText,H.status,r.url))}).catch(H=>{"AbortError"!==H.name&&o(new Error(`${H.message} ${r.url}`))})},E=(C,D,L)=>{("arrayBuffer"===r.type?C.arrayBuffer():"json"===r.type?C.json():C.text()).then(V=>{f||(D&&L&&function(H,te,Y){if(Bn(),!fn)return;const ee={status:te.status,statusText:te.statusText,headers:new M.Headers};te.headers.forEach((be,ge)=>ee.headers.set(ge,be));const ae=tn(te.headers.get("Cache-Control")||"");if(ae["no-store"])return;ae["max-age"]&&ee.headers.set("Expires",new Date(Y+1e3*ae["max-age"]).toUTCString());const ne=ee.headers.get("Expires");ne&&(new Date(ne).getTime()-Y<42e4||function(be,ge){if(void 0===qn)try{new Response(new ReadableStream),qn=!0}catch{qn=!1}qn?ge(be.body):be.blob().then(ge)}(te,be=>{const ge=new M.Response(be,ee);Bn(),fn&&fn.then(Se=>Se.put(gr(H.url),ge)).catch(Se=>ii(Se.message))}))}(u,D,L),p=!0,o(null,V,C.headers.get("Cache-Control"),C.headers.get("Expires")))}).catch(V=>{f||o(new Error(V.message))})};return _?function(C,D){if(Bn(),!fn)return D(null);const L=gr(C.url);fn.then(V=>{V.match(L).then(H=>{const te=function(Y){if(!Y)return!1;const ee=new Date(Y.headers.get("Expires")||0),ae=tn(Y.headers.get("Cache-Control")||"");return ee>Date.now()&&!ae["no-cache"]}(H);V.delete(L),te&&V.put(L,H.clone()),D(null,H,te)}).catch(D)}).catch(D)}(u,w):w(null,null),{cancel:()=>{f=!0,p||c.abort()}}}(t,e);if(wn()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,e,void 0,!0)}var i;return function(r,o){const c=new M.XMLHttpRequest;c.open(r.method||"GET",r.url,!0),"arrayBuffer"===r.type&&(c.responseType="arraybuffer");for(const u in r.headers)c.setRequestHeader(u,r.headers[u]);return"json"===r.type&&(c.responseType="text",c.setRequestHeader("Accept","application/json")),c.withCredentials="include"===r.credentials,c.onerror=()=>{o(new Error(c.statusText))},c.onload=()=>{if((c.status>=200&&c.status<300||0===c.status)&&null!==c.response){let u=c.response;if("json"===r.type)try{u=JSON.parse(c.response)}catch(p){return o(p)}o(null,u,c.getResponseHeader("Cache-Control"),c.getResponseHeader("Expires"))}else o(new _n(c.statusText,c.status,r.url))},c.send(r.body),{cancel:()=>c.abort()}}(t,e)},Hn=function(t,e){return Un(Mt(t,{type:"arrayBuffer"}),e)};function $i(t){const e=M.document.createElement("a");return e.href=t,e.protocol===M.document.location.protocol&&e.host===M.document.location.host}const Q="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let O,B;O=[],B=0;const K=function(t,e){if(dt.supported&&(t.headers||(t.headers={}),t.headers.accept="image/webp,*/*"),B>=Fe.MAX_PARALLEL_IMAGE_REQUESTS){const c={requestParameters:t,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return O.push(c),c}B++;let i=!1;const r=()=>{if(!i)for(i=!0,B--;O.length&&B<Fe.MAX_PARALLEL_IMAGE_REQUESTS;){const c=O.shift(),{requestParameters:u,callback:p,cancelled:f}=c;f||(c.cancel=K(u,p).cancel)}},o=Hn(t,(c,u,p,f)=>{r(),c?e(c):u&&(M.createImageBitmap?function(_,x){const w=new M.Blob([new Uint8Array(_)],{type:"image/png"});M.createImageBitmap(w).then(E=>{x(null,E)}).catch(E=>{x(new Error(`Could not load image because of ${E.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(u,(_,x)=>e(_,x,p,f)):function(_,x){const w=new M.Image,E=M.URL;w.onload=()=>{x(null,w),E.revokeObjectURL(w.src),w.onload=null,M.requestAnimationFrame(()=>{w.src=Q})},w.onerror=()=>x(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const C=new M.Blob([new Uint8Array(_)],{type:"image/png"});w.src=_.byteLength?E.createObjectURL(C):Q}(u,(_,x)=>e(_,x,p,f)))});return{cancel:()=>{o.cancel(),r()}}},re="NO_ACCESS_TOKEN";function ue(t){return 0===t.indexOf("mapbox:")}function me(t){return Fe.API_URL_REGEX.test(t)}function fe(t){return Fe.API_CDN_URL_REGEX.test(t)}function he(t){return Fe.API_STYLE_REGEX.test(t)&&!xe(t)}function xe(t){return Fe.API_SPRITE_REGEX.test(t)}const Ge=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Ke(t){const e=t.match(Ge);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function je(t){const e=t.params.length?`?${t.params.join("&")}`:"";return`${t.protocol}://${t.authority}${t.path}${e}`}const Ct="mapbox.eventData";function Ft(t){if(!t)return null;const e=t.split(".");if(!e||3!==e.length)return null;try{return JSON.parse(decodeURIComponent(M.atob(e[1]).split("").map(i=>"%"+("00"+i.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class It{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){const i=Ft(Fe.ACCESS_TOKEN);let r="";return r=i&&i.u?M.btoa(encodeURIComponent(i.u).replace(/%([0-9A-F]{2})/g,(o,c)=>String.fromCharCode(+("0x"+c)))):Fe.ACCESS_TOKEN||"",e?`${Ct}.${e}:${r}`:`${Ct}:${r}`}fetchEventData(){const e=En("localStorage"),i=this.getStorageKey(),r=this.getStorageKey("uuid");if(e)try{const o=M.localStorage.getItem(i);o&&(this.eventData=JSON.parse(o));const c=M.localStorage.getItem(r);c&&(this.anonId=c)}catch{ii("Unable to read from LocalStorage")}}saveEventData(){const e=En("localStorage"),i=this.getStorageKey(),r=this.getStorageKey("uuid");if(e)try{M.localStorage.setItem(r,this.anonId),Object.keys(this.eventData).length>=1&&M.localStorage.setItem(i,JSON.stringify(this.eventData))}catch{ii("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,i,r,o){if(!Fe.EVENTS_URL)return;const c=Ke(Fe.EVENTS_URL);c.params.push(`access_token=${o||Fe.ACCESS_TOKEN||""}`);const u={event:this.type,created:new Date(e).toISOString()},p=i?Mt(u,i):u,f={url:je(c),headers:{"Content-Type":"text/plain"},body:JSON.stringify([p])};var x;this.pendingRequest=(x=_=>{this.pendingRequest=null,r(_),this.saveEventData(),this.processRequests(o)},Un(Mt(f,{method:"POST"}),x))}queueRequest(e,i){this.queue.push(e),this.processRequests(i)}}const Ut=new class extends It{constructor(t){super("appUserTurnstile"),this._customAccessToken=t}postTurnstileEvent(t,e){Fe.EVENTS_URL&&Fe.ACCESS_TOKEN&&Array.isArray(t)&&t.some(i=>ue(i)||me(i))&&this.queueRequest(Date.now(),e)}processRequests(t){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const e=Ft(Fe.ACCESS_TOKEN),i=e?e.u:Fe.ACCESS_TOKEN;let r=i!==this.eventData.tokenU;Ln(this.anonId)||(this.anonId=zi(),r=!0);const o=this.queue.shift();if(this.eventData.lastSuccess){const c=new Date(this.eventData.lastSuccess),u=new Date(o),p=(o-this.eventData.lastSuccess)/864e5;r=r||p>=1||p<-1||c.getDate()!==u.getDate()}else r=!0;r?this.postEvent(o,{sdkIdentifier:"mapbox-gl-js",sdkVersion:wt,skuId:Jt,"enabled.telemetry":!1,userId:this.anonId},c=>{c||(this.eventData.lastSuccess=o,this.eventData.tokenU=i)},t):this.processRequests()}},Zt=Ut.postTurnstileEvent.bind(Ut),di=new class extends It{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(t,e,i,r){this.skuToken=e,this.errorCb=r,Fe.EVENTS_URL&&(i||Fe.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},i):this.errorCb(new Error(re)))}processRequests(t){if(this.pendingRequest||0===this.queue.length)return;const{id:e,timestamp:i}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),Ln(this.anonId)||(this.anonId=zi()),this.postEvent(i,{sdkIdentifier:"mapbox-gl-js",sdkVersion:wt,skuId:Jt,skuToken:this.skuToken,userId:this.anonId},r=>{r?this.errorCb(r):e&&(this.success[e]=!0)},t))}},pi=di.postMapLoadEvent.bind(di),nn=new class extends It{constructor(){super("gljs.performance")}postPerformanceEvent(t,e){Fe.EVENTS_URL&&(t||Fe.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:e},t)}processRequests(t){if(this.pendingRequest||0===this.queue.length)return;const{timestamp:e,performanceData:i}=this.queue.shift(),r=function(o){const c=M.performance.getEntriesByType("resource"),u=M.performance.getEntriesByType("mark"),p=function(E){const C={};if(E)for(const D in E)if("other"!==D)for(const L of E[D]){const V=`${D}ResolveRangeMin`,H=`${D}ResolveRangeMax`,te=`${D}RequestCount`,Y=`${D}RequestCachedCount`;C[V]=Math.min(C[V]||1/0,L.startTime),C[H]=Math.max(C[H]||-1/0,L.responseEnd);const ee=ae=>{void 0===C[ae]&&(C[ae]=0),++C[ae]};void 0!==L.transferSize&&0===L.transferSize&&ee(Y),ee(te)}return C}(function(E,C){const D={};if(E)for(const L of E){const V=C(L);void 0===D[V]&&(D[V]=[]),D[V].push(L)}return D}(c,Ja)),f=M.devicePixelRatio,_=M.navigator.connection||M.navigator.mozConnection||M.navigator.webkitConnection,x={counters:[],metadata:[],attributes:[]},w=(E,C,D)=>{null!=D&&E.push({name:C,value:D.toString()})};for(const E in p)w(x.counters,E,p[E]);if(o.interactionRange[0]!==1/0&&o.interactionRange[1]!==-1/0&&(w(x.counters,"interactionRangeMin",o.interactionRange[0]),w(x.counters,"interactionRangeMax",o.interactionRange[1])),u)for(const E of Object.keys(Vn)){const C=Vn[E],D=u.find(L=>L.name===C);D&&w(x.counters,C,D.startTime)}return w(x.counters,"visibilityHidden",o.visibilityHidden),w(x.attributes,"style",function(E){if(E)for(const C of E){const D=C.name.split("?")[0];if(he(D)){const L=D.split("/").slice(-2);if(2===L.length)return`mapbox://styles/${L[0]}/${L[1]}`}}}(c)),w(x.attributes,"terrainEnabled",o.terrainEnabled?"true":"false"),w(x.attributes,"fogEnabled",o.fogEnabled?"true":"false"),w(x.attributes,"projection",o.projection),w(x.attributes,"zoom",o.zoom),w(x.metadata,"devicePixelRatio",f),w(x.metadata,"connectionEffectiveType",_?_.effectiveType:void 0),w(x.metadata,"navigatorUserAgent",M.navigator.userAgent),w(x.metadata,"screenWidth",M.screen.width),w(x.metadata,"screenHeight",M.screen.height),w(x.metadata,"windowWidth",M.innerWidth),w(x.metadata,"windowHeight",M.innerHeight),w(x.metadata,"mapWidth",o.width/f),w(x.metadata,"mapHeight",o.height/f),w(x.metadata,"webglRenderer",o.renderer),w(x.metadata,"webglVendor",o.vendor),w(x.metadata,"sdkVersion",wt),w(x.metadata,"sdkIdentifier","mapbox-gl-js"),x}(i);for(const o of r.metadata);for(const o of r.counters);for(const o of r.attributes);this.postEvent(e,r,()=>{},t)}},ci=nn.postPerformanceEvent.bind(nn),an=new class extends It{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(t,e,i,r){if(!Fe.API_URL||!Fe.SESSION_PATH)return;const o=Ke(Fe.API_URL+Fe.SESSION_PATH);o.params.push(`sku=${e||""}`),o.params.push(`access_token=${r||Fe.ACCESS_TOKEN||""}`);const c={url:je(o),headers:{"Content-Type":"text/plain"}};var p;this.pendingRequest=(p=u=>{this.pendingRequest=null,i(u),this.saveEventData(),this.processRequests(r)},Un(Mt(c,{method:"GET"}),p))}getSessionAPI(t,e,i,r){this.skuToken=e,this.errorCb=r,Fe.SESSION_PATH&&Fe.API_URL&&(i||Fe.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},i):this.errorCb(new Error(re)))}processRequests(t){if(this.pendingRequest||0===this.queue.length)return;const{id:e,timestamp:i}=this.queue.shift();e&&this.success[e]||this.getSession(i,this.skuToken,r=>{r?this.errorCb(r):e&&(this.success[e]=!0)},t)}},Ri=an.getSessionAPI.bind(an),Bi=new Set,Vn={create:"create",load:"load",fullLoad:"fullLoad"},Ka={mark(t){M.performance.mark(t)},measure(t,e,i){M.performance.measure(t,e,i)}};function Ja(t){const e=t.name.split("?")[0];return fe(e)&&e.includes("mapbox-gl.js")?"javascript":fe(e)&&e.includes("mapbox-gl.css")?"css":Fe.API_FONTS_REGEX.test(e)?"fontRange":xe(e)?"sprite":he(e)?"style":Fe.API_TILEJSON_REGEX.test(e)?"tilejson":"other"}const Yt=M.performance;function Ar(t){const e=t?t.url.toString():void 0;return Yt.getEntriesByName(e)}let Yn,Cr,Wr,Nn;const Xn={now:()=>void 0!==Wr?Wr:M.performance.now(),setNow(t){Wr=t},restoreNow(){Wr=void 0},frame(t){const e=M.requestAnimationFrame(t);return{cancel:()=>M.cancelAnimationFrame(e)}},getImageData(t,e=0){const{width:i,height:r}=t;Nn||(Nn=M.document.createElement("canvas"));const o=Nn.getContext("2d",{willReadFrequently:!0});if(!o)throw new Error("failed to create canvas 2d context");return(i>Nn.width||r>Nn.height)&&(Nn.width=i,Nn.height=r),o.clearRect(-e,-e,i+2*e,r+2*e),o.drawImage(t,0,0,i,r),o.getImageData(-e,-e,i+2*e,r+2*e)},resolveURL:t=>(Yn||(Yn=M.document.createElement("a")),Yn.href=t,Yn.href),get devicePixelRatio(){return M.devicePixelRatio},get prefersReducedMotion(){return!!M.matchMedia&&(null==Cr&&(Cr=M.matchMedia("(prefers-reduced-motion: reduce)")),Cr.matches)}};function aa(t,e,i){i[t]&&-1!==i[t].indexOf(e)||(i[t]=i[t]||[],i[t].push(e))}function oa(t,e,i){if(i&&i[t]){const r=i[t].indexOf(e);-1!==r&&i[t].splice(r,1)}}class cr{constructor(e,i={}){Mt(this,i),this.type=e}}class jn extends cr{constructor(e,i={}){super("error",Mt({error:e},i))}}class Mr{on(e,i){return this._listeners=this._listeners||{},aa(e,i,this._listeners),this}off(e,i){return oa(e,i,this._listeners),oa(e,i,this._oneTimeListeners),this}once(e,i){return i?(this._oneTimeListeners=this._oneTimeListeners||{},aa(e,i,this._oneTimeListeners),this):new Promise(r=>this.once(e,r))}fire(e,i){"string"==typeof e&&(e=new cr(e,i||{}));const r=e.type;if(this.listens(r)){e.target=this;const o=this._listeners&&this._listeners[r]?this._listeners[r].slice():[];for(const p of o)p.call(this,e);const c=this._oneTimeListeners&&this._oneTimeListeners[r]?this._oneTimeListeners[r].slice():[];for(const p of c)oa(r,p,this._oneTimeListeners),p.call(this,e);const u=this._eventedParent;u&&(Mt(e,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),u.fire(e))}else e instanceof jn&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,i){return this._eventedParent=e,this._eventedParentData=i,this}}var ke=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["source"]}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["fill-extrusion-edge-radius"]},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"requires":["fill-extrusion-edge-radius"],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":false,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"transition":false,"requires":[{"source":"geojson","has":{"lineMetrics":true}}],"property-type":"constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function Kn(t,...e){for(const i of e)for(const r in i)t[r]=i[r];return t}function Fi(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function F(t){if(Array.isArray(t))return t.map(F);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){const e={};for(const i in t)e[i]=F(t[i]);return e}return Fi(t)}class R extends Error{constructor(e,i){super(i),this.message=i,this.key=e}}var ie=R;class q{constructor(e,i=[]){this.parent=e,this.bindings={};for(const[r,o]of i)this.bindings[r]=o}concat(e){return new q(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}var b=q;const I={kind:"null"},z={kind:"number"},W={kind:"string"},se={kind:"boolean"},_t={kind:"color"},Kt={kind:"object"},At={kind:"value"},mi={kind:"collator"},Jn={kind:"formatted"},Dr={kind:"resolvedImage"};function Qn(t,e){return{kind:"array",itemType:t,N:e}}function Ii(t){if("array"===t.kind){const e=Ii(t.itemType);return"number"==typeof t.N?`array<${e}, ${t.N}>`:"value"===t.itemType.kind?"array":`array<${e}>`}return t.kind}const oc=[I,z,W,se,_t,Jn,Kt,Qn(At),Dr];function Ir(t,e){if("error"===e.kind)return null;if("array"===t.kind){if("array"===e.kind&&(0===e.N&&"value"===e.itemType.kind||!Ir(t.itemType,e.itemType))&&("number"!=typeof t.N||t.N===e.N))return null}else{if(t.kind===e.kind)return null;if("value"===t.kind)for(const i of oc)if(!Ir(i,e))return null}return`Expected ${Ii(t)} but found ${Ii(e)} instead.`}function Qa(t,e){return e.some(i=>i.kind===t.kind)}function eo(t,e){return e.some(i=>"null"===i?null===t:"array"===i?Array.isArray(t):"object"===i?t&&!Array.isArray(t)&&"object"==typeof t:i===typeof t)}var Ls,sc={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function to(t){return(t=Math.round(t))<0?0:t>255?255:t}function io(t){return to("%"===t[t.length-1]?parseFloat(t)/100*255:parseInt(t))}function Fo(t){return(e="%"===t[t.length-1]?parseFloat(t)/100:parseFloat(t))<0?0:e>1?1:e;var e}function Ta(t,e,i){return i<0?i+=1:i>1&&(i-=1),6*i<1?t+(e-t)*i*6:2*i<1?e:3*i<2?t+(e-t)*(2/3-i)*6:t}try{Ls={}.parseCSSColor=function(t){var e,i=t.replace(/ /g,"").toLowerCase();if(i in sc)return sc[i].slice();if("#"===i[0])return 4===i.length?(e=parseInt(i.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:7===i.length&&(e=parseInt(i.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var r=i.indexOf("("),o=i.indexOf(")");if(-1!==r&&o+1===i.length){var c=i.substr(0,r),u=i.substr(r+1,o-(r+1)).split(","),p=1;switch(c){case"rgba":if(4!==u.length)return null;p=Fo(u.pop());case"rgb":return 3!==u.length?null:[io(u[0]),io(u[1]),io(u[2]),p];case"hsla":if(4!==u.length)return null;p=Fo(u.pop());case"hsl":if(3!==u.length)return null;var f=(parseFloat(u[0])%360+360)%360/360,_=Fo(u[1]),x=Fo(u[2]),w=x<=.5?x*(_+1):x+_-x*_,E=2*x-w;return[to(255*Ta(E,w,f+1/3)),to(255*Ta(E,w,f)),to(255*Ta(E,w,f-1/3)),p];default:return null}}return null}}catch{}class kn{constructor(e,i,r,o=1){this.r=e,this.g=i,this.b=r,this.a=o}static parse(e){if(!e)return;if(e instanceof kn)return e;if("string"!=typeof e)return;const i=Ls(e);return i?new kn(i[0]/255*i[3],i[1]/255*i[3],i[2]/255*i[3],i[3]):void 0}toString(){const[e,i,r,o]=this.toArray();return`rgba(${Math.round(e)},${Math.round(i)},${Math.round(r)},${o})`}toArray(){const{r:e,g:i,b:r,a:o}=this;return 0===o?[0,0,0,0]:[255*e/o,255*i/o,255*r/o,o]}toArray01(){const{r:e,g:i,b:r,a:o}=this;return 0===o?[0,0,0,0]:[e/o,i/o,r/o,o]}toArray01PremultipliedAlpha(){const{r:e,g:i,b:r,a:o}=this;return[e,i,r,o]}}kn.black=new kn(0,0,0,1),kn.white=new kn(1,1,1,1),kn.transparent=new kn(0,0,0,0),kn.red=new kn(1,0,0,1),kn.blue=new kn(0,0,1,1);var Zi=kn;class Rs{constructor(e,i,r){this.sensitivity=e?i?"variant":"case":i?"accent":"base",this.locale=r,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,i){return this.collator.compare(e,i)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Os{constructor(e,i,r,o,c){this.text=e.normalize?e.normalize():e,this.image=i,this.scale=r,this.fontStack=o,this.textColor=c}}class An{constructor(e){this.sections=e}static fromString(e){return new An([new Os(e,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(e=>0!==e.text.length||e.image&&0!==e.image.name.length)}static factory(e){return e instanceof An?e:An.fromString(e)}toString(){return 0===this.sections.length?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const i of this.sections){if(i.image){e.push(["image",i.image.name]);continue}e.push(i.text);const r={};i.fontStack&&(r["text-font"]=["literal",i.fontStack.split(",")]),i.scale&&(r["font-scale"]=i.scale),i.textColor&&(r["text-color"]=["rgba"].concat(i.textColor.toArray())),e.push(r)}return e}}class er{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new er({name:e,available:!1}):null}serialize(){return["image",this.name]}}function lc(t,e,i,r){return"number"==typeof t&&t>=0&&t<=255&&"number"==typeof e&&e>=0&&e<=255&&"number"==typeof i&&i>=0&&i<=255?void 0===r||"number"==typeof r&&r>=0&&r<=1?null:`Invalid rgba value [${[t,e,i,r].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof r?[t,e,i,r]:[t,e,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function no(t){if(null===t||"string"==typeof t||"boolean"==typeof t||"number"==typeof t||t instanceof Zi||t instanceof Rs||t instanceof An||t instanceof er)return!0;if(Array.isArray(t)){for(const e of t)if(!no(e))return!1;return!0}if("object"==typeof t){for(const e in t)if(!no(t[e]))return!1;return!0}return!1}function Vi(t){if(null===t)return I;if("string"==typeof t)return W;if("boolean"==typeof t)return se;if("number"==typeof t)return z;if(t instanceof Zi)return _t;if(t instanceof Rs)return mi;if(t instanceof An)return Jn;if(t instanceof er)return Dr;if(Array.isArray(t)){const e=t.length;let i;for(const r of t){const o=Vi(r);if(i){if(i===o)continue;i=At;break}i=o}return Qn(i||At,e)}return Kt}function ro(t){const e=typeof t;return null===t?"":"string"===e||"number"===e||"boolean"===e?String(t):t instanceof Zi||t instanceof An||t instanceof er?t.toString():JSON.stringify(t)}class Bs{constructor(e,i){this.type=e,this.value=i}static parse(e,i){if(2!==e.length)return i.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!no(e[1]))return i.error("invalid value");const r=e[1];let o=Vi(r);const c=i.expectedType;return"array"!==o.kind||0!==o.N||!c||"array"!==c.kind||"number"==typeof c.N&&0!==c.N||(o=c),new Bs(o,r)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof Zi?["rgba"].concat(this.value.toArray()):this.value instanceof An?this.value.serialize():this.value}}var sa=Bs,un=class{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}};const Fs={string:W,number:z,boolean:se,object:Kt};class Us{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");let r,o=1;const c=e[0];if("array"===c){let p,f;if(e.length>2){const _=e[1];if("string"!=typeof _||!(_ in Fs)||"object"===_)return i.error('The item type argument of "array" must be one of string, number, boolean',1);p=Fs[_],o++}else p=At;if(e.length>3){if(null!==e[2]&&("number"!=typeof e[2]||e[2]<0||e[2]!==Math.floor(e[2])))return i.error('The length argument to "array" must be a positive integer literal',2);f=e[2],o++}r=Qn(p,f)}else r=Fs[c];const u=[];for(;o<e.length;o++){const p=i.parse(e[o],o,At);if(!p)return null;u.push(p)}return new Us(r,u)}evaluate(e){for(let i=0;i<this.args.length;i++){const r=this.args[i].evaluate(e);if(!Ir(this.type,Vi(r)))return r;if(i===this.args.length-1)throw new un(`Expected value to be of type ${Ii(this.type)}, but found ${Ii(Vi(r))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,i=[e.kind];if("array"===e.kind){const r=e.itemType;if("string"===r.kind||"number"===r.kind||"boolean"===r.kind){i.push(r.kind);const o=e.N;("number"==typeof o||this.args.length>1)&&i.push(o)}}return i.concat(this.args.map(r=>r.serialize()))}}var Sr=Us;class Hr{constructor(e){this.type=Jn,this.sections=e}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const r=e[1];if(!Array.isArray(r)&&"object"==typeof r)return i.error("First argument must be an image or text section.");const o=[];let c=!1;for(let u=1;u<=e.length-1;++u){const p=e[u];if(c&&"object"==typeof p&&!Array.isArray(p)){c=!1;let f=null;if(p["font-scale"]&&(f=i.parse(p["font-scale"],1,z),!f))return null;let _=null;if(p["text-font"]&&(_=i.parse(p["text-font"],1,Qn(W)),!_))return null;let x=null;if(p["text-color"]&&(x=i.parse(p["text-color"],1,_t),!x))return null;const w=o[o.length-1];w.scale=f,w.font=_,w.textColor=x}else{const f=i.parse(e[u],1,At);if(!f)return null;const _=f.type.kind;if("string"!==_&&"value"!==_&&"null"!==_&&"resolvedImage"!==_)return i.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");c=!0,o.push({content:f,scale:null,font:null,textColor:null})}}return new Hr(o)}evaluate(e){return new An(this.sections.map(i=>{const r=i.content.evaluate(e);return Vi(r)===Dr?new Os("",r,null,null,null):new Os(ro(r),null,i.scale?i.scale.evaluate(e):null,i.font?i.font.evaluate(e).join(","):null,i.textColor?i.textColor.evaluate(e):null)}))}eachChild(e){for(const i of this.sections)e(i.content),i.scale&&e(i.scale),i.font&&e(i.font),i.textColor&&e(i.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const i of this.sections){e.push(i.content.serialize());const r={};i.scale&&(r["font-scale"]=i.scale.serialize()),i.font&&(r["text-font"]=i.font.serialize()),i.textColor&&(r["text-color"]=i.textColor.serialize()),e.push(r)}return e}}class Uo{constructor(e){this.type=Dr,this.input=e}static parse(e,i){if(2!==e.length)return i.error("Expected two arguments.");const r=i.parse(e[1],1,W);return r?new Uo(r):i.error("No image name provided.")}evaluate(e){const i=this.input.evaluate(e),r=er.fromString(i);return r&&e.availableImages&&(r.available=e.availableImages.indexOf(i)>-1),r}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const Mh={"to-boolean":se,"to-color":_t,"to-number":z,"to-string":W};class Vs{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const r=e[0];if(("to-boolean"===r||"to-string"===r)&&2!==e.length)return i.error("Expected one argument.");const o=Mh[r],c=[];for(let u=1;u<e.length;u++){const p=i.parse(e[u],u,At);if(!p)return null;c.push(p)}return new Vs(o,c)}evaluate(e){if("boolean"===this.type.kind)return!!this.args[0].evaluate(e);if("color"===this.type.kind){let i,r;for(const o of this.args){if(i=o.evaluate(e),r=null,i instanceof Zi)return i;if("string"==typeof i){const c=e.parseColor(i);if(c)return c}else if(Array.isArray(i)&&(r=i.length<3||i.length>4?`Invalid rbga value ${JSON.stringify(i)}: expected an array containing either three or four numeric values.`:lc(i[0],i[1],i[2],i[3]),!r))return new Zi(i[0]/255,i[1]/255,i[2]/255,i[3])}throw new un(r||`Could not parse color from value '${"string"==typeof i?i:String(JSON.stringify(i))}'`)}if("number"===this.type.kind){let i=null;for(const r of this.args){if(i=r.evaluate(e),null===i)return 0;const o=Number(i);if(!isNaN(o))return o}throw new un(`Could not convert ${JSON.stringify(i)} to number.`)}return"formatted"===this.type.kind?An.fromString(ro(this.args[0].evaluate(e))):"resolvedImage"===this.type.kind?er.fromString(ro(this.args[0].evaluate(e))):ro(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if("formatted"===this.type.kind)return new Hr([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new Uo(this.args[0]).serialize();const e=[`to-${this.type.kind}`];return this.eachChild(i=>{e.push(i.serialize())}),e}}var Ea=Vs;const yr=["Unknown","Point","LineString","Polygon"];var Ns=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&void 0!==this.feature.id?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?yr[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const t=this.featureDistanceData.center,e=this.featureDistanceData.scale,{x:i,y:r}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(i*e-t[0])+this.featureDistanceData.bearing[1]*(r*e-t[1])}return 0}parseColor(t){let e=this._parseColorCache[t];return e||(e=this._parseColorCache[t]=Zi.parse(t)),e}};class la{constructor(e,i,r,o){this.name=e,this.type=i,this._evaluate=r,this.args=o}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,i){const r=e[0],o=la.definitions[r];if(!o)return i.error(`Unknown expression "${r}". If you wanted a literal array, use ["literal", [...]].`,0);const c=Array.isArray(o)?o[0]:o.type,u=Array.isArray(o)?[[o[1],o[2]]]:o.overloads,p=u.filter(([_])=>!Array.isArray(_)||_.length===e.length-1);let f=null;for(const[_,x]of p){f=new Ws(i.registry,i.path,null,i.scope);const w=[];let E=!1;for(let C=1;C<e.length;C++){const D=e[C],L=Array.isArray(_)?_[C-1]:_.type,V=f.parse(D,1+w.length,L);if(!V){E=!0;break}w.push(V)}if(!E)if(Array.isArray(_)&&_.length!==w.length)f.error(`Expected ${_.length} arguments, but found ${w.length} instead.`);else{for(let C=0;C<w.length;C++){const D=Array.isArray(_)?_[C]:_.type,L=w[C];f.concat(C+1).checkSubtype(D,L.type)}if(0===f.errors.length)return new la(r,c,x,w)}}if(1===p.length)i.errors.push(...f.errors);else{const _=(p.length?p:u).map(([w])=>{return E=w,Array.isArray(E)?`(${E.map(Ii).join(", ")})`:`(${Ii(E.type)}...)`;var E}).join(" | "),x=[];for(let w=1;w<e.length;w++){const E=i.parse(e[w],1+x.length);if(!E)return null;x.push(Ii(E.type))}i.error(`Expected arguments of type ${_}, but found (${x.join(", ")}) instead.`)}return null}static register(e,i){la.definitions=i;for(const r in i)e[r]=la}}var Pr=la;class ao{constructor(e,i,r){this.type=mi,this.locale=r,this.caseSensitive=e,this.diacriticSensitive=i}static parse(e,i){if(2!==e.length)return i.error("Expected one argument.");const r=e[1];if("object"!=typeof r||Array.isArray(r))return i.error("Collator options argument must be an object.");const o=i.parse(void 0!==r["case-sensitive"]&&r["case-sensitive"],1,se);if(!o)return null;const c=i.parse(void 0!==r["diacritic-sensitive"]&&r["diacritic-sensitive"],1,se);if(!c)return null;let u=null;return r.locale&&(u=i.parse(r.locale,1,W),!u)?null:new ao(o,c,u)}evaluate(e){return new Rs(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}const zr=8192;function Vo(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.max(t[2],e[0]),t[3]=Math.max(t[3],e[1])}function ka(t,e){return!(t[0]<=e[0]||t[2]>=e[2]||t[1]<=e[1]||t[3]>=e[3])}function oo(t,e){const i=(180+t[0])/360,r=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t[1]*Math.PI/360)))/360,o=Math.pow(2,e.z);return[Math.round(i*o*zr),Math.round(r*o*zr)]}function cc(t,e,i){const r=t[0]-e[0],o=t[1]-e[1],c=t[0]-i[0],u=t[1]-i[1];return r*u-c*o==0&&r*c<=0&&o*u<=0}function No(t,e){let i=!1;for(let u=0,p=e.length;u<p;u++){const f=e[u];for(let _=0,x=f.length;_<x-1;_++){if(cc(t,f[_],f[_+1]))return!1;(o=f[_])[1]>(r=t)[1]!=(c=f[_+1])[1]>r[1]&&r[0]<(c[0]-o[0])*(r[1]-o[1])/(c[1]-o[1])+o[0]&&(i=!i)}}var r,o,c;return i}function js(t,e){for(let i=0;i<e.length;i++)if(No(t,e[i]))return!0;return!1}function Zs(t,e,i,r){const o=r[0]-i[0],c=r[1]-i[1],u=(t[0]-i[0])*c-o*(t[1]-i[1]),p=(e[0]-i[0])*c-o*(e[1]-i[1]);return u>0&&p<0||u<0&&p>0}function Aa(t,e,i){for(const _ of i)for(let x=0;x<_.length-1;++x)if((p=[(u=_[x+1])[0]-(c=_[x])[0],u[1]-c[1]])[0]*(f=[(o=e)[0]-(r=t)[0],o[1]-r[1]])[1]-p[1]*f[0]!=0&&Zs(r,o,c,u)&&Zs(c,u,r,o))return!0;var r,o,c,u,p,f;return!1}function li(t,e){for(let i=0;i<t.length;++i)if(!No(t[i],e))return!1;for(let i=0;i<t.length-1;++i)if(Aa(t[i],t[i+1],e))return!1;return!0}function Dh(t,e){for(let i=0;i<e.length;i++)if(li(t,e[i]))return!0;return!1}function Gs(t,e,i){const r=[];for(let o=0;o<t.length;o++){const c=[];for(let u=0;u<t[o].length;u++){const p=oo(t[o][u],i);Vo(e,p),c.push(p)}r.push(c)}return r}function hc(t,e,i){const r=[];for(let o=0;o<t.length;o++){const c=Gs(t[o],e,i);r.push(c)}return r}function qs(t,e,i,r){if(t[0]<i[0]||t[0]>i[2]){const o=.5*r;let c=t[0]-i[0]>o?-r:i[0]-t[0]>o?r:0;0===c&&(c=t[0]-i[2]>o?-r:i[2]-t[0]>o?r:0),t[0]+=c}Vo(e,t)}function uc(t,e,i,r){const o=Math.pow(2,r.z)*zr,c=[r.x*zr,r.y*zr],u=[];if(!t)return u;for(const p of t)for(const f of p){const _=[f.x+c[0],f.y+c[1]];qs(_,e,i,o),u.push(_)}return u}function $s(t,e,i,r){const o=Math.pow(2,r.z)*zr,c=[r.x*zr,r.y*zr],u=[];if(!t)return u;for(const f of t){const _=[];for(const x of f){const w=[x.x+c[0],x.y+c[1]];Vo(e,w),_.push(w)}u.push(_)}if(e[2]-e[0]<=o/2){(p=e)[0]=p[1]=1/0,p[2]=p[3]=-1/0;for(const f of u)for(const _ of f)qs(_,e,i,o)}var p;return u}class Ca{constructor(e,i){this.type=se,this.geojson=e,this.geometries=i}static parse(e,i){if(2!==e.length)return i.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(no(e[1])){const r=e[1];if("FeatureCollection"===r.type)for(let o=0;o<r.features.length;++o){const c=r.features[o].geometry.type;if("Polygon"===c||"MultiPolygon"===c)return new Ca(r,r.features[o].geometry)}else if("Feature"===r.type){const o=r.geometry.type;if("Polygon"===o||"MultiPolygon"===o)return new Ca(r,r.geometry)}else if("Polygon"===r.type||"MultiPolygon"===r.type)return new Ca(r,r)}return i.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(null!=e.geometry()&&null!=e.canonicalID()){if("Point"===e.geometryType())return function(i,r){const o=[1/0,1/0,-1/0,-1/0],c=[1/0,1/0,-1/0,-1/0],u=i.canonicalID();if(!u)return!1;if("Polygon"===r.type){const p=Gs(r.coordinates,c,u),f=uc(i.geometry(),o,c,u);if(!ka(o,c))return!1;for(const _ of f)if(!No(_,p))return!1}if("MultiPolygon"===r.type){const p=hc(r.coordinates,c,u),f=uc(i.geometry(),o,c,u);if(!ka(o,c))return!1;for(const _ of f)if(!js(_,p))return!1}return!0}(e,this.geometries);if("LineString"===e.geometryType())return function(i,r){const o=[1/0,1/0,-1/0,-1/0],c=[1/0,1/0,-1/0,-1/0],u=i.canonicalID();if(!u)return!1;if("Polygon"===r.type){const p=Gs(r.coordinates,c,u),f=$s(i.geometry(),o,c,u);if(!ka(o,c))return!1;for(const _ of f)if(!li(_,p))return!1}if("MultiPolygon"===r.type){const p=hc(r.coordinates,c,u),f=$s(i.geometry(),o,c,u);if(!ka(o,c))return!1;for(const _ of f)if(!Dh(_,p))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var jo=Ca;function Ma(t){if(t instanceof Pr&&("get"===t.name&&1===t.args.length||"feature-state"===t.name||"has"===t.name&&1===t.args.length||"properties"===t.name||"geometry-type"===t.name||"id"===t.name||/^filter-/.test(t.name))||t instanceof jo)return!1;let e=!0;return t.eachChild(i=>{e&&!Ma(i)&&(e=!1)}),e}function Lr(t){if(t instanceof Pr&&"feature-state"===t.name)return!1;let e=!0;return t.eachChild(i=>{e&&!Lr(i)&&(e=!1)}),e}function ca(t,e){if(t instanceof Pr&&e.indexOf(t.name)>=0)return!1;let i=!0;return t.eachChild(r=>{i&&!ca(r,e)&&(i=!1)}),i}class Zo{constructor(e,i){this.type=i.type,this.name=e,this.boundExpression=i}static parse(e,i){if(2!==e.length||"string"!=typeof e[1])return i.error("'var' expression requires exactly one string literal argument.");const r=e[1];return i.scope.has(r)?new Zo(r,i.scope.get(r)):i.error(`Unknown variable "${r}". Make sure "${r}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var dc=Zo;class so{constructor(e,i=[],r,o=new b,c=[]){this.registry=e,this.path=i,this.key=i.map(u=>`[${u}]`).join(""),this.scope=o,this.errors=c,this.expectedType=r}parse(e,i,r,o,c={}){return i?this.concat(i,r,o)._parse(e,c):this._parse(e,c)}_parse(e,i){function r(o,c,u){return"assert"===u?new Sr(c,[o]):"coerce"===u?new Ea(c,[o]):o}if(null!==e&&"string"!=typeof e&&"boolean"!=typeof e&&"number"!=typeof e||(e=["literal",e]),Array.isArray(e)){if(0===e.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const o=e[0];if("string"!=typeof o)return this.error(`Expression name must be a string, but found ${typeof o} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const c=this.registry[o];if(c){let u=c.parse(e,this);if(!u)return null;if(this.expectedType){const p=this.expectedType,f=u.type;if("string"!==p.kind&&"number"!==p.kind&&"boolean"!==p.kind&&"object"!==p.kind&&"array"!==p.kind||"value"!==f.kind)if("color"!==p.kind&&"formatted"!==p.kind&&"resolvedImage"!==p.kind||"value"!==f.kind&&"string"!==f.kind){if(this.checkSubtype(p,f))return null}else u=r(u,p,i.typeAnnotation||"coerce");else u=r(u,p,i.typeAnnotation||"assert")}if(!(u instanceof sa)&&"resolvedImage"!==u.type.kind&&Hs(u)){const p=new Ns;try{u=new sa(u.type,u.evaluate(p))}catch(f){return this.error(f.message),null}}return u}return this.error(`Unknown expression "${o}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===e?"'undefined' value invalid. Use null instead.":"object"==typeof e?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,i,r){const o="number"==typeof e?this.path.concat(e):this.path,c=r?this.scope.concat(r):this.scope;return new so(this.registry,o,i||null,c,this.errors)}error(e,...i){const r=`${this.key}${i.map(o=>`[${o}]`).join("")}`;this.errors.push(new ie(r,e))}checkSubtype(e,i){const r=Ir(e,i);return r&&this.error(r),r}}var Ws=so;function Hs(t){if(t instanceof dc)return Hs(t.boundExpression);if(t instanceof Pr&&"error"===t.name||t instanceof ao||t instanceof jo)return!1;const e=t instanceof Ea||t instanceof Sr;let i=!0;return t.eachChild(r=>{i=e?i&&Hs(r):i&&r instanceof sa}),!!i&&Ma(t)&&ca(t,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function Go(t,e){const i=t.length-1;let r,o,c=0,u=i,p=0;for(;c<=u;)if(p=Math.floor((c+u)/2),r=t[p],o=t[p+1],r<=e){if(p===i||e<o)return p;c=p+1}else{if(!(r>e))throw new un("Input is not a number.");u=p-1}return 0}class qo{constructor(e,i,r){this.type=e,this.input=i,this.labels=[],this.outputs=[];for(const[o,c]of r)this.labels.push(o),this.outputs.push(c)}static parse(e,i){if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");const r=i.parse(e[1],1,z);if(!r)return null;const o=[];let c=null;i.expectedType&&"value"!==i.expectedType.kind&&(c=i.expectedType);for(let u=1;u<e.length;u+=2){const p=1===u?-1/0:e[u],f=e[u+1],_=u,x=u+1;if("number"!=typeof p)return i.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',_);if(o.length&&o[o.length-1][0]>=p)return i.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',_);const w=i.parse(f,x,c);if(!w)return null;c=c||w.type,o.push([p,w])}return new qo(c,r,o)}evaluate(e){const i=this.labels,r=this.outputs;if(1===i.length)return r[0].evaluate(e);const o=this.input.evaluate(e);if(o<=i[0])return r[0].evaluate(e);const c=i.length;return o>=i[c-1]?r[c-1].evaluate(e):r[Go(i,o)].evaluate(e)}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let i=0;i<this.labels.length;i++)i>0&&e.push(this.labels[i]),e.push(this.outputs[i].serialize());return e}}var Ys=qo;function ei(t,e,i){return t*(1-i)+e*i}var lo=Object.freeze({__proto__:null,array:function(t,e,i){return t.map((r,o)=>ei(r,e[o],i))},color:function(t,e,i){return new Zi(ei(t.r,e.r,i),ei(t.g,e.g,i),ei(t.b,e.b,i),ei(t.a,e.a,i))},number:ei});const mc=4/29,ha=6/29,Ks=3*ha*ha,Ih=ha*ha*ha,Sh=Math.PI/180,Ph=180/Math.PI;function Js(t){return t>Ih?Math.pow(t,1/3):t/Ks+mc}function Qs(t){return t>ha?t*t*t:Ks*(t-mc)}function el(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function $o(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function fc(t){const e=$o(t.r),i=$o(t.g),r=$o(t.b),o=Js((.4124564*e+.3575761*i+.1804375*r)/.95047),c=Js((.2126729*e+.7151522*i+.072175*r)/1);return{l:116*c-16,a:500*(o-c),b:200*(c-Js((.0193339*e+.119192*i+.9503041*r)/1.08883)),alpha:t.a}}function _c(t){let e=(t.l+16)/116,i=isNaN(t.a)?e:e+t.a/500,r=isNaN(t.b)?e:e-t.b/200;return e=1*Qs(e),i=.95047*Qs(i),r=1.08883*Qs(r),new Zi(el(3.2404542*i-1.5371385*e-.4985314*r),el(-.969266*i+1.8760108*e+.041556*r),el(.0556434*i-.2040259*e+1.0572252*r),t.alpha)}function zh(t,e,i){const r=e-t;return t+i*(r>180||r<-180?r-360*Math.round(r/360):r)}const co={forward:fc,reverse:_c,interpolate:function(t,e,i){return{l:ei(t.l,e.l,i),a:ei(t.a,e.a,i),b:ei(t.b,e.b,i),alpha:ei(t.alpha,e.alpha,i)}}},Da={forward:function(t){const{l:e,a:i,b:r}=fc(t),o=Math.atan2(r,i)*Ph;return{h:o<0?o+360:o,c:Math.sqrt(i*i+r*r),l:e,alpha:t.a}},reverse:function(t){const e=t.h*Sh,i=t.c;return _c({l:t.l,a:Math.cos(e)*i,b:Math.sin(e)*i,alpha:t.alpha})},interpolate:function(t,e,i){return{h:zh(t.h,e.h,i),c:ei(t.c,e.c,i),l:ei(t.l,e.l,i),alpha:ei(t.alpha,e.alpha,i)}}};var tl=Object.freeze({__proto__:null,hcl:Da,lab:co});class ho{constructor(e,i,r,o,c){this.type=e,this.operator=i,this.interpolation=r,this.input=o,this.labels=[],this.outputs=[];for(const[u,p]of c)this.labels.push(u),this.outputs.push(p)}static interpolationFactor(e,i,r,o){let c=0;if("exponential"===e.name)c=il(i,e.base,r,o);else if("linear"===e.name)c=il(i,1,r,o);else if("cubic-bezier"===e.name){const u=e.controlPoints;c=new Gt(u[0],u[1],u[2],u[3]).solve(il(i,1,r,o))}return c}static parse(e,i){let[r,o,c,...u]=e;if(!Array.isArray(o)||0===o.length)return i.error("Expected an interpolation type expression.",1);if("linear"===o[0])o={name:"linear"};else if("exponential"===o[0]){const _=o[1];if("number"!=typeof _)return i.error("Exponential interpolation requires a numeric base.",1,1);o={name:"exponential",base:_}}else{if("cubic-bezier"!==o[0])return i.error(`Unknown interpolation type ${String(o[0])}`,1,0);{const _=o.slice(1);if(4!==_.length||_.some(x=>"number"!=typeof x||x<0||x>1))return i.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);o={name:"cubic-bezier",controlPoints:_}}}if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");if(c=i.parse(c,2,z),!c)return null;const p=[];let f=null;"interpolate-hcl"===r||"interpolate-lab"===r?f=_t:i.expectedType&&"value"!==i.expectedType.kind&&(f=i.expectedType);for(let _=0;_<u.length;_+=2){const x=u[_],w=u[_+1],E=_+3,C=_+4;if("number"!=typeof x)return i.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',E);if(p.length&&p[p.length-1][0]>=x)return i.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',E);const D=i.parse(w,C,f);if(!D)return null;f=f||D.type,p.push([x,D])}return"number"===f.kind||"color"===f.kind||"array"===f.kind&&"number"===f.itemType.kind&&"number"==typeof f.N?new ho(f,r,o,c,p):i.error(`Type ${Ii(f)} is not interpolatable.`)}evaluate(e){const i=this.labels,r=this.outputs;if(1===i.length)return r[0].evaluate(e);const o=this.input.evaluate(e);if(o<=i[0])return r[0].evaluate(e);const c=i.length;if(o>=i[c-1])return r[c-1].evaluate(e);const u=Go(i,o),p=ho.interpolationFactor(this.interpolation,o,i[u],i[u+1]),f=r[u].evaluate(e),_=r[u+1].evaluate(e);return"interpolate"===this.operator?lo[this.type.kind.toLowerCase()](f,_,p):"interpolate-hcl"===this.operator?Da.reverse(Da.interpolate(Da.forward(f),Da.forward(_),p)):co.reverse(co.interpolate(co.forward(f),co.forward(_),p))}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const i=[this.operator,e,this.input.serialize()];for(let r=0;r<this.labels.length;r++)i.push(this.labels[r],this.outputs[r].serialize());return i}}function il(t,e,i,r){const o=r-i,c=t-i;return 0===o?0:1===e?c/o:(Math.pow(e,c)-1)/(Math.pow(e,o)-1)}var xr=ho;class Wo{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expectected at least one argument.");let r=null;const o=i.expectedType;o&&"value"!==o.kind&&(r=o);const c=[];for(const p of e.slice(1)){const f=i.parse(p,1+c.length,r,void 0,{typeAnnotation:"omit"});if(!f)return null;r=r||f.type,c.push(f)}const u=o&&c.some(p=>Ir(o,p.type));return new Wo(u?At:r,c)}evaluate(e){let i,r=null,o=0;for(const c of this.args){if(o++,r=c.evaluate(e),r&&r instanceof er&&!r.available&&(i||(i=r),r=null,o===this.args.length))return i;if(null!==r)break}return r}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(i=>{e.push(i.serialize())}),e}}var nl=Wo;class Ho{constructor(e,i){this.type=i.type,this.bindings=[].concat(e),this.result=i}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const i of this.bindings)e(i[1]);e(this.result)}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const r=[];for(let c=1;c<e.length-1;c+=2){const u=e[c];if("string"!=typeof u)return i.error(`Expected string, but found ${typeof u} instead.`,c);if(/[^a-zA-Z0-9_]/.test(u))return i.error("Variable names must contain only alphanumeric characters or '_'.",c);const p=i.parse(e[c+1],c+1);if(!p)return null;r.push([u,p])}const o=i.parse(e[e.length-1],e.length-1,i.expectedType,r);return o?new Ho(r,o):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[i,r]of this.bindings)e.push(i,r.serialize());return e.push(this.result.serialize()),e}}var gc=Ho;class rl{constructor(e,i,r){this.type=e,this.index=i,this.input=r}static parse(e,i){if(3!==e.length)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const r=i.parse(e[1],1,z),o=i.parse(e[2],2,Qn(i.expectedType||At));return r&&o?new rl(o.type.itemType,r,o):null}evaluate(e){const i=this.index.evaluate(e),r=this.input.evaluate(e);if(i<0)throw new un(`Array index out of bounds: ${i} < 0.`);if(i>=r.length)throw new un(`Array index out of bounds: ${i} > ${r.length-1}.`);if(i!==Math.floor(i))throw new un(`Array index must be an integer, but found ${i} instead.`);return r[i]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var Lh=rl;class al{constructor(e,i){this.type=se,this.needle=e,this.haystack=i}static parse(e,i){if(3!==e.length)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const r=i.parse(e[1],1,At),o=i.parse(e[2],2,At);return r&&o?Qa(r.type,[se,W,z,I,At])?new al(r,o):i.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ii(r.type)} instead`):null}evaluate(e){const i=this.needle.evaluate(e),r=this.haystack.evaluate(e);if(null==r)return!1;if(!eo(i,["boolean","string","number","null"]))throw new un(`Expected first argument to be of type boolean, string, number or null, but found ${Ii(Vi(i))} instead.`);if(!eo(r,["string","array"]))throw new un(`Expected second argument to be of type array or string, but found ${Ii(Vi(r))} instead.`);return r.indexOf(i)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var Yo=al;class uo{constructor(e,i,r){this.type=z,this.needle=e,this.haystack=i,this.fromIndex=r}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const r=i.parse(e[1],1,At),o=i.parse(e[2],2,At);if(!r||!o)return null;if(!Qa(r.type,[se,W,z,I,At]))return i.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ii(r.type)} instead`);if(4===e.length){const c=i.parse(e[3],3,z);return c?new uo(r,o,c):null}return new uo(r,o)}evaluate(e){const i=this.needle.evaluate(e),r=this.haystack.evaluate(e);if(!eo(i,["boolean","string","number","null"]))throw new un(`Expected first argument to be of type boolean, string, number or null, but found ${Ii(Vi(i))} instead.`);if(!eo(r,["string","array"]))throw new un(`Expected second argument to be of type array or string, but found ${Ii(Vi(r))} instead.`);if(this.fromIndex){const o=this.fromIndex.evaluate(e);return r.indexOf(i,o)}return r.indexOf(i)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var yc=uo;class ol{constructor(e,i,r,o,c,u){this.inputType=e,this.type=i,this.input=r,this.cases=o,this.outputs=c,this.otherwise=u}static parse(e,i){if(e.length<5)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return i.error("Expected an even number of arguments.");let r,o;i.expectedType&&"value"!==i.expectedType.kind&&(o=i.expectedType);const c={},u=[];for(let _=2;_<e.length-1;_+=2){let x=e[_];const w=e[_+1];Array.isArray(x)||(x=[x]);const E=i.concat(_);if(0===x.length)return E.error("Expected at least one branch label.");for(const D of x){if("number"!=typeof D&&"string"!=typeof D)return E.error("Branch labels must be numbers or strings.");if("number"==typeof D&&Math.abs(D)>Number.MAX_SAFE_INTEGER)return E.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof D&&Math.floor(D)!==D)return E.error("Numeric branch labels must be integer values.");if(r){if(E.checkSubtype(r,Vi(D)))return null}else r=Vi(D);if(void 0!==c[String(D)])return E.error("Branch labels must be unique.");c[String(D)]=u.length}const C=i.parse(w,_,o);if(!C)return null;o=o||C.type,u.push(C)}const p=i.parse(e[1],1,At);if(!p)return null;const f=i.parse(e[e.length-1],e.length-1,o);return f?"value"!==p.type.kind&&i.concat(1).checkSubtype(r,p.type)?null:new ol(r,o,p,c,u,f):null}evaluate(e){const i=this.input.evaluate(e);return(Vi(i)===this.inputType&&this.outputs[this.cases[i]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],i=Object.keys(this.cases).sort(),r=[],o={};for(const u of i){const p=o[this.cases[u]];void 0===p?(o[this.cases[u]]=r.length,r.push([this.cases[u],[u]])):r[p][1].push(u)}const c=u=>"number"===this.inputType.kind?Number(u):u;for(const[u,p]of r)e.push(1===p.length?c(p[0]):p.map(c)),e.push(this.outputs[u].serialize());return e.push(this.otherwise.serialize()),e}}var Rh=ol;class sl{constructor(e,i,r){this.type=e,this.branches=i,this.otherwise=r}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return i.error("Expected an odd number of arguments.");let r;i.expectedType&&"value"!==i.expectedType.kind&&(r=i.expectedType);const o=[];for(let u=1;u<e.length-1;u+=2){const p=i.parse(e[u],u,se);if(!p)return null;const f=i.parse(e[u+1],u+1,r);if(!f)return null;o.push([p,f]),r=r||f.type}const c=i.parse(e[e.length-1],e.length-1,r);return c?new sl(r,o,c):null}evaluate(e){for(const[i,r]of this.branches)if(i.evaluate(e))return r.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[i,r]of this.branches)e(i),e(r);e(this.otherwise)}outputDefined(){return this.branches.every(([e,i])=>i.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(i=>{e.push(i.serialize())}),e}}var xc=sl;class po{constructor(e,i,r,o){this.type=e,this.input=i,this.beginIndex=r,this.endIndex=o}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const r=i.parse(e[1],1,At),o=i.parse(e[2],2,z);if(!r||!o)return null;if(!Qa(r.type,[Qn(At),W,At]))return i.error(`Expected first argument to be of type array or string, but found ${Ii(r.type)} instead`);if(4===e.length){const c=i.parse(e[3],3,z);return c?new po(r.type,r,o,c):null}return new po(r.type,r,o)}evaluate(e){const i=this.input.evaluate(e),r=this.beginIndex.evaluate(e);if(!eo(i,["string","array"]))throw new un(`Expected first argument to be of type array or string, but found ${Ii(Vi(i))} instead.`);if(this.endIndex){const o=this.endIndex.evaluate(e);return i.slice(r,o)}return i.slice(r)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var vc=po;function Xo(t,e){return"=="===t||"!="===t?"boolean"===e.kind||"string"===e.kind||"number"===e.kind||"null"===e.kind||"value"===e.kind:"string"===e.kind||"number"===e.kind||"value"===e.kind}function bc(t,e,i,r){return 0===r.compare(e,i)}function Ia(t,e,i){const r="=="!==t&&"!="!==t;return class Om{constructor(c,u,p){this.type=se,this.lhs=c,this.rhs=u,this.collator=p,this.hasUntypedArgument="value"===c.type.kind||"value"===u.type.kind}static parse(c,u){if(3!==c.length&&4!==c.length)return u.error("Expected two or three arguments.");const p=c[0];let f=u.parse(c[1],1,At);if(!f)return null;if(!Xo(p,f.type))return u.concat(1).error(`"${p}" comparisons are not supported for type '${Ii(f.type)}'.`);let _=u.parse(c[2],2,At);if(!_)return null;if(!Xo(p,_.type))return u.concat(2).error(`"${p}" comparisons are not supported for type '${Ii(_.type)}'.`);if(f.type.kind!==_.type.kind&&"value"!==f.type.kind&&"value"!==_.type.kind)return u.error(`Cannot compare types '${Ii(f.type)}' and '${Ii(_.type)}'.`);r&&("value"===f.type.kind&&"value"!==_.type.kind?f=new Sr(_.type,[f]):"value"!==f.type.kind&&"value"===_.type.kind&&(_=new Sr(f.type,[_])));let x=null;if(4===c.length){if("string"!==f.type.kind&&"string"!==_.type.kind&&"value"!==f.type.kind&&"value"!==_.type.kind)return u.error("Cannot use collator to compare non-string types.");if(x=u.parse(c[3],3,mi),!x)return null}return new Om(f,_,x)}evaluate(c){const u=this.lhs.evaluate(c),p=this.rhs.evaluate(c);if(r&&this.hasUntypedArgument){const f=Vi(u),_=Vi(p);if(f.kind!==_.kind||"string"!==f.kind&&"number"!==f.kind)throw new un(`Expected arguments for "${t}" to be (string, string) or (number, number), but found (${f.kind}, ${_.kind}) instead.`)}if(this.collator&&!r&&this.hasUntypedArgument){const f=Vi(u),_=Vi(p);if("string"!==f.kind||"string"!==_.kind)return e(c,u,p)}return this.collator?i(c,u,p,this.collator.evaluate(c)):e(c,u,p)}eachChild(c){c(this.lhs),c(this.rhs),this.collator&&c(this.collator)}outputDefined(){return!0}serialize(){const c=[t];return this.eachChild(u=>{c.push(u.serialize())}),c}}}const Oh=Ia("==",function(t,e,i){return e===i},bc),Bh=Ia("!=",function(t,e,i){return e!==i},function(t,e,i,r){return!bc(0,e,i,r)}),Fh=Ia("<",function(t,e,i){return e<i},function(t,e,i,r){return r.compare(e,i)<0}),Uh=Ia(">",function(t,e,i){return e>i},function(t,e,i,r){return r.compare(e,i)>0}),Vh=Ia("<=",function(t,e,i){return e<=i},function(t,e,i,r){return r.compare(e,i)<=0}),wc=Ia(">=",function(t,e,i){return e>=i},function(t,e,i,r){return r.compare(e,i)>=0});class Ko{constructor(e,i,r,o,c,u){this.type=W,this.number=e,this.locale=i,this.currency=r,this.unit=o,this.minFractionDigits=c,this.maxFractionDigits=u}static parse(e,i){if(3!==e.length)return i.error("Expected two arguments.");const r=i.parse(e[1],1,z);if(!r)return null;const o=e[2];if("object"!=typeof o||Array.isArray(o))return i.error("NumberFormat options argument must be an object.");let c=null;if(o.locale&&(c=i.parse(o.locale,1,W),!c))return null;let u=null;if(o.currency&&(u=i.parse(o.currency,1,W),!u))return null;let p=null;if(o.unit&&(p=i.parse(o.unit,1,W),!p))return null;let f=null;if(o["min-fraction-digits"]&&(f=i.parse(o["min-fraction-digits"],1,z),!f))return null;let _=null;return o["max-fraction-digits"]&&(_=i.parse(o["max-fraction-digits"],1,z),!_)?null:new Ko(r,c,u,p,f,_)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class Sa{constructor(e){this.type=z,this.input=e}static parse(e,i){if(2!==e.length)return i.error(`Expected 1 argument, but found ${e.length-1} instead.`);const r=i.parse(e[1],1);return r?"array"!==r.type.kind&&"string"!==r.type.kind&&"value"!==r.type.kind?i.error(`Expected argument of type string or array, but found ${Ii(r.type)} instead.`):new Sa(r):null}evaluate(e){const i=this.input.evaluate(e);if("string"==typeof i||Array.isArray(i))return i.length;throw new un(`Expected value to be of type string or array, but found ${Ii(Vi(i))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(i=>{e.push(i.serialize())}),e}}const Tc={"==":Oh,"!=":Bh,">":Uh,"<":Fh,">=":wc,"<=":Vh,array:Sr,at:Lh,boolean:Sr,case:xc,coalesce:nl,collator:ao,format:Hr,image:Uo,in:Yo,"index-of":yc,interpolate:xr,"interpolate-hcl":xr,"interpolate-lab":xr,length:Sa,let:gc,literal:sa,match:Rh,number:Sr,"number-format":Ko,object:Sr,slice:vc,step:Ys,string:Sr,"to-boolean":Ea,"to-color":Ea,"to-number":Ea,"to-string":Ea,var:dc,within:jo};function Ec(t,[e,i,r,o]){e=e.evaluate(t),i=i.evaluate(t),r=r.evaluate(t);const c=o?o.evaluate(t):1,u=lc(e,i,r,c);if(u)throw new un(u);return new Zi(e/255*c,i/255*c,r/255*c,c)}function Rr(t,e){return t in e}function Jo(t,e){const i=e[t];return void 0===i?null:i}function tr(t){return{type:t}}Pr.register(Tc,{error:[{kind:"error"},[W],(t,[e])=>{throw new un(e.evaluate(t))}],typeof:[W,[At],(t,[e])=>Ii(Vi(e.evaluate(t)))],"to-rgba":[Qn(z,4),[_t],(t,[e])=>e.evaluate(t).toArray()],rgb:[_t,[z,z,z],Ec],rgba:[_t,[z,z,z,z],Ec],has:{type:se,overloads:[[[W],(t,[e])=>Rr(e.evaluate(t),t.properties())],[[W,Kt],(t,[e,i])=>Rr(e.evaluate(t),i.evaluate(t))]]},get:{type:At,overloads:[[[W],(t,[e])=>Jo(e.evaluate(t),t.properties())],[[W,Kt],(t,[e,i])=>Jo(e.evaluate(t),i.evaluate(t))]]},"feature-state":[At,[W],(t,[e])=>Jo(e.evaluate(t),t.featureState||{})],properties:[Kt,[],t=>t.properties()],"geometry-type":[W,[],t=>t.geometryType()],id:[At,[],t=>t.id()],zoom:[z,[],t=>t.globals.zoom],pitch:[z,[],t=>t.globals.pitch||0],"distance-from-center":[z,[],t=>t.distanceFromCenter()],"heatmap-density":[z,[],t=>t.globals.heatmapDensity||0],"line-progress":[z,[],t=>t.globals.lineProgress||0],"sky-radial-progress":[z,[],t=>t.globals.skyRadialProgress||0],accumulated:[At,[],t=>void 0===t.globals.accumulated?null:t.globals.accumulated],"+":[z,tr(z),(t,e)=>{let i=0;for(const r of e)i+=r.evaluate(t);return i}],"*":[z,tr(z),(t,e)=>{let i=1;for(const r of e)i*=r.evaluate(t);return i}],"-":{type:z,overloads:[[[z,z],(t,[e,i])=>e.evaluate(t)-i.evaluate(t)],[[z],(t,[e])=>-e.evaluate(t)]]},"/":[z,[z,z],(t,[e,i])=>e.evaluate(t)/i.evaluate(t)],"%":[z,[z,z],(t,[e,i])=>e.evaluate(t)%i.evaluate(t)],ln2:[z,[],()=>Math.LN2],pi:[z,[],()=>Math.PI],e:[z,[],()=>Math.E],"^":[z,[z,z],(t,[e,i])=>Math.pow(e.evaluate(t),i.evaluate(t))],sqrt:[z,[z],(t,[e])=>Math.sqrt(e.evaluate(t))],log10:[z,[z],(t,[e])=>Math.log(e.evaluate(t))/Math.LN10],ln:[z,[z],(t,[e])=>Math.log(e.evaluate(t))],log2:[z,[z],(t,[e])=>Math.log(e.evaluate(t))/Math.LN2],sin:[z,[z],(t,[e])=>Math.sin(e.evaluate(t))],cos:[z,[z],(t,[e])=>Math.cos(e.evaluate(t))],tan:[z,[z],(t,[e])=>Math.tan(e.evaluate(t))],asin:[z,[z],(t,[e])=>Math.asin(e.evaluate(t))],acos:[z,[z],(t,[e])=>Math.acos(e.evaluate(t))],atan:[z,[z],(t,[e])=>Math.atan(e.evaluate(t))],min:[z,tr(z),(t,e)=>Math.min(...e.map(i=>i.evaluate(t)))],max:[z,tr(z),(t,e)=>Math.max(...e.map(i=>i.evaluate(t)))],abs:[z,[z],(t,[e])=>Math.abs(e.evaluate(t))],round:[z,[z],(t,[e])=>{const i=e.evaluate(t);return i<0?-Math.round(-i):Math.round(i)}],floor:[z,[z],(t,[e])=>Math.floor(e.evaluate(t))],ceil:[z,[z],(t,[e])=>Math.ceil(e.evaluate(t))],"filter-==":[se,[W,At],(t,[e,i])=>t.properties()[e.value]===i.value],"filter-id-==":[se,[At],(t,[e])=>t.id()===e.value],"filter-type-==":[se,[W],(t,[e])=>t.geometryType()===e.value],"filter-<":[se,[W,At],(t,[e,i])=>{const r=t.properties()[e.value],o=i.value;return typeof r==typeof o&&r<o}],"filter-id-<":[se,[At],(t,[e])=>{const i=t.id(),r=e.value;return typeof i==typeof r&&i<r}],"filter->":[se,[W,At],(t,[e,i])=>{const r=t.properties()[e.value],o=i.value;return typeof r==typeof o&&r>o}],"filter-id->":[se,[At],(t,[e])=>{const i=t.id(),r=e.value;return typeof i==typeof r&&i>r}],"filter-<=":[se,[W,At],(t,[e,i])=>{const r=t.properties()[e.value],o=i.value;return typeof r==typeof o&&r<=o}],"filter-id-<=":[se,[At],(t,[e])=>{const i=t.id(),r=e.value;return typeof i==typeof r&&i<=r}],"filter->=":[se,[W,At],(t,[e,i])=>{const r=t.properties()[e.value],o=i.value;return typeof r==typeof o&&r>=o}],"filter-id->=":[se,[At],(t,[e])=>{const i=t.id(),r=e.value;return typeof i==typeof r&&i>=r}],"filter-has":[se,[At],(t,[e])=>e.value in t.properties()],"filter-has-id":[se,[],t=>null!==t.id()&&void 0!==t.id()],"filter-type-in":[se,[Qn(W)],(t,[e])=>e.value.indexOf(t.geometryType())>=0],"filter-id-in":[se,[Qn(At)],(t,[e])=>e.value.indexOf(t.id())>=0],"filter-in-small":[se,[W,Qn(At)],(t,[e,i])=>i.value.indexOf(t.properties()[e.value])>=0],"filter-in-large":[se,[W,Qn(At)],(t,[e,i])=>function(r,o,c,u){for(;c<=u;){const p=c+u>>1;if(o[p]===r)return!0;o[p]>r?u=p-1:c=p+1}return!1}(t.properties()[e.value],i.value,0,i.value.length-1)],all:{type:se,overloads:[[[se,se],(t,[e,i])=>e.evaluate(t)&&i.evaluate(t)],[tr(se),(t,e)=>{for(const i of e)if(!i.evaluate(t))return!1;return!0}]]},any:{type:se,overloads:[[[se,se],(t,[e,i])=>e.evaluate(t)||i.evaluate(t)],[tr(se),(t,e)=>{for(const i of e)if(i.evaluate(t))return!0;return!1}]]},"!":[se,[se],(t,[e])=>!e.evaluate(t)],"is-supported-script":[se,[W],(t,[e])=>{const i=t.globals&&t.globals.isSupportedScript;return!i||i(e.evaluate(t))}],upcase:[W,[W],(t,[e])=>e.evaluate(t).toUpperCase()],downcase:[W,[W],(t,[e])=>e.evaluate(t).toLowerCase()],concat:[W,tr(At),(t,e)=>e.map(i=>ro(i.evaluate(t))).join("")],"resolved-locale":[W,[mi],(t,[e])=>e.evaluate(t).resolvedLocale()]});var mo=Tc;function kc(t){return{result:"success",value:t}}function ua(t){return{result:"error",value:t}}function Pa(t){return"data-driven"===t["property-type"]}function Qo(t){return!!t.expression&&t.expression.parameters.indexOf("zoom")>-1}function es(t){return!!t.expression&&t.expression.interpolated}function ni(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":null===t?"null":typeof t}function fo(t){return"object"==typeof t&&null!==t&&!Array.isArray(t)}function Ac(t){return t}function ts(t,e){const i="color"===e.type,r=t.stops&&"object"==typeof t.stops[0][0],o=r||!(r||void 0!==t.property),c=t.type||(es(e)?"exponential":"interval");if(i&&((t=Kn({},t)).stops&&(t.stops=t.stops.map(_=>[_[0],Zi.parse(_[1])])),t.default=Zi.parse(t.default?t.default:e.default)),t.colorSpace&&"rgb"!==t.colorSpace&&!tl[t.colorSpace])throw new Error(`Unknown color space: ${t.colorSpace}`);let u,p,f;if("exponential"===c)u=Or;else if("interval"===c)u=is;else if("categorical"===c){u=Cc,p=Object.create(null);for(const _ of t.stops)p[_[0]]=_[1];f=typeof t.stops[0][0]}else{if("identity"!==c)throw new Error(`Unknown function type "${c}"`);u=Mc}if(r){const _={},x=[];for(let C=0;C<t.stops.length;C++){const D=t.stops[C],L=D[0].zoom;void 0===_[L]&&(_[L]={zoom:L,type:t.type,property:t.property,default:t.default,stops:[]},x.push(L)),_[L].stops.push([D[0].value,D[1]])}const w=[];for(const C of x)w.push([_[C].zoom,ts(_[C],e)]);const E={name:"linear"};return{kind:"composite",interpolationType:E,interpolationFactor:xr.interpolationFactor.bind(void 0,E),zoomStops:w.map(C=>C[0]),evaluate:({zoom:C},D)=>Or({stops:w,base:t.base},e,C).evaluate(C,D)}}if(o){const _="exponential"===c?{name:"exponential",base:void 0!==t.base?t.base:1}:null;return{kind:"camera",interpolationType:_,interpolationFactor:xr.interpolationFactor.bind(void 0,_),zoomStops:t.stops.map(x=>x[0]),evaluate:({zoom:x})=>u(t,e,x,p,f)}}return{kind:"source",evaluate(_,x){const w=x&&x.properties?x.properties[t.property]:void 0;return void 0===w?za(t.default,e.default):u(t,e,w,p,f)}}}function za(t,e,i){return void 0!==t?t:void 0!==e?e:void 0!==i?i:void 0}function Cc(t,e,i,r,o){return za(typeof i===o?r[i]:void 0,t.default,e.default)}function is(t,e,i){if("number"!==ni(i))return za(t.default,e.default);const r=t.stops.length;if(1===r||i<=t.stops[0][0])return t.stops[0][1];if(i>=t.stops[r-1][0])return t.stops[r-1][1];const o=Go(t.stops.map(c=>c[0]),i);return t.stops[o][1]}function Or(t,e,i){const r=void 0!==t.base?t.base:1;if("number"!==ni(i))return za(t.default,e.default);const o=t.stops.length;if(1===o||i<=t.stops[0][0])return t.stops[0][1];if(i>=t.stops[o-1][0])return t.stops[o-1][1];const c=Go(t.stops.map(x=>x[0]),i),u=function(x,w,E,C){const D=C-E,L=x-E;return 0===D?0:1===w?L/D:(Math.pow(w,L)-1)/(Math.pow(w,D)-1)}(i,r,t.stops[c][0],t.stops[c+1][0]),p=t.stops[c][1],f=t.stops[c+1][1];let _=lo[e.type]||Ac;if(t.colorSpace&&"rgb"!==t.colorSpace){const x=tl[t.colorSpace];_=(w,E)=>x.reverse(x.interpolate(x.forward(w),x.forward(E),u))}return"function"==typeof p.evaluate?{evaluate(...x){const w=p.evaluate.apply(void 0,x),E=f.evaluate.apply(void 0,x);if(void 0!==w&&void 0!==E)return _(w,E,u)}}:_(p,f,u)}function Mc(t,e,i){return"color"===e.type?i=Zi.parse(i):"formatted"===e.type?i=An.fromString(i.toString()):"resolvedImage"===e.type?i=er.fromString(i.toString()):ni(i)===e.type||"enum"===e.type&&e.values[i]||(i=void 0),za(i,t.default,e.default)}class ns{constructor(e,i){var r;this.expression=e,this._warningHistory={},this._evaluator=new Ns,this._defaultValue=i?"color"===(r=i).type&&(fo(r.default)||Array.isArray(r.default))?new Zi(0,0,0,0):"color"===r.type?Zi.parse(r.default)||null:void 0===r.default?null:r.default:null,this._enumValues=i&&"enum"===i.type?i.values:null}evaluateWithoutErrorHandling(e,i,r,o,c,u,p,f){return this._evaluator.globals=e,this._evaluator.feature=i,this._evaluator.featureState=r,this._evaluator.canonical=o||null,this._evaluator.availableImages=c||null,this._evaluator.formattedSection=u,this._evaluator.featureTileCoord=p||null,this._evaluator.featureDistanceData=f||null,this.expression.evaluate(this._evaluator)}evaluate(e,i,r,o,c,u,p,f){this._evaluator.globals=e,this._evaluator.feature=i||null,this._evaluator.featureState=r||null,this._evaluator.canonical=o||null,this._evaluator.availableImages=c||null,this._evaluator.formattedSection=u||null,this._evaluator.featureTileCoord=p||null,this._evaluator.featureDistanceData=f||null;try{const _=this.expression.evaluate(this._evaluator);if(null==_||"number"==typeof _&&_!=_)return this._defaultValue;if(this._enumValues&&!(_ in this._enumValues))throw new un(`Expected value to be one of ${Object.keys(this._enumValues).map(x=>JSON.stringify(x)).join(", ")}, but found ${JSON.stringify(_)} instead.`);return _}catch(_){return this._warningHistory[_.message]||(this._warningHistory[_.message]=!0,typeof console<"u"&&console.warn(_.message)),this._defaultValue}}}function La(t){return Array.isArray(t)&&t.length>0&&"string"==typeof t[0]&&t[0]in mo}function Ra(t,e){const i=new Ws(mo,[],e?function(o){const c={color:_t,string:W,number:z,enum:W,boolean:se,formatted:Jn,resolvedImage:Dr};return"array"===o.type?Qn(c[o.value]||At,o.length):c[o.type]}(e):void 0),r=i.parse(t,void 0,void 0,void 0,e&&"string"===e.type?{typeAnnotation:"coerce"}:void 0);return r?kc(new ns(r,e)):ua(i.errors)}class ll{constructor(e,i){this.kind=e,this._styleExpression=i,this.isStateDependent="constant"!==e&&!Lr(i.expression)}evaluateWithoutErrorHandling(e,i,r,o,c,u){return this._styleExpression.evaluateWithoutErrorHandling(e,i,r,o,c,u)}evaluate(e,i,r,o,c,u){return this._styleExpression.evaluate(e,i,r,o,c,u)}}class _o{constructor(e,i,r,o){this.kind=e,this.zoomStops=r,this._styleExpression=i,this.isStateDependent="camera"!==e&&!Lr(i.expression),this.interpolationType=o}evaluateWithoutErrorHandling(e,i,r,o,c,u){return this._styleExpression.evaluateWithoutErrorHandling(e,i,r,o,c,u)}evaluate(e,i,r,o,c,u){return this._styleExpression.evaluate(e,i,r,o,c,u)}interpolationFactor(e,i,r){return this.interpolationType?xr.interpolationFactor(this.interpolationType,e,i,r):0}}function go(t,e){if("error"===(t=Ra(t,e)).result)return t;const i=t.value.expression,r=Ma(i);if(!r&&!Pa(e))return ua([new ie("","data expressions not supported")]);const o=ca(i,["zoom","pitch","distance-from-center"]);if(!o&&!Qo(e))return ua([new ie("","zoom expressions not supported")]);const c=as(i);return c||o?c instanceof ie?ua([c]):c instanceof xr&&!es(e)?ua([new ie("",'"interpolate" expressions cannot be used with this property')]):kc(c?new _o(r?"camera":"composite",t.value,c.labels,c instanceof xr?c.interpolation:void 0):new ll(r?"constant":"source",t.value)):ua([new ie("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class rs{constructor(e,i){this._parameters=e,this._specification=i,Kn(this,ts(this._parameters,this._specification))}static deserialize(e){return new rs(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function as(t){let e=null;if(t instanceof gc)e=as(t.result);else if(t instanceof nl){for(const i of t.args)if(e=as(i),e)break}else(t instanceof Ys||t instanceof xr)&&t.input instanceof Pr&&"zoom"===t.input.name&&(e=t);return e instanceof ie||t.eachChild(i=>{const r=as(i);r instanceof ie?e=r:!e&&r?e=new ie("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&r&&e!==r&&(e=new ie("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}class ot{constructor(e,i,r,o){this.message=(e?`${e}: `:"")+r,o&&(this.identifier=o),null!=i&&i.__line__&&(this.line=i.__line__)}}function hr(t){const e=t.key,i=t.value,r=t.valueSpec||{},o=t.objectElementValidators||{},c=t.style,u=t.styleSpec;let p=[];const f=ni(i);if("object"!==f)return[new ot(e,i,`object expected, ${f} found`)];for(const _ in i){const x=_.split(".")[0];let w;o[x]?w=o[x]:r[x]?w=gn:o["*"]?w=o["*"]:r["*"]&&(w=gn),w?p=p.concat(w({key:(e&&`${e}.`)+_,value:i[_],valueSpec:r[x]||r["*"],style:c,styleSpec:u,object:i,objectKey:_},i)):p.push(new ot(e,i[_],`unknown property "${_}"`))}for(const _ in r)o[_]||r[_].required&&void 0===r[_].default&&void 0===i[_]&&p.push(new ot(e,i,`missing required property "${_}"`));return p}function Dc(t){const e=t.value,i=t.valueSpec,r=t.style,o=t.styleSpec,c=t.key,u=t.arrayElementValidator||gn;if("array"!==ni(e))return[new ot(c,e,`array expected, ${ni(e)} found`)];if(i.length&&e.length!==i.length)return[new ot(c,e,`array length ${i.length} expected, length ${e.length} found`)];if(i["min-length"]&&e.length<i["min-length"])return[new ot(c,e,`array length at least ${i["min-length"]} expected, length ${e.length} found`)];let p={type:i.value,values:i.values,minimum:i.minimum,maximum:i.maximum,function:void 0};o.$version<7&&(p.function=i.function),"object"===ni(i.value)&&(p=i.value);let f=[];for(let _=0;_<e.length;_++)f=f.concat(u({array:e,arrayIndex:_,value:e[_],valueSpec:p,style:r,styleSpec:o,key:`${c}[${_}]`}));return f}function yo(t){const e=t.key,i=t.value,r=t.valueSpec;let o=ni(i);if("number"===o&&i!=i&&(o="NaN"),"number"!==o)return[new ot(e,i,`number expected, ${o} found`)];if("minimum"in r){let c=r.minimum;if("array"===ni(r.minimum)&&(c=r.minimum[t.arrayIndex]),i<c)return[new ot(e,i,`${i} is less than the minimum value ${c}`)]}if("maximum"in r){let c=r.maximum;if("array"===ni(r.maximum)&&(c=r.maximum[t.arrayIndex]),i>c)return[new ot(e,i,`${i} is greater than the maximum value ${c}`)]}return[]}function xo(t){const e=t.valueSpec,i=Fi(t.value.type);let r,o,c,u={};const p="categorical"!==i&&void 0===t.value.property,f=!p,_="array"===ni(t.value.stops)&&"array"===ni(t.value.stops[0])&&"object"===ni(t.value.stops[0][0]),x=hr({key:t.key,value:t.value,valueSpec:t.styleSpec.function,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{stops:function(C){if("identity"===i)return[new ot(C.key,C.value,'identity function may not have a "stops" property')];let D=[];const L=C.value;return D=D.concat(Dc({key:C.key,value:L,valueSpec:C.valueSpec,style:C.style,styleSpec:C.styleSpec,arrayElementValidator:w})),"array"===ni(L)&&0===L.length&&D.push(new ot(C.key,L,"array must have at least one stop")),D},default:function(C){return gn({key:C.key,value:C.value,valueSpec:e,style:C.style,styleSpec:C.styleSpec})}}});return"identity"===i&&p&&x.push(new ot(t.key,t.value,'missing required property "property"')),"identity"===i||t.value.stops||x.push(new ot(t.key,t.value,'missing required property "stops"')),"exponential"===i&&t.valueSpec.expression&&!es(t.valueSpec)&&x.push(new ot(t.key,t.value,"exponential functions not supported")),t.styleSpec.$version>=8&&(f&&!Pa(t.valueSpec)?x.push(new ot(t.key,t.value,"property functions not supported")):p&&!Qo(t.valueSpec)&&x.push(new ot(t.key,t.value,"zoom functions not supported"))),"categorical"!==i&&!_||void 0!==t.value.property||x.push(new ot(t.key,t.value,'"property" property is required')),x;function w(C){let D=[];const L=C.value,V=C.key;if("array"!==ni(L))return[new ot(V,L,`array expected, ${ni(L)} found`)];if(2!==L.length)return[new ot(V,L,`array length 2 expected, length ${L.length} found`)];if(_){if("object"!==ni(L[0]))return[new ot(V,L,`object expected, ${ni(L[0])} found`)];if(void 0===L[0].zoom)return[new ot(V,L,"object stop key must have zoom")];if(void 0===L[0].value)return[new ot(V,L,"object stop key must have value")];const H=Fi(L[0].zoom);if("number"!=typeof H)return[new ot(V,L[0].zoom,"stop zoom values must be numbers")];if(c&&c>H)return[new ot(V,L[0].zoom,"stop zoom values must appear in ascending order")];H!==c&&(c=H,o=void 0,u={}),D=D.concat(hr({key:`${V}[0]`,value:L[0],valueSpec:{zoom:{}},style:C.style,styleSpec:C.styleSpec,objectElementValidators:{zoom:yo,value:E}}))}else D=D.concat(E({key:`${V}[0]`,value:L[0],valueSpec:{},style:C.style,styleSpec:C.styleSpec},L));return La(F(L[1]))?D.concat([new ot(`${V}[1]`,L[1],"expressions are not allowed in function stops.")]):D.concat(gn({key:`${V}[1]`,value:L[1],valueSpec:e,style:C.style,styleSpec:C.styleSpec}))}function E(C,D){const L=ni(C.value),V=Fi(C.value),H=null!==C.value?C.value:D;if(r){if(L!==r)return[new ot(C.key,H,`${L} stop domain type must match previous stop domain type ${r}`)]}else r=L;if("number"!==L&&"string"!==L&&"boolean"!==L&&"number"!=typeof V&&"string"!=typeof V&&"boolean"!=typeof V)return[new ot(C.key,H,"stop domain value must be a number, string, or boolean")];if("number"!==L&&"categorical"!==i){let te=`number expected, ${L} found`;return Pa(e)&&void 0===i&&(te+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new ot(C.key,H,te)]}return"categorical"!==i||"number"!==L||"number"==typeof V&&isFinite(V)&&Math.floor(V)===V?"categorical"!==i&&"number"===L&&"number"==typeof V&&"number"==typeof o&&void 0!==o&&V<o?[new ot(C.key,H,"stop domain values must appear in ascending order")]:(o=V,"categorical"===i&&V in u?[new ot(C.key,H,"stop domain values must be unique")]:(u[V]=!0,[])):[new ot(C.key,H,`integer expected, found ${String(V)}`)]}}function on(t){const e=("property"===t.expressionContext?go:Ra)(F(t.value),t.valueSpec);if("error"===e.result)return e.value.map(r=>new ot(`${t.key}${r.key}`,t.value,r.message));const i=e.value.expression||e.value._styleExpression.expression;if("property"===t.expressionContext&&"text-font"===t.propertyKey&&!i.outputDefined())return[new ot(t.key,t.value,`Invalid data expression for "${t.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===t.expressionContext&&"layout"===t.propertyType&&!Lr(i))return[new ot(t.key,t.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===t.expressionContext)return vo(i,t);if(t.expressionContext&&0===t.expressionContext.indexOf("cluster")){if(!ca(i,["zoom","feature-state"]))return[new ot(t.key,t.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===t.expressionContext&&!Ma(i))return[new ot(t.key,t.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function vo(t,e){const i=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(e.valueSpec&&e.valueSpec.expression)for(const o of e.valueSpec.expression.parameters)i.delete(o);if(0===i.size)return[];const r=[];return t instanceof Pr&&i.has(t.name)?[new ot(e.key,e.value,`["${t.name}"] expression is not supported in a filter for a ${e.object.type} layer with id: ${e.object.id}`)]:(t.eachChild(o=>{r.push(...vo(o,e))}),r)}function os(t){const e=t.key,i=t.value,r=t.valueSpec,o=[];return Array.isArray(r.values)?-1===r.values.indexOf(Fi(i))&&o.push(new ot(e,i,`expected one of [${r.values.join(", ")}], ${JSON.stringify(i)} found`)):-1===Object.keys(r.values).indexOf(Fi(i))&&o.push(new ot(e,i,`expected one of [${Object.keys(r.values).join(", ")}], ${JSON.stringify(i)} found`)),o}function cl(t){if(!0===t||!1===t)return!0;if(!Array.isArray(t)||0===t.length)return!1;switch(t[0]){case"has":return t.length>=2&&"$id"!==t[1]&&"$type"!==t[1];case"in":return t.length>=3&&("string"!=typeof t[1]||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==t.length||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(const e of t.slice(1))if(!cl(e)&&"boolean"!=typeof e)return!1;return!0;default:return!0}}function ss(t,e="fill"){if(null==t)return{filter:()=>!0,needGeometry:!1,needFeature:!1};cl(t)||(t=Ba(t));const i=t;let r=!0;try{r=function(_){if(!Oa(_))return _;let x=F(_);return ls(x),x=Ic(x),x}(i)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n${JSON.stringify(i,null,2)}\n        `)}const o=ke[`filter_${e}`],c=Ra(r,o);let u=null;if("error"===c.result)throw new Error(c.value.map(_=>`${_.key}: ${_.message}`).join(", "));u=(_,x,w)=>c.value.evaluate(_,x,{},w);let p=null,f=null;if(r!==i){const _=Ra(i,o);if("error"===_.result)throw new Error(_.value.map(x=>`${x.key}: ${x.message}`).join(", "));p=(x,w,E,C,D)=>_.value.evaluate(x,w,{},E,void 0,void 0,C,D),f=!Ma(_.value.expression)}return{filter:u,dynamicFilter:p||void 0,needGeometry:Sc(r),needFeature:!!f}}function Ic(t){if(!Array.isArray(t))return t;const e=function(i){if(hl.has(i[0]))for(let r=1;r<i.length;r++)if(Oa(i[r]))return!0;return i}(t);return!0===e?e:e.map(i=>Ic(i))}function ls(t){let e=!1;const i=[];if("case"===t[0]){for(let r=1;r<t.length-1;r+=2)e=e||Oa(t[r]),i.push(t[r+1]);i.push(t[t.length-1])}else if("match"===t[0]){e=e||Oa(t[1]);for(let r=2;r<t.length-1;r+=2)i.push(t[r+1]);i.push(t[t.length-1])}else if("step"===t[0]){e=e||Oa(t[1]);for(let r=1;r<t.length-1;r+=2)i.push(t[r+1])}e&&(t.length=0,t.push("any",...i));for(let r=1;r<t.length;r++)ls(t[r])}function Oa(t){if(!Array.isArray(t))return!1;if("pitch"===(e=t[0])||"distance-from-center"===e)return!0;var e;for(let i=1;i<t.length;i++)if(Oa(t[i]))return!0;return!1}const hl=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Nh(t,e){return t<e?-1:t>e?1:0}function Sc(t){if(!Array.isArray(t))return!1;if("within"===t[0])return!0;for(let e=1;e<t.length;e++)if(Sc(t[e]))return!0;return!1}function Ba(t){if(!t)return!0;const e=t[0];return t.length<=1?"any"!==e:"=="===e?ul(t[1],t[2],"=="):"!="===e?cs(ul(t[1],t[2],"==")):"<"===e||">"===e||"<="===e||">="===e?ul(t[1],t[2],e):"any"===e?(i=t.slice(1),["any"].concat(i.map(Ba))):"all"===e?["all"].concat(t.slice(1).map(Ba)):"none"===e?["all"].concat(t.slice(1).map(Ba).map(cs)):"in"===e?dl(t[1],t.slice(2)):"!in"===e?cs(dl(t[1],t.slice(2))):"has"===e?pl(t[1]):"!has"===e?cs(pl(t[1])):"within"!==e||t;var i}function ul(t,e,i){switch(t){case"$type":return[`filter-type-${i}`,e];case"$id":return[`filter-id-${i}`,e];default:return[`filter-${i}`,t,e]}}function dl(t,e){if(0===e.length)return!1;switch(t){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(i=>typeof i!=typeof e[0])?["filter-in-large",t,["literal",e.sort(Nh)]]:["filter-in-small",t,["literal",e]]}}function pl(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function cs(t){return["!",t]}function bo(t){return cl(F(t.value))?on(Kn({},t,{expressionContext:"filter",valueSpec:t.styleSpec[`filter_${t.layerType||"fill"}`]})):wo(t)}function wo(t){const e=t.value,i=t.key;if("array"!==ni(e))return[new ot(i,e,`array expected, ${ni(e)} found`)];const r=t.styleSpec;let o,c=[];if(e.length<1)return[new ot(i,e,"filter array must have at least 1 element")];switch(c=c.concat(os({key:`${i}[0]`,value:e[0],valueSpec:r.filter_operator,style:t.style,styleSpec:t.styleSpec})),Fi(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&"$type"===Fi(e[1])&&c.push(new ot(i,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":3!==e.length&&c.push(new ot(i,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(o=ni(e[1]),"string"!==o&&c.push(new ot(`${i}[1]`,e[1],`string expected, ${o} found`)));for(let u=2;u<e.length;u++)o=ni(e[u]),"$type"===Fi(e[1])?c=c.concat(os({key:`${i}[${u}]`,value:e[u],valueSpec:r.geometry_type,style:t.style,styleSpec:t.styleSpec})):"string"!==o&&"number"!==o&&"boolean"!==o&&c.push(new ot(`${i}[${u}]`,e[u],`string, number, or boolean expected, ${o} found`));break;case"any":case"all":case"none":for(let u=1;u<e.length;u++)c=c.concat(wo({key:`${i}[${u}]`,value:e[u],style:t.style,styleSpec:t.styleSpec}));break;case"has":case"!has":o=ni(e[1]),2!==e.length?c.push(new ot(i,e,`filter array for "${e[0]}" operator must have 2 elements`)):"string"!==o&&c.push(new ot(`${i}[1]`,e[1],`string expected, ${o} found`));break;case"within":o=ni(e[1]),2!==e.length?c.push(new ot(i,e,`filter array for "${e[0]}" operator must have 2 elements`)):"object"!==o&&c.push(new ot(`${i}[1]`,e[1],`object expected, ${o} found`))}return c}function ml(t,e){const i=t.key,r=t.style,o=t.styleSpec,c=t.value,u=t.objectKey,p=o[`${e}_${t.layerType}`];if(!p)return[];const f=u.match(/^(.*)-transition$/);if("paint"===e&&f&&p[f[1]]&&p[f[1]].transition)return gn({key:i,value:c,valueSpec:o.transition,style:r,styleSpec:o});const _=t.valueSpec||p[u];if(!_)return[new ot(i,c,`unknown property "${u}"`)];let x;if("string"===ni(c)&&Pa(_)&&!_.tokens&&(x=/^{([^}]+)}$/.exec(c))){const E=`\`{ "type": "identity", "property": ${x?JSON.stringify(x[1]):'"_"'} }\``;return[new ot(i,c,`"${u}" does not support interpolation syntax\nUse an identity property function instead: ${E}.`)]}const w=[];return"symbol"===t.layerType&&("text-field"===u&&r&&!r.glyphs&&w.push(new ot(i,c,'use of "text-field" requires a style "glyphs" property')),"text-font"===u&&fo(F(c))&&"identity"===Fi(c.type)&&w.push(new ot(i,c,'"text-font" does not support identity functions'))),w.concat(gn({key:t.key,value:c,valueSpec:_,style:r,styleSpec:o,expressionContext:"property",propertyType:e,propertyKey:u}))}function Pc(t){return ml(t,"paint")}function fl(t){return ml(t,"layout")}function zc(t){let e=[];const i=t.value,r=t.key,o=t.style,c=t.styleSpec;i.type||i.ref||e.push(new ot(r,i,'either "type" or "ref" is required'));let u=Fi(i.type);const p=Fi(i.ref);if(i.id){const f=Fi(i.id);for(let _=0;_<t.arrayIndex;_++){const x=o.layers[_];Fi(x.id)===f&&e.push(new ot(r,i.id,`duplicate layer id "${i.id}", previously used at line ${x.id.__line__}`))}}if("ref"in i){let f;["type","source","source-layer","filter","layout"].forEach(_=>{_ in i&&e.push(new ot(r,i[_],`"${_}" is prohibited for ref layers`))}),o.layers.forEach(_=>{Fi(_.id)===p&&(f=_)}),f?f.ref?e.push(new ot(r,i.ref,"ref cannot reference another ref layer")):u=Fi(f.type):"string"==typeof p&&e.push(new ot(r,i.ref,`ref layer "${p}" not found`))}else if("background"!==u&&"sky"!==u)if(i.source){const f=o.sources&&o.sources[i.source],_=f&&Fi(f.type);f?"vector"===_&&"raster"===u?e.push(new ot(r,i.source,`layer "${i.id}" requires a raster source`)):"raster"===_&&"raster"!==u?e.push(new ot(r,i.source,`layer "${i.id}" requires a vector source`)):"vector"!==_||i["source-layer"]?"raster-dem"===_&&"hillshade"!==u?e.push(new ot(r,i.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==u||!i.paint||!i.paint["line-gradient"]&&!i.paint["line-trim-offset"]||"geojson"===_&&f.lineMetrics||e.push(new ot(r,i,`layer "${i.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new ot(r,i,`layer "${i.id}" must specify a "source-layer"`)):e.push(new ot(r,i.source,`source "${i.source}" not found`))}else e.push(new ot(r,i,'missing required property "source"'));return e=e.concat(hr({key:r,value:i,valueSpec:c.layer,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":()=>[],type:()=>gn({key:`${r}.type`,value:i.type,valueSpec:c.layer.type,style:t.style,styleSpec:t.styleSpec,object:i,objectKey:"type"}),filter:f=>bo(Kn({layerType:u},f)),layout:f=>hr({layer:i,key:f.key,value:f.value,valueSpec:{},style:f.style,styleSpec:f.styleSpec,objectElementValidators:{"*":_=>fl(Kn({layerType:u},_))}}),paint:f=>hr({layer:i,key:f.key,value:f.value,valueSpec:{},style:f.style,styleSpec:f.styleSpec,objectElementValidators:{"*":_=>Pc(Kn({layerType:u},_))}})}})),e}function Yr(t){const e=t.value,i=t.key,r=ni(e);return"string"!==r?[new ot(i,e,`string expected, ${r} found`)]:[]}const Lc={promoteId:function({key:t,value:e}){if("string"===ni(e))return Yr({key:t,value:e});{const i=[];for(const r in e)i.push(...Yr({key:`${t}.${r}`,value:e[r]}));return i}}};function Rc(t){const e=t.value,i=t.key,r=t.styleSpec,o=t.style;if(!e.type)return[new ot(i,e,'"type" is required')];const c=Fi(e.type);let u;switch(c){case"vector":case"raster":case"raster-dem":return u=hr({key:i,value:e,valueSpec:r[`source_${c.replace("-","_")}`],style:t.style,styleSpec:r,objectElementValidators:Lc}),u;case"geojson":if(u=hr({key:i,value:e,valueSpec:r.source_geojson,style:o,styleSpec:r,objectElementValidators:Lc}),e.cluster)for(const p in e.clusterProperties){const[f,_]=e.clusterProperties[p],x="string"==typeof f?[f,["accumulated"],["get",p]]:f;u.push(...on({key:`${i}.${p}.map`,value:_,expressionContext:"cluster-map"})),u.push(...on({key:`${i}.${p}.reduce`,value:x,expressionContext:"cluster-reduce"}))}return u;case"video":return hr({key:i,value:e,valueSpec:r.source_video,style:o,styleSpec:r});case"image":return hr({key:i,value:e,valueSpec:r.source_image,style:o,styleSpec:r});case"canvas":return[new ot(i,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return os({key:`${i}.type`,value:e.type,valueSpec:{values:jh(r)},style:o,styleSpec:r})}}function jh(t){return t.source.reduce((e,i)=>{const r=t[i];return"enum"===r.type.type&&(e=e.concat(Object.keys(r.type.values))),e},[])}function Oc(t){const e=t.value,i=t.styleSpec,r=i.light,o=t.style;let c=[];const u=ni(e);if(void 0===e)return c;if("object"!==u)return c=c.concat([new ot("light",e,`object expected, ${u} found`)]),c;for(const p in e){const f=p.match(/^(.*)-transition$/);c=c.concat(f&&r[f[1]]&&r[f[1]].transition?gn({key:p,value:e[p],valueSpec:i.transition,style:o,styleSpec:i}):r[p]?gn({key:p,value:e[p],valueSpec:r[p],style:o,styleSpec:i}):[new ot(p,e[p],`unknown property "${p}"`)])}return c}function _l(t){const e=t.value,i=t.key,r=t.style,o=t.styleSpec,c=o.terrain;let u=[];const p=ni(e);if(void 0===e)return u;if("object"!==p)return u=u.concat([new ot("terrain",e,`object expected, ${p} found`)]),u;for(const f in e){const _=f.match(/^(.*)-transition$/);u=u.concat(_&&c[_[1]]&&c[_[1]].transition?gn({key:f,value:e[f],valueSpec:o.transition,style:r,styleSpec:o}):c[f]?gn({key:f,value:e[f],valueSpec:c[f],style:r,styleSpec:o}):[new ot(f,e[f],`unknown property "${f}"`)])}if(e.source){const f=r.sources&&r.sources[e.source],_=f&&Fi(f.type);f?"raster-dem"!==_&&u.push(new ot(i,e.source,`terrain cannot be used with a source of type ${String(_)}, it only be used with a "raster-dem" source type`)):u.push(new ot(i,e.source,`source "${e.source}" not found`))}else u.push(new ot(i,e,'terrain is missing required property "source"'));return u}function Bc(t){const e=t.value,i=t.style,r=t.styleSpec,o=r.fog;let c=[];const u=ni(e);if(void 0===e)return c;if("object"!==u)return c=c.concat([new ot("fog",e,`object expected, ${u} found`)]),c;for(const p in e){const f=p.match(/^(.*)-transition$/);c=c.concat(f&&o[f[1]]&&o[f[1]].transition?gn({key:p,value:e[p],valueSpec:r.transition,style:i,styleSpec:r}):o[p]?gn({key:p,value:e[p],valueSpec:o[p],style:i,styleSpec:r}):[new ot(p,e[p],`unknown property "${p}"`)])}return c}const Fc={"*":()=>[],array:Dc,boolean:function(t){const e=t.value,i=t.key,r=ni(e);return"boolean"!==r?[new ot(i,e,`boolean expected, ${r} found`)]:[]},number:yo,color:function(t){const e=t.key,i=t.value,r=ni(i);return"string"!==r?[new ot(e,i,`color expected, ${r} found`)]:null===Ls(i)?[new ot(e,i,`color expected, "${i}" found`)]:[]},enum:os,filter:bo,function:xo,layer:zc,object:hr,source:Rc,light:Oc,terrain:_l,fog:Bc,string:Yr,formatted:function(t){return 0===Yr(t).length?[]:on(t)},resolvedImage:function(t){return 0===Yr(t).length?[]:on(t)},projection:function(t){const e=t.value,i=t.styleSpec,r=i.projection,o=t.style;let c=[];const u=ni(e);if("object"===u)for(const p in e)c=c.concat(gn({key:p,value:e[p],valueSpec:r[p],style:o,styleSpec:i}));else"string"!==u&&(c=c.concat([new ot("projection",e,`object or string expected, ${u} found`)]));return c}};function gn(t){const e=t.value,i=t.valueSpec,r=t.styleSpec;return i.expression&&fo(Fi(e))?xo(t):i.expression&&La(F(e))?on(t):i.type&&Fc[i.type]?Fc[i.type](t):hr(Kn({},t,{valueSpec:i.type?r[i.type]:i}))}function Zh(t){const e=t.value,i=t.key,r=Yr(t);return r.length||(-1===e.indexOf("{fontstack}")&&r.push(new ot(i,e,'"glyphs" url must include a "{fontstack}" token')),-1===e.indexOf("{range}")&&r.push(new ot(i,e,'"glyphs" url must include a "{range}" token'))),r}function Uc(t,e=ke){return ir(gn({key:"",value:t,valueSpec:e.$root,styleSpec:e,style:t,objectElementValidators:{glyphs:Zh,"*":()=>[]}}))}const Gh=t=>ir(Pc(t)),qh=t=>ir(fl(t));function ir(t){return t.slice().sort((e,i)=>e.line&&i.line?e.line-i.line:0)}function Vc(t,e){let i=!1;if(e&&e.length)for(const r of e)t.fire(new jn(new Error(r.message))),i=!0;return i}var $h=vr,ur=3;function vr(t,e,i){var r=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var o=new Int32Array(this.arrayBuffer);t=o[0],this.d=(e=o[1])+2*(i=o[2]);for(var c=0;c<this.d*this.d;c++){var u=o[ur+c],p=o[ur+c+1];r.push(u===p?null:o.subarray(u,p))}var f=o[ur+r.length+1];this.keys=o.subarray(o[ur+r.length],f),this.bboxes=o.subarray(f),this.insert=this._insertReadonly}else{this.d=e+2*i;for(var _=0;_<this.d*this.d;_++)r.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=t,this.padding=i,this.scale=e/t,this.uid=0;var x=i/e*t;this.min=-x,this.max=t+x}vr.prototype.insert=function(t,e,i,r,o){this._forEachCell(e,i,r,o,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(e),this.bboxes.push(i),this.bboxes.push(r),this.bboxes.push(o)},vr.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},vr.prototype._insertCell=function(t,e,i,r,o,c){this.cells[o].push(c)},vr.prototype.query=function(t,e,i,r,o){var c=this.min,u=this.max;if(t<=c&&e<=c&&u<=i&&u<=r&&!o)return Array.prototype.slice.call(this.keys);var p=[];return this._forEachCell(t,e,i,r,this._queryCell,p,{},o),p},vr.prototype._queryCell=function(t,e,i,r,o,c,u,p){var f=this.cells[o];if(null!==f)for(var _=this.keys,x=this.bboxes,w=0;w<f.length;w++){var E=f[w];if(void 0===u[E]){var C=4*E;(p?p(x[C+0],x[C+1],x[C+2],x[C+3]):t<=x[C+2]&&e<=x[C+3]&&i>=x[C+0]&&r>=x[C+1])?(u[E]=!0,c.push(_[E])):u[E]=!1}}},vr.prototype._forEachCell=function(t,e,i,r,o,c,u,p){for(var f=this._convertToCellCoord(t),_=this._convertToCellCoord(e),x=this._convertToCellCoord(i),w=this._convertToCellCoord(r),E=f;E<=x;E++)for(var C=_;C<=w;C++){var D=this.d*C+E;if((!p||p(this._convertFromCellCoord(E),this._convertFromCellCoord(C),this._convertFromCellCoord(E+1),this._convertFromCellCoord(C+1)))&&o.call(this,t,e,i,r,D,c,u,p))return}},vr.prototype._convertFromCellCoord=function(t){return(t-this.padding)/this.scale},vr.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},vr.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,e=ur+this.cells.length+1+1,i=0,r=0;r<this.cells.length;r++)i+=this.cells[r].length;var o=new Int32Array(e+i+this.keys.length+this.bboxes.length);o[0]=this.extent,o[1]=this.n,o[2]=this.padding;for(var c=e,u=0;u<t.length;u++){var p=t[u];o[ur+u]=c,o.set(p,c),c+=p.length}return o[ur+t.length]=c,o.set(this.keys,c),o[ur+t.length+1]=c+=this.keys.length,o.set(this.bboxes,c),c+=this.bboxes.length,o.buffer};var da=Xt($h);const hs={};function ct(t,e,i={}){Object.defineProperty(t,"_classRegistryKey",{value:e,writeable:!1}),hs[e]={klass:t,omit:i.omit||[]}}ct(Object,"Object"),da.serialize=function(t,e){const i=t.toArrayBuffer();return e&&e.push(i),{buffer:i}},da.deserialize=function(t){return new da(t.buffer)},Object.defineProperty(da,"name",{value:"Grid"}),ct(da,"Grid"),ct(Zi,"Color"),ct(Error,"Error"),ct(_n,"AJAXError"),ct(er,"ResolvedImage"),ct(rs,"StylePropertyFunction"),ct(ns,"StyleExpression",{omit:["_evaluator"]}),ct(_o,"ZoomDependentExpression"),ct(ll,"ZoomConstantExpression"),ct(Pr,"CompoundExpression",{omit:["_evaluate"]});for(const t in mo)hs[mo[t]._classRegistryKey]||ct(mo[t],`Expression${t}`);function gl(t){return t&&typeof ArrayBuffer<"u"&&(t instanceof ArrayBuffer||t.constructor&&"ArrayBuffer"===t.constructor.name)}function yl(t){return M.ImageBitmap&&t instanceof M.ImageBitmap}function Fa(t,e){if(null==t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp)return t;if(gl(t)||yl(t))return e&&e.push(t),t;if(ArrayBuffer.isView(t)){const i=t;return e&&e.push(i.buffer),i}if(t instanceof M.ImageData)return e&&e.push(t.data.buffer),t;if(Array.isArray(t)){const i=[];for(const r of t)i.push(Fa(r,e));return i}if("object"==typeof t){const i=t.constructor,r=i._classRegistryKey;if(!r)throw new Error(`can't serialize object of unregistered class ${r}`);const o=i.serialize?i.serialize(t,e):{};if(!i.serialize){for(const c in t)t.hasOwnProperty(c)&&(hs[r].omit.indexOf(c)>=0||(o[c]=Fa(t[c],e)));t instanceof Error&&(o.message=t.message)}if(o.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==r&&(o.$name=r),o}throw new Error("can't serialize object of type "+typeof t)}function pa(t){if(null==t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||gl(t)||yl(t)||ArrayBuffer.isView(t)||t instanceof M.ImageData)return t;if(Array.isArray(t))return t.map(pa);if("object"==typeof t){const e=t.$name||"Object",{klass:i}=hs[e];if(!i)throw new Error(`can't deserialize unregistered class ${e}`);if(i.deserialize)return i.deserialize(t);const r=Object.create(i.prototype);for(const o of Object.keys(t))"$name"!==o&&(r[o]=pa(t[o]));return r}throw new Error("can't deserialize object of type "+typeof t)}const it={"Latin-1 Supplement":t=>t>=128&&t<=255,Arabic:t=>t>=1536&&t<=1791,"Arabic Supplement":t=>t>=1872&&t<=1919,"Arabic Extended-A":t=>t>=2208&&t<=2303,"Hangul Jamo":t=>t>=4352&&t<=4607,"Unified Canadian Aboriginal Syllabics":t=>t>=5120&&t<=5759,Khmer:t=>t>=6016&&t<=6143,"Unified Canadian Aboriginal Syllabics Extended":t=>t>=6320&&t<=6399,"General Punctuation":t=>t>=8192&&t<=8303,"Letterlike Symbols":t=>t>=8448&&t<=8527,"Number Forms":t=>t>=8528&&t<=8591,"Miscellaneous Technical":t=>t>=8960&&t<=9215,"Control Pictures":t=>t>=9216&&t<=9279,"Optical Character Recognition":t=>t>=9280&&t<=9311,"Enclosed Alphanumerics":t=>t>=9312&&t<=9471,"Geometric Shapes":t=>t>=9632&&t<=9727,"Miscellaneous Symbols":t=>t>=9728&&t<=9983,"Miscellaneous Symbols and Arrows":t=>t>=11008&&t<=11263,"CJK Radicals Supplement":t=>t>=11904&&t<=12031,"Kangxi Radicals":t=>t>=12032&&t<=12255,"Ideographic Description Characters":t=>t>=12272&&t<=12287,"CJK Symbols and Punctuation":t=>t>=12288&&t<=12351,Hiragana:t=>t>=12352&&t<=12447,Katakana:t=>t>=12448&&t<=12543,Bopomofo:t=>t>=12544&&t<=12591,"Hangul Compatibility Jamo":t=>t>=12592&&t<=12687,Kanbun:t=>t>=12688&&t<=12703,"Bopomofo Extended":t=>t>=12704&&t<=12735,"CJK Strokes":t=>t>=12736&&t<=12783,"Katakana Phonetic Extensions":t=>t>=12784&&t<=12799,"Enclosed CJK Letters and Months":t=>t>=12800&&t<=13055,"CJK Compatibility":t=>t>=13056&&t<=13311,"CJK Unified Ideographs Extension A":t=>t>=13312&&t<=19903,"Yijing Hexagram Symbols":t=>t>=19904&&t<=19967,"CJK Unified Ideographs":t=>t>=19968&&t<=40959,"Yi Syllables":t=>t>=40960&&t<=42127,"Yi Radicals":t=>t>=42128&&t<=42191,"Hangul Jamo Extended-A":t=>t>=43360&&t<=43391,"Hangul Syllables":t=>t>=44032&&t<=55215,"Hangul Jamo Extended-B":t=>t>=55216&&t<=55295,"Private Use Area":t=>t>=57344&&t<=63743,"CJK Compatibility Ideographs":t=>t>=63744&&t<=64255,"Arabic Presentation Forms-A":t=>t>=64336&&t<=65023,"Vertical Forms":t=>t>=65040&&t<=65055,"CJK Compatibility Forms":t=>t>=65072&&t<=65103,"Small Form Variants":t=>t>=65104&&t<=65135,"Arabic Presentation Forms-B":t=>t>=65136&&t<=65279,"Halfwidth and Fullwidth Forms":t=>t>=65280&&t<=65519};function xl(t){for(const e of t)if(vl(e.charCodeAt(0)))return!0;return!1}function Wh(t){for(const e of t)if(!Nc(e.charCodeAt(0)))return!1;return!0}function Nc(t){return!(it.Arabic(t)||it["Arabic Supplement"](t)||it["Arabic Extended-A"](t)||it["Arabic Presentation Forms-A"](t)||it["Arabic Presentation Forms-B"](t))}function vl(t){return!(746!==t&&747!==t&&(t<4352||!(it["Bopomofo Extended"](t)||it.Bopomofo(t)||it["CJK Compatibility Forms"](t)&&!(t>=65097&&t<=65103)||it["CJK Compatibility Ideographs"](t)||it["CJK Compatibility"](t)||it["CJK Radicals Supplement"](t)||it["CJK Strokes"](t)||!(!it["CJK Symbols and Punctuation"](t)||t>=12296&&t<=12305||t>=12308&&t<=12319||12336===t)||it["CJK Unified Ideographs Extension A"](t)||it["CJK Unified Ideographs"](t)||it["Enclosed CJK Letters and Months"](t)||it["Hangul Compatibility Jamo"](t)||it["Hangul Jamo Extended-A"](t)||it["Hangul Jamo Extended-B"](t)||it["Hangul Jamo"](t)||it["Hangul Syllables"](t)||it.Hiragana(t)||it["Ideographic Description Characters"](t)||it.Kanbun(t)||it["Kangxi Radicals"](t)||it["Katakana Phonetic Extensions"](t)||it.Katakana(t)&&12540!==t||!(!it["Halfwidth and Fullwidth Forms"](t)||65288===t||65289===t||65293===t||t>=65306&&t<=65310||65339===t||65341===t||65343===t||t>=65371&&t<=65503||65507===t||t>=65512&&t<=65519)||!(!it["Small Form Variants"](t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||it["Unified Canadian Aboriginal Syllabics"](t)||it["Unified Canadian Aboriginal Syllabics Extended"](t)||it["Vertical Forms"](t)||it["Yijing Hexagram Symbols"](t)||it["Yi Syllables"](t)||it["Yi Radicals"](t))))}function jc(t){return!(vl(t)||(e=t,it["Latin-1 Supplement"](e)&&(167===e||169===e||174===e||177===e||188===e||189===e||190===e||215===e||247===e)||it["General Punctuation"](e)&&(8214===e||8224===e||8225===e||8240===e||8241===e||8251===e||8252===e||8258===e||8263===e||8264===e||8265===e||8273===e)||it["Letterlike Symbols"](e)||it["Number Forms"](e)||it["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||9003===e||e>=9085&&e<=9114||e>=9150&&e<=9165||9167===e||e>=9169&&e<=9179||e>=9186&&e<=9215)||it["Control Pictures"](e)&&9251!==e||it["Optical Character Recognition"](e)||it["Enclosed Alphanumerics"](e)||it["Geometric Shapes"](e)||it["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||it["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||it["CJK Symbols and Punctuation"](e)||it.Katakana(e)||it["Private Use Area"](e)||it["CJK Compatibility Forms"](e)||it["Small Form Variants"](e)||it["Halfwidth and Fullwidth Forms"](e)||8734===e||8756===e||8757===e||e>=9984&&e<=10087||e>=10102&&e<=10131||65532===e||65533===e));var e}function Zc(t){return t>=1424&&t<=2303||it["Arabic Presentation Forms-A"](t)||it["Arabic Presentation Forms-B"](t)}function Hh(t,e){return!(!e&&Zc(t)||t>=2304&&t<=3583||t>=3840&&t<=4255||it.Khmer(t))}function Yh(t){for(const e of t)if(Zc(e.charCodeAt(0)))return!0;return!1}const bl="deferred",wl="loading",Tl="loaded";let Ua=null,l="unavailable",n=null;const a=function(t){t&&"string"==typeof t&&t.indexOf("NetworkError")>-1&&(l="error"),Ua&&Ua(t)};function h(){d.fire(new cr("pluginStateChange",{pluginStatus:l,pluginURL:n}))}const d=new Mr,m=function(){return l},g=function(){if(l!==bl||!n)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");l=wl,h(),n&&Hn({url:n},t=>{t?a(t):(l=Tl,h())})},y={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>l===Tl||null!=y.applyArabicShaping,isLoading:()=>l===wl,setState(t){l=t.pluginStatus,n=t.pluginURL},isParsed:()=>null!=y.applyArabicShaping&&null!=y.processBidirectionalText&&null!=y.processStyledBidirectionalText,getPluginURL:()=>n};class v{constructor(e,i){this.zoom=e,i?(this.now=i.now,this.fadeDuration=i.fadeDuration,this.transition=i.transition,this.pitch=i.pitch):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0)}isSupportedScript(e){return function(i,r){for(const o of i)if(!Hh(o.charCodeAt(0),r))return!1;return!0}(e,y.isLoaded())}}class A{constructor(e,i){this.property=e,this.value=i,this.expression=function(r,o){if(fo(r))return new rs(r,o);if(La(r)){const c=go(r,o);if("error"===c.result)throw new Error(c.value.map(u=>`${u.key}: ${u.message}`).join(", "));return c.value}{let c=r;return"string"==typeof r&&"color"===o.type&&(c=Zi.parse(r)),{kind:"constant",evaluate:()=>c}}}(void 0===i?e.specification.default:i,e.specification)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(e,i,r){return this.property.possiblyEvaluate(this,e,i,r)}}class k{constructor(e){this.property=e,this.value=new A(e,void 0)}transitioned(e,i){return new U(this.property,this.value,i,Mt({},e.transition,this.transition),e.now)}untransitioned(){return new U(this.property,this.value,null,{},0)}}class S{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return Di(this._values[e].value.value)}setValue(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new k(this._values[e].property)),this._values[e].value=new A(this._values[e].property,null===i?void 0:Di(i))}getTransition(e){return Di(this._values[e].transition)}setTransition(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new k(this._values[e].property)),this._values[e].transition=Di(i)||void 0}serialize(){const e={};for(const i of Object.keys(this._values)){const r=this.getValue(i);void 0!==r&&(e[i]=r);const o=this.getTransition(i);void 0!==o&&(e[`${i}-transition`]=o)}return e}transitioned(e,i){const r=new j(this._properties);for(const o of Object.keys(this._values))r._values[o]=this._values[o].transitioned(e,i._values[o]);return r}untransitioned(){const e=new j(this._properties);for(const i of Object.keys(this._values))e._values[i]=this._values[i].untransitioned();return e}}class U{constructor(e,i,r,o,c){const u=o.delay||0,p=o.duration||0;c=c||0,this.property=e,this.value=i,this.begin=c+u,this.end=this.begin+p,e.specification.transition&&(o.delay||o.duration)&&(this.prior=r)}possiblyEvaluate(e,i,r){const o=e.now||0,c=this.value.possiblyEvaluate(e,i,r),u=this.prior;if(u){if(o>this.end)return this.prior=null,c;if(this.value.isDataDriven())return this.prior=null,c;if(o<this.begin)return u.possiblyEvaluate(e,i,r);{const p=(o-this.begin)/(this.end-this.begin);return this.property.interpolate(u.possiblyEvaluate(e,i,r),c,Je(p))}}return c}}class j{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,i,r){const o=new $(this._properties);for(const c of Object.keys(this._values))o._values[c]=this._values[c].possiblyEvaluate(e,i,r);return o}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class G{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}getValue(e){return Di(this._values[e].value)}setValue(e,i){this._values[e]=new A(this._values[e].property,null===i?void 0:Di(i))}serialize(){const e={};for(const i of Object.keys(this._values)){const r=this.getValue(i);void 0!==r&&(e[i]=r)}return e}possiblyEvaluate(e,i,r){const o=new $(this._properties);for(const c of Object.keys(this._values))o._values[c]=this._values[c].possiblyEvaluate(e,i,r);return o}}class Z{constructor(e,i,r){this.property=e,this.value=i,this.parameters=r}isConstant(){return"constant"===this.value.kind}constantOr(e){return"constant"===this.value.kind?this.value.value:e}evaluate(e,i,r,o){return this.property.evaluate(this.value,this.parameters,e,i,r,o)}}class ${constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class P{constructor(e){this.specification=e}possiblyEvaluate(e,i){return e.expression.evaluate(i)}interpolate(e,i,r){const o=lo[this.specification.type];return o?o(e,i,r):e}}class N{constructor(e,i){this.specification=e,this.overrides=i}possiblyEvaluate(e,i,r,o){return new Z(this,"constant"===e.expression.kind||"camera"===e.expression.kind?{kind:"constant",value:e.expression.evaluate(i,null,{},r,o)}:e.expression,i)}interpolate(e,i,r){if("constant"!==e.value.kind||"constant"!==i.value.kind)return e;if(void 0===e.value.value||void 0===i.value.value)return new Z(this,{kind:"constant",value:void 0},e.parameters);const o=lo[this.specification.type];return o?new Z(this,{kind:"constant",value:o(e.value.value,i.value.value,r)},e.parameters):e}evaluate(e,i,r,o,c,u){return"constant"===e.kind?e.value:e.evaluate(i,r,o,c,u)}}class X{constructor(e){this.specification=e}possiblyEvaluate(e,i,r,o){return!!e.expression.evaluate(i,null,{},r,o)}interpolate(){return!1}}class J{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const i=new v(0,{});for(const r in e){const o=e[r];o.specification.overridable&&this.overridableProperties.push(r);const c=this.defaultPropertyValues[r]=new A(o,void 0),u=this.defaultTransitionablePropertyValues[r]=new k(o);this.defaultTransitioningPropertyValues[r]=u.untransitioned(),this.defaultPossiblyEvaluatedValues[r]=c.possiblyEvaluate(i)}}}function oe(t,e){return 256*(t=Ee(Math.floor(t),0,255))+Ee(Math.floor(e),0,255)}ct(N,"DataDrivenProperty"),ct(P,"DataConstantProperty"),ct(X,"ColorRampProperty");const ce={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class le{constructor(e,i){this._structArray=e,this._pos1=i*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class pe{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,i){return e._trim(),i&&(e.isTransferred=!0,i.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const i=Object.create(this.prototype);return i.arrayBuffer=e.arrayBuffer,i.length=e.length,i.capacity=e.arrayBuffer.byteLength/i.bytesPerElement,i._refreshViews(),i}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const i=this.uint8;this._refreshViews(),i&&this.uint8.set(i)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function de(t,e=1){let i=0,r=0;return{members:t.map(o=>{const c=ce[o.type].BYTES_PER_ELEMENT,u=i=ve(i,Math.max(e,c)),p=o.components||1;return r=Math.max(r,c),i+=c*p,{name:o.name,type:o.type,components:p,offset:u}}),size:ve(i,Math.max(r,e)),alignment:e}}function ve(t,e){return Math.ceil(t/e)*e}class qe extends pe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i){const r=this.length;return this.resize(r+1),this.emplace(r,e,i)}emplace(e,i,r){const o=2*e;return this.int16[o+0]=i,this.int16[o+1]=r,e}}qe.prototype.bytesPerElement=4,ct(qe,"StructArrayLayout2i4");class _e extends pe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,r){const o=this.length;return this.resize(o+1),this.emplace(o,e,i,r)}emplace(e,i,r,o){const c=3*e;return this.int16[c+0]=i,this.int16[c+1]=r,this.int16[c+2]=o,e}}_e.prototype.bytesPerElement=6,ct(_e,"StructArrayLayout3i6");class Le extends pe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,r,o){const c=this.length;return this.resize(c+1),this.emplace(c,e,i,r,o)}emplace(e,i,r,o,c){const u=4*e;return this.int16[u+0]=i,this.int16[u+1]=r,this.int16[u+2]=o,this.int16[u+3]=c,e}}Le.prototype.bytesPerElement=8,ct(Le,"StructArrayLayout4i8");class we extends pe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,r,o,c,u,p){const f=this.length;return this.resize(f+1),this.emplace(f,e,i,r,o,c,u,p)}emplace(e,i,r,o,c,u,p,f){const _=6*e,x=12*e,w=3*e;return this.int16[_+0]=i,this.int16[_+1]=r,this.uint8[x+4]=o,this.uint8[x+5]=c,this.uint8[x+6]=u,this.uint8[x+7]=p,this.float32[w+2]=f,e}}we.prototype.bytesPerElement=12,ct(we,"StructArrayLayout2i4ub1f12");class Ze extends pe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,r,o){const c=this.length;return this.resize(c+1),this.emplace(c,e,i,r,o)}emplace(e,i,r,o,c){const u=4*e;return this.float32[u+0]=i,this.float32[u+1]=r,this.float32[u+2]=o,this.float32[u+3]=c,e}}Ze.prototype.bytesPerElement=16,ct(Ze,"StructArrayLayout4f16");class ye extends pe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,r,o,c){const u=this.length;return this.resize(u+1),this.emplace(u,e,i,r,o,c)}emplace(e,i,r,o,c,u){const p=6*e,f=3*e;return this.uint16[p+0]=i,this.uint16[p+1]=r,this.uint16[p+2]=o,this.uint16[p+3]=c,this.float32[f+2]=u,e}}ye.prototype.bytesPerElement=12,ct(ye,"StructArrayLayout4ui1f12");class ze extends pe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,r,o){const c=this.length;return this.resize(c+1),this.emplace(c,e,i,r,o)}emplace(e,i,r,o,c){const u=4*e;return this.uint16[u+0]=i,this.uint16[u+1]=r,this.uint16[u+2]=o,this.uint16[u+3]=c,e}}ze.prototype.bytesPerElement=8,ct(ze,"StructArrayLayout4ui8");class We extends pe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,r,o,c,u){const p=this.length;return this.resize(p+1),this.emplace(p,e,i,r,o,c,u)}emplace(e,i,r,o,c,u,p){const f=6*e;return this.int16[f+0]=i,this.int16[f+1]=r,this.int16[f+2]=o,this.int16[f+3]=c,this.int16[f+4]=u,this.int16[f+5]=p,e}}We.prototype.bytesPerElement=12,ct(We,"StructArrayLayout6i12");class Be extends pe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,r,o,c,u,p,f,_,x,w,E){const C=this.length;return this.resize(C+1),this.emplace(C,e,i,r,o,c,u,p,f,_,x,w,E)}emplace(e,i,r,o,c,u,p,f,_,x,w,E,C){const D=12*e;return this.int16[D+0]=i,this.int16[D+1]=r,this.int16[D+2]=o,this.int16[D+3]=c,this.uint16[D+4]=u,this.uint16[D+5]=p,this.uint16[D+6]=f,this.uint16[D+7]=_,this.int16[D+8]=x,this.int16[D+9]=w,this.int16[D+10]=E,this.int16[D+11]=C,e}}Be.prototype.bytesPerElement=24,ct(Be,"StructArrayLayout4i4ui4i24");class He extends pe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,r,o,c,u){const p=this.length;return this.resize(p+1),this.emplace(p,e,i,r,o,c,u)}emplace(e,i,r,o,c,u,p){const f=10*e,_=5*e;return this.int16[f+0]=i,this.int16[f+1]=r,this.int16[f+2]=o,this.float32[_+2]=c,this.float32[_+3]=u,this.float32[_+4]=p,e}}He.prototype.bytesPerElement=20,ct(He,"StructArrayLayout3i3f20");class gt extends pe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint32[1*e+0]=i,e}}gt.prototype.bytesPerElement=4,ct(gt,"StructArrayLayout1ul4");class St extends pe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,r,o,c,u,p,f,_,x,w,E,C){const D=this.length;return this.resize(D+1),this.emplace(D,e,i,r,o,c,u,p,f,_,x,w,E,C)}emplace(e,i,r,o,c,u,p,f,_,x,w,E,C,D){const L=20*e,V=10*e;return this.int16[L+0]=i,this.int16[L+1]=r,this.int16[L+2]=o,this.int16[L+3]=c,this.int16[L+4]=u,this.float32[V+3]=p,this.float32[V+4]=f,this.float32[V+5]=_,this.float32[V+6]=x,this.int16[L+14]=w,this.uint32[V+8]=E,this.uint16[L+18]=C,this.uint16[L+19]=D,e}}St.prototype.bytesPerElement=40,ct(St,"StructArrayLayout5i4f1i1ul2ui40");class ht extends pe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,r,o,c,u,p){const f=this.length;return this.resize(f+1),this.emplace(f,e,i,r,o,c,u,p)}emplace(e,i,r,o,c,u,p,f){const _=8*e;return this.int16[_+0]=i,this.int16[_+1]=r,this.int16[_+2]=o,this.int16[_+4]=c,this.int16[_+5]=u,this.int16[_+6]=p,this.int16[_+7]=f,e}}ht.prototype.bytesPerElement=16,ct(ht,"StructArrayLayout3i2i2i16");class Et extends pe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,r,o,c){const u=this.length;return this.resize(u+1),this.emplace(u,e,i,r,o,c)}emplace(e,i,r,o,c,u){const p=4*e,f=8*e;return this.float32[p+0]=i,this.float32[p+1]=r,this.float32[p+2]=o,this.int16[f+6]=c,this.int16[f+7]=u,e}}Et.prototype.bytesPerElement=16,ct(Et,"StructArrayLayout2f1f2i16");class Wt extends pe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,r,o){const c=this.length;return this.resize(c+1),this.emplace(c,e,i,r,o)}emplace(e,i,r,o,c){const u=12*e,p=3*e;return this.uint8[u+0]=i,this.uint8[u+1]=r,this.float32[p+1]=o,this.float32[p+2]=c,e}}Wt.prototype.bytesPerElement=12,ct(Wt,"StructArrayLayout2ub2f12");class qt extends pe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,r){const o=this.length;return this.resize(o+1),this.emplace(o,e,i,r)}emplace(e,i,r,o){const c=3*e;return this.float32[c+0]=i,this.float32[c+1]=r,this.float32[c+2]=o,e}}qt.prototype.bytesPerElement=12,ct(qt,"StructArrayLayout3f12");class pt extends pe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,r){const o=this.length;return this.resize(o+1),this.emplace(o,e,i,r)}emplace(e,i,r,o){const c=3*e;return this.uint16[c+0]=i,this.uint16[c+1]=r,this.uint16[c+2]=o,e}}pt.prototype.bytesPerElement=6,ct(pt,"StructArrayLayout3ui6");class hi extends pe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,r,o,c,u,p,f,_,x,w,E,C,D,L,V,H,te,Y,ee,ae){const ne=this.length;return this.resize(ne+1),this.emplace(ne,e,i,r,o,c,u,p,f,_,x,w,E,C,D,L,V,H,te,Y,ee,ae)}emplace(e,i,r,o,c,u,p,f,_,x,w,E,C,D,L,V,H,te,Y,ee,ae,ne){const be=30*e,ge=15*e,Se=60*e;return this.int16[be+0]=i,this.int16[be+1]=r,this.int16[be+2]=o,this.float32[ge+2]=c,this.float32[ge+3]=u,this.uint16[be+8]=p,this.uint16[be+9]=f,this.uint32[ge+5]=_,this.uint32[ge+6]=x,this.uint32[ge+7]=w,this.uint16[be+16]=E,this.uint16[be+17]=C,this.uint16[be+18]=D,this.float32[ge+10]=L,this.float32[ge+11]=V,this.uint8[Se+48]=H,this.uint8[Se+49]=te,this.uint8[Se+50]=Y,this.uint32[ge+13]=ee,this.int16[be+28]=ae,this.uint8[Se+58]=ne,e}}hi.prototype.bytesPerElement=60,ct(hi,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class fi extends pe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,r,o,c,u,p,f,_,x,w,E,C,D,L,V,H,te,Y,ee,ae,ne,be,ge,Se,$e,Te,Re,Oe,Ve){const Ye=this.length;return this.resize(Ye+1),this.emplace(Ye,e,i,r,o,c,u,p,f,_,x,w,E,C,D,L,V,H,te,Y,ee,ae,ne,be,ge,Se,$e,Te,Re,Oe,Ve)}emplace(e,i,r,o,c,u,p,f,_,x,w,E,C,D,L,V,H,te,Y,ee,ae,ne,be,ge,Se,$e,Te,Re,Oe,Ve,Ye){const Ae=38*e,et=19*e;return this.int16[Ae+0]=i,this.int16[Ae+1]=r,this.int16[Ae+2]=o,this.float32[et+2]=c,this.float32[et+3]=u,this.int16[Ae+8]=p,this.int16[Ae+9]=f,this.int16[Ae+10]=_,this.int16[Ae+11]=x,this.int16[Ae+12]=w,this.int16[Ae+13]=E,this.uint16[Ae+14]=C,this.uint16[Ae+15]=D,this.uint16[Ae+16]=L,this.uint16[Ae+17]=V,this.uint16[Ae+18]=H,this.uint16[Ae+19]=te,this.uint16[Ae+20]=Y,this.uint16[Ae+21]=ee,this.uint16[Ae+22]=ae,this.uint16[Ae+23]=ne,this.uint16[Ae+24]=be,this.uint16[Ae+25]=ge,this.uint16[Ae+26]=Se,this.uint16[Ae+27]=$e,this.uint16[Ae+28]=Te,this.uint32[et+15]=Re,this.float32[et+16]=Oe,this.float32[et+17]=Ve,this.float32[et+18]=Ye,e}}fi.prototype.bytesPerElement=76,ct(fi,"StructArrayLayout3i2f6i15ui1ul3f76");class _i extends pe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.float32[1*e+0]=i,e}}_i.prototype.bytesPerElement=4,ct(_i,"StructArrayLayout1f4");class gi extends pe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,r,o,c){const u=this.length;return this.resize(u+1),this.emplace(u,e,i,r,o,c)}emplace(e,i,r,o,c,u){const p=5*e;return this.float32[p+0]=i,this.float32[p+1]=r,this.float32[p+2]=o,this.float32[p+3]=c,this.float32[p+4]=u,e}}gi.prototype.bytesPerElement=20,ct(gi,"StructArrayLayout5f20");class yn extends pe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,r,o){const c=this.length;return this.resize(c+1),this.emplace(c,e,i,r,o)}emplace(e,i,r,o,c){const u=6*e;return this.uint32[3*e+0]=i,this.uint16[u+2]=r,this.uint16[u+3]=o,this.uint16[u+4]=c,e}}yn.prototype.bytesPerElement=12,ct(yn,"StructArrayLayout1ul3ui12");class sn extends pe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i){const r=this.length;return this.resize(r+1),this.emplace(r,e,i)}emplace(e,i,r){const o=2*e;return this.uint16[o+0]=i,this.uint16[o+1]=r,e}}sn.prototype.bytesPerElement=4,ct(sn,"StructArrayLayout2ui4");class nr extends pe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint16[1*e+0]=i,e}}nr.prototype.bytesPerElement=2,ct(nr,"StructArrayLayout1ui2");class br extends pe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i){const r=this.length;return this.resize(r+1),this.emplace(r,e,i)}emplace(e,i,r){const o=2*e;return this.float32[o+0]=i,this.float32[o+1]=r,e}}br.prototype.bytesPerElement=8,ct(br,"StructArrayLayout2f8");class Si extends le{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Si.prototype.size=40;class yi extends St{get(e){return new Si(this,e)}}ct(yi,"CollisionBoxArray");class oi extends le{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}oi.prototype.size=60;class Wi extends hi{get(e){return new oi(this,e)}}ct(Wi,"PlacedSymbolArray");class Tn extends le{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(e){this._structArray.uint32[this._pos4+15]=e}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}Tn.prototype.size=76;class Mi extends fi{get(e){return new Tn(this,e)}}ct(Mi,"SymbolInstanceArray");class Cn extends _i{getoffsetX(e){return this.float32[1*e+0]}}ct(Cn,"GlyphOffsetArray");class us extends qe{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}ct(us,"SymbolLineVertexArray");class ma extends le{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}ma.prototype.size=12;class To extends yn{get(e){return new ma(this,e)}}ct(To,"FeatureIndexArray");class Br extends sn{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}ct(Br,"FillExtrusionCentroidArray");const Xr=de([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),fa=de([{name:"a_dash",components:4,type:"Uint16"}]);var ds={exports:{}},sd=function(t,e){var i,r,o,c,u,p,f,_;for(r=t.length-(i=3&t.length),o=e,u=3432918353,p=461845907,_=0;_<r;)f=255&t.charCodeAt(_)|(255&t.charCodeAt(++_))<<8|(255&t.charCodeAt(++_))<<16|(255&t.charCodeAt(++_))<<24,++_,o=27492+(65535&(c=5*(65535&(o=(o^=f=(65535&(f=(f=(65535&f)*u+(((f>>>16)*u&65535)<<16)&4294967295)<<15|f>>>17))*p+(((f>>>16)*p&65535)<<16)&4294967295)<<13|o>>>19))+((5*(o>>>16)&65535)<<16)&4294967295))+((58964+(c>>>16)&65535)<<16);switch(f=0,i){case 3:f^=(255&t.charCodeAt(_+2))<<16;case 2:f^=(255&t.charCodeAt(_+1))<<8;case 1:o^=f=(65535&(f=(f=(65535&(f^=255&t.charCodeAt(_)))*u+(((f>>>16)*u&65535)<<16)&4294967295)<<15|f>>>17))*p+(((f>>>16)*p&65535)<<16)&4294967295}return o^=t.length,o=2246822507*(65535&(o^=o>>>16))+((2246822507*(o>>>16)&65535)<<16)&4294967295,o=3266489909*(65535&(o^=o>>>13))+((3266489909*(o>>>16)&65535)<<16)&4294967295,(o^=o>>>16)>>>0},Bm=function(t,e){for(var i,r=t.length,o=e^r,c=0;r>=4;)i=1540483477*(65535&(i=255&t.charCodeAt(c)|(255&t.charCodeAt(++c))<<8|(255&t.charCodeAt(++c))<<16|(255&t.charCodeAt(++c))<<24))+((1540483477*(i>>>16)&65535)<<16),o=1540483477*(65535&o)+((1540483477*(o>>>16)&65535)<<16)^(i=1540483477*(65535&(i^=i>>>24))+((1540483477*(i>>>16)&65535)<<16)),r-=4,++c;switch(r){case 3:o^=(255&t.charCodeAt(c+2))<<16;case 2:o^=(255&t.charCodeAt(c+1))<<8;case 1:o=1540483477*(65535&(o^=255&t.charCodeAt(c)))+((1540483477*(o>>>16)&65535)<<16)}return o=1540483477*(65535&(o^=o>>>13))+((1540483477*(o>>>16)&65535)<<16),(o^=o>>>15)>>>0};ds.exports=sd,ds.exports.murmur3=sd,ds.exports.murmur2=Bm;var Xh=Xt(ds.exports);class Gc{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,i,r,o){this.ids.push(ld(e)),this.positions.push(i,r,o)}getPositions(e){const i=ld(e);let r=0,o=this.ids.length-1;for(;r<o;){const u=r+o>>1;this.ids[u]>=i?o=u:r=u+1}const c=[];for(;this.ids[r]===i;)c.push({index:this.positions[3*r],start:this.positions[3*r+1],end:this.positions[3*r+2]}),r++;return c}static serialize(e,i){const r=new Float64Array(e.ids),o=new Uint32Array(e.positions);return Kh(r,o,0,r.length-1),i&&i.push(r.buffer,o.buffer),{ids:r,positions:o}}static deserialize(e){const i=new Gc;return i.ids=e.ids,i.positions=e.positions,i.indexed=!0,i}}function ld(t){const e=+t;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:Xh(String(t))}function Kh(t,e,i,r){for(;i<r;){const o=t[i+r>>1];let c=i-1,u=r+1;for(;;){do{c++}while(t[c]<o);do{u--}while(t[u]>o);if(c>=u)break;qc(t,c,u),qc(e,3*c,3*u),qc(e,3*c+1,3*u+1),qc(e,3*c+2,3*u+2)}u-i<r-u?(Kh(t,e,i,u),i=u+1):(Kh(t,e,u+1,r),r=u)}}function qc(t,e,i){const r=t[e];t[e]=t[i],t[i]=r}ct(Gc,"FeaturePositionMap");class _a{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,i){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,i),this.initialized=!0),!!this.location}}class $c extends _a{constructor(e){super(e),this.current=0}set(e,i,r){this.fetchUniformLocation(e,i)&&this.current!==r&&(this.current=r,this.gl.uniform1f(this.location,r))}}class cd extends _a{constructor(e){super(e),this.current=[0,0,0,0]}set(e,i,r){this.fetchUniformLocation(e,i)&&(r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]&&r[3]===this.current[3]||(this.current=r,this.gl.uniform4f(this.location,r[0],r[1],r[2],r[3])))}}class hd extends _a{constructor(e){super(e),this.current=Zi.transparent}set(e,i,r){this.fetchUniformLocation(e,i)&&(r.r===this.current.r&&r.g===this.current.g&&r.b===this.current.b&&r.a===this.current.a||(this.current=r,this.gl.uniform4f(this.location,r.r,r.g,r.b,r.a)))}}const Fm=new Float32Array(16),Um=new Float32Array(9),Vm=new Float32Array(4);function Jh(t){return[oe(255*t.r,255*t.g),oe(255*t.b,255*t.a)]}class kl{constructor(e,i,r){this.value=e,this.uniformNames=i.map(o=>`u_${o}`),this.type=r}setUniform(e,i,r,o,c){i.set(e,c,o.constantOr(this.value))}getBinding(e,i){return"color"===this.type?new hd(e):new $c(e)}}class ps{constructor(e,i){this.uniformNames=i.map(r=>`u_${r}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(e){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br)}setUniform(e,i,r,o,c){const u="u_pattern"===c||"u_dash"===c?this.pattern:"u_pixel_ratio"===c?this.pixelRatio:null;u&&i.set(e,c,u)}getBinding(e,i){return"u_pattern"===i||"u_dash"===i?new cd(e):new $c(e)}}class ga{constructor(e,i,r,o){this.expression=e,this.type=r,this.maxValue=0,this.paintVertexAttributes=i.map(c=>({name:`a_${c}`,type:"Float32",components:"color"===r?2:1,offset:0})),this.paintVertexArray=new o}populatePaintArray(e,i,r,o,c,u){const p=this.paintVertexArray.length,f=this.expression.evaluate(new v(0),i,{},c,o,u);this.paintVertexArray.resize(e),this._setPaintValue(p,e,f)}updatePaintArray(e,i,r,o,c){const u=this.expression.evaluate({zoom:0},r,o,void 0,c);this._setPaintValue(e,i,u)}_setPaintValue(e,i,r){if("color"===this.type){const o=Jh(r);for(let c=e;c<i;c++)this.paintVertexArray.emplace(c,o[0],o[1])}else{for(let o=e;o<i;o++)this.paintVertexArray.emplace(o,r);this.maxValue=Math.max(this.maxValue,Math.abs(r))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Fr{constructor(e,i,r,o,c,u){this.expression=e,this.uniformNames=i.map(p=>`u_${p}_t`),this.type=r,this.useIntegerZoom=o,this.zoom=c,this.maxValue=0,this.paintVertexAttributes=i.map(p=>({name:`a_${p}`,type:"Float32",components:"color"===r?4:2,offset:0})),this.paintVertexArray=new u}populatePaintArray(e,i,r,o,c,u){const p=this.expression.evaluate(new v(this.zoom),i,{},c,o,u),f=this.expression.evaluate(new v(this.zoom+1),i,{},c,o,u),_=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(_,e,p,f)}updatePaintArray(e,i,r,o,c){const u=this.expression.evaluate({zoom:this.zoom},r,o,void 0,c),p=this.expression.evaluate({zoom:this.zoom+1},r,o,void 0,c);this._setPaintValue(e,i,u,p)}_setPaintValue(e,i,r,o){if("color"===this.type){const c=Jh(r),u=Jh(o);for(let p=e;p<i;p++)this.paintVertexArray.emplace(p,c[0],c[1],u[0],u[1])}else{for(let c=e;c<i;c++)this.paintVertexArray.emplace(c,r,o);this.maxValue=Math.max(this.maxValue,Math.abs(r),Math.abs(o))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,i,r,o,c){const u=this.useIntegerZoom?Math.floor(r.zoom):r.zoom,p=Ee(this.expression.interpolationFactor(u,this.zoom,this.zoom+1),0,1);i.set(e,c,p)}getBinding(e,i){return new $c(e)}}class Va{constructor(e,i,r,o,c){this.expression=e,this.layerId=c,this.paintVertexAttributes=("array"===r?fa:Xr).members;for(let u=0;u<i.length;++u);this.paintVertexArray=new o}populatePaintArray(e,i,r){const o=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(o,e,i.patterns&&i.patterns[this.layerId],r)}updatePaintArray(e,i,r,o,c,u){this._setPaintValues(e,i,r.patterns&&r.patterns[this.layerId],u)}_setPaintValues(e,i,r,o){if(!o||!r)return;const c=o[r];if(!c)return;const{tl:u,br:p,pixelRatio:f}=c;for(let _=e;_<i;_++)this.paintVertexArray.emplace(_,u[0],u[1],p[0],p[1],f)}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Na{constructor(e,i,r=(()=>!0)){this.binders={},this._buffers=[];const o=[];for(const c in e.paint._values){if(!r(c))continue;const u=e.paint.get(c);if(!(u instanceof Z&&Pa(u.property.specification)))continue;const p=jm(c,e.type),f=u.value,_=u.property.specification.type,x=!!u.property.useIntegerZoom,w="line-dasharray"===c||c.endsWith("pattern"),E="line-dasharray"===c&&"constant"!==e.layout.get("line-cap").value.kind;if("constant"!==f.kind||E)if("source"===f.kind||E||w){const C=ud(c,_,"source");this.binders[c]=w?new Va(f,p,_,C,e.id):new ga(f,p,_,C),o.push(`/a_${c}`)}else{const C=ud(c,_,"composite");this.binders[c]=new Fr(f,p,_,x,i,C),o.push(`/z_${c}`)}else this.binders[c]=w?new ps(f.value,p):new kl(f.value,p,_),o.push(`/u_${c}`)}this.cacheKey=o.sort().join("")}getMaxValue(e){const i=this.binders[e];return i instanceof ga||i instanceof Fr?i.maxValue:0}populatePaintArrays(e,i,r,o,c,u){for(const p in this.binders){const f=this.binders[p];(f instanceof ga||f instanceof Fr||f instanceof Va)&&f.populatePaintArray(e,i,r,o,c,u)}}setConstantPatternPositions(e){for(const i in this.binders){const r=this.binders[i];r instanceof ps&&r.setConstantPatternPositions(e)}}updatePaintArrays(e,i,r,o,c,u){let p=!1;for(const f in e){const _=i.getPositions(f);for(const x of _){const w=r.feature(x.index);for(const E in this.binders){const C=this.binders[E];if((C instanceof ga||C instanceof Fr||C instanceof Va)&&!0===C.expression.isStateDependent){const D=o.paint.get(E);C.expression=D.value,C.updatePaintArray(x.start,x.end,w,e[f],c,u),p=!0}}}}return p}defines(){const e=[];for(const i in this.binders){const r=this.binders[i];(r instanceof kl||r instanceof ps)&&e.push(...r.uniformNames.map(o=>`#define HAS_UNIFORM_${o}`))}return e}getBinderAttributes(){const e=[];for(const i in this.binders){const r=this.binders[i];if(r instanceof ga||r instanceof Fr||r instanceof Va)for(let o=0;o<r.paintVertexAttributes.length;o++)e.push(r.paintVertexAttributes[o].name)}return e}getBinderUniforms(){const e=[];for(const i in this.binders){const r=this.binders[i];if(r instanceof kl||r instanceof ps||r instanceof Fr)for(const o of r.uniformNames)e.push(o)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const i=[];for(const r in this.binders){const o=this.binders[r];if(o instanceof kl||o instanceof ps||o instanceof Fr)for(const c of o.uniformNames)i.push({name:c,property:r,binding:o.getBinding(e,c)})}return i}setUniforms(e,i,r,o,c){for(const{name:u,property:p,binding:f}of r)this.binders[p].setUniform(e,f,c,o.get(p),u)}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const i=this.binders[e];(i instanceof ga||i instanceof Fr||i instanceof Va)&&i.paintVertexBuffer&&this._buffers.push(i.paintVertexBuffer)}}upload(e){for(const i in this.binders){const r=this.binders[i];(r instanceof ga||r instanceof Fr||r instanceof Va)&&r.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const i=this.binders[e];(i instanceof ga||i instanceof Fr||i instanceof Va)&&i.destroy()}}}class ko{constructor(e,i,r=(()=>!0)){this.programConfigurations={};for(const o of e)this.programConfigurations[o.id]=new Na(o,i,r);this.needsUpload=!1,this._featureMap=new Gc,this._bufferOffset=0}populatePaintArrays(e,i,r,o,c,u,p){for(const f in this.programConfigurations)this.programConfigurations[f].populatePaintArrays(e,i,o,c,u,p);void 0!==i.id&&this._featureMap.add(i.id,r,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,i,r,o,c){for(const u of r)this.needsUpload=this.programConfigurations[u.id].updatePaintArrays(e,this._featureMap,i,u,o,c)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const i in this.programConfigurations)this.programConfigurations[i].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const Nm={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function jm(t,e){return Nm[t]||[t.replace(`${e}-`,"").replace(/-/g,"_")]}const Zm={"line-pattern":{source:ye,composite:ye},"fill-pattern":{source:ye,composite:ye},"fill-extrusion-pattern":{source:ye,composite:ye},"line-dasharray":{source:ze,composite:ze}},Gm={color:{source:br,composite:Ze},number:{source:_i,composite:br}};function ud(t,e,i){const r=Zm[t];return r&&r[i]||Gm[e][i]}ct(kl,"ConstantBinder"),ct(ps,"PatternConstantBinder"),ct(ga,"SourceExpressionBinder"),ct(Va,"PatternCompositeBinder"),ct(Fr,"CompositeExpressionBinder"),ct(Na,"ProgramConfiguration",{omit:["_buffers"]}),ct(ko,"ProgramConfigurationSet");const dd="-transition";class Ur extends Mr{constructor(e,i){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,"custom"!==e.type&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,"background"!==e.type&&"sky"!==e.type&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),i.layout&&(this._unevaluatedLayout=new G(i.layout)),i.paint)){this._transitionablePaint=new S(i.paint);for(const r in e.paint)this.setPaintProperty(r,e.paint[r],{validate:!1});for(const r in e.layout)this.setLayoutProperty(r,e.layout[r],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new $(i.paint)}}getLayoutProperty(e){return"visibility"===e?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,i,r={}){null!=i&&this._validate(qh,`layers.${this.id}.layout.${e}`,e,i,r)||("visibility"!==e?this._unevaluatedLayout.setValue(e,i):this.visibility=i)}getPaintProperty(e){return $t(e,dd)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,i,r={}){if(null!=i&&this._validate(Gh,`layers.${this.id}.paint.${e}`,e,i,r))return!1;if($t(e,dd))return this._transitionablePaint.setTransition(e.slice(0,-11),i||void 0),!1;{const o=this._transitionablePaint._values[e],c=o.value.isDataDriven(),u=o.value;this._transitionablePaint.setValue(e,i),this._handleSpecialPaintPropertyUpdate(e);const p=this._transitionablePaint._values[e].value,f=p.isDataDriven(),_=$t(e,"pattern")||"line-dasharray"===e;return f||c||_||this._handleOverridablePaintPropertyUpdate(e,u,p)}}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getProgramConfiguration(e){return null}_handleOverridablePaintPropertyUpdate(e,i,r){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||"none"===this.visibility}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,i){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,i)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,i)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),en(e,(i,r)=>!(void 0===i||"layout"===r&&!Object.keys(i).length||"paint"===r&&!Object.keys(i).length))}_validate(e,i,r,o,c={}){return(!c||!1!==c.validate)&&Vc(this,e.call(Uc,{key:i,layerType:this.type,objectKey:r,value:o,styleSpec:ke,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const i=this.paint.get(e);if(i instanceof Z&&Pa(i.property.specification)&&("source"===i.value.kind||"composite"===i.value.kind)&&i.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=ss(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const qm=de([{name:"a_pos",components:2,type:"Int16"}],4),$m=de([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Hi{constructor(e=[]){this.segments=e}prepareSegment(e,i,r,o){let c=this.segments[this.segments.length-1];return e>Hi.MAX_VERTEX_ARRAY_LENGTH&&ii(`Max vertices per segment is ${Hi.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!c||c.vertexLength+e>Hi.MAX_VERTEX_ARRAY_LENGTH||c.sortKey!==o)&&(c={vertexOffset:i.length,primitiveOffset:r.length,vertexLength:0,primitiveLength:0},void 0!==o&&(c.sortKey=o),this.segments.push(c)),c}get(){return this.segments}destroy(){for(const e of this.segments)for(const i in e.vaos)e.vaos[i].destroy()}static simpleSegment(e,i,r,o){return new Hi([{vertexOffset:e,primitiveOffset:i,vertexLength:r,primitiveLength:o,vaos:{},sortKey:0}])}}Hi.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,ct(Hi,"SegmentVector");var vt=8192;class ja{constructor(e,i){e&&(i?this.setSouthWest(e).setNorthEast(i):4===e.length?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof xi?new xi(e.lng,e.lat):xi.convert(e),this}setSouthWest(e){return this._sw=e instanceof xi?new xi(e.lng,e.lat):xi.convert(e),this}extend(e){const i=this._sw,r=this._ne;let o,c;if(e instanceof xi)o=e,c=e;else{if(!(e instanceof ja))return Array.isArray(e)?4===e.length||e.every(Array.isArray)?this.extend(ja.convert(e)):this.extend(xi.convert(e)):"object"==typeof e&&null!==e&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(xi.convert(e)):this;if(o=e._sw,c=e._ne,!o||!c)return this}return i||r?(i.lng=Math.min(o.lng,i.lng),i.lat=Math.min(o.lat,i.lat),r.lng=Math.max(c.lng,r.lng),r.lat=Math.max(c.lat,r.lat)):(this._sw=new xi(o.lng,o.lat),this._ne=new xi(c.lng,c.lat)),this}getCenter(){return new xi((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new xi(this.getWest(),this.getNorth())}getSouthEast(){return new xi(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:i,lat:r}=xi.convert(e);let o=this._sw.lng<=i&&i<=this._ne.lng;return this._sw.lng>this._ne.lng&&(o=this._sw.lng>=i&&i>=this._ne.lng),this._sw.lat<=r&&r<=this._ne.lat&&o}static convert(e){return!e||e instanceof ja?e:new ja(e)}}var Wc=1e-6,rr=typeof Float32Array<"u"?Float32Array:Array;function pd(){var t=new rr(9);return rr!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function md(t,e,i){var r=e[0],o=e[1],c=e[2],u=e[3],p=e[4],f=e[5],_=e[6],x=e[7],w=e[8],E=i[0],C=i[1],D=i[2],L=i[3],V=i[4],H=i[5],te=i[6],Y=i[7],ee=i[8];return t[0]=E*r+C*u+D*_,t[1]=E*o+C*p+D*x,t[2]=E*c+C*f+D*w,t[3]=L*r+V*u+H*_,t[4]=L*o+V*p+H*x,t[5]=L*c+V*f+H*w,t[6]=te*r+Y*u+ee*_,t[7]=te*o+Y*p+ee*x,t[8]=te*c+Y*f+ee*w,t}function Vr(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Qh(t,e){var i=e[0],r=e[1],o=e[2],c=e[3],u=e[4],p=e[5],f=e[6],_=e[7],x=e[8],w=e[9],E=e[10],C=e[11],D=e[12],L=e[13],V=e[14],H=e[15],te=i*p-r*u,Y=i*f-o*u,ee=i*_-c*u,ae=r*f-o*p,ne=r*_-c*p,be=o*_-c*f,ge=x*L-w*D,Se=x*V-E*D,$e=x*H-C*D,Te=w*V-E*L,Re=w*H-C*L,Oe=E*H-C*V,Ve=te*Oe-Y*Re+ee*Te+ae*$e-ne*Se+be*ge;return Ve?(t[0]=(p*Oe-f*Re+_*Te)*(Ve=1/Ve),t[1]=(o*Re-r*Oe-c*Te)*Ve,t[2]=(L*be-V*ne+H*ae)*Ve,t[3]=(E*ne-w*be-C*ae)*Ve,t[4]=(f*$e-u*Oe-_*Se)*Ve,t[5]=(i*Oe-o*$e+c*Se)*Ve,t[6]=(V*ee-D*be-H*Y)*Ve,t[7]=(x*be-E*ee+C*Y)*Ve,t[8]=(u*Re-p*$e+_*ge)*Ve,t[9]=(r*$e-i*Re-c*ge)*Ve,t[10]=(D*ne-L*ee+H*te)*Ve,t[11]=(w*ee-x*ne-C*te)*Ve,t[12]=(p*Se-u*Te-f*ge)*Ve,t[13]=(i*Te-r*Se+o*ge)*Ve,t[14]=(L*Y-D*ae-V*te)*Ve,t[15]=(x*ae-w*Y+E*te)*Ve,t):null}function Ao(t,e,i){var r=e[0],o=e[1],c=e[2],u=e[3],p=e[4],f=e[5],_=e[6],x=e[7],w=e[8],E=e[9],C=e[10],D=e[11],L=e[12],V=e[13],H=e[14],te=e[15],Y=i[0],ee=i[1],ae=i[2],ne=i[3];return t[0]=Y*r+ee*p+ae*w+ne*L,t[1]=Y*o+ee*f+ae*E+ne*V,t[2]=Y*c+ee*_+ae*C+ne*H,t[3]=Y*u+ee*x+ae*D+ne*te,t[4]=(Y=i[4])*r+(ee=i[5])*p+(ae=i[6])*w+(ne=i[7])*L,t[5]=Y*o+ee*f+ae*E+ne*V,t[6]=Y*c+ee*_+ae*C+ne*H,t[7]=Y*u+ee*x+ae*D+ne*te,t[8]=(Y=i[8])*r+(ee=i[9])*p+(ae=i[10])*w+(ne=i[11])*L,t[9]=Y*o+ee*f+ae*E+ne*V,t[10]=Y*c+ee*_+ae*C+ne*H,t[11]=Y*u+ee*x+ae*D+ne*te,t[12]=(Y=i[12])*r+(ee=i[13])*p+(ae=i[14])*w+(ne=i[15])*L,t[13]=Y*o+ee*f+ae*E+ne*V,t[14]=Y*c+ee*_+ae*C+ne*H,t[15]=Y*u+ee*x+ae*D+ne*te,t}function Al(t,e,i){var r,o,c,u,p,f,_,x,w,E,C,D,L=i[0],V=i[1],H=i[2];return e===t?(t[12]=e[0]*L+e[4]*V+e[8]*H+e[12],t[13]=e[1]*L+e[5]*V+e[9]*H+e[13],t[14]=e[2]*L+e[6]*V+e[10]*H+e[14],t[15]=e[3]*L+e[7]*V+e[11]*H+e[15]):(o=e[1],c=e[2],u=e[3],p=e[4],f=e[5],_=e[6],x=e[7],w=e[8],E=e[9],C=e[10],D=e[11],t[0]=r=e[0],t[1]=o,t[2]=c,t[3]=u,t[4]=p,t[5]=f,t[6]=_,t[7]=x,t[8]=w,t[9]=E,t[10]=C,t[11]=D,t[12]=r*L+p*V+w*H+e[12],t[13]=o*L+f*V+E*H+e[13],t[14]=c*L+_*V+C*H+e[14],t[15]=u*L+x*V+D*H+e[15]),t}function Co(t,e,i){var r=i[0],o=i[1],c=i[2];return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*o,t[5]=e[5]*o,t[6]=e[6]*o,t[7]=e[7]*o,t[8]=e[8]*c,t[9]=e[9]*c,t[10]=e[10]*c,t[11]=e[11]*c,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function eu(t,e,i){var r=Math.sin(i),o=Math.cos(i),c=e[4],u=e[5],p=e[6],f=e[7],_=e[8],x=e[9],w=e[10],E=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=c*o+_*r,t[5]=u*o+x*r,t[6]=p*o+w*r,t[7]=f*o+E*r,t[8]=_*o-c*r,t[9]=x*o-u*r,t[10]=w*o-p*r,t[11]=E*o-f*r,t}function Hc(t,e,i){var r=Math.sin(i),o=Math.cos(i),c=e[0],u=e[1],p=e[2],f=e[3],_=e[8],x=e[9],w=e[10],E=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=c*o-_*r,t[1]=u*o-x*r,t[2]=p*o-w*r,t[3]=f*o-E*r,t[8]=c*r+_*o,t[9]=u*r+x*o,t[10]=p*r+w*o,t[11]=f*r+E*o,t}function fd(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function _d(t,e,i){var r,o,c,u=i[0],p=i[1],f=i[2],_=Math.hypot(u,p,f);return _<Wc?null:(u*=_=1/_,p*=_,f*=_,r=Math.sin(e),o=Math.cos(e),t[0]=u*u*(c=1-o)+o,t[1]=p*u*c+f*r,t[2]=f*u*c-p*r,t[3]=0,t[4]=u*p*c-f*r,t[5]=p*p*c+o,t[6]=f*p*c+u*r,t[7]=0,t[8]=u*f*c+p*r,t[9]=p*f*c-u*r,t[10]=f*f*c+o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var Wm=Ao;function tu(){var t=new rr(3);return rr!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function gd(t){var e=new rr(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function Cl(t){return Math.hypot(t[0],t[1],t[2])}function ms(t,e,i){var r=new rr(3);return r[0]=t,r[1]=e,r[2]=i,r}function ya(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t}function iu(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t}function yd(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t[2]=e[2]*i[2],t}function Ml(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t[2]=Math.min(e[2],i[2]),t}function Dl(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t[2]=Math.max(e[2],i[2]),t}function dr(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t}function Il(t,e,i,r){return t[0]=e[0]+i[0]*r,t[1]=e[1]+i[1]*r,t[2]=e[2]+i[2]*r,t}function Mn(t,e){var i=e[0],r=e[1],o=e[2],c=i*i+r*r+o*o;return c>0&&(c=1/Math.sqrt(c)),t[0]=e[0]*c,t[1]=e[1]*c,t[2]=e[2]*c,t}function wr(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function nu(t,e,i){var r=e[0],o=e[1],c=e[2],u=i[0],p=i[1],f=i[2];return t[0]=o*f-c*p,t[1]=c*u-r*f,t[2]=r*p-o*u,t}function Gi(t,e,i){var r=e[0],o=e[1],c=e[2],u=i[3]*r+i[7]*o+i[11]*c+i[15];return t[0]=(i[0]*r+i[4]*o+i[8]*c+i[12])/(u=u||1),t[1]=(i[1]*r+i[5]*o+i[9]*c+i[13])/u,t[2]=(i[2]*r+i[6]*o+i[10]*c+i[14])/u,t}function xd(t,e,i){var r=i[0],o=i[1],c=i[2],u=e[0],p=e[1],f=e[2],_=o*f-c*p,x=c*u-r*f,w=r*p-o*u,E=o*w-c*x,C=c*_-r*w,D=r*x-o*_,L=2*i[3];return x*=L,w*=L,C*=2,D*=2,t[0]=u+(_*=L)+(E*=2),t[1]=p+x+C,t[2]=f+w+D,t}var Sl,Nr=iu,Hm=yd,Ym=Cl;function vd(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t}function bd(t,e){var i=e[0],r=e[1],o=e[2],c=e[3],u=i*i+r*r+o*o+c*c;return u>0&&(u=1/Math.sqrt(u)),t[0]=i*u,t[1]=r*u,t[2]=o*u,t[3]=c*u,t}function Mo(t,e,i){var r=e[0],o=e[1],c=e[2],u=e[3];return t[0]=i[0]*r+i[4]*o+i[8]*c+i[12]*u,t[1]=i[1]*r+i[5]*o+i[9]*c+i[13]*u,t[2]=i[2]*r+i[6]*o+i[10]*c+i[14]*u,t[3]=i[3]*r+i[7]*o+i[11]*c+i[15]*u,t}function wd(){var t=new rr(4);return rr!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function Td(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function Ed(t,e,i){i*=.5;var r=e[0],o=e[1],c=e[2],u=e[3],p=Math.sin(i),f=Math.cos(i);return t[0]=r*f+u*p,t[1]=o*f+c*p,t[2]=c*f-o*p,t[3]=u*f-r*p,t}function kd(t,e,i){i*=.5;var r=e[0],o=e[1],c=e[2],u=e[3],p=Math.sin(i),f=Math.cos(i);return t[0]=r*f-c*p,t[1]=o*f+u*p,t[2]=c*f+r*p,t[3]=u*f-o*p,t}tu(),Sl=new rr(4),rr!=Float32Array&&(Sl[0]=0,Sl[1]=0,Sl[2]=0,Sl[3]=0);var Xm=bd;tu(),ms(1,0,0),ms(0,1,0),wd(),wd(),pd();const Km=de([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Ad}=Km,Cd=de([{name:"a_pos_3",components:3,type:"Int16"}]);var Pl=de([{name:"a_pos",type:"Int16",components:2}]);class ru{constructor(e,i){this.pos=e,this.dir=i}intersectsPlane(e,i,r){const o=wr(i,this.dir);if(Math.abs(o)<1e-6)return!1;const c=((e[0]-this.pos[0])*i[0]+(e[1]-this.pos[1])*i[1]+(e[2]-this.pos[2])*i[2])/o;return r[0]=this.pos[0]+this.dir[0]*c,r[1]=this.pos[1]+this.dir[1]*c,r[2]=this.pos[2]+this.dir[2]*c,!0}closestPointOnSphere(e,i,r){if(L=(C=this.pos)[0],V=C[1],H=C[2],te=(D=e)[0],Y=D[1],ee=D[2],Math.abs(L-te)<=Wc*Math.max(1,Math.abs(L),Math.abs(te))&&Math.abs(V-Y)<=Wc*Math.max(1,Math.abs(V),Math.abs(Y))&&Math.abs(H-ee)<=Wc*Math.max(1,Math.abs(H),Math.abs(ee))||0===i)return r[0]=r[1]=r[2]=0,!1;var C,D,L,V,H,te,Y,ee;const[o,c,u]=this.dir,p=this.pos[0]-e[0],f=this.pos[1]-e[1],_=this.pos[2]-e[2],x=o*o+c*c+u*u,w=2*(p*o+f*c+_*u),E=w*w-4*x*(p*p+f*f+_*_-i*i);if(E<0){const C=Math.max(-w/2,0),D=p+o*C,L=f+c*C,V=_+u*C,H=Math.hypot(D,L,V);return r[0]=D*i/H,r[1]=L*i/H,r[2]=V*i/H,!1}{const C=(-w-Math.sqrt(E))/(2*x);if(C<0){const D=Math.hypot(p,f,_);return r[0]=p*i/D,r[1]=f*i/D,r[2]=_*i/D,!1}return r[0]=p+o*C,r[1]=f+c*C,r[2]=_+u*C,!0}}}class au{constructor(e,i,r,o,c){this.TL=e,this.TR=i,this.BR=r,this.BL=o,this.horizon=c}static fromInvProjectionMatrix(e,i,r){const o=[-1,1,1],c=[1,1,1],u=[1,-1,1],p=[-1,-1,1],f=Gi(o,o,e),_=Gi(c,c,e),x=Gi(u,u,e),w=Gi(p,p,e);return new au(f,_,x,w,i/r)}}class ou{constructor(e,i){this.points=e,this.planes=i}static fromInvProjectionMatrix(e,i,r,o){const c=Math.pow(2,r),u=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(f=>{const _=Mo([],f,e),x=1/_[3]/i*c;return(w=_)[0]=(E=_)[0]*(C=[x,x,o?1/_[3]:x,x])[0],w[1]=E[1]*C[1],w[2]=E[2]*C[2],w[3]=E[3]*C[3],w;var w,E,C}),p=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(f=>{const _=Mn([],nu([],Nr([],u[f[0]],u[f[1]]),Nr([],u[f[2]],u[f[1]]))),x=-wr(_,u[f[1]]);return _.concat(x)});return new ou(u,p)}}class Dn{static fromPoints(e){const i=[1/0,1/0,1/0],r=[-1/0,-1/0,-1/0];for(const o of e)Ml(i,i,o),Dl(r,r,o);return new Dn(i,r)}static applyTransform(e,i){const r=e.getCorners();for(let o=0;o<r.length;++o)Gi(r[o],r[o],i);return Dn.fromPoints(r)}constructor(e,i){this.min=e,this.max=i,this.center=dr([],ya([],this.min,this.max),.5)}quadrant(e){const i=[e%2==0,e<2],r=gd(this.min),o=gd(this.max);for(let c=0;c<i.length;c++)r[c]=i[c]?this.min[c]:this.center[c],o[c]=i[c]?this.center[c]:this.max[c];return o[2]=this.max[2],new Dn(r,o)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,i=this.max;return[[e[0],e[1],e[2]],[i[0],e[1],e[2]],[i[0],i[1],e[2]],[e[0],i[1],e[2]],[e[0],e[1],i[2]],[i[0],e[1],i[2]],[i[0],i[1],i[2]],[e[0],i[1],i[2]]]}intersects(e){const i=this.getCorners();let r=!0;for(let o=0;o<e.planes.length;o++){const c=e.planes[o];let u=0;for(let p=0;p<i.length;p++)u+=wr(c,i[p])+c[3]>=0;if(0===u)return 0;u!==i.length&&(r=!1)}if(r)return 2;for(let o=0;o<3;o++){let c=Number.MAX_VALUE,u=-Number.MAX_VALUE;for(let p=0;p<e.points.length;p++){const f=e.points[p][o]-this.min[o];c=Math.min(c,f),u=Math.max(u,f)}if(u<0||c>this.max[o]-this.min[o])return 0}return 1}}const su=5,Md=6,Kr=vt/Math.PI/2,Jm=16383,zl=[64,32,16],Tr=-Kr,Er=Kr,Qm=[new Dn([Tr,Tr,Tr],[Er,Er,Er]),new Dn([Tr,Tr,Tr],[0,0,Er]),new Dn([0,Tr,Tr],[Er,0,Er]),new Dn([Tr,0,Tr],[0,Er,Er]),new Dn([0,0,Tr],[Er,Er,Er])];function Yc(t){return t*Kr/Ol}function Dd(t,e,i,r=!0){const o=dr([],t._camera.position,t.worldSize),c=[e,i,1,1];Mo(c,c,t.pixelMatrixInverse),vd(c,c,1/c[3]);const u=Mn([],Nr([],c,o)),p=t.globeMatrix,f=[p[12],p[13],p[14]],_=Nr([],f,o),x=Cl(_),w=Mn([],_),E=t.worldSize/(2*Math.PI),C=wr(w,u),D=Math.asin(E/x);if(D<Math.acos(C)){if(!r)return null;const $e=[],Te=[];dr($e,u,x/C),Mn(Te,Nr(Te,$e,_)),Mn(u,ya(u,_,dr(u,Te,Math.tan(D)*x)))}const L=[];new ru(o,u).closestPointOnSphere(f,E,L);const V=Mn([],On(p,0)),H=Mn([],On(p,1)),te=Mn([],On(p,2)),Y=wr(V,L),ee=wr(H,L),ae=wr(te,L),ne=at(Math.asin(-ee/E));let be=at(Math.atan2(Y,ae));be=t.center.lng+function($e,Te){const Re=(Te-$e+180)%360-180;return Re<-180?Re+360:Re}(t.center.lng,be);const ge=Qr(be),Se=Ee(ea(ne),0,1);return new ys(ge,Se)}class ef{constructor(e,i,r){this.a=Nr([],e,r),this.b=Nr([],i,r),this.center=r;const o=Mn([],this.a),c=Mn([],this.b);this.angle=Math.acos(wr(o,c))}}function lu(t,e){if(0===t.angle)return null;let i;return i=0===t.a[e]?1/t.angle*.5*Math.PI:1/t.angle*Math.atan(t.b[e]/t.a[e]/Math.sin(t.angle)-1/Math.tan(t.angle)),i<0||i>1?null:function(r,o,c,u){const p=Math.sin(c);return r*(Math.sin((1-u)*c)/p)+o*(Math.sin(u*c)/p)}(t.a[e],t.b[e],t.angle,Ee(i,0,1))+t.center[e]}function Jr(t){if(t.z<=1)return Qm[t.z+2*t.y+t.x];const e=cu(Xc(t));return Dn.fromPoints(e)}function Io(t,e,i){return dr(t,t,1-i),Il(t,t,e,i)}function Id(t,e){const i=gs(e.zoom);if(0===i)return Jr(t);const r=Xc(t),o=cu(r),c=Qr(r.getWest())*e.worldSize,u=Qr(r.getEast())*e.worldSize,p=ea(r.getNorth())*e.worldSize,f=ea(r.getSouth())*e.worldSize,_=[c,p,0],x=[u,p,0],w=[c,f,0],E=[u,f,0],C=Qh([],e.globeMatrix);return Gi(_,_,C),Gi(x,x,C),Gi(w,w,C),Gi(E,E,C),o[0]=Io(o[0],w,i),o[1]=Io(o[1],E,i),o[2]=Io(o[2],x,i),o[3]=Io(o[3],_,i),Dn.fromPoints(o)}function Sd(t,e,i){for(const r of t)Gi(r,r,e),dr(r,r,i)}function Xc({x:t,y:e,z:i}){const r=1/(1<<i),o=new xi(pr(t*r),xn((e+1)*r)),c=new xi(pr((t+1)*r),xn(e*r));return new ja(o,c)}function cu(t){const e=De(t.getNorth()),i=De(t.getSouth()),r=Math.cos(e),o=Math.cos(i),c=Math.sin(e),u=Math.sin(i),p=t.getWest(),f=t.getEast();return[fs(o,u,p),fs(o,u,f),fs(r,c,f),fs(r,c,p)]}function fs(t,e,i,r=Kr){return i=De(i),[t*Math.sin(i)*r,-e*r,t*Math.cos(i)*r]}function _s(t,e,i){return fs(Math.cos(De(t)),Math.sin(De(t)),e,i)}function Ll(t,e,i,r){const o=1<<i.z,c=(t/vt+i.x)/o;return _s(xn((e/vt+i.y)/o),pr(c),r)}function Kc({min:t,max:e}){return Jm/Math.max(e[0]-t[0],e[1]-t[1],e[2]-t[2])}const Pd=new Float64Array(16);function Rl(t){const e=Kc(t),i=fd(Pd,[e,e,e]);return Al(i,i,((r=[])[0]=-(o=t.min)[0],r[1]=-o[1],r[2]=-o[2],r));var r,o}function hu(t){const e=(r=t.min,(i=Pd)[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=r[0],i[13]=r[1],i[14]=r[2],i[15]=1,i);var i,r;const o=1/Kc(t);return Co(e,e,[o,o,o])}function zd(t,e,i,r,o){const c=function(f){const _=vt/(2*Math.PI);return f/(2*Math.PI)/_}(i),u=[t,e,-i/(2*Math.PI)],p=Vr(new Float64Array(16));return Al(p,p,u),Co(p,p,[c,c,c]),eu(p,p,De(-o)),Hc(p,p,De(-r)),p}function gs(t){return Me(su,Md,t)}function Ld(t,e){const i=_s(e.lat,e.lng);return u=(o=iu([],function(D){const L=_s(D._center.lat,D._center.lng);let V=nu([],ms(0,1,0),L);const H=_d([],-D.angle,L);V=Gi(V,V,H),_d(H,-D._pitch,V);const te=Mn([],L);return dr(te,te,Yc(D.cameraToCenterDistance/D.pixelsPerMeter)),Gi(te,te,H),ya([],L,te)}(t),i))[0],p=o[1],f=o[2],_=(c=i)[0],x=c[1],w=c[2],C=(E=Math.sqrt(u*u+p*p+f*f)*Math.sqrt(_*_+x*x+w*w))&&wr(o,c)/E,Math.acos(Math.min(Math.max(C,-1),1));var o,c,u,p,f,_,x,w,E,C}function uu(t,e){return Ld(t,e)>Math.PI/2*1.01}const Rd=De(85),nf=Math.cos(Rd),rf=Math.sin(Rd),Ol=6371008.8,Od=2*Math.PI*Ol;class Za{constructor(e,i){if(isNaN(e)||isNaN(i))throw new Error(`Invalid LngLat object: (${e}, ${i})`);if(this.lng=+e,this.lat=+i,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Za(st(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const i=Math.PI/180,r=this.lat*i,o=e.lat*i,c=Math.sin(r)*Math.sin(o)+Math.cos(r)*Math.cos(o)*Math.cos((e.lng-this.lng)*i);return Ol*Math.acos(Math.min(c,1))}toBounds(e=0){const i=360*e/40075017,r=i/Math.cos(Math.PI/180*this.lat);return new ja(new Za(this.lng-r,this.lat-i),new Za(this.lng+r,this.lat+i))}toEcef(e){const i=Yc(e);return _s(this.lat,this.lng,Kr+i)}static convert(e){if(e instanceof Za)return e;if(Array.isArray(e)&&(2===e.length||3===e.length))return new Za(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&"object"==typeof e&&null!==e)return new Za(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}var xi=Za;function du(t){return Od*Math.cos(t*Math.PI/180)}function Qr(t){return(180+t)/360}function ea(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function jr(t,e){return t/du(e)}function pr(t){return 360*t-180}function xn(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}function Bd(t,e){return t*du(xn(e))}const vn=85.051129;function Fd(t){return 1/Math.cos(t*Math.PI/180)}class ys{constructor(e,i,r=0){this.x=+e,this.y=+i,this.z=+r}static fromLngLat(e,i=0){const r=xi.convert(e);return new ys(Qr(r.lng),ea(r.lat),jr(i,r.lat))}toLngLat(){return new xi(pr(this.x),xn(this.y))}toAltitude(){return Bd(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Od*Fd(xn(this.y))}}function pu(t,e,i,r,o,c,u,p,f){const _=(e+r)/2,x=(i+o)/2,w=new Pe(_,x);p(w),function(E,C,D,L,V,H){const te=D-V,Y=L-H;return Math.abs((L-C)*te-(D-E)*Y)/Math.hypot(te,Y)}(w.x,w.y,c.x,c.y,u.x,u.y)>=f?(pu(t,e,i,_,x,c,w,p,f),pu(t,_,x,r,o,w,u,p,f)):t.push(u)}function Ud(t,e,i){let r=t[0],o=r.x,c=r.y;e(r);const u=[r];for(let p=1;p<t.length;p++){const f=t[p],{x:_,y:x}=f;e(f),pu(u,o,c,_,x,r,f,e,i),o=_,c=x,r=f}return u}function mu(t,e,i,r){if(r(e,i)){const o=e.add(i)._mult(.5);mu(t,e,o,r),mu(t,o,i,r)}else t.push(i)}function af(t,e){let i=t[0];const r=[i];for(let o=1;o<t.length;o++){const c=t[o];mu(r,i,c,e),i=c}return r}const fu=Math.pow(2,14)-1,Vd=-fu-1;function of(t,e){const i=Math.round(t.x*e),r=Math.round(t.y*e);return t.x=Ee(i,Vd,fu),t.y=Ee(r,Vd,fu),(i<t.x||i>t.x+1||r<t.y||r>t.y+1)&&ii("Geometry exceeds allowed extent, reduce your vector tile buffer size"),t}function xa(t,e,i){const r=t.loadGeometry(),o=t.extent,c=vt/o;if(e&&i&&i.projection.isReprojectedInTileSpace){const u=1<<e.z,{scale:p,x:f,y:_,projection:x}=i,w=E=>{const C=pr((e.x+E.x/o)/u),D=xn((e.y+E.y/o)/u),L=x.project(C,D);E.x=(L.x*p-f)*o,E.y=(L.y*p-_)*o};for(let E=0;E<r.length;E++)if(1!==t.type)r[E]=Ud(r[E],w,1);else{const C=[];for(const D of r[E])D.x<0||D.x>=o||D.y<0||D.y>=o||(w(D),C.push(D));r[E]=C}}for(const u of r)for(const p of u)of(p,c);return r}function So(t,e){return{type:t.type,id:t.id,properties:t.properties,geometry:e?xa(t):[]}}function Jc(t,e,i,r,o){t.emplaceBack(2*e+(r+1)/2,2*i+(o+1)/2)}function Qc(t,e,i){t.emplaceBack(e.x,e.y,e.z,16384*i[0],16384*i[1],16384*i[2])}class _u{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.id),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new qe,this.indexArray=new pt,this.segments=new Hi,this.programConfigurations=new ko(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(e,i,r,o){const c=this.layers[0],u=[];let p=null;"circle"===c.type&&(p=c.layout.get("circle-sort-key"));for(const{feature:_,id:x,index:w,sourceLayerIndex:E}of e){const C=this.layers[0]._featureFilter.needGeometry,D=So(_,C);if(!this.layers[0]._featureFilter.filter(new v(this.zoom),D,r))continue;const L=p?p.evaluate(D,{},r):void 0,V={id:x,properties:_.properties,type:_.type,sourceLayerIndex:E,index:w,geometry:C?D.geometry:xa(_,r,o),patterns:{},sortKey:L};u.push(V)}p&&u.sort((_,x)=>_.sortKey-x.sortKey);let f=null;"globe"===o.projection.name&&(this.globeExtVertexArray=new We,f=o.projection);for(const _ of u){const{geometry:x,index:w,sourceLayerIndex:E}=_,C=e[w].feature;this.addFeature(_,x,w,i.availableImages,r,f),i.featureIndex.insert(C,x,w,E,this.index)}}update(e,i,r,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,r,o)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,qm.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,$m.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,i,r,o,c,u){for(const p of i)for(const f of p){const _=f.x,x=f.y;if(_<0||_>=vt||x<0||x>=vt)continue;if(u){const C=u.projectTilePoint(_,x,c),D=u.upVector(c,_,x),L=this.globeExtVertexArray;Qc(L,C,D),Qc(L,C,D),Qc(L,C,D),Qc(L,C,D)}const w=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),E=w.vertexLength;Jc(this.layoutVertexArray,_,x,-1,-1),Jc(this.layoutVertexArray,_,x,1,-1),Jc(this.layoutVertexArray,_,x,1,1),Jc(this.layoutVertexArray,_,x,-1,1),this.indexArray.emplaceBack(E,E+1,E+2),this.indexArray.emplaceBack(E,E+2,E+3),w.vertexLength+=4,w.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,{},o,c)}}function Nd(t,e){for(let i=0;i<t.length;i++)if(Po(e,t[i]))return!0;for(let i=0;i<e.length;i++)if(Po(t,e[i]))return!0;return!!gu(t,e)}function sf(t,e,i){return!!Po(t,e)||!!yu(e,t,i)}function jd(t,e){if(1===t.length)return Gd(e,t[0]);for(let i=0;i<e.length;i++){const r=e[i];for(let o=0;o<r.length;o++)if(Po(t,r[o]))return!0}for(let i=0;i<t.length;i++)if(Gd(e,t[i]))return!0;for(let i=0;i<e.length;i++)if(gu(t,e[i]))return!0;return!1}function lf(t,e,i){if(t.length>1){if(gu(t,e))return!0;for(let r=0;r<e.length;r++)if(yu(e[r],t,i))return!0}for(let r=0;r<t.length;r++)if(yu(t[r],e,i))return!0;return!1}function gu(t,e){if(0===t.length||0===e.length)return!1;for(let i=0;i<t.length-1;i++){const r=t[i],o=t[i+1];for(let c=0;c<e.length-1;c++)if(cf(r,o,e[c],e[c+1]))return!0}return!1}function cf(t,e,i,r){return qi(t,i,r)!==qi(e,i,r)&&qi(t,e,i)!==qi(t,e,r)}function yu(t,e,i){const r=i*i;if(1===e.length)return t.distSqr(e[0])<r;for(let o=1;o<e.length;o++)if(Zd(t,e[o-1],e[o])<r)return!0;return!1}function Zd(t,e,i){const r=e.distSqr(i);if(0===r)return t.distSqr(e);const o=((t.x-e.x)*(i.x-e.x)+(t.y-e.y)*(i.y-e.y))/r;return t.distSqr(o<0?e:o>1?i:i.sub(e)._mult(o)._add(e))}function Gd(t,e){let i,r,o,c=!1;for(let u=0;u<t.length;u++){i=t[u];for(let p=0,f=i.length-1;p<i.length;f=p++)r=i[p],o=i[f],r.y>e.y!=o.y>e.y&&e.x<(o.x-r.x)*(e.y-r.y)/(o.y-r.y)+r.x&&(c=!c)}return c}function Po(t,e){let i=!1;for(let r=0,o=t.length-1;r<t.length;o=r++){const c=t[r],u=t[o];c.y>e.y!=u.y>e.y&&e.x<(u.x-c.x)*(e.y-c.y)/(u.y-c.y)+c.x&&(i=!i)}return i}function qd(t,e,i,r,o){for(const u of t)if(e<=u.x&&i<=u.y&&r>=u.x&&o>=u.y)return!0;const c=[new Pe(e,i),new Pe(e,o),new Pe(r,o),new Pe(r,i)];if(t.length>2)for(const u of c)if(Po(t,u))return!0;for(let u=0;u<t.length-1;u++)if(hf(t[u],t[u+1],c))return!0;return!1}function hf(t,e,i){const r=i[0],o=i[2];if(t.x<r.x&&e.x<r.x||t.x>o.x&&e.x>o.x||t.y<r.y&&e.y<r.y||t.y>o.y&&e.y>o.y)return!1;const c=qi(t,e,i[0]);return c!==qi(t,e,i[1])||c!==qi(t,e,i[2])||c!==qi(t,e,i[3])}function xs(t,e,i){const r=e.paint.get(t).value;return"constant"===r.kind?r.value:i.programConfigurations.get(e.id).getMaxValue(t)}function eh(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function $d(t,e,i,r,o){if(!e[0]&&!e[1])return t;const c=Pe.convert(e)._mult(o);"viewport"===i&&c._rotate(-r);const u=[];for(let p=0;p<t.length;p++)u.push(t[p].sub(c));return u}function Wd(t,e,i,r){const o=Pe.convert(t)._mult(r);return"viewport"===e&&o._rotate(-i),o}ct(_u,"CircleBucket",{omit:["layers"]});const uf=new J({"circle-sort-key":new N(ke.layout_circle["circle-sort-key"])});var df={paint:new J({"circle-radius":new N(ke.paint_circle["circle-radius"]),"circle-color":new N(ke.paint_circle["circle-color"]),"circle-blur":new N(ke.paint_circle["circle-blur"]),"circle-opacity":new N(ke.paint_circle["circle-opacity"]),"circle-translate":new P(ke.paint_circle["circle-translate"]),"circle-translate-anchor":new P(ke.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new P(ke.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new P(ke.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new N(ke.paint_circle["circle-stroke-width"]),"circle-stroke-color":new N(ke.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new N(ke.paint_circle["circle-stroke-opacity"])}),layout:uf};function Hd(t,e,i,r,o,c,u,p,f){if(c&&t.queryGeometry.isAboveHorizon)return!1;c&&(f*=t.pixelToTileUnitsFactor);const _=t.tileID.canonical,x=i.projection.upVectorScale(_,i.center.lat,i.worldSize).metersToTile;for(const w of e)for(const E of w){const C=E.add(p),D=o&&i.elevation?i.elevation.exaggeration()*o.getElevationAt(C.x,C.y,!0):0,L=i.projection.projectTilePoint(C.x,C.y,_);if(D>0){const Y=i.projection.upVector(_,C.x,C.y);L.x+=Y[0]*x*D,L.y+=Y[1]*x*D,L.z+=Y[2]*x*D}const V=c?C:pf(L.x,L.y,L.z,r),H=c?t.tilespaceRays.map(Y=>ff(Y,D)):t.queryGeometry.screenGeometry,te=Mo([],[L.x,L.y,L.z,1],r);if(!u&&c?f*=te[3]/i.cameraToCenterDistance:u&&!c&&(f*=i.cameraToCenterDistance/te[3]),c){const Y=xn((E.y/vt+_.y)/(1<<_.z));f/=i.projection.pixelsPerMeter(Y,1)/jr(1,Y)}if(sf(H,V,f))return!0}return!1}function pf(t,e,i,r){const o=Mo([],[t,e,i,1],r);return new Pe(o[0]/o[3],o[1]/o[3])}const Yd=ms(0,0,0),mf=ms(0,0,1);function ff(t,e){const i=tu();return Yd[2]=e,t.intersectsPlane(Yd,mf,i),new Pe(i[0],i[1])}class Xd extends _u{}function Kd(t,{width:e,height:i},r,o){if(o){if(o instanceof Uint8ClampedArray)o=new Uint8Array(o.buffer);else if(o.length!==e*i*r)throw new RangeError("mismatched image size")}else o=new Uint8Array(e*i*r);return t.width=e,t.height=i,t.data=o,t}function Jd(t,e,i){const{width:r,height:o}=e;r===t.width&&o===t.height||(xu(t,e,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,r),height:Math.min(t.height,o)},i),t.width=r,t.height=o,t.data=e.data)}function xu(t,e,i,r,o,c){if(0===o.width||0===o.height)return e;if(o.width>t.width||o.height>t.height||i.x>t.width-o.width||i.y>t.height-o.height)throw new RangeError("out of range source coordinates for image copy");if(o.width>e.width||o.height>e.height||r.x>e.width-o.width||r.y>e.height-o.height)throw new RangeError("out of range destination coordinates for image copy");const u=t.data,p=e.data;for(let f=0;f<o.height;f++){const _=((i.y+f)*t.width+i.x)*c,x=((r.y+f)*e.width+r.x)*c;for(let w=0;w<o.width*c;w++)p[x+w]=u[_+w]}return e}ct(Xd,"HeatmapBucket",{omit:["layers"]});class va{constructor(e,i){Kd(this,e,1,i)}resize(e){Jd(this,new va(e),1)}clone(){return new va({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,r,o,c){xu(e,i,r,o,c,1)}}class ar{constructor(e,i){Kd(this,e,4,i)}resize(e){Jd(this,new ar(e),4)}replace(e,i){i?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new ar({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,r,o,c){xu(e,i,r,o,c,4)}}ct(va,"AlphaImage"),ct(ar,"RGBAImage");var _f={paint:new J({"heatmap-radius":new N(ke.paint_heatmap["heatmap-radius"]),"heatmap-weight":new N(ke.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new P(ke.paint_heatmap["heatmap-intensity"]),"heatmap-color":new X(ke.paint_heatmap["heatmap-color"]),"heatmap-opacity":new P(ke.paint_heatmap["heatmap-opacity"])})};function vu(t){const e={},i=t.resolution||256,r=t.clips?t.clips.length:1,o=t.image||new ar({width:i,height:r}),c=(u,p,f)=>{e[t.evaluationKey]=f;const _=t.expression.evaluate(e);o.data[u+p+0]=Math.floor(255*_.r/_.a),o.data[u+p+1]=Math.floor(255*_.g/_.a),o.data[u+p+2]=Math.floor(255*_.b/_.a),o.data[u+p+3]=Math.floor(255*_.a)};if(t.clips)for(let u=0,p=0;u<r;++u,p+=4*i)for(let f=0,_=0;f<i;f++,_+=4){const x=f/(i-1),{start:w,end:E}=t.clips[u];c(p,_,w*(1-x)+E*x)}else for(let u=0,p=0;u<i;u++,p+=4)c(0,p,u/(i-1));return o}var gf={paint:new J({"hillshade-illumination-direction":new P(ke.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new P(ke.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new P(ke.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new P(ke.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new P(ke.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new P(ke.paint_hillshade["hillshade-accent-color"])})};const yf=de([{name:"a_pos",components:2,type:"Int16"}],4),{members:xf}=yf;var bu={exports:{}};function th(t,e,i){i=i||2;var r,o,c,u,p,f,_,x=e&&e.length,w=x?e[0]*i:t.length,E=Qd(t,0,w,i,!0),C=[];if(!E||E.next===E.prev)return C;if(x&&(E=function(L,V,H,te){var Y,ee,ae,ne=[];for(Y=0,ee=V.length;Y<ee;Y++)(ae=Qd(L,V[Y]*te,Y<ee-1?V[Y+1]*te:L.length,te,!1))===ae.next&&(ae.steiner=!0),ne.push(Cf(ae));for(ne.sort(Ef),Y=0;Y<ne.length;Y++)H=kf(ne[Y],H);return H}(t,e,E,i)),t.length>80*i){r=c=t[0],o=u=t[1];for(var D=i;D<w;D+=i)(p=t[D])<r&&(r=p),(f=t[D+1])<o&&(o=f),p>c&&(c=p),f>u&&(u=f);_=0!==(_=Math.max(c-r,u-o))?32767/_:0}return Bl(E,C,i,r,o,_,0),C}function Qd(t,e,i,r,o){var c,u;if(o===Eu(t,e,i,r)>0)for(c=e;c<i;c+=r)u=ip(c,t[c],t[c+1],u);else for(c=i-r;c>=e;c-=r)u=ip(c,t[c],t[c+1],u);return u&&ih(u,u.next)&&(Ul(u),u=u.next),u}function zo(t,e){if(!t)return t;e||(e=t);var i,r=t;do{if(i=!1,r.steiner||!ih(r,r.next)&&0!==Yi(r.prev,r,r.next))r=r.next;else{if(Ul(r),(r=e=r.prev)===r.next)break;i=!0}}while(i||r!==e);return e}function Bl(t,e,i,r,o,c,u){if(t){!u&&c&&function(x,w,E,C){var D=x;do{0===D.z&&(D.z=wu(D.x,D.y,w,E,C)),D.prevZ=D.prev,D.nextZ=D.next,D=D.next}while(D!==x);D.prevZ.nextZ=null,D.prevZ=null,function(L){var V,H,te,Y,ee,ae,ne,be,ge=1;do{for(H=L,L=null,ee=null,ae=0;H;){for(ae++,te=H,ne=0,V=0;V<ge&&(ne++,te=te.nextZ);V++);for(be=ge;ne>0||be>0&&te;)0!==ne&&(0===be||!te||H.z<=te.z)?(Y=H,H=H.nextZ,ne--):(Y=te,te=te.nextZ,be--),ee?ee.nextZ=Y:L=Y,Y.prevZ=ee,ee=Y;H=te}ee.nextZ=null,ge*=2}while(ae>1)}(D)}(t,r,o,c);for(var p,f,_=t;t.prev!==t.next;)if(p=t.prev,f=t.next,c?bf(t,r,o,c):vf(t))e.push(p.i/i|0),e.push(t.i/i|0),e.push(f.i/i|0),Ul(t),t=f.next,_=f.next;else if((t=f)===_){u?1===u?Bl(t=wf(zo(t),e,i),e,i,r,o,c,2):2===u&&Tf(t,e,i,r,o,c):Bl(zo(t),e,i,r,o,c,1);break}}}function vf(t){var e=t.prev,i=t,r=t.next;if(Yi(e,i,r)>=0)return!1;for(var o=e.x,c=i.x,u=r.x,p=e.y,f=i.y,_=r.y,x=o<c?o<u?o:u:c<u?c:u,w=p<f?p<_?p:_:f<_?f:_,E=o>c?o>u?o:u:c>u?c:u,C=p>f?p>_?p:_:f>_?f:_,D=r.next;D!==e;){if(D.x>=x&&D.x<=E&&D.y>=w&&D.y<=C&&vs(o,p,c,f,u,_,D.x,D.y)&&Yi(D.prev,D,D.next)>=0)return!1;D=D.next}return!0}function bf(t,e,i,r){var o=t.prev,c=t,u=t.next;if(Yi(o,c,u)>=0)return!1;for(var p=o.x,f=c.x,_=u.x,x=o.y,w=c.y,E=u.y,C=p<f?p<_?p:_:f<_?f:_,D=x<w?x<E?x:E:w<E?w:E,L=p>f?p>_?p:_:f>_?f:_,V=x>w?x>E?x:E:w>E?w:E,H=wu(C,D,e,i,r),te=wu(L,V,e,i,r),Y=t.prevZ,ee=t.nextZ;Y&&Y.z>=H&&ee&&ee.z<=te;){if(Y.x>=C&&Y.x<=L&&Y.y>=D&&Y.y<=V&&Y!==o&&Y!==u&&vs(p,x,f,w,_,E,Y.x,Y.y)&&Yi(Y.prev,Y,Y.next)>=0||(Y=Y.prevZ,ee.x>=C&&ee.x<=L&&ee.y>=D&&ee.y<=V&&ee!==o&&ee!==u&&vs(p,x,f,w,_,E,ee.x,ee.y)&&Yi(ee.prev,ee,ee.next)>=0))return!1;ee=ee.nextZ}for(;Y&&Y.z>=H;){if(Y.x>=C&&Y.x<=L&&Y.y>=D&&Y.y<=V&&Y!==o&&Y!==u&&vs(p,x,f,w,_,E,Y.x,Y.y)&&Yi(Y.prev,Y,Y.next)>=0)return!1;Y=Y.prevZ}for(;ee&&ee.z<=te;){if(ee.x>=C&&ee.x<=L&&ee.y>=D&&ee.y<=V&&ee!==o&&ee!==u&&vs(p,x,f,w,_,E,ee.x,ee.y)&&Yi(ee.prev,ee,ee.next)>=0)return!1;ee=ee.nextZ}return!0}function wf(t,e,i){var r=t;do{var o=r.prev,c=r.next.next;!ih(o,c)&&ep(o,r,r.next,c)&&Fl(o,c)&&Fl(c,o)&&(e.push(o.i/i|0),e.push(r.i/i|0),e.push(c.i/i|0),Ul(r),Ul(r.next),r=t=c),r=r.next}while(r!==t);return zo(r)}function Tf(t,e,i,r,o,c){var u=t;do{for(var p=u.next.next;p!==u.prev;){if(u.i!==p.i&&Mf(u,p)){var f=tp(u,p);return u=zo(u,u.next),f=zo(f,f.next),Bl(u,e,i,r,o,c,0),void Bl(f,e,i,r,o,c,0)}p=p.next}u=u.next}while(u!==t)}function Ef(t,e){return t.x-e.x}function kf(t,e){var i=function(o,c){var u,p=c,f=o.x,_=o.y,x=-1/0;do{if(_<=p.y&&_>=p.next.y&&p.next.y!==p.y){var w=p.x+(_-p.y)*(p.next.x-p.x)/(p.next.y-p.y);if(w<=f&&w>x&&(x=w,u=p.x<p.next.x?p:p.next,w===f))return u}p=p.next}while(p!==c);if(!u)return null;var E,C=u,D=u.x,L=u.y,V=1/0;p=u;do{f>=p.x&&p.x>=D&&f!==p.x&&vs(_<L?f:x,_,D,L,_<L?x:f,_,p.x,p.y)&&(E=Math.abs(_-p.y)/(f-p.x),Fl(p,o)&&(E<V||E===V&&(p.x>u.x||p.x===u.x&&Af(u,p)))&&(u=p,V=E)),p=p.next}while(p!==C);return u}(t,e);if(!i)return e;var r=tp(i,t);return zo(r,r.next),zo(i,i.next)}function Af(t,e){return Yi(t.prev,t,e.prev)<0&&Yi(e.next,t,t.next)<0}function wu(t,e,i,r,o){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-i)*o|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-r)*o|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Cf(t){var e=t,i=t;do{(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next}while(e!==t);return i}function vs(t,e,i,r,o,c,u,p){return(o-u)*(e-p)>=(t-u)*(c-p)&&(t-u)*(r-p)>=(i-u)*(e-p)&&(i-u)*(c-p)>=(o-u)*(r-p)}function Mf(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(i,r){var o=i;do{if(o.i!==i.i&&o.next.i!==i.i&&o.i!==r.i&&o.next.i!==r.i&&ep(o,o.next,i,r))return!0;o=o.next}while(o!==i);return!1}(t,e)&&(Fl(t,e)&&Fl(e,t)&&function(i,r){var o=i,c=!1,u=(i.x+r.x)/2,p=(i.y+r.y)/2;do{o.y>p!=o.next.y>p&&o.next.y!==o.y&&u<(o.next.x-o.x)*(p-o.y)/(o.next.y-o.y)+o.x&&(c=!c),o=o.next}while(o!==i);return c}(t,e)&&(Yi(t.prev,t,e.prev)||Yi(t,e.prev,e))||ih(t,e)&&Yi(t.prev,t,t.next)>0&&Yi(e.prev,e,e.next)>0)}function Yi(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function ih(t,e){return t.x===e.x&&t.y===e.y}function ep(t,e,i,r){var o=rh(Yi(t,e,i)),c=rh(Yi(t,e,r)),u=rh(Yi(i,r,t)),p=rh(Yi(i,r,e));return o!==c&&u!==p||!(0!==o||!nh(t,i,e))||!(0!==c||!nh(t,r,e))||!(0!==u||!nh(i,t,r))||!(0!==p||!nh(i,e,r))}function nh(t,e,i){return e.x<=Math.max(t.x,i.x)&&e.x>=Math.min(t.x,i.x)&&e.y<=Math.max(t.y,i.y)&&e.y>=Math.min(t.y,i.y)}function rh(t){return t>0?1:t<0?-1:0}function Fl(t,e){return Yi(t.prev,t,t.next)<0?Yi(t,e,t.next)>=0&&Yi(t,t.prev,e)>=0:Yi(t,e,t.prev)<0||Yi(t,t.next,e)<0}function tp(t,e){var i=new Tu(t.i,t.x,t.y),r=new Tu(e.i,e.x,e.y),o=t.next,c=e.prev;return t.next=e,e.prev=t,i.next=o,o.prev=i,r.next=i,i.prev=r,c.next=r,r.prev=c,r}function ip(t,e,i,r){var o=new Tu(t,e,i);return r?(o.next=r.next,o.prev=r,r.next.prev=o,r.next=o):(o.prev=o,o.next=o),o}function Ul(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Tu(t,e,i){this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Eu(t,e,i,r){for(var o=0,c=e,u=i-r;c<i;c+=r)o+=(t[u]-t[c])*(t[c+1]+t[u+1]),u=c;return o}bu.exports=th,bu.exports.default=th,th.deviation=function(t,e,i,r){var o=e&&e.length,c=Math.abs(Eu(t,0,o?e[0]*i:t.length,i));if(o)for(var u=0,p=e.length;u<p;u++)c-=Math.abs(Eu(t,e[u]*i,u<p-1?e[u+1]*i:t.length,i));var f=0;for(u=0;u<r.length;u+=3){var _=r[u]*i,x=r[u+1]*i,w=r[u+2]*i;f+=Math.abs((t[_]-t[w])*(t[x+1]-t[_+1])-(t[_]-t[x])*(t[w+1]-t[_+1]))}return 0===c&&0===f?0:Math.abs((f-c)/c)},th.flatten=function(t){for(var e=t[0][0].length,i={vertices:[],holes:[],dimensions:e},r=0,o=0;o<t.length;o++){for(var c=0;c<t[o].length;c++)for(var u=0;u<e;u++)i.vertices.push(t[o][c][u]);o>0&&i.holes.push(r+=t[o-1].length)}return i};var ku=Xt(bu.exports);function Df(t,e,i,r,o){np(t,e,i||0,r||t.length-1,o||If)}function np(t,e,i,r,o){for(;r>i;){if(r-i>600){var c=r-i+1,u=e-i+1,p=Math.log(c),f=.5*Math.exp(2*p/3),_=.5*Math.sqrt(p*f*(c-f)/c)*(u-c/2<0?-1:1);np(t,e,Math.max(i,Math.floor(e-u*f/c+_)),Math.min(r,Math.floor(e+(c-u)*f/c+_)),o)}var x=t[e],w=i,E=r;for(Vl(t,i,e),o(t[r],x)>0&&Vl(t,i,r);w<E;){for(Vl(t,w,E),w++,E--;o(t[w],x)<0;)w++;for(;o(t[E],x)>0;)E--}0===o(t[i],x)?Vl(t,i,E):Vl(t,++E,r),E<=e&&(i=E+1),e<=E&&(r=E-1)}}function Vl(t,e,i){var r=t[e];t[e]=t[i],t[i]=r}function If(t,e){return t<e?-1:t>e?1:0}function Au(t,e){const i=t.length;if(i<=1)return[t];const r=[];let o,c;for(let u=0;u<i;u++){const p=bn(t[u]);0!==p&&(t[u].area=Math.abs(p),void 0===c&&(c=p<0),c===p<0?(o&&r.push(o),o=[t[u]]):o.push(t[u]))}if(o&&r.push(o),e>1)for(let u=0;u<r.length;u++)r[u].length<=e||(Df(r[u],e,1,r[u].length-1,Sf),r[u]=r[u].slice(0,e));return r}function Sf(t,e){return e.area-t.area}function Cu(t,e,i){const r=i.patternDependencies;let o=!1;for(const c of e){const u=c.paint.get(`${t}-pattern`);u.isConstant()||(o=!0);const p=u.constantOr(null);p&&(o=!0,r[p]=!0)}return o}function Mu(t,e,i,r,o){const c=o.patternDependencies;for(const u of e){const p=u.paint.get(`${t}-pattern`).value;if("constant"!==p.kind){let f=p.evaluate({zoom:r},i,{},o.availableImages);f=f&&f.name?f.name:f,c[f]=!0,i.patterns[u.id]=f}}return i}class ah{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new qe,this.indexArray=new pt,this.indexArray2=new sn,this.programConfigurations=new ko(e.layers,e.zoom),this.segments=new Hi,this.segments2=new Hi,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.projection=e.projection}populate(e,i,r,o){this.hasPattern=Cu("fill",this.layers,i);const c=this.layers[0].layout.get("fill-sort-key"),u=[];for(const{feature:p,id:f,index:_,sourceLayerIndex:x}of e){const w=this.layers[0]._featureFilter.needGeometry,E=So(p,w);if(!this.layers[0]._featureFilter.filter(new v(this.zoom),E,r))continue;const C=c?c.evaluate(E,{},r,i.availableImages):void 0,D={id:f,properties:p.properties,type:p.type,sourceLayerIndex:x,index:_,geometry:w?E.geometry:xa(p,r,o),patterns:{},sortKey:C};u.push(D)}c&&u.sort((p,f)=>p.sortKey-f.sortKey);for(const p of u){const{geometry:f,index:_,sourceLayerIndex:x}=p;if(this.hasPattern){const w=Mu("fill",this.layers,p,this.zoom,i);this.patternFeatures.push(w)}else this.addFeature(p,f,_,r,{},i.availableImages);i.featureIndex.insert(e[_].feature,f,_,x,this.index)}}update(e,i,r,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,r,o)}addFeatures(e,i,r,o,c){for(const u of this.patternFeatures)this.addFeature(u,u.geometry,u.index,i,r,o)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,xf),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,i,r,o,c,u=[]){for(const p of Au(i,500)){let f=0;for(const D of p)f+=D.length;const _=this.segments.prepareSegment(f,this.layoutVertexArray,this.indexArray),x=_.vertexLength,w=[],E=[];for(const D of p){if(0===D.length)continue;D!==p[0]&&E.push(w.length/2);const L=this.segments2.prepareSegment(D.length,this.layoutVertexArray,this.indexArray2),V=L.vertexLength;this.layoutVertexArray.emplaceBack(D[0].x,D[0].y),this.indexArray2.emplaceBack(V+D.length-1,V),w.push(D[0].x),w.push(D[0].y);for(let H=1;H<D.length;H++)this.layoutVertexArray.emplaceBack(D[H].x,D[H].y),this.indexArray2.emplaceBack(V+H-1,V+H),w.push(D[H].x),w.push(D[H].y);L.vertexLength+=D.length,L.primitiveLength+=D.length}const C=ku(w,E);for(let D=0;D<C.length;D+=3)this.indexArray.emplaceBack(x+C[D],x+C[D+1],x+C[D+2]);_.vertexLength+=f,_.primitiveLength+=C.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,c,u,o)}}ct(ah,"FillBucket",{omit:["layers","patternFeatures"]});const Pf=new J({"fill-sort-key":new N(ke.layout_fill["fill-sort-key"])});var zf={paint:new J({"fill-antialias":new P(ke.paint_fill["fill-antialias"]),"fill-opacity":new N(ke.paint_fill["fill-opacity"]),"fill-color":new N(ke.paint_fill["fill-color"]),"fill-outline-color":new N(ke.paint_fill["fill-outline-color"]),"fill-translate":new P(ke.paint_fill["fill-translate"]),"fill-translate-anchor":new P(ke.paint_fill["fill-translate-anchor"]),"fill-pattern":new N(ke.paint_fill["fill-pattern"])}),layout:Pf};const Lf=de([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),Rf=de([{name:"a_centroid_pos",components:2,type:"Uint16"}]),Of=de([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:Bf}=Lf;var oh={},Ff=Tt,rp=bs;function bs(t,e,i,r,o){this.properties={},this.extent=i,this.type=0,this._pbf=t,this._geometry=-1,this._keys=r,this._values=o,t.readFields(Uf,this,e)}function Uf(t,e,i){1==t?e.id=i.readVarint():2==t?function(r,o){for(var c=r.readVarint()+r.pos;r.pos<c;){var u=o._keys[r.readVarint()],p=o._values[r.readVarint()];o.properties[u]=p}}(i,e):3==t?e.type=i.readVarint():4==t&&(e._geometry=i.pos)}function Vf(t){for(var e,i,r=0,o=0,c=t.length,u=c-1;o<c;u=o++)r+=((i=t[u]).x-(e=t[o]).x)*(e.y+i.y);return r}bs.types=["Unknown","Point","LineString","Polygon"],bs.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,i=t.readVarint()+t.pos,r=1,o=0,c=0,u=0,p=[];t.pos<i;){if(o<=0){var f=t.readVarint();r=7&f,o=f>>3}if(o--,1===r||2===r)c+=t.readSVarint(),u+=t.readSVarint(),1===r&&(e&&p.push(e),e=[]),e.push(new Ff(c,u));else{if(7!==r)throw new Error("unknown command "+r);e&&e.push(e[0].clone())}}return e&&p.push(e),p},bs.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,i=1,r=0,o=0,c=0,u=1/0,p=-1/0,f=1/0,_=-1/0;t.pos<e;){if(r<=0){var x=t.readVarint();i=7&x,r=x>>3}if(r--,1===i||2===i)(o+=t.readSVarint())<u&&(u=o),o>p&&(p=o),(c+=t.readSVarint())<f&&(f=c),c>_&&(_=c);else if(7!==i)throw new Error("unknown command "+i)}return[u,f,p,_]},bs.prototype.toGeoJSON=function(t,e,i){var r,o,c=this.extent*Math.pow(2,i),u=this.extent*t,p=this.extent*e,f=this.loadGeometry(),_=bs.types[this.type];function x(C){for(var D=0;D<C.length;D++){var L=C[D];C[D]=[360*(L.x+u)/c-180,360/Math.PI*Math.atan(Math.exp((180-360*(L.y+p)/c)*Math.PI/180))-90]}}switch(this.type){case 1:var w=[];for(r=0;r<f.length;r++)w[r]=f[r][0];x(f=w);break;case 2:for(r=0;r<f.length;r++)x(f[r]);break;case 3:for(f=function(C){var D=C.length;if(D<=1)return[C];for(var L,V,H=[],te=0;te<D;te++){var Y=Vf(C[te]);0!==Y&&(void 0===V&&(V=Y<0),V===Y<0?(L&&H.push(L),L=[C[te]]):L.push(C[te]))}return L&&H.push(L),H}(f),r=0;r<f.length;r++)for(o=0;o<f[r].length;o++)x(f[r][o])}1===f.length?f=f[0]:_="Multi"+_;var E={type:"Feature",geometry:{type:_,coordinates:f},properties:this.properties};return"id"in this&&(E.id=this.id),E};var Nf=rp,ap=op;function op(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(jf,this,e),this.length=this._features.length}function jf(t,e,i){15===t?e.version=i.readVarint():1===t?e.name=i.readString():5===t?e.extent=i.readVarint():2===t?e._features.push(i.pos):3===t?e._keys.push(i.readString()):4===t&&e._values.push(function(r){for(var o=null,c=r.readVarint()+r.pos;r.pos<c;){var u=r.readVarint()>>3;o=1===u?r.readString():2===u?r.readFloat():3===u?r.readDouble():4===u?r.readVarint64():5===u?r.readVarint():6===u?r.readSVarint():7===u?r.readBoolean():null}return o}(i))}op.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new Nf(this._pbf,e,this.extent,this._keys,this._values)};var Zf=ap;function Gf(t,e,i){if(3===t){var r=new Zf(i,i.readVarint()+i.pos);r.length&&(e[r.name]=r)}}var Du=oh.VectorTile=function(t,e){this.layers=t.readFields(Gf,{},e)},sh=oh.VectorTileFeature=rp;function lh(t,e,i,r){const o=[],c=0===r?(u,p,f,_,x,w)=>{u.push(new Pe(w,f+(w-p)/(_-p)*(x-f)))}:(u,p,f,_,x,w)=>{u.push(new Pe(p+(w-f)/(x-f)*(_-p),w))};for(const u of t){const p=[];for(const f of u){if(f.length<=2)continue;const _=[];for(let E=0;E<f.length-1;E++){const C=f[E].x,D=f[E].y,L=f[E+1].x,V=f[E+1].y,H=0===r?C:D,te=0===r?L:V;H<e?te>e&&c(_,C,D,L,V,e):H>i?te<i&&c(_,C,D,L,V,i):_.push(f[E]),te<e&&H>=e&&c(_,C,D,L,V,e),te>i&&H<=i&&c(_,C,D,L,V,i)}let x=f[f.length-1];const w=0===r?x.x:x.y;w>=e&&w<=i&&_.push(x),_.length&&(x=_[_.length-1],_[0].x===x.x&&_[0].y===x.y||_.push(_[0]),p.push(_))}p.length&&o.push(p)}return o}oh.VectorTileLayer=ap;const qf=sh.types,$f=Math.pow(2,13);function Nl(t,e,i,r,o,c,u,p){t.emplaceBack((e<<1)+u,(i<<1)+c,(Math.floor(r*$f)<<1)+o,Math.round(p))}function jl(t,e,i){t.emplaceBack(e.x,e.y,e.z,16384*i[0],16384*i[1],16384*i[2])}class sp{constructor(){this.acc=new Pe(0,0),this.polyCount=[]}startRing(e){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new Pe(e.x,e.y),this.max=new Pe(e.x,e.y))}append(e,i){this.currentPolyCount.edges++,this.acc._add(e);const r=this.min,o=this.max;e.x<r.x?r.x=e.x:e.x>o.x&&(o.x=e.x),e.y<r.y?r.y=e.y:e.y>o.y&&(o.y=e.y),((0===e.x||e.x===vt)&&e.x===i.x)!=((0===e.y||e.y===vt)&&e.y===i.y)&&this.processBorderOverlap(e,i),i.x<0!=e.x<0&&this.addBorderIntersection(0,ei(i.y,e.y,(0-i.x)/(e.x-i.x))),i.x>vt!=e.x>vt&&this.addBorderIntersection(1,ei(i.y,e.y,(vt-i.x)/(e.x-i.x))),i.y<0!=e.y<0&&this.addBorderIntersection(2,ei(i.x,e.x,(0-i.y)/(e.y-i.y))),i.y>vt!=e.y>vt&&this.addBorderIntersection(3,ei(i.x,e.x,(vt-i.y)/(e.y-i.y)))}addBorderIntersection(e,i){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const r=this.borders[e];i<r[0]&&(r[0]=i),i>r[1]&&(r[1]=i)}processBorderOverlap(e,i){if(e.x===i.x){if(e.y===i.y)return;const r=0===e.x?0:1;this.addBorderIntersection(r,i.y),this.addBorderIntersection(r,e.y)}else{const r=0===e.y?2:3;this.addBorderIntersection(r,i.x),this.addBorderIntersection(r,e.x)}}centroid(){const e=this.polyCount.reduce((i,r)=>i+r.edges,0);return 0!==e?this.acc.div(e)._round():new Pe(0,0)}span(){return new Pe(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((e,i)=>e+ +(i[0]!==Number.MAX_VALUE),0)}}class Zl{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.id),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.layoutVertexArray=new Le,this.centroidVertexArray=new Br,this.indexArray=new pt,this.programConfigurations=new ko(e.layers,e.zoom),this.segments=new Hi,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.enableTerrain=e.enableTerrain}populate(e,i,r,o){this.features=[],this.hasPattern=Cu("fill-extrusion",this.layers,i),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(c){const u=Math.exp(Math.PI*(1-c.y/(1<<c.z)*2));return 80150034*u/(u*u+1)/vt/(1<<c.z)}(r),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:c,id:u,index:p,sourceLayerIndex:f}of e){const _=this.layers[0]._featureFilter.needGeometry,x=So(c,_);if(!this.layers[0]._featureFilter.filter(new v(this.zoom),x,r))continue;const w={id:u,sourceLayerIndex:f,index:p,geometry:_?x.geometry:xa(c,r,o),properties:c.properties,type:c.type,patterns:{}},E=this.layoutVertexArray.length;this.hasPattern?this.features.push(Mu("fill-extrusion",this.layers,w,this.zoom,i)):this.addFeature(w,w.geometry,p,r,{},i.availableImages,o),i.featureIndex.insert(c,w.geometry,p,f,this.index,E)}this.sortBorders()}addFeatures(e,i,r,o,c){for(const u of this.features){const{geometry:p}=u;this.addFeature(u,p,u.index,i,r,o,c)}this.sortBorders()}update(e,i,r,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,r,o)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Bf),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,Of.members,!0))),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){0!==this.centroidVertexArray.length&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,Rf.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,i,r,o,c,u,p){const f=[new Pe(0,0),new Pe(vt,vt)],_=p.projection,x="globe"===_.name,w=this.enableTerrain&&!x?new sp:null,E="Polygon"===qf[e.type];x&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new We);const C=Au(i,500);for(let H=C.length-1;H>=0;H--){const te=C[H];(0===te.length||(D=te[0]).every(Y=>Y.x<=0)||D.every(Y=>Y.x>=vt)||D.every(Y=>Y.y<=0)||D.every(Y=>Y.y>=vt))&&C.splice(H,1)}var D;let L;if(x)L=mp(C,f,o);else{L=[];for(const H of C)L.push({polygon:H,bounds:f})}const V=E?this.edgeRadius:0;for(const{polygon:H,bounds:te}of L){let Y=0,ee=0;for(const ne of H)E&&!ne[0].equals(ne[ne.length-1])&&ne.push(ne[0]),ee+=E?ne.length-1:ne.length;const ae=this.segments.prepareSegment((E?5:4)*ee,this.layoutVertexArray,this.indexArray);if(E){const ne=[],be=[];Y=ae.vertexLength;for(const Se of H){let $e,Te;Se.length&&Se!==H[0]&&be.push(ne.length/2),$e=Se[1].sub(Se[0])._perp()._unit();for(let Re=1;Re<Se.length;Re++){const Oe=Se[Re],Ve=Se[Re===Se.length-1?1:Re+1];let{x:Ye,y:Ae}=Oe;if(V){Te=Ve.sub(Oe)._perp()._unit();const et=$e.add(Te)._unit(),ut=V*Math.min(4,1/($e.x*et.x+$e.y*et.y));Ye+=ut*et.x,Ae+=ut*et.y,$e=Te}Nl(this.layoutVertexArray,Ye,Ae,0,0,1,1,0),ae.vertexLength++,ne.push(Oe.x,Oe.y),x&&jl(this.layoutVertexExtArray,_.projectTilePoint(Ye,Ae,o),_.upVector(o,Ye,Ae))}}const ge=ku(ne,be);for(let Se=0;Se<ge.length;Se+=3)this.indexArray.emplaceBack(Y+ge[Se],Y+ge[Se+2],Y+ge[Se+1]),ae.primitiveLength++}for(const ne of H){w&&ne.length&&w.startRing(ne[0]);let be,ge,Se,$e=ne.length>4&&up(ne[ne.length-2],ne[0],ne[1]),Te=V?Wf(ne[ne.length-2],ne[0],ne[1],V):0;ge=ne[1].sub(ne[0])._perp()._unit();let Re=!0;for(let Oe=1,Ve=0;Oe<ne.length;Oe++){let Ye=ne[Oe-1],Ae=ne[Oe];const et=ne[Oe===ne.length-1?1:Oe+1];if(w&&E&&w.currentPolyCount.top++,hp(Ae,Ye,te)){V&&(ge=et.sub(Ae)._perp()._unit(),Re=!Re);continue}w&&w.append(Ae,Ye);const ut=Ae.sub(Ye)._perp(),tt=ut.x/(Math.abs(ut.x)+Math.abs(ut.y)),Lt=ut.y>0?1:0,Xe=Ye.dist(Ae);if(Ve+Xe>32768&&(Ve=0),V){Se=et.sub(Ae)._perp()._unit();let Ot=cp(Ye,Ae,et,lp(ge,Se),V);isNaN(Ot)&&(Ot=0);const kt=Ae.sub(Ye)._unit();Ye=Ye.add(kt.mult(Te))._round(),Ae=Ae.add(kt.mult(-Ot))._round(),Te=Ot,ge=Se}const xt=ae.vertexLength,Rt=ne.length>4&&up(Ye,Ae,et);let ri=dp(Ve,$e,Re);if(Nl(this.layoutVertexArray,Ye.x,Ye.y,tt,Lt,0,0,ri),Nl(this.layoutVertexArray,Ye.x,Ye.y,tt,Lt,0,1,ri),Ve+=Xe,ri=dp(Ve,Rt,!Re),$e=Rt,Nl(this.layoutVertexArray,Ae.x,Ae.y,tt,Lt,0,0,ri),Nl(this.layoutVertexArray,Ae.x,Ae.y,tt,Lt,0,1,ri),ae.vertexLength+=4,this.indexArray.emplaceBack(xt+0,xt+1,xt+2),this.indexArray.emplaceBack(xt+1,xt+3,xt+2),ae.primitiveLength+=2,V){const Ot=Y+(1===Oe?ne.length-2:Oe-2),kt=1===Oe?Y:Ot+1;if(this.indexArray.emplaceBack(xt+1,Ot,xt+3),this.indexArray.emplaceBack(Ot,kt,xt+3),ae.primitiveLength+=2,void 0===be&&(be=xt),!hp(et,ne[Oe],te)){const Ci=Oe===ne.length-1?be:ae.vertexLength;this.indexArray.emplaceBack(xt+2,xt+3,Ci),this.indexArray.emplaceBack(xt+3,Ci+1,Ci),this.indexArray.emplaceBack(xt+3,kt,Ci+1),ae.primitiveLength+=3}Re=!Re}if(x){const Ot=this.layoutVertexExtArray,kt=_.projectTilePoint(Ye.x,Ye.y,o),Ci=_.projectTilePoint(Ae.x,Ae.y,o),Vt=_.upVector(o,Ye.x,Ye.y),Nt=_.upVector(o,Ae.x,Ae.y);jl(Ot,kt,Vt),jl(Ot,kt,Vt),jl(Ot,Ci,Nt),jl(Ot,Ci,Nt)}}E&&(Y+=ne.length-1)}}if(w&&w.polyCount.length>0){if(w.borders){w.vertexArrayOffset=this.centroidVertexArray.length;const H=w.borders,te=this.featuresOnBorder.push(w)-1;for(let Y=0;Y<4;Y++)H[Y][0]!==Number.MAX_VALUE&&this.borders[Y].push(te)}this.encodeCentroid(w.borders?void 0:w.centroid(),w)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,c,u,o)}sortBorders(){for(let e=0;e<4;e++)this.borders[e].sort((i,r)=>this.featuresOnBorder[i].borders[e][0]-this.featuresOnBorder[r].borders[e][0])}encodeCentroid(e,i,r=!0){let o,c;if(e)if(0!==e.y){const p=i.span()._mult(this.tileToMeter);o=(Math.max(e.x,1)<<3)+Math.min(7,Math.round(p.x/10)),c=(Math.max(e.y,1)<<3)+Math.min(7,Math.round(p.y/10))}else o=Math.ceil(7*(e.x+450)),c=0;else o=0,c=+r;let u=r?this.centroidVertexArray.length:i.vertexArrayOffset;for(const p of i.polyCount){r&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*p.edges+p.top);for(let f=0;f<p.top;f++)this.centroidVertexArray.emplace(u++,o,c);for(let f=0;f<2*p.edges;f++)this.centroidVertexArray.emplace(u++,0,c),this.centroidVertexArray.emplace(u++,o,c)}}}function lp(t,e){const i=t.add(e)._unit();return t.x*i.x+t.y*i.y}function Wf(t,e,i,r){const o=e.sub(t)._perp()._unit(),c=i.sub(e)._perp()._unit();return cp(t,e,i,lp(o,c),r)}function cp(t,e,i,r,o){const c=Math.sqrt(1-r*r);return Math.min(t.dist(e)/3,e.dist(i)/3,o*c/r)}function hp(t,e,i){return t.x<i[0].x&&e.x<i[0].x||t.x>i[1].x&&e.x>i[1].x||t.y<i[0].y&&e.y<i[0].y||t.y>i[1].y&&e.y>i[1].y}function up(t,e,i){if(t.x<0||t.x>=vt||e.x<0||e.x>=vt||i.x<0||i.x>=vt)return!1;const r=i.sub(e),o=r.perp(),c=t.sub(e);return(r.x*c.x+r.y*c.y)/Math.sqrt((r.x*r.x+r.y*r.y)*(c.x*c.x+c.y*c.y))>-.866&&o.x*c.x+o.y*c.y<0}function dp(t,e,i){const r=e?2|t:-3&t;return i?1|r:-2&r}function pp(){const t=Math.PI/32,e=Math.tan(t),i=Ol;return i*Math.sqrt(1+2*e*e)-i}function mp(t,e,i){const r=1<<i.z,o=pr(i.x/r),c=pr((i.x+1)/r),u=xn(i.y/r),p=xn((i.y+1)/r);return function(f,_,x,w,E=0,C){const D=[];if(!f.length||!x||!w)return D;const L=(ne,be)=>{for(const ge of ne)D.push({polygon:ge,bounds:be})},V=Math.ceil(Math.log2(x)),H=Math.ceil(Math.log2(w)),te=V-H,Y=[];for(let ne=0;ne<Math.abs(te);ne++)Y.push(te>0?0:1);for(let ne=0;ne<Math.min(V,H);ne++)Y.push(0),Y.push(1);let ee=f;if(ee=lh(ee,_[0].y-E,_[1].y+E,1),ee=lh(ee,_[0].x-E,_[1].x+E,0),!ee.length)return D;const ae=[];for(Y.length?ae.push({polygons:ee,bounds:_,depth:0}):L(ee,_);ae.length;){const ne=ae.pop(),be=ne.depth,ge=Y[be],Se=ne.bounds[0],$e=ne.bounds[1],Te=0===ge?Se.x:Se.y,Re=0===ge?$e.x:$e.y,Oe=C?C(ge,Te,Re):.5*(Te+Re),Ve=lh(ne.polygons,Te-E,Oe+E,ge),Ye=lh(ne.polygons,Oe-E,Re+E,ge);if(Ve.length){const Ae=[Se,new Pe(0===ge?Oe:$e.x,1===ge?Oe:$e.y)];Y.length>be+1?ae.push({polygons:Ve,bounds:Ae,depth:be+1}):L(Ve,Ae)}if(Ye.length){const Ae=[new Pe(0===ge?Oe:Se.x,1===ge?Oe:Se.y),$e];Y.length>be+1?ae.push({polygons:Ye,bounds:Ae,depth:be+1}):L(Ye,Ae)}}return D}(t,e,Math.ceil((c-o)/11.25),Math.ceil((u-p)/11.25),1,(f,_,x)=>{if(0===f)return.5*(_+x);{const w=xn((i.y+_/vt)/r);return(ea(.5*(xn((i.y+x/vt)/r)+w))*r-i.y)*vt}})}ct(Zl,"FillExtrusionBucket",{omit:["layers","features"]}),ct(sp,"PartMetadata");const Hf=new J({"fill-extrusion-edge-radius":new P(ke["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var Yf={paint:new J({"fill-extrusion-opacity":new P(ke["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new N(ke["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new P(ke["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new P(ke["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new N(ke["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new N(ke["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new N(ke["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new P(ke["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new P(ke["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new P(ke["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-rounded-roof":new P(ke["paint_fill-extrusion"]["fill-extrusion-rounded-roof"])}),layout:Hf};function fp(t,e,i){var r=2*Math.PI*6378137/256/Math.pow(2,i);return[t*r-2*Math.PI*6378137/2,e*r-2*Math.PI*6378137/2]}class ch{constructor(e,i,r){this.z=e,this.x=i,this.y=r,this.key=Gl(0,e,e,i,r)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,i){const r=(u=this.y,p=this.z,f=fp(256*(c=this.x),256*(u=Math.pow(2,p)-u-1),p),_=fp(256*(c+1),256*(u+1),p),f[0]+","+f[1]+","+_[0]+","+_[1]),o=function(c,u,p){let f,_="";for(let x=c;x>0;x--)f=1<<x-1,_+=(u&f?1:0)+(p&f?2:0);return _}(this.z,this.x,this.y);var c,u,p,f,_;return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===i?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",o).replace("{bbox-epsg-3857}",r)}toString(){return`${this.z}/${this.x}/${this.y}`}}class _p{constructor(e,i){this.wrap=e,this.canonical=i,this.key=Gl(e,i.z,i.z,i.x,i.y)}}class In{constructor(e,i,r,o,c){this.overscaledZ=e,this.wrap=i,this.canonical=new ch(r,+o,+c),this.key=0===i&&e===r?this.canonical.key:Gl(i,e,r,o,c)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const i=this.canonical.z-e;return e>this.canonical.z?new In(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new In(e,this.wrap,e,this.canonical.x>>i,this.canonical.y>>i)}calculateScaledKey(e,i=!0){if(this.overscaledZ===e&&i)return this.key;if(e>this.canonical.z)return Gl(this.wrap*+i,e,this.canonical.z,this.canonical.x,this.canonical.y);{const r=this.canonical.z-e;return Gl(this.wrap*+i,e,e,this.canonical.x>>r,this.canonical.y>>r)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const i=this.canonical.z-e.canonical.z;return 0===e.overscaledZ||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>i&&e.canonical.y===this.canonical.y>>i}children(e){if(this.overscaledZ>=e)return[new In(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const i=this.canonical.z+1,r=2*this.canonical.x,o=2*this.canonical.y;return[new In(i,this.wrap,i,r,o),new In(i,this.wrap,i,r+1,o),new In(i,this.wrap,i,r,o+1),new In(i,this.wrap,i,r+1,o+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new In(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new In(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new _p(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Gl(t,e,i,r,o){const c=1<<Math.min(i,22);let u=c*(o%c)+r%c;return t&&i<22&&(u+=c*c*((t<0?-2*t-1:2*t)%(1<<2*(22-i)))),16*(32*u+i)+(e-i)}ct(ch,"CanonicalTileID"),ct(In,"OverscaledTileID",{omit:["projMatrix"]});class ws extends Pe{constructor(e,i,r){super(e,i),this.z=r}}function ql(t,e){return t.x*e.x+t.y*e.y}function gp(t,e){if(1===t.length){let i=0;const r=e[i++];let o;for(;!o||r.equals(o);)if(o=e[i++],!o)return 1/0;for(;i<e.length;i++){const c=e[i],u=t[0],p=o.sub(r),f=c.sub(r),_=u.sub(r),x=ql(p,p),w=ql(p,f),E=ql(f,f),C=ql(_,p),D=ql(_,f),L=x*E-w*w,V=(E*C-w*D)/L,H=(x*D-w*C)/L,te=r.z*(1-V-H)+o.z*V+c.z*H;if(isFinite(te))return te}return 1/0}{let i=1/0;for(const r of e)i=Math.min(i,r.z);return i}}function yp(t,e,i,r,o,c,u,p){const f=u*o.getElevationAt(t,e,!0,!0),_=0!==c[0],x=_?0===c[1]?u*(c[0]/7-450):u*function(w,E,C){const D=Math.floor(E[0]/8),L=Math.floor(E[1]/8),V=10*(E[0]-8*D),H=10*(E[1]-8*L),te=w.getElevationAt(D,L,!0,!0),Y=w.getMeterToDEM(C),ee=Math.floor(.5*(V*Y-1)),ae=Math.floor(.5*(H*Y-1)),ne=w.tileCoordToPixel(D,L),be=2*ee+1,ge=2*ae+1,Se=(ut=be,tt=ge,[(Ye=w).getElevationAtPixel(Ae=ne.x-ee,et=ne.y-ae,!0),Ye.getElevationAtPixel(Ae+tt,et,!0),Ye.getElevationAtPixel(Ae,et+tt,!0),Ye.getElevationAtPixel(Ae+ut,et+tt,!0)]),$e=Math.abs(Se[0]-Se[1]),Te=Math.abs(Se[2]-Se[3]),Re=Math.abs(Se[0]-Se[2])+Math.abs(Se[1]-Se[3]),Oe=Math.min(.25,.5*Y*($e+Te)/be),Ve=Math.min(.25,.5*Y*Re/ge);var Ye,Ae,et,ut,tt;return te+Math.max(Oe*V,Ve*H)}(o,c,p):f;return{base:f+(0===i)?-1:i,top:_?Math.max(x+r,f+i+2):f+r}}const Xf=de([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:Kf}=Xf,Jf=de([{name:"a_packed",components:4,type:"Float32"}]),{members:Qf}=Jf,e_=sh.types,t_=Math.cos(Math.PI/180*37.5);class hh{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.id),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(i=>{this.gradients[i.id]={}}),this.layoutVertexArray=new we,this.layoutVertexArray2=new Ze,this.indexArray=new pt,this.programConfigurations=new ko(e.layers,e.zoom),this.segments=new Hi,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(e,i,r,o){this.hasPattern=Cu("line",this.layers,i);const c=this.layers[0].layout.get("line-sort-key"),u=[];for(const{feature:x,id:w,index:E,sourceLayerIndex:C}of e){const D=this.layers[0]._featureFilter.needGeometry,L=So(x,D);if(!this.layers[0]._featureFilter.filter(new v(this.zoom),L,r))continue;const V=c?c.evaluate(L,{},r):void 0,H={id:w,properties:x.properties,type:x.type,sourceLayerIndex:C,index:E,geometry:D?L.geometry:xa(x,r,o),patterns:{},sortKey:V};u.push(H)}c&&u.sort((x,w)=>x.sortKey-w.sortKey);const{lineAtlas:p,featureIndex:f}=i,_=this.addConstantDashes(p);for(const x of u){const{geometry:w,index:E,sourceLayerIndex:C}=x;if(_&&this.addFeatureDashes(x,p),this.hasPattern){const D=Mu("line",this.layers,x,this.zoom,i);this.patternFeatures.push(D)}else this.addFeature(x,w,E,r,p.positions,i.availableImages);f.insert(e[E].feature,w,E,C,this.index)}}addConstantDashes(e){let i=!1;for(const r of this.layers){const o=r.paint.get("line-dasharray").value,c=r.layout.get("line-cap").value;if("constant"!==o.kind||"constant"!==c.kind)i=!0;else{const u=c.value,p=o.value;if(!p)continue;e.addDash(p,u)}}return i}addFeatureDashes(e,i){const r=this.zoom;for(const o of this.layers){const c=o.paint.get("line-dasharray").value,u=o.layout.get("line-cap").value;if("constant"===c.kind&&"constant"===u.kind)continue;let p,f;if("constant"===c.kind){if(p=c.value,!p)continue}else p=c.evaluate({zoom:r},e);f="constant"===u.kind?u.value:u.evaluate({zoom:r},e),i.addDash(p,f),e.patterns[o.id]=i.getKey(p,f)}}update(e,i,r,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,r,o)}addFeatures(e,i,r,o,c){for(const u of this.patternFeatures)this.addFeature(u,u.geometry,u.index,i,r,o)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,Qf)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Kf),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,i,r,o,c,u){const p=this.layers[0].layout,f=p.get("line-join").evaluate(e,{}),_=p.get("line-cap").evaluate(e,{}),x=p.get("line-miter-limit"),w=p.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const E of i)this.addLine(E,e,f,_,x,w);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,c,u,o)}addLine(e,i,r,o,c,u){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let H=0;H<e.length-1;H++)this.totalDistance+=e[H].dist(e[H+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const p="Polygon"===e_[i.type];let f=e.length;for(;f>=2&&e[f-1].equals(e[f-2]);)f--;let _=0;for(;_<f-1&&e[_].equals(e[_+1]);)_++;if(f<(p?3:2))return;"bevel"===r&&(c=1.05);const x=this.overscaling<=16?15*vt/(512*this.overscaling):0,w=this.segments.prepareSegment(10*f,this.layoutVertexArray,this.indexArray);let E,C,D,L,V;this.e1=this.e2=-1,p&&(E=e[f-2],V=e[_].sub(E)._unit()._perp());for(let H=_;H<f;H++){if(D=H===f-1?p?e[_+1]:void 0:e[H+1],D&&e[H].equals(D))continue;V&&(L=V),E&&(C=E),E=e[H],V=D?D.sub(E)._unit()._perp():L,L=L||V;let te=L.add(V);0===te.x&&0===te.y||te._unit();const Y=L.x*V.x+L.y*V.y,ee=te.x*V.x+te.y*V.y,ae=0!==ee?1/ee:1/0,ne=2*Math.sqrt(2-2*ee),be=ee<t_&&C&&D,ge=L.x*V.y-L.y*V.x>0;if(be&&H>_){const Te=E.dist(C);if(Te>2*x){const Re=E.sub(E.sub(C)._mult(x/Te)._round());this.updateDistance(C,Re),this.addCurrentVertex(Re,L,0,0,w),C=Re}}const Se=C&&D;let $e=Se?r:p?"butt":o;if(Se&&"round"===$e&&(ae<u?$e="miter":ae<=2&&($e="fakeround")),"miter"===$e&&ae>c&&($e="bevel"),"bevel"===$e&&(ae>2&&($e="flipbevel"),ae<c&&($e="miter")),C&&this.updateDistance(C,E),"miter"===$e)te._mult(ae),this.addCurrentVertex(E,te,0,0,w);else if("flipbevel"===$e){if(ae>100)te=V.mult(-1);else{const Te=ae*L.add(V).mag()/L.sub(V).mag();te._perp()._mult(Te*(ge?-1:1))}this.addCurrentVertex(E,te,0,0,w),this.addCurrentVertex(E,te.mult(-1),0,0,w)}else if("bevel"===$e||"fakeround"===$e){const Te=-Math.sqrt(ae*ae-1),Re=ge?Te:0,Oe=ge?0:Te;if(C&&this.addCurrentVertex(E,L,Re,Oe,w),"fakeround"===$e){const Ve=Math.round(180*ne/Math.PI/20);for(let Ye=1;Ye<Ve;Ye++){let Ae=Ye/Ve;if(.5!==Ae){const ut=Ae-.5;Ae+=Ae*ut*(Ae-1)*((1.0904+Y*(Y*(3.55645-1.43519*Y)-3.2452))*ut*ut+(.848013+Y*(.215638*Y-1.06021)))}const et=V.sub(L)._mult(Ae)._add(L)._unit()._mult(ge?-1:1);this.addHalfVertex(E,et.x,et.y,!1,ge,0,w)}}D&&this.addCurrentVertex(E,V,-Re,-Oe,w)}else if("butt"===$e)this.addCurrentVertex(E,te,0,0,w);else if("square"===$e){const Te=C?1:-1;C||this.addCurrentVertex(E,te,Te,Te,w),this.addCurrentVertex(E,te,0,0,w),C&&this.addCurrentVertex(E,te,Te,Te,w)}else"round"===$e&&(C&&(this.addCurrentVertex(E,L,0,0,w),this.addCurrentVertex(E,L,1,1,w,!0)),D&&(this.addCurrentVertex(E,V,-1,-1,w,!0),this.addCurrentVertex(E,V,0,0,w)));if(be&&H<f-1){const Te=E.dist(D);if(Te>2*x){const Re=E.add(D.sub(E)._mult(x/Te)._round());this.updateDistance(E,Re),this.addCurrentVertex(Re,V,0,0,w),E=Re}}}}addCurrentVertex(e,i,r,o,c,u=!1){const p=i.y*o-i.x,f=-i.y-i.x*o;this.addHalfVertex(e,i.x+i.y*r,i.y-i.x*r,u,!1,r,c),this.addHalfVertex(e,p,f,u,!0,-o,c)}addHalfVertex({x:e,y:i},r,o,c,u,p,f){this.layoutVertexArray.emplaceBack((e<<1)+(c?1:0),(i<<1)+(u?1:0),Math.round(63*r)+128,Math.round(63*o)+128,1+(0===p?0:p<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const _=f.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,_),f.primitiveLength++),u?this.e2=_:this.e1=_}updateScaledDistance(){if(this.lineClips){const e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,i){this.distance+=e.dist(i),this.updateScaledDistance()}}ct(hh,"LineBucket",{omit:["layers","patternFeatures"]});const i_=new J({"line-cap":new N(ke.layout_line["line-cap"]),"line-join":new N(ke.layout_line["line-join"]),"line-miter-limit":new P(ke.layout_line["line-miter-limit"]),"line-round-limit":new P(ke.layout_line["line-round-limit"]),"line-sort-key":new N(ke.layout_line["line-sort-key"])});var xp={paint:new J({"line-opacity":new N(ke.paint_line["line-opacity"]),"line-color":new N(ke.paint_line["line-color"]),"line-translate":new P(ke.paint_line["line-translate"]),"line-translate-anchor":new P(ke.paint_line["line-translate-anchor"]),"line-width":new N(ke.paint_line["line-width"]),"line-gap-width":new N(ke.paint_line["line-gap-width"]),"line-offset":new N(ke.paint_line["line-offset"]),"line-blur":new N(ke.paint_line["line-blur"]),"line-dasharray":new N(ke.paint_line["line-dasharray"]),"line-pattern":new N(ke.paint_line["line-pattern"]),"line-gradient":new X(ke.paint_line["line-gradient"]),"line-trim-offset":new P(ke.paint_line["line-trim-offset"])}),layout:i_};const vp=new class extends N{possiblyEvaluate(t,e){return e=new v(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,transition:e.transition}),super.possiblyEvaluate(t,e)}evaluate(t,e,i,r){return e=Mt({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(t,e,i,r)}}(xp.paint.properties["line-width"].specification);function bp(t,e){return e>0?e+2*t:t}vp.useIntegerZoom=!0;const n_=de([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),r_=de([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),a_=de([{name:"a_projected_pos",components:4,type:"Float32"}],4);de([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const o_=de([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),s_=de([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);de([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const wp=de([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),l_=de([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);de([{name:"triangle",components:3,type:"Uint16"}]),de([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),de([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),de([{type:"Float32",name:"offsetX"}]),de([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var dn=24;const Zr=128;function Iu(t,e){const{expression:i}=e;if("constant"===i.kind)return{kind:"constant",layoutSize:i.evaluate(new v(t+1))};if("source"===i.kind)return{kind:"source"};{const{zoomStops:r,interpolationType:o}=i;let c=0;for(;c<r.length&&r[c]<=t;)c++;c=Math.max(0,c-1);let u=c;for(;u<r.length&&r[u]<t+1;)u++;u=Math.min(r.length-1,u);const p=r[c],f=r[u];return"composite"===i.kind?{kind:"composite",minZoom:p,maxZoom:f,interpolationType:o}:{kind:"camera",minZoom:p,maxZoom:f,minSize:i.evaluate(new v(p)),maxSize:i.evaluate(new v(f)),interpolationType:o}}}function uh(t,{uSize:e,uSizeT:i},{lowerSize:r,upperSize:o}){return"source"===t.kind?r/Zr:"composite"===t.kind?ei(r/Zr,o/Zr,i):e}function Ts(t,e){let i=0,r=0;if("constant"===t.kind)r=t.layoutSize;else if("source"!==t.kind){const{interpolationType:o,minZoom:c,maxZoom:u}=t,p=o?Ee(xr.interpolationFactor(o,e,c,u),0,1):0;"camera"===t.kind?r=ei(t.minSize,t.maxSize,p):i=p}return{uSizeT:i,uSize:r}}var c_=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:Zr,evaluateSizeForFeature:uh,evaluateSizeForZoom:Ts,getSizeData:Iu});function h_(t,e,i){return t.sections.forEach(r=>{r.text=function(o,c,u){const p=c.layout.get("text-transform").evaluate(u,{});return"uppercase"===p?o=o.toLocaleUpperCase():"lowercase"===p&&(o=o.toLocaleLowerCase()),y.applyArabicShaping&&(o=y.applyArabicShaping(o)),o}(r.text,e,i)}),t}const $l={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42","\u2190":"\u2191","\u2192":"\u2193"};function u_(t){return"\ufe36"===t||"\ufe48"===t||"\ufe38"===t||"\ufe44"===t||"\ufe42"===t||"\ufe3e"===t||"\ufe3c"===t||"\ufe3a"===t||"\ufe18"===t||"\ufe40"===t||"\ufe10"===t||"\ufe13"===t||"\ufe14"===t||"\uff40"===t||"\uffe3"===t||"\ufe11"===t||"\ufe12"===t}function d_(t){return"\ufe35"===t||"\ufe47"===t||"\ufe37"===t||"\ufe43"===t||"\ufe41"===t||"\ufe3d"===t||"\ufe3b"===t||"\ufe39"===t||"\ufe17"===t||"\ufe3f"===t}var Tp=Ti,Ep=function(t,e,i,r,o){var c,u,p=8*o-r-1,f=(1<<p)-1,_=f>>1,x=-7,w=i?o-1:0,E=i?-1:1,C=t[e+w];for(w+=E,c=C&(1<<-x)-1,C>>=-x,x+=p;x>0;c=256*c+t[e+w],w+=E,x-=8);for(u=c&(1<<-x)-1,c>>=-x,x+=r;x>0;u=256*u+t[e+w],w+=E,x-=8);if(0===c)c=1-_;else{if(c===f)return u?NaN:1/0*(C?-1:1);u+=Math.pow(2,r),c-=_}return(C?-1:1)*u*Math.pow(2,c-r)},kp=function(t,e,i,r,o,c){var u,p,f,_=8*c-o-1,x=(1<<_)-1,w=x>>1,E=23===o?Math.pow(2,-24)-Math.pow(2,-77):0,C=r?0:c-1,D=r?1:-1,L=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(p=isNaN(e)?1:0,u=x):(u=Math.floor(Math.log(e)/Math.LN2),e*(f=Math.pow(2,-u))<1&&(u--,f*=2),(e+=u+w>=1?E/f:E*Math.pow(2,1-w))*f>=2&&(u++,f/=2),u+w>=x?(p=0,u=x):u+w>=1?(p=(e*f-1)*Math.pow(2,o),u+=w):(p=e*Math.pow(2,w-1)*Math.pow(2,o),u=0));o>=8;t[i+C]=255&p,C+=D,p/=256,o-=8);for(u=u<<o|p,_+=o;_>0;t[i+C]=255&u,C+=D,u/=256,_-=8);t[i+C-D]|=128*L};function Ti(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}Ti.Varint=0,Ti.Fixed64=1,Ti.Bytes=2,Ti.Fixed32=5;var Su=4294967296,Ap=1/Su,Cp=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function ba(t){return t.type===Ti.Bytes?t.readVarint()+t.pos:t.pos+1}function Mp(t,e,i){var r=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));i.realloc(r);for(var o=i.pos-1;o>=t;o--)i.buf[o+r]=i.buf[o]}function p_(t,e){for(var i=0;i<t.length;i++)e.writeVarint(t[i])}function m_(t,e){for(var i=0;i<t.length;i++)e.writeSVarint(t[i])}function f_(t,e){for(var i=0;i<t.length;i++)e.writeFloat(t[i])}function __(t,e){for(var i=0;i<t.length;i++)e.writeDouble(t[i])}function g_(t,e){for(var i=0;i<t.length;i++)e.writeBoolean(t[i])}function y_(t,e){for(var i=0;i<t.length;i++)e.writeFixed32(t[i])}function x_(t,e){for(var i=0;i<t.length;i++)e.writeSFixed32(t[i])}function v_(t,e){for(var i=0;i<t.length;i++)e.writeFixed64(t[i])}function b_(t,e){for(var i=0;i<t.length;i++)e.writeSFixed64(t[i])}function dh(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function ks(t,e,i){t[i]=e,t[i+1]=e>>>8,t[i+2]=e>>>16,t[i+3]=e>>>24}function Dp(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}Ti.prototype={destroy:function(){this.buf=null},readFields:function(t,e,i){for(i=i||this.length;this.pos<i;){var r=this.readVarint(),o=r>>3,c=this.pos;this.type=7&r,t(o,e,this),this.pos===c&&this.skip(r)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=dh(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=Dp(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=dh(this.buf,this.pos)+dh(this.buf,this.pos+4)*Su;return this.pos+=8,t},readSFixed64:function(){var t=dh(this.buf,this.pos)+Dp(this.buf,this.pos+4)*Su;return this.pos+=8,t},readFloat:function(){var t=Ep(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=Ep(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,i,r=this.buf;return e=127&(i=r[this.pos++]),i<128?e:(e|=(127&(i=r[this.pos++]))<<7,i<128?e:(e|=(127&(i=r[this.pos++]))<<14,i<128?e:(e|=(127&(i=r[this.pos++]))<<21,i<128?e:function(o,c,u){var p,f,_=u.buf;if(p=(112&(f=_[u.pos++]))>>4,f<128||(p|=(127&(f=_[u.pos++]))<<3,f<128)||(p|=(127&(f=_[u.pos++]))<<10,f<128)||(p|=(127&(f=_[u.pos++]))<<17,f<128)||(p|=(127&(f=_[u.pos++]))<<24,f<128)||(p|=(1&(f=_[u.pos++]))<<31,f<128))return function Es(t,e,i){return i?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}(o,p,c);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(i=r[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=12&&Cp?Cp.decode(this.buf.subarray(e,t)):function(i,r,o){for(var c="",u=r;u<o;){var p,f,_,x=i[u],w=null,E=x>239?4:x>223?3:x>191?2:1;if(u+E>o)break;1===E?x<128&&(w=x):2===E?128==(192&(p=i[u+1]))&&(w=(31&x)<<6|63&p)<=127&&(w=null):3===E?(f=i[u+2],128==(192&(p=i[u+1]))&&128==(192&f)&&((w=(15&x)<<12|(63&p)<<6|63&f)<=2047||w>=55296&&w<=57343)&&(w=null)):4===E&&(f=i[u+2],_=i[u+3],128==(192&(p=i[u+1]))&&128==(192&f)&&128==(192&_)&&((w=(15&x)<<18|(63&p)<<12|(63&f)<<6|63&_)<=65535||w>=1114112)&&(w=null)),null===w?(w=65533,E=1):w>65535&&(w-=65536,c+=String.fromCharCode(w>>>10&1023|55296),w=56320|1023&w),c+=String.fromCharCode(w),u+=E}return c}(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==Ti.Bytes)return t.push(this.readVarint(e));var i=ba(this);for(t=t||[];this.pos<i;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==Ti.Bytes)return t.push(this.readSVarint());var e=ba(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==Ti.Bytes)return t.push(this.readBoolean());var e=ba(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==Ti.Bytes)return t.push(this.readFloat());var e=ba(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==Ti.Bytes)return t.push(this.readDouble());var e=ba(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==Ti.Bytes)return t.push(this.readFixed32());var e=ba(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==Ti.Bytes)return t.push(this.readSFixed32());var e=ba(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==Ti.Bytes)return t.push(this.readFixed64());var e=ba(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==Ti.Bytes)return t.push(this.readSFixed64());var e=ba(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===Ti.Varint)for(;this.buf[this.pos++]>127;);else if(e===Ti.Bytes)this.pos=this.readVarint()+this.pos;else if(e===Ti.Fixed32)this.pos+=4;else{if(e!==Ti.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var i=new Uint8Array(e);i.set(this.buf),this.buf=i,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),ks(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),ks(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),ks(this.buf,-1&t,this.pos),ks(this.buf,Math.floor(t*Ap),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),ks(this.buf,-1&t,this.pos),ks(this.buf,Math.floor(t*Ap),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(e,i){var r,o,c,p;if(e>=0?(r=e%4294967296|0,o=e/4294967296|0):(o=~(-e/4294967296),4294967295^(r=~(-e%4294967296))?r=r+1|0:(r=0,o=o+1|0)),e>=0x10000000000000000||e<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");i.realloc(10),c=r,(p=i).buf[p.pos++]=127&c|128,c>>>=7,p.buf[p.pos++]=127&c|128,c>>>=7,p.buf[p.pos++]=127&c|128,c>>>=7,p.buf[p.pos++]=127&c|128,p.buf[p.pos]=127&(c>>>=7),function(c,u){var p=(7&c)<<4;u.buf[u.pos++]|=p|((c>>>=3)?128:0),c&&(u.buf[u.pos++]=127&c|((c>>>=7)?128:0),c&&(u.buf[u.pos++]=127&c|((c>>>=7)?128:0),c&&(u.buf[u.pos++]=127&c|((c>>>=7)?128:0),c&&(u.buf[u.pos++]=127&c|((c>>>=7)?128:0),c&&(u.buf[u.pos++]=127&c)))))}(o,i)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(!!t)},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(r,o,c){for(var u,p,f=0;f<o.length;f++){if((u=o.charCodeAt(f))>55295&&u<57344){if(!p){u>56319||f+1===o.length?(r[c++]=239,r[c++]=191,r[c++]=189):p=u;continue}if(u<56320){r[c++]=239,r[c++]=191,r[c++]=189,p=u;continue}u=p-55296<<10|u-56320|65536,p=null}else p&&(r[c++]=239,r[c++]=191,r[c++]=189,p=null);u<128?r[c++]=u:(u<2048?r[c++]=u>>6|192:(u<65536?r[c++]=u>>12|224:(r[c++]=u>>18|240,r[c++]=u>>12&63|128),r[c++]=u>>6&63|128),r[c++]=63&u|128)}return c}(this.buf,t,this.pos);var i=this.pos-e;i>=128&&Mp(e,i,this),this.pos=e-1,this.writeVarint(i),this.pos+=i},writeFloat:function(t){this.realloc(4),kp(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),kp(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var i=0;i<e;i++)this.buf[this.pos++]=t[i]},writeRawMessage:function(t,e){this.pos++;var i=this.pos;t(e,this);var r=this.pos-i;r>=128&&Mp(i,r,this),this.pos=i-1,this.writeVarint(r),this.pos+=r},writeMessage:function(t,e,i){this.writeTag(t,Ti.Bytes),this.writeRawMessage(e,i)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,p_,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,m_,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,g_,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,f_,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,__,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,y_,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,x_,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,v_,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,b_,e)},writeBytesField:function(t,e){this.writeTag(t,Ti.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,Ti.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,Ti.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,Ti.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,Ti.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,Ti.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,Ti.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,Ti.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,Ti.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,Ti.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,!!e)}};var ph=Xt(Tp);const Pu=3;function w_(t,e,i){e.glyphs=[],1===t&&i.readMessage(T_,e)}function T_(t,e,i){if(3===t){const{id:r,bitmap:o,width:c,height:u,left:p,top:f,advance:_}=i.readMessage(E_,{});e.glyphs.push({id:r,bitmap:new va({width:c+2*Pu,height:u+2*Pu},o),metrics:{width:c,height:u,left:p,top:f,advance:_}})}else 4===t?e.ascender=i.readSVarint():5===t&&(e.descender=i.readSVarint())}function E_(t,e,i){1===t?e.id=i.readVarint():2===t?e.bitmap=i.readBytes():3===t?e.width=i.readVarint():4===t?e.height=i.readVarint():5===t?e.left=i.readSVarint():6===t?e.top=i.readSVarint():7===t&&(e.advance=i.readVarint())}const Ip=Pu;function zu(t){let e=0,i=0;for(const u of t)e+=u.w*u.h,i=Math.max(i,u.w);t.sort((u,p)=>p.h-u.h);const r=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),i),h:1/0}];let o=0,c=0;for(const u of t)for(let p=r.length-1;p>=0;p--){const f=r[p];if(!(u.w>f.w||u.h>f.h)){if(u.x=f.x,u.y=f.y,c=Math.max(c,u.y+u.h),o=Math.max(o,u.x+u.w),u.w===f.w&&u.h===f.h){const _=r.pop();p<r.length&&(r[p]=_)}else u.h===f.h?(f.x+=u.w,f.w-=u.w):u.w===f.w?(f.y+=u.h,f.h-=u.h):(r.push({x:f.x+u.w,y:f.y,w:f.w-u.w,h:u.h}),f.y+=u.h,f.h-=u.h);break}}return{w:o,h:c,fill:e/(o*c)||0}}const Zn=1;class Lu{constructor(e,{pixelRatio:i,version:r,stretchX:o,stretchY:c,content:u}){this.paddedRect=e,this.pixelRatio=i,this.stretchX=o,this.stretchY=c,this.content=u,this.version=r}get tl(){return[this.paddedRect.x+Zn,this.paddedRect.y+Zn]}get br(){return[this.paddedRect.x+this.paddedRect.w-Zn,this.paddedRect.y+this.paddedRect.h-Zn]}get displaySize(){return[(this.paddedRect.w-2*Zn)/this.pixelRatio,(this.paddedRect.h-2*Zn)/this.pixelRatio]}}class Sp{constructor(e,i){const r={},o={};this.haveRenderCallbacks=[];const c=[];this.addImages(e,r,c),this.addImages(i,o,c);const{w:u,h:p}=zu(c),f=new ar({width:u||1,height:p||1});for(const _ in e){const x=e[_],w=r[_].paddedRect;ar.copy(x.data,f,{x:0,y:0},{x:w.x+Zn,y:w.y+Zn},x.data)}for(const _ in i){const x=i[_],w=o[_].paddedRect,E=w.x+Zn,C=w.y+Zn,D=x.data.width,L=x.data.height;ar.copy(x.data,f,{x:0,y:0},{x:E,y:C},x.data),ar.copy(x.data,f,{x:0,y:L-1},{x:E,y:C-1},{width:D,height:1}),ar.copy(x.data,f,{x:0,y:0},{x:E,y:C+L},{width:D,height:1}),ar.copy(x.data,f,{x:D-1,y:0},{x:E-1,y:C},{width:1,height:L}),ar.copy(x.data,f,{x:0,y:0},{x:E+D,y:C},{width:1,height:L})}this.image=f,this.iconPositions=r,this.patternPositions=o}addImages(e,i,r){for(const o in e){const c=e[o],u={x:0,y:0,w:c.data.width+2*Zn,h:c.data.height+2*Zn};r.push(u),i[o]=new Lu(u,c),c.hasRenderCallback&&this.haveRenderCallbacks.push(o)}}patchUpdatedImages(e,i){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(r=>e.hasImage(r)),e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const r in e.updatedImages)this.patchUpdatedImage(this.iconPositions[r],e.getImage(r),i),this.patchUpdatedImage(this.patternPositions[r],e.getImage(r),i)}patchUpdatedImage(e,i,r){if(!e||!i||e.version===i.version)return;e.version=i.version;const[o,c]=e.tl;r.update(i.data,void 0,{x:o,y:c})}}ct(Lu,"ImagePosition"),ct(Sp,"ImageAtlas");const mr={horizontal:1,vertical:2,horizontalOnly:3},Pp=-17;class Wl{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,i){const r=new Wl;return r.scale=e||1,r.fontStack=i,r}static forImage(e){const i=new Wl;return i.imageName=e,i}}class As{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,i){const r=new As;for(let o=0;o<e.sections.length;o++){const c=e.sections[o];c.image?r.addImageSection(c):r.addTextSection(c,i)}return r}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(e){this.text=function(i,r){let o="";for(let c=0;c<i.length;c++){const u=i.charCodeAt(c+1)||null,p=i.charCodeAt(c-1)||null;o+=!r&&(u&&jc(u)&&!$l[i[c+1]]||p&&jc(p)&&!$l[i[c-1]])||!$l[i[c]]?i[c]:$l[i[c]]}return o}(this.text,e)}trim(){let e=0;for(let r=0;r<this.text.length&&mh[this.text.charCodeAt(r)];r++)e++;let i=this.text.length;for(let r=this.text.length-1;r>=0&&r>=e&&mh[this.text.charCodeAt(r)];r--)i--;this.text=this.text.substring(e,i),this.sectionIndex=this.sectionIndex.slice(e,i)}substring(e,i){const r=new As;return r.text=this.text.substring(e,i),r.sectionIndex=this.sectionIndex.slice(e,i),r.sections=this.sections,r}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,i)=>Math.max(e,this.sections[i].scale),0)}addTextSection(e,i){this.text+=e.text,this.sections.push(Wl.forText(e.scale,e.fontStack||i));const r=this.sections.length-1;for(let o=0;o<e.text.length;++o)this.sectionIndex.push(r)}addImageSection(e){const i=e.image?e.image.name:"";if(0===i.length)return void ii("Can't add FormattedSection with an empty image.");const r=this.getNextImageSectionCharCode();r?(this.text+=String.fromCharCode(r),this.sections.push(Wl.forImage(i)),this.sectionIndex.push(this.sections.length-1)):ii("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Ru(t,e,i,r,o,c,u,p,f,_,x,w,E,C,D){const L=As.fromFeature(t,o);w===mr.vertical&&L.verticalizePunctuation(E);let V=[];const H=function(ne,be,ge,Se,$e,Te){if(!ne)return[];const Re=[],Oe=function(et,ut,tt,Lt,Xe,xt){let Rt=0;for(let ri=0;ri<et.length();ri++){const Ot=et.getSection(ri);Rt+=zp(et.getCharCode(ri),Ot,Lt,Xe,ut,xt)}return Rt/Math.max(1,Math.ceil(Rt/tt))}(ne,be,ge,Se,$e,Te),Ve=ne.text.indexOf("\u200b")>=0;let Ye=0;for(let et=0;et<ne.length();et++){const ut=ne.getSection(et),tt=ne.getCharCode(et);if(mh[tt]||(Ye+=zp(tt,ut,Se,$e,be,Te)),et<ne.length()-1){const Lt=!((Ae=tt)<11904||!(it["Bopomofo Extended"](Ae)||it.Bopomofo(Ae)||it["CJK Compatibility Forms"](Ae)||it["CJK Compatibility Ideographs"](Ae)||it["CJK Compatibility"](Ae)||it["CJK Radicals Supplement"](Ae)||it["CJK Strokes"](Ae)||it["CJK Symbols and Punctuation"](Ae)||it["CJK Unified Ideographs Extension A"](Ae)||it["CJK Unified Ideographs"](Ae)||it["Enclosed CJK Letters and Months"](Ae)||it["Halfwidth and Fullwidth Forms"](Ae)||it.Hiragana(Ae)||it["Ideographic Description Characters"](Ae)||it["Kangxi Radicals"](Ae)||it["Katakana Phonetic Extensions"](Ae)||it.Katakana(Ae)||it["Vertical Forms"](Ae)||it["Yi Radicals"](Ae)||it["Yi Syllables"](Ae)));(k_[tt]||Lt||ut.imageName)&&Re.push(Rp(et+1,Ye,Oe,Re,A_(tt,ne.getCharCode(et+1),Lt&&Ve),!1))}}var Ae;return Op(Rp(ne.length(),Ye,Oe,Re,0,!0))}(L,_,c,e,r,C),{processBidirectionalText:te,processStyledBidirectionalText:Y}=y;if(te&&1===L.sections.length){const ne=te(L.toString(),H);for(const be of ne){const ge=new As;ge.text=be,ge.sections=L.sections;for(let Se=0;Se<be.length;Se++)ge.sectionIndex.push(0);V.push(ge)}}else if(Y){const ne=Y(L.text,L.sectionIndex,H);for(const be of ne){const ge=new As;ge.text=be[0],ge.sectionIndex=be[1],ge.sections=L.sections,V.push(ge)}}else V=function(ne,be){const ge=[],Se=ne.text;let $e=0;for(const Te of be)ge.push(ne.substring($e,Te)),$e=Te;return $e<Se.length&&ge.push(ne.substring($e,Se.length)),ge}(L,H);const ee=[],ae={positionedLines:ee,text:L.toString(),top:x[1],bottom:x[1],left:x[0],right:x[0],writingMode:w,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(ne,be,ge,Se,$e,Te,Re,Oe,Ve,Ye,Ae,et){let ut=0,tt=0,Lt=0;const Xe="right"===Oe?1:"left"===Oe?0:.5;let xt=!1;for(const Vt of $e){const Nt=Vt.getSections();for(const vi of Nt){if(vi.imageName)continue;const Ei=be[vi.fontStack];if(Ei&&(xt=void 0!==Ei.ascender&&void 0!==Ei.descender,!xt))break}if(!xt)break}let Rt=0;for(const Vt of $e){Vt.trim();const Nt=Vt.getMaxScale(),vi=(Nt-1)*dn,Ei={positionedGlyphs:[],lineOffset:0};ne.positionedLines[Rt]=Ei;const ki=Ei.positionedGlyphs;let bi=0;if(!Vt.length()){tt+=Te,++Rt;continue}let Oi=0,Ni=0;for(let wi=0;wi<Vt.length();wi++){const rn=Vt.getSection(wi),Ki=Vt.getSectionIndex(wi),Ui=Vt.getCharCode(wi);let si=rn.scale,Ji=null,Ai=null,Sn=null,Qi=dn,pn=0;const ln=!(Ve===mr.horizontal||!Ae&&!vl(Ui)||Ae&&(mh[Ui]||(ri=Ui,it.Arabic(ri)||it["Arabic Supplement"](ri)||it["Arabic Extended-A"](ri)||it["Arabic Presentation Forms-A"](ri)||it["Arabic Presentation Forms-B"](ri))));if(rn.imageName){const Pn=Se[rn.imageName];if(!Pn)continue;Sn=rn.imageName,ne.iconsInText=ne.iconsInText||!0,Ai=Pn.paddedRect;const cn=Pn.displaySize;si=si*dn/et,Ji={width:cn[0],height:cn[1],left:Zn,top:-Ip,advance:ln?cn[1]:cn[0],localGlyph:!1},pn=xt?-Ji.height*si:Pp+Nt*dn-cn[1]*si,Qi=Ji.advance;const $r=(ln?cn[0]:cn[1])*si-dn*Nt;$r>0&&$r>bi&&(bi=$r)}else{const Pn=ge[rn.fontStack];if(!Pn)continue;Pn[Ui]&&(Ai=Pn[Ui]);const cn=be[rn.fontStack];if(!cn)continue;const $r=cn.glyphs[Ui];if(!$r)continue;if(Ji=$r.metrics,Qi=8203!==Ui?dn:0,xt){const zs=void 0!==cn.ascender?Math.abs(cn.ascender):0,nc=void 0!==cn.descender?Math.abs(cn.descender):0,rc=(zs+nc)*si;Oi<rc&&(Oi=rc,Ni=(zs-nc)/2*si),pn=-zs*si}else pn=Pp+(Nt-si)*dn}ln?(ne.verticalizable=!0,ki.push({glyph:Ui,imageName:Sn,x:ut,y:tt+pn,vertical:ln,scale:si,localGlyph:Ji.localGlyph,fontStack:rn.fontStack,sectionIndex:Ki,metrics:Ji,rect:Ai}),ut+=Qi*si+Ye):(ki.push({glyph:Ui,imageName:Sn,x:ut,y:tt+pn,vertical:ln,scale:si,localGlyph:Ji.localGlyph,fontStack:rn.fontStack,sectionIndex:Ki,metrics:Ji,rect:Ai}),ut+=Ji.advance*si+Ye)}0!==ki.length&&(Lt=Math.max(ut-Ye,Lt),xt?Bp(ki,Xe,bi,Ni,Te*Nt/2):Bp(ki,Xe,bi,0,Te/2)),ut=0;const Xi=Te*Nt+bi;Ei.lineOffset=Math.max(bi,vi),tt+=Xi,++Rt}var ri;const Ot=tt,{horizontalAlign:kt,verticalAlign:Ci}=Ou(Re);(function(Vt,Nt,vi,Ei,ki,bi){const Oi=(Nt-vi)*ki,Ni=-bi*Ei;for(const Xi of Vt)for(const wi of Xi.positionedGlyphs)wi.x+=Oi,wi.y+=Ni})(ne.positionedLines,Xe,kt,Ci,Lt,Ot),ne.top+=-Ci*Ot,ne.bottom=ne.top+Ot,ne.left+=-kt*Lt,ne.right=ne.left+Lt,ne.hasBaseline=xt}(ae,e,i,r,V,u,p,f,w,_,E,D),!function(ne){for(const be of ne)if(0!==be.positionedGlyphs.length)return!1;return!0}(ee)&&ae}const mh={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},k_={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function zp(t,e,i,r,o,c){if(e.imageName){const u=r[e.imageName];return u?u.displaySize[0]*e.scale*dn/c+o:0}{const u=i[e.fontStack],p=u&&u.glyphs[t];return p?p.metrics.advance*e.scale+o:0}}function Lp(t,e,i,r){const o=Math.pow(t-e,2);return r?t<e?o/2:2*o:o+Math.abs(i)*i}function A_(t,e,i){let r=0;return 10===t&&(r-=1e4),i&&(r+=150),40!==t&&65288!==t||(r+=50),41!==e&&65289!==e||(r+=50),r}function Rp(t,e,i,r,o,c){let u=null,p=Lp(e,i,o,c);for(const f of r){const _=Lp(e-f.x,i,o,c)+f.badness;_<=p&&(u=f,p=_)}return{index:t,x:e,priorBreak:u,badness:p}}function Op(t){return t?Op(t.priorBreak).concat(t.index):[]}function Ou(t){let e=.5,i=.5;switch(t){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:e,verticalAlign:i}}function Bp(t,e,i,r,o){if(!(e||i||r||o))return;const c=t.length-1,u=t[c],p=(u.x+u.metrics.advance*u.scale)*e;for(let f=0;f<=c;f++)t[f].x-=p,t[f].y+=i+r+o}function C_(t,e,i){const{horizontalAlign:r,verticalAlign:o}=Ou(i),c=e[0]-t.displaySize[0]*r,u=e[1]-t.displaySize[1]*o;return{image:t,top:u,bottom:u+t.displaySize[1],left:c,right:c+t.displaySize[0]}}function Fp(t,e,i,r,o,c){const u=t.image;let p;if(u.content){const V=u.content,H=u.pixelRatio||1;p=[V[0]/H,V[1]/H,u.displaySize[0]-V[2]/H,u.displaySize[1]-V[3]/H]}const f=e.left*c,_=e.right*c;let x,w,E,C;"width"===i||"both"===i?(C=o[0]+f-r[3],w=o[0]+_+r[1]):(C=o[0]+(f+_-u.displaySize[0])/2,w=C+u.displaySize[0]);const D=e.top*c,L=e.bottom*c;return"height"===i||"both"===i?(x=o[1]+D-r[0],E=o[1]+L+r[2]):(x=o[1]+(D+L-u.displaySize[1])/2,E=x+u.displaySize[1]),{image:u,top:x,right:w,bottom:E,left:C,collisionPadding:p}}class wa extends Pe{constructor(e,i,r,o,c){super(e,i),this.angle=o,this.z=r,void 0!==c&&(this.segment=c)}clone(){return new wa(this.x,this.y,this.z,this.angle,this.segment)}}function Up(t,e,i,r,o){if(void 0===e.segment)return!0;let c=e,u=e.segment+1,p=0;for(;p>-i/2;){if(u--,u<0)return!1;p-=t[u].dist(c),c=t[u]}p+=t[u].dist(t[u+1]),u++;const f=[];let _=0;for(;p<i/2;){const x=t[u],w=t[u+1];if(!w)return!1;let E=t[u-1].angleTo(x)-x.angleTo(w);for(E=Math.abs((E+3*Math.PI)%(2*Math.PI)-Math.PI),f.push({distance:p,angleDelta:E}),_+=E;p-f[0].distance>r;)_-=f.shift().angleDelta;if(_>o)return!1;u++,p+=x.dist(w)}return!0}function Vp(t){let e=0;for(let i=0;i<t.length-1;i++)e+=t[i].dist(t[i+1]);return e}function Np(t,e,i){return t?.6*e*i:0}function jp(t,e){return Math.max(t?t.right-t.left:0,e?e.right-e.left:0)}function M_(t,e,i,r,o,c){const u=Np(i,o,c),p=jp(i,r)*c;let f=0;const _=Vp(t)/2;for(let x=0;x<t.length-1;x++){const w=t[x],E=t[x+1],C=w.dist(E);if(f+C>_){const D=(_-f)/C,L=ei(w.x,E.x,D),V=ei(w.y,E.y,D),H=new wa(L,V,0,E.angleTo(w),x);return!u||Up(t,H,p,u,e)?H:void 0}f+=C}}function D_(t,e,i,r,o,c,u,p,f){const _=Np(r,c,u),x=jp(r,o),w=x*u,E=0===t[0].x||t[0].x===f||0===t[0].y||t[0].y===f;return e-w<e/4&&(e=w+e/4),Zp(t,E?e/2*p%e:(x/2+2*c)*u*p%e,e,_,i,w,E,!1,f)}function Zp(t,e,i,r,o,c,u,p,f){const _=c/2,x=Vp(t);let w=0,E=e-i,C=[];for(let D=0;D<t.length-1;D++){const L=t[D],V=t[D+1],H=L.dist(V),te=V.angleTo(L);for(;E+i<w+H;){E+=i;const Y=(E-w)/H,ee=ei(L.x,V.x,Y),ae=ei(L.y,V.y,Y);if(ee>=0&&ee<f&&ae>=0&&ae<f&&E-_>=0&&E+_<=x){const ne=new wa(ee,ae,0,te,D);ne._round(),r&&!Up(t,ne,c,r,o)||C.push(ne)}}w+=H}return p||C.length||u||(C=Zp(t,w/2,i,r,o,c,u,!0,f)),C}function Gp(t,e,i,r,o){const c=[];for(let u=0;u<t.length;u++){const p=t[u];let f;for(let _=0;_<p.length-1;_++){let x=p[_],w=p[_+1];x.x<e&&w.x<e||(x.x<e?x=new Pe(e,x.y+(e-x.x)/(w.x-x.x)*(w.y-x.y))._round():w.x<e&&(w=new Pe(e,x.y+(e-x.x)/(w.x-x.x)*(w.y-x.y))._round()),x.y<i&&w.y<i||(x.y<i?x=new Pe(x.x+(i-x.y)/(w.y-x.y)*(w.x-x.x),i)._round():w.y<i&&(w=new Pe(x.x+(i-x.y)/(w.y-x.y)*(w.x-x.x),i)._round()),x.x>=r&&w.x>=r||(x.x>=r?x=new Pe(r,x.y+(r-x.x)/(w.x-x.x)*(w.y-x.y))._round():w.x>=r&&(w=new Pe(r,x.y+(r-x.x)/(w.x-x.x)*(w.y-x.y))._round()),x.y>=o&&w.y>=o||(x.y>=o?x=new Pe(x.x+(o-x.y)/(w.y-x.y)*(w.x-x.x),o)._round():w.y>=o&&(w=new Pe(x.x+(o-x.y)/(w.y-x.y)*(w.x-x.x),o)._round()),f&&x.equals(f[f.length-1])||(f=[x],c.push(f)),f.push(w)))))}}return c}ct(wa,"Anchor");const Hl=1e20;function qp(t,e,i,r,o,c,u,p,f){for(let _=e;_<e+r;_++)$p(t,i*c+_,c,o,u,p,f);for(let _=i;_<i+o;_++)$p(t,_*c+e,1,r,u,p,f)}function $p(t,e,i,r,o,c,u){c[0]=0,u[0]=-Hl,u[1]=Hl,o[0]=t[e];for(let p=1,f=0,_=0;p<r;p++){o[p]=t[e+p*i];const x=p*p;do{const w=c[f];_=(o[p]-o[w]+x-w*w)/(p-w)/2}while(_<=u[f]&&--f>-1);f++,c[f]=p,u[f]=_,u[f+1]=Hl}for(let p=0,f=0;p<r;p++){for(;u[f+1]<p;)f++;const _=c[f],x=p-_;t[e+p*i]=o[_]+x*x}}const Gr=2,Bu={none:0,ideographs:1,all:2};class Cs{constructor(e,i,r){this.requestManager=e,this.localGlyphMode=i,this.localFontFamily=r,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e){this.url=e}getGlyphs(e,i){const r=[];for(const o in e)for(const c of e[o])r.push({stack:o,id:c});jt(r,({stack:o,id:c},u)=>{let p=this.entries[o];p||(p=this.entries[o]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let f=p.glyphs[c];if(void 0!==f)return void u(null,{stack:o,id:c,glyph:f});if(f=this._tinySDF(p,o,c),f)return p.glyphs[c]=f,void u(null,{stack:o,id:c,glyph:f});const _=Math.floor(c/256);if(256*_>65535)return void u(new Error("glyphs > 65535 not supported"));if(p.ranges[_])return void u(null,{stack:o,id:c,glyph:f});let x=p.requests[_];x||(x=p.requests[_]=[],Cs.loadGlyphRange(o,_,this.url,this.requestManager,(w,E)=>{if(E){p.ascender=E.ascender,p.descender=E.descender;for(const C in E.glyphs)this._doesCharSupportLocalGlyph(+C)||(p.glyphs[+C]=E.glyphs[+C]);p.ranges[_]=!0}for(const C of x)C(w,E);delete p.requests[_]})),x.push((w,E)=>{w?u(w):E&&u(null,{stack:o,id:c,glyph:E.glyphs[c]||null})})},(o,c)=>{if(o)i(o);else if(c){const u={};for(const{stack:p,id:f,glyph:_}of c)void 0===u[p]&&(u[p]={}),void 0===u[p].glyphs&&(u[p].glyphs={}),u[p].glyphs[f]=_&&{id:_.id,bitmap:_.bitmap.clone(),metrics:_.metrics},u[p].ascender=this.entries[p].ascender,u[p].descender=this.entries[p].descender;i(null,u)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==Bu.none&&(this.localGlyphMode===Bu.all?!!this.localFontFamily:!!this.localFontFamily&&(it["CJK Unified Ideographs"](e)||it["Hangul Syllables"](e)||it.Hiragana(e)||it.Katakana(e)||it["CJK Symbols and Punctuation"](e)))}_tinySDF(e,i,r){const o=this.localFontFamily;if(!o||!this._doesCharSupportLocalGlyph(r))return;let c=e.tinySDF;if(!c){let L="400";/bold/i.test(i)?L="900":/medium/i.test(i)?L="500":/light/i.test(i)&&(L="200"),c=e.tinySDF=new Cs.TinySDF({fontFamily:o,fontWeight:L,fontSize:24*Gr,buffer:3*Gr,radius:8*Gr}),c.fontWeight=L}if(this.localGlyphs[c.fontWeight][r])return this.localGlyphs[c.fontWeight][r];const u=String.fromCharCode(r),{data:p,width:f,height:_,glyphWidth:x,glyphHeight:w,glyphLeft:E,glyphTop:C,glyphAdvance:D}=c.draw(u);return this.localGlyphs[c.fontWeight][r]={id:r,bitmap:new va({width:f,height:_},p),metrics:{width:x/Gr,height:w/Gr,left:E/Gr,top:C/Gr-27,advance:D/Gr,localGlyph:!0}}}}Cs.loadGlyphRange=function(t,e,i,r,o){const c=256*e,u=c+255,p=r.transformRequest(r.normalizeGlyphsURL(i).replace("{fontstack}",t).replace("{range}",`${c}-${u}`),Wn.Glyphs);Hn(p,(f,_)=>{if(f)o(f);else if(_){const x={},w=new ph(_).readFields(w_,{});for(const E of w.glyphs)x[E.id]=E;o(null,{glyphs:x,ascender:w.ascender,descender:w.descender})}})},Cs.TinySDF=class{constructor({fontSize:t=24,buffer:e=3,radius:i=8,cutoff:r=.25,fontFamily:o="sans-serif",fontWeight:c="normal",fontStyle:u="normal"}={}){this.buffer=e,this.cutoff=r,this.radius=i;const p=this.size=t+4*e,f=this._createCanvas(p),_=this.ctx=f.getContext("2d",{willReadFrequently:!0});_.font=`${u} ${c} ${t}px ${o}`,_.textBaseline="alphabetic",_.textAlign="left",_.fillStyle="black",this.gridOuter=new Float64Array(p*p),this.gridInner=new Float64Array(p*p),this.f=new Float64Array(p),this.z=new Float64Array(p+1),this.v=new Uint16Array(p)}_createCanvas(t){const e=document.createElement("canvas");return e.width=e.height=t,e}draw(t){const{width:e,actualBoundingBoxAscent:i,actualBoundingBoxDescent:r,actualBoundingBoxLeft:o,actualBoundingBoxRight:c}=this.ctx.measureText(t),u=Math.ceil(i),p=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(c-o))),f=Math.min(this.size-this.buffer,u+Math.ceil(r)),_=p+2*this.buffer,x=f+2*this.buffer,w=Math.max(_*x,0),E=new Uint8ClampedArray(w),C={data:E,width:_,height:x,glyphWidth:p,glyphHeight:f,glyphTop:u,glyphLeft:0,glyphAdvance:e};if(0===p||0===f)return C;const{ctx:D,buffer:L,gridInner:V,gridOuter:H}=this;D.clearRect(L,L,p,f),D.fillText(t,L,L+u);const te=D.getImageData(L,L,p,f);H.fill(Hl,0,w),V.fill(0,0,w);for(let Y=0;Y<f;Y++)for(let ee=0;ee<p;ee++){const ae=te.data[4*(Y*p+ee)+3]/255;if(0===ae)continue;const ne=(Y+L)*_+ee+L;if(1===ae)H[ne]=0,V[ne]=Hl;else{const be=.5-ae;H[ne]=be>0?be*be:0,V[ne]=be<0?be*be:0}}qp(H,0,0,_,x,_,this.f,this.v,this.z),qp(V,L,L,p,f,_,this.f,this.v,this.z);for(let Y=0;Y<w;Y++){const ee=Math.sqrt(H[Y])-Math.sqrt(V[Y]);E[Y]=Math.round(255-255*(ee/this.radius+this.cutoff))}return C}};const Ms=Zn;function Wp(t,e,i,r){const o=[],c=t.image,u=c.pixelRatio,p=c.paddedRect.w-2*Ms,f=c.paddedRect.h-2*Ms,_=t.right-t.left,x=t.bottom-t.top,w=c.stretchX||[[0,p]],E=c.stretchY||[[0,f]],C=(Te,Re)=>Te+Re[1]-Re[0],D=w.reduce(C,0),L=E.reduce(C,0),V=p-D,H=f-L;let te=0,Y=D,ee=0,ae=L,ne=0,be=V,ge=0,Se=H;if(c.content&&r){const Te=c.content;te=fh(w,0,Te[0]),ee=fh(E,0,Te[1]),Y=fh(w,Te[0],Te[2]),ae=fh(E,Te[1],Te[3]),ne=Te[0]-te,ge=Te[1]-ee,be=Te[2]-Te[0]-Y,Se=Te[3]-Te[1]-ae}const $e=(Te,Re,Oe,Ve)=>{const Ye=_h(Te.stretch-te,Y,_,t.left),Ae=gh(Te.fixed-ne,be,Te.stretch,D),et=_h(Re.stretch-ee,ae,x,t.top),ut=gh(Re.fixed-ge,Se,Re.stretch,L),tt=_h(Oe.stretch-te,Y,_,t.left),Lt=gh(Oe.fixed-ne,be,Oe.stretch,D),Xe=_h(Ve.stretch-ee,ae,x,t.top),xt=gh(Ve.fixed-ge,Se,Ve.stretch,L),Rt=new Pe(Ye,et),ri=new Pe(tt,et),Ot=new Pe(tt,Xe),kt=new Pe(Ye,Xe),Ci=new Pe(Ae/u,ut/u),Vt=new Pe(Lt/u,xt/u),Nt=e*Math.PI/180;if(Nt){const ki=Math.sin(Nt),bi=Math.cos(Nt),Oi=[bi,-ki,ki,bi];Rt._matMult(Oi),ri._matMult(Oi),kt._matMult(Oi),Ot._matMult(Oi)}const vi=Te.stretch+Te.fixed,Ei=Re.stretch+Re.fixed;return{tl:Rt,tr:ri,bl:kt,br:Ot,tex:{x:c.paddedRect.x+Ms+vi,y:c.paddedRect.y+Ms+Ei,w:Oe.stretch+Oe.fixed-vi,h:Ve.stretch+Ve.fixed-Ei},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Ci,pixelOffsetBR:Vt,minFontScaleX:be/u/_,minFontScaleY:Se/u/x,isSDF:i}};if(r&&(c.stretchX||c.stretchY)){const Te=Hp(w,V,D),Re=Hp(E,H,L);for(let Oe=0;Oe<Te.length-1;Oe++){const Ve=Te[Oe],Ye=Te[Oe+1];for(let Ae=0;Ae<Re.length-1;Ae++)o.push($e(Ve,Re[Ae],Ye,Re[Ae+1]))}}else o.push($e({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:p+1},{fixed:0,stretch:f+1}));return o}function fh(t,e,i){let r=0;for(const o of t)r+=Math.max(e,Math.min(i,o[1]))-Math.max(e,Math.min(i,o[0]));return r}function Hp(t,e,i){const r=[{fixed:-Ms,stretch:0}];for(const[o,c]of t){const u=r[r.length-1];r.push({fixed:o-u.stretch,stretch:u.stretch}),r.push({fixed:o-u.stretch,stretch:u.stretch+(c-o)})}return r.push({fixed:e+Ms,stretch:i}),r}function _h(t,e,i,r){return t/e*i+r}function gh(t,e,i,r){return t-e*i/r}function I_(t,e,i,r){const o=e+t.positionedLines[r].lineOffset;return 0===r?i+o/2:i+(o+(e+t.positionedLines[r-1].lineOffset))/2}class S_{constructor(e=[],i=P_){if(this.data=e,this.length=this.data.length,this.compare=i,this.length>0)for(let r=(this.length>>1)-1;r>=0;r--)this._down(r)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const e=this.data[0],i=this.data.pop();return this.length--,this.length>0&&(this.data[0]=i,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:i,compare:r}=this,o=i[e];for(;e>0;){const c=e-1>>1,u=i[c];if(r(o,u)>=0)break;i[e]=u,e=c}i[e]=o}_down(e){const{data:i,compare:r}=this,o=this.length>>1,c=i[e];for(;e<o;){let u=1+(e<<1),p=i[u];const f=u+1;if(f<this.length&&r(i[f],p)<0&&(u=f,p=i[f]),r(p,c)>=0)break;i[e]=p,e=u}i[e]=c}}function P_(t,e){return t<e?-1:t>e?1:0}function z_(t,e=1,i=!1){let r=1/0,o=1/0,c=-1/0,u=-1/0;const p=t[0];for(let C=0;C<p.length;C++){const D=p[C];(!C||D.x<r)&&(r=D.x),(!C||D.y<o)&&(o=D.y),(!C||D.x>c)&&(c=D.x),(!C||D.y>u)&&(u=D.y)}const f=Math.min(c-r,u-o);let _=f/2;const x=new S_([],L_);if(0===f)return new Pe(r,o);for(let C=r;C<c;C+=f)for(let D=o;D<u;D+=f)x.push(new Ds(C+_,D+_,_,t));let w=function(C){let D=0,L=0,V=0;const H=C[0];for(let te=0,Y=H.length,ee=Y-1;te<Y;ee=te++){const ae=H[te],ne=H[ee],be=ae.x*ne.y-ne.x*ae.y;L+=(ae.x+ne.x)*be,V+=(ae.y+ne.y)*be,D+=3*be}return new Ds(L/D,V/D,0,C)}(t),E=x.length;for(;x.length;){const C=x.pop();(C.d>w.d||!w.d)&&(w=C,i&&console.log("found best %d after %d probes",Math.round(1e4*C.d)/1e4,E)),C.max-w.d<=e||(_=C.h/2,x.push(new Ds(C.p.x-_,C.p.y-_,_,t)),x.push(new Ds(C.p.x+_,C.p.y-_,_,t)),x.push(new Ds(C.p.x-_,C.p.y+_,_,t)),x.push(new Ds(C.p.x+_,C.p.y+_,_,t)),E+=4)}return i&&(console.log(`num probes: ${E}`),console.log(`best distance: ${w.d}`)),w.p}function L_(t,e){return e.max-t.max}class Ds{constructor(e,i,r,o){this.p=new Pe(e,i),this.h=r,this.d=function(c,u){let p=!1,f=1/0;for(let _=0;_<u.length;_++){const x=u[_];for(let w=0,E=x.length,C=E-1;w<E;C=w++){const D=x[w],L=x[C];D.y>c.y!=L.y>c.y&&c.x<(L.x-D.x)*(c.y-D.y)/(L.y-D.y)+D.x&&(p=!p),f=Math.min(f,Zd(c,D,L))}}return(p?1:-1)*Math.sqrt(f)}(this.p,o),this.max=this.d+this.h*Math.SQRT2}}const Is=7,Fu=Number.POSITIVE_INFINITY,R_=Math.sqrt(2);function Yp(t,[e,i]){let r=0,o=0;if(i===Fu){e<0&&(e=0);const c=e/R_;switch(t){case"top-right":case"top-left":o=c-Is;break;case"bottom-right":case"bottom-left":o=-c+Is;break;case"bottom":o=-e+Is;break;case"top":o=e-Is}switch(t){case"top-right":case"bottom-right":r=-c;break;case"top-left":case"bottom-left":r=c;break;case"left":r=e;break;case"right":r=-e}}else{switch(e=Math.abs(e),i=Math.abs(i),t){case"top-right":case"top-left":case"top":o=i-Is;break;case"bottom-right":case"bottom-left":case"bottom":o=-i+Is}switch(t){case"top-right":case"bottom-right":case"right":r=-e;break;case"top-left":case"bottom-left":case"left":r=e}}return[r,o]}function O_(t,e,i,r,o,c,u,p,f,_){t.createArrays(),t.tilePixelRatio=vt/(512*t.overscaling),t.compareText={},t.iconsNeedLinear=!1;const x=t.layers[0].layout,w=t.layers[0]._unevaluatedLayout._values,E={};if("composite"===t.textSizeData.kind){const{minZoom:L,maxZoom:V}=t.textSizeData;E.compositeTextSizes=[w["text-size"].possiblyEvaluate(new v(L),p),w["text-size"].possiblyEvaluate(new v(V),p)]}if("composite"===t.iconSizeData.kind){const{minZoom:L,maxZoom:V}=t.iconSizeData;E.compositeIconSizes=[w["icon-size"].possiblyEvaluate(new v(L),p),w["icon-size"].possiblyEvaluate(new v(V),p)]}E.layoutTextSize=w["text-size"].possiblyEvaluate(new v(f+1),p),E.layoutIconSize=w["icon-size"].possiblyEvaluate(new v(f+1),p),E.textMaxSize=w["text-size"].possiblyEvaluate(new v(18),p);const C="map"===x.get("text-rotation-alignment")&&"point"!==x.get("symbol-placement"),D=x.get("text-size");for(const L of t.features){const V=x.get("text-font").evaluate(L,{},p).join(","),H=D.evaluate(L,{},p),te=E.layoutTextSize.evaluate(L,{},p),Y=(E.layoutIconSize.evaluate(L,{},p),{horizontal:{},vertical:void 0}),ee=L.text;let ae,ne=[0,0];if(ee){const Se=ee.toString(),$e=x.get("text-letter-spacing").evaluate(L,{},p)*dn,Te=x.get("text-line-height").evaluate(L,{},p)*dn,Re=Wh(Se)?$e:0,Oe=x.get("text-anchor").evaluate(L,{},p),Ve=x.get("text-variable-anchor");if(!Ve){const tt=x.get("text-radial-offset").evaluate(L,{},p);ne=tt?Yp(Oe,[tt*dn,Fu]):x.get("text-offset").evaluate(L,{},p).map(Lt=>Lt*dn)}let Ye=C?"center":x.get("text-justify").evaluate(L,{},p);const Ae="point"===x.get("symbol-placement"),et=Ae?x.get("text-max-width").evaluate(L,{},p)*dn:1/0,ut=tt=>{t.allowVerticalPlacement&&xl(Se)&&(Y.vertical=Ru(ee,e,i,o,V,et,Te,Oe,tt,Re,ne,mr.vertical,!0,te,H))};if(!C&&Ve){const tt="auto"===Ye?Ve.map(Xe=>Uu(Xe)):[Ye];let Lt=!1;for(let Xe=0;Xe<tt.length;Xe++){const xt=tt[Xe];if(!Y.horizontal[xt])if(Lt)Y.horizontal[xt]=Y.horizontal[0];else{const Rt=Ru(ee,e,i,o,V,et,Te,"center",xt,Re,ne,mr.horizontal,!1,te,H);Rt&&(Y.horizontal[xt]=Rt,Lt=1===Rt.positionedLines.length)}}ut("left")}else{if("auto"===Ye&&(Ye=Uu(Oe)),Ae||x.get("text-writing-mode").indexOf("horizontal")>=0||!xl(Se)){const tt=Ru(ee,e,i,o,V,et,Te,Oe,Ye,Re,ne,mr.horizontal,!1,te,H);tt&&(Y.horizontal[Ye]=tt)}ut(Ae?"left":Ye)}}let be=!1;if(L.icon&&L.icon.name){const Se=r[L.icon.name];Se&&(ae=C_(o[L.icon.name],x.get("icon-offset").evaluate(L,{},p),x.get("icon-anchor").evaluate(L,{},p)),be=Se.sdf,void 0===t.sdfIcons?t.sdfIcons=Se.sdf:t.sdfIcons!==Se.sdf&&ii("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Se.pixelRatio!==t.pixelRatio||0!==x.get("icon-rotate").constantOr(1))&&(t.iconsNeedLinear=!0))}const ge=Kp(Y.horizontal)||Y.vertical;t.iconsInText||(t.iconsInText=!!ge&&ge.iconsInText),(ge||ae)&&B_(t,L,Y,ae,r,E,te,0,ne,be,u,p,_)}c&&t.generateCollisionDebugBuffers(f,t.collisionBoxArray)}function Uu(t){switch(t){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function B_(t,e,i,r,o,c,u,p,f,_,x,w,E){let C=c.textMaxSize.evaluate(e,{},w);void 0===C&&(C=u);const D=t.layers[0].layout,L=D.get("icon-offset").evaluate(e,{},w),V=Kp(i.horizontal)||i.vertical,H="globe"===E.name,te=dn,Y=u/te,ee=t.tilePixelRatio*C/te,ae=(Oe=t.overscaling,t.zoom>18&&Oe>2&&(Oe>>=1),Math.max(vt/(512*Oe),1)*D.get("symbol-spacing")),ne=D.get("text-padding")*t.tilePixelRatio,be=D.get("icon-padding")*t.tilePixelRatio,ge=De(D.get("text-max-angle")),Se="map"===D.get("text-rotation-alignment")&&"point"!==D.get("symbol-placement"),$e="map"===D.get("icon-rotation-alignment")&&"point"!==D.get("symbol-placement"),Te=D.get("symbol-placement"),Re=ae/2;var Oe;const Ve=D.get("icon-text-fit");let Ye;r&&"none"!==Ve&&(t.allowVerticalPlacement&&i.vertical&&(Ye=Fp(r,i.vertical,Ve,D.get("icon-text-fit-padding"),L,Y)),V&&(r=Fp(r,V,Ve,D.get("icon-text-fit-padding"),L,Y)));const Ae=(et,ut,tt)=>{if(ut.x<0||ut.x>=vt||ut.y<0||ut.y>=vt)return;let Lt=null;if(H){const{x:Xe,y:xt,z:Rt}=E.projectTilePoint(ut.x,ut.y,tt);Lt={anchor:new wa(Xe,xt,Rt,0,void 0),up:E.upVector(tt,ut.x,ut.y)}}!function(Xe,xt,Rt,ri,Ot,kt,Ci,Vt,Nt,vi,Ei,ki,bi,Oi,Ni,Xi,wi,rn,Ki,Ui,si,Ji,Ai,Sn,Qi){const pn=Xe.addToLineVertexArray(xt,ri);let ln,Pn,cn,$r,zs,nc,rc,Im=0,Sm=0,Pm=0,zm=0,ed=-1,td=-1;const ra={};let Lm=Xh("");const Oo=Rt?Rt.anchor:xt;let id=0,nd=0;if(void 0===Nt._unevaluatedLayout.getValue("text-radial-offset")?[id,nd]=Nt.layout.get("text-offset").evaluate(si,{},Qi).map(or=>or*dn):(id=Nt.layout.get("text-radial-offset").evaluate(si,{},Qi)*dn,nd=Fu),Xe.allowVerticalPlacement&&Ot.vertical){const or=Ot.vertical;if(Ni)nc=Vu(or),Vt&&(rc=Vu(Vt));else{const sr=Nt.layout.get("text-rotate").evaluate(si,{},Qi)+90;cn=yh(vi,Oo,xt,Ei,ki,bi,or,Oi,sr,Xi),Vt&&($r=yh(vi,Oo,xt,Ei,ki,bi,Vt,rn,sr))}}if(kt){const or=Nt.layout.get("icon-rotate").evaluate(si,{},Qi),sr="none"!==Nt.layout.get("icon-text-fit"),ac=Wp(kt,or,Ai,sr),ad=Vt?Wp(Vt,or,Ai,sr):void 0;Pn=yh(vi,Oo,xt,Ei,ki,bi,kt,rn,or),Im=4*ac.length;const Rm=Xe.iconSizeData;let Bo=null;"source"===Rm.kind?(Bo=[Zr*Nt.layout.get("icon-size").evaluate(si,{},Qi)],Bo[0]>Ga&&ii(`${Xe.layerIds[0]}: Value for "icon-size" is >= ${Yl}. Reduce your "icon-size".`)):"composite"===Rm.kind&&(Bo=[Zr*Ji.compositeIconSizes[0].evaluate(si,{},Qi),Zr*Ji.compositeIconSizes[1].evaluate(si,{},Qi)],(Bo[0]>Ga||Bo[1]>Ga)&&ii(`${Xe.layerIds[0]}: Value for "icon-size" is >= ${Yl}. Reduce your "icon-size".`)),Xe.addSymbols(Xe.icon,ac,Bo,Ui,Ki,si,!1,Rt,xt,pn.lineStartIndex,pn.lineLength,-1,Sn,Qi),ed=Xe.icon.placedSymbolArray.length-1,ad&&(Sm=4*ad.length,Xe.addSymbols(Xe.icon,ad,Bo,Ui,Ki,si,mr.vertical,Rt,xt,pn.lineStartIndex,pn.lineLength,-1,Sn,Qi),td=Xe.icon.placedSymbolArray.length-1)}for(const or in Ot.horizontal){const sr=Ot.horizontal[or];ln||(Lm=Xh(sr.text),Ni?zs=Vu(sr):ln=yh(vi,Oo,xt,Ei,ki,bi,sr,Oi,Nt.layout.get("text-rotate").evaluate(si,{},Qi),Xi));const ac=1===sr.positionedLines.length;if(Pm+=Xp(Xe,Rt,xt,sr,Ci,Nt,Ni,si,Xi,pn,Ot.vertical?mr.horizontal:mr.horizontalOnly,ac?Object.keys(Ot.horizontal):[or],ra,ed,Ji,Sn,Qi),ac)break}Ot.vertical&&(zm+=Xp(Xe,Rt,xt,Ot.vertical,Ci,Nt,Ni,si,Xi,pn,mr.vertical,["vertical"],ra,td,Ji,Sn,Qi));let Xa=-1;const rd=(or,sr)=>or?Math.max(or,sr):sr;Xa=rd(zs,Xa),Xa=rd(nc,Xa),Xa=rd(rc,Xa);const ug=Xa>-1?1:0;Xe.glyphOffsetArray.length>=$a.MAX_GLYPHS&&ii("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==si.sortKey&&Xe.addToSortKeyRanges(Xe.symbolInstances.length,si.sortKey),Xe.symbolInstances.emplaceBack(Oo.x,Oo.y,Oo.z,xt.x,xt.y,ra.right>=0?ra.right:-1,ra.center>=0?ra.center:-1,ra.left>=0?ra.left:-1,ra.vertical>=0?ra.vertical:-1,ed,td,Lm,void 0!==ln?ln:Xe.collisionBoxArray.length,void 0!==ln?ln+1:Xe.collisionBoxArray.length,void 0!==cn?cn:Xe.collisionBoxArray.length,void 0!==cn?cn+1:Xe.collisionBoxArray.length,void 0!==Pn?Pn:Xe.collisionBoxArray.length,void 0!==Pn?Pn+1:Xe.collisionBoxArray.length,$r||Xe.collisionBoxArray.length,$r?$r+1:Xe.collisionBoxArray.length,Ei,Pm,zm,Im,Sm,ug,0,id,nd,Xa)}(t,ut,Lt,et,i,r,o,Ye,t.layers[0],t.collisionBoxArray,e.index,e.sourceLayerIndex,t.index,ne,Se,f,0,be,$e,L,e,c,_,x,w)};if("line"===Te)for(const et of Gp(e.geometry,0,0,vt,vt)){const ut=D_(et,ae,ge,i.vertical||V,r,te,ee,t.overscaling,vt);for(const tt of ut)V&&F_(t,V.text,Re,tt)||Ae(et,tt,w)}else if("line-center"===Te){for(const et of e.geometry)if(et.length>1){const ut=M_(et,ge,i.vertical||V,r,te,ee);ut&&Ae(et,ut,w)}}else if("Polygon"===e.type)for(const et of Au(e.geometry,0)){const ut=z_(et,16);Ae(et[0],new wa(ut.x,ut.y,0,0,void 0),w)}else if("LineString"===e.type)for(const et of e.geometry)Ae(et,new wa(et[0].x,et[0].y,0,0,void 0),w);else if("Point"===e.type)for(const et of e.geometry)for(const ut of et)Ae([ut],new wa(ut.x,ut.y,0,0,void 0),w)}const Yl=255,Ga=Yl*Zr;function Xp(t,e,i,r,o,c,u,p,f,_,x,w,E,C,D,L,V){const H=function(ee,ae,ne,be,ge,Se,$e,Te){const Re=[];if(0===ae.positionedLines.length)return Re;const Oe=be.layout.get("text-rotate").evaluate(Se,{})*Math.PI/180,Ve=function(tt){const Lt=tt[0],Xe=tt[1],xt=Lt*Xe;return xt>0?[Lt,-Xe]:xt<0?[-Lt,Xe]:0===Lt?[Xe,Lt]:[Xe,-Lt]}(ne);let Ye=Math.abs(ae.top-ae.bottom);for(const tt of ae.positionedLines)Ye-=tt.lineOffset;const Ae=ae.positionedLines.length,et=Ye/Ae;let ut=ae.top-ne[1];for(let tt=0;tt<Ae;++tt){const Lt=ae.positionedLines[tt];ut=I_(ae,et,ut,tt);for(const Xe of Lt.positionedGlyphs){if(!Xe.rect)continue;const xt=Xe.rect||{};let Rt=Ip+1,ri=!0,Ot=1,kt=0;if(Xe.imageName){const Ai=$e[Xe.imageName];if(!Ai)continue;if(Ai.sdf){ii("SDF images are not supported in formatted text and will be ignored.");continue}ri=!1,Ot=Ai.pixelRatio,Rt=Zn/Ot}const Ci=(ge||Te)&&Xe.vertical,Vt=Xe.metrics.advance*Xe.scale/2,Nt=Xe.metrics,vi=Xe.rect;if(null===vi)continue;Te&&ae.verticalizable&&(kt=Xe.imageName?Vt-Xe.metrics.width*Xe.scale/2:0);const Ei=ge?[Xe.x+Vt,Xe.y]:[0,0];let ki=[0,0],bi=[0,0],Oi=!1;ge||(Ci?(bi=[Xe.x+Vt+Ve[0],Xe.y+Ve[1]-kt],Oi=!0):ki=[Xe.x+Vt+ne[0],Xe.y+ne[1]-kt]);const Ni=vi.w*Xe.scale/(Ot*(Xe.localGlyph?Gr:1)),Xi=vi.h*Xe.scale/(Ot*(Xe.localGlyph?Gr:1));let wi,rn,Ki,Ui;if(Ci){const Ai=Xe.y-ut,Sn=new Pe(-Vt,Vt-Ai),Qi=-Math.PI/2,pn=new Pe(...bi);wi=new Pe(-Vt+ki[0],ki[1]),wi._rotateAround(Qi,Sn)._add(pn),wi.x+=-Ai+Vt,wi.y-=(Nt.left-Rt)*Xe.scale;const ln=Xe.imageName?Nt.advance*Xe.scale:dn*Xe.scale,Pn=String.fromCharCode(Xe.glyph);u_(Pn)?wi.x+=(1-Rt)*Xe.scale:d_(Pn)?wi.x+=ln-Nt.height*Xe.scale+(-Rt-1)*Xe.scale:wi.x+=Xe.imageName||Nt.width+2*Rt===vi.w&&Nt.height+2*Rt===vi.h?(ln-Xi)/2:(ln-(Nt.height+2*Rt)*Xe.scale)/2,rn=new Pe(wi.x,wi.y-Ni),Ki=new Pe(wi.x+Xi,wi.y),Ui=new Pe(wi.x+Xi,wi.y-Ni)}else{const Ai=(Nt.left-Rt)*Xe.scale-Vt+ki[0],Sn=(-Nt.top-Rt)*Xe.scale+ki[1],Qi=Ai+Ni,pn=Sn+Xi;wi=new Pe(Ai,Sn),rn=new Pe(Qi,Sn),Ki=new Pe(Ai,pn),Ui=new Pe(Qi,pn)}if(Oe){let Ai;Ai=ge?new Pe(0,0):Oi?new Pe(Ve[0],Ve[1]):new Pe(ne[0],ne[1]),wi._rotateAround(Oe,Ai),rn._rotateAround(Oe,Ai),Ki._rotateAround(Oe,Ai),Ui._rotateAround(Oe,Ai)}const si=new Pe(0,0),Ji=new Pe(0,0);Re.push({tl:wi,tr:rn,bl:Ki,br:Ui,tex:xt,writingMode:ae.writingMode,glyphOffset:Ei,sectionIndex:Xe.sectionIndex,isSDF:ri,pixelOffsetTL:si,pixelOffsetBR:Ji,minFontScaleX:0,minFontScaleY:0})}}return Re}(0,r,f,c,u,p,o,t.allowVerticalPlacement),te=t.textSizeData;let Y=null;"source"===te.kind?(Y=[Zr*c.layout.get("text-size").evaluate(p,{},V)],Y[0]>Ga&&ii(`${t.layerIds[0]}: Value for "text-size" is >= ${Yl}. Reduce your "text-size".`)):"composite"===te.kind&&(Y=[Zr*D.compositeTextSizes[0].evaluate(p,{},V),Zr*D.compositeTextSizes[1].evaluate(p,{},V)],(Y[0]>Ga||Y[1]>Ga)&&ii(`${t.layerIds[0]}: Value for "text-size" is >= ${Yl}. Reduce your "text-size".`)),t.addSymbols(t.text,H,Y,f,u,p,x,e,i,_.lineStartIndex,_.lineLength,C,L,V);for(const ee of w)E[ee]=t.text.placedSymbolArray.length-1;return 4*H.length}function Kp(t){for(const e in t)return t[e];return null}function yh(t,e,i,r,o,c,u,p,f,_){let x=u.top,w=u.bottom,E=u.left,C=u.right;const D=u.collisionPadding;if(D&&(E-=D[0],x-=D[1],C+=D[2],w+=D[3]),f){const L=new Pe(E,x),V=new Pe(C,x),H=new Pe(E,w),te=new Pe(C,w),Y=De(f);let ee=new Pe(0,0);_&&(ee=new Pe(_[0],_[1])),L._rotateAround(Y,ee),V._rotateAround(Y,ee),H._rotateAround(Y,ee),te._rotateAround(Y,ee),E=Math.min(L.x,V.x,H.x,te.x),C=Math.max(L.x,V.x,H.x,te.x),x=Math.min(L.y,V.y,H.y,te.y),w=Math.max(L.y,V.y,H.y,te.y)}return t.emplaceBack(e.x,e.y,e.z,i.x,i.y,E,x,C,w,p,r,o,c),t.length-1}function Vu(t){t.collisionPadding&&(t.top-=t.collisionPadding[1],t.bottom+=t.collisionPadding[3]);const e=t.bottom-t.top;return e>0?Math.max(10,e):null}function F_(t,e,i,r){const o=t.compareText;if(e in o){const c=o[e];for(let u=c.length-1;u>=0;u--)if(r.dist(c[u])<i)return!0}else o[e]=[];return o[e].push(r),!1}function Jp(t,e){const i=t.fovAboveCenter,r=t.elevation?t.elevation.getMinElevationBelowMSL()*e:0,o=(t._camera.position[2]*t.worldSize-r)/Math.cos(t._pitch),c=Math.sin(i)*o/Math.sin(Math.max(Math.PI/2-t._pitch-i,.01)),u=Math.sin(t._pitch)*c+o;return Math.min(1.01*u,o*(1/t._horizonShift))}function Lo(t,e){if(!e.isReprojectedInTileSpace)return{scale:1<<t.z,x:t.x,y:t.y,x2:t.x+1,y2:t.y+1,projection:e};const i=Math.pow(2,-t.z),r=t.x*i,o=(t.x+1)*i,c=t.y*i,u=(t.y+1)*i,p=pr(r),f=pr(o),_=xn(c),x=xn(u),w=e.project(p,_),E=e.project(f,_),C=e.project(f,x),D=e.project(p,x);let L=Math.min(w.x,E.x,C.x,D.x),V=Math.min(w.y,E.y,C.y,D.y),H=Math.max(w.x,E.x,C.x,D.x),te=Math.max(w.y,E.y,C.y,D.y);const Y=i/16;function ee(ne,be,ge,Se,$e,Te){const Re=(ge+$e)/2,Oe=(Se+Te)/2,Ve=e.project(pr(Re),xn(Oe)),Ye=Math.max(0,L-Ve.x,V-Ve.y,Ve.x-H,Ve.y-te);L=Math.min(L,Ve.x),H=Math.max(H,Ve.x),V=Math.min(V,Ve.y),te=Math.max(te,Ve.y),Ye>Y&&(ee(ne,Ve,ge,Se,Re,Oe),ee(Ve,be,Re,Oe,$e,Te))}ee(w,E,r,c,o,c),ee(E,C,o,c,o,u),ee(C,D,o,u,r,u),ee(D,w,r,u,r,c),L-=Y,V-=Y,H+=Y,te+=Y;const ae=1/Math.max(H-L,te-V);return{scale:ae,x:L*ae,y:V*ae,x2:H*ae,y2:te*ae,projection:e}}const U_=Vr(new Float32Array(16));class qa{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,i){return{x:0,y:0,z:0}}unproject(e,i){return new xi(0,0)}projectTilePoint(e,i,r){return{x:e,y:i,z:0}}locationPoint(e,i,r=!0){return e._coordinatePoint(e.locationCoordinate(i),r)}pixelsPerMeter(e,i){return jr(1,e)*i}pixelSpaceConversion(e,i,r){return 1}farthestPixelDistance(e){return Jp(e,e.pixelsPerMeter)}pointCoordinate(e,i,r,o){const c=e.horizonLineFromTop(!1),u=new Pe(i,Math.max(c,r));return e.rayIntersectionCoordinate(e.pointRayIntersection(u,o))}pointCoordinate3D(e,i,r){const o=new Pe(i,r);if(e.elevation)return e.elevation.pointCoordinate(o);{const c=this.pointCoordinate(e,o.x,o.y,0);return[c.x,c.y,c.z]}}isPointAboveHorizon(e,i){if(e.elevation)return!this.pointCoordinate3D(e,i.x,i.y);const r=e.horizonLineFromTop();return i.y<r}createInversionMatrix(e,i){return U_}createTileMatrix(e,i,r){let o,c,u;const p=r.canonical,f=Vr(new Float64Array(16));if(this.isReprojectedInTileSpace){const _=Lo(p,this);o=1,c=_.x+r.wrap*_.scale,u=_.y,Co(f,f,[o/_.scale,o/_.scale,e.pixelsPerMeter/i])}else o=i/e.zoomScale(p.z),c=(p.x+Math.pow(2,p.z)*r.wrap)*o,u=p.y*o;return Al(f,f,[c,u,0]),Co(f,f,[o/vt,o/vt,1]),f}upVector(e,i,r){return[0,0,1]}upVectorScale(e,i,r){return{metersToTile:1}}}class V_ extends qa{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[i,r]=this.parallels=e.parallels||[29.5,45.5],o=Math.sin(De(i));this.n=(o+Math.sin(De(r)))/2,this.c=1+o*(2*this.n-o),this.r0=Math.sqrt(this.c)/this.n}project(e,i){const{n:r,c:o,r0:c}=this,u=De(e-this.center[0]),p=De(i),f=Math.sqrt(o-2*r*Math.sin(p))/r;return{x:f*Math.sin(u*r),y:f*Math.cos(u*r)-c,z:0}}unproject(e,i){const{n:r,c:o,r0:c}=this,u=c+i;let p=Math.atan2(e,Math.abs(u))*Math.sign(u);u*r<0&&(p-=Math.PI*Math.sign(e)*Math.sign(u));const f=De(this.center[0])*r;p=st(p,-Math.PI-f,Math.PI-f);const _=Ee(at(p/r)+this.center[0],-180,180),x=Math.asin(Ee((o-(e*e+u*u)*r*r)/(2*r),-1,1)),w=Ee(at(x),-vn,vn);return new xi(_,w)}}const Xl=1.340264,Kl=-.081106,Jl=893e-6,Ql=.003796,xh=Math.sqrt(3)/2;class N_ extends qa{project(e,i){i=i/180*Math.PI,e=e/180*Math.PI;const r=Math.asin(xh*Math.sin(i)),o=r*r,c=o*o*o;return{x:.5*(e*Math.cos(r)/(xh*(Xl+3*Kl*o+c*(7*Jl+9*Ql*o)))/Math.PI+.5),y:1-.5*(r*(Xl+Kl*o+c*(Jl+Ql*o))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let r=i=(2*(1-i)-1)*Math.PI,o=r*r,c=o*o*o;for(let x,w,E,C=0;C<12&&(w=r*(Xl+Kl*o+c*(Jl+Ql*o))-i,E=Xl+3*Kl*o+c*(7*Jl+9*Ql*o),x=w/E,r=Ee(r-x,-Math.PI/3,Math.PI/3),o=r*r,c=o*o*o,!(Math.abs(x)<1e-12));++C);const u=xh*e*(Xl+3*Kl*o+c*(7*Jl+9*Ql*o))/Math.cos(r),p=Math.asin(Math.sin(r)/xh),f=Ee(180*u/Math.PI,-180,180),_=Ee(180*p/Math.PI,-vn,vn);return new xi(f,_)}}class j_ extends qa{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){return{x:.5+e/360,y:.5-i/360,z:0}}unproject(e,i){const r=360*(e-.5),o=Ee(360*(.5-i),-vn,vn);return new xi(r,o)}}const Ss=Math.PI/2;function vh(t){return Math.tan((Ss+t)/2)}class Z_ extends qa{constructor(e){super(e),this.center=e.center||[0,30];const[i,r]=this.parallels=e.parallels||[30,30];let o=De(i),c=De(r);this.southernCenter=o+c<0,this.southernCenter&&(o=-o,c=-c);const u=Math.cos(o),p=vh(o);this.n=o===c?Math.sin(o):Math.log(u/Math.cos(c))/Math.log(vh(c)/p),this.f=u*Math.pow(vh(o),this.n)/this.n}project(e,i){i=De(i),this.southernCenter&&(i=-i),e=De(e-this.center[0]);const r=1e-6,{n:o,f:c}=this;c>0?i<-Ss+r&&(i=-Ss+r):i>Ss-r&&(i=Ss-r);const u=c/Math.pow(vh(i),o);let p=u*Math.sin(o*e),f=c-u*Math.cos(o*e);return p=.5*(p/Math.PI+.5),f=.5*(f/Math.PI+.5),{x:p,y:this.southernCenter?f:1-f,z:0}}unproject(e,i){e=(2*e-.5)*Math.PI,this.southernCenter&&(i=1-i),i=(2*(1-i)-.5)*Math.PI;const{n:r,f:o}=this,c=o-i,u=Math.sign(c),p=Math.sign(r)*Math.sqrt(e*e+c*c);let f=Math.atan2(e,Math.abs(c))*u;c*r<0&&(f-=Math.PI*Math.sign(e)*u);const _=Ee(at(f/r)+this.center[0],-180,180),x=Ee(at(2*Math.atan(Math.pow(o/p,1/r))-Ss),-vn,vn);return new xi(_,this.southernCenter?-x:x)}}class Qp extends qa{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,i){return{x:Qr(e),y:ea(i),z:0}}unproject(e,i){const r=pr(e),o=xn(i);return new xi(r,o)}}const em=De(vn);class G_ extends qa{project(e,i){const r=(i=De(i))*i,o=r*r;return{x:.5*((e=De(e))*(.8707-.131979*r+o*(o*(.003971*r-.001529*o)-.013791))/Math.PI+.5),y:1-.5*(i*(1.007226+r*(.015085+o*(.028874*r-.044475-.005916*o)))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let r=i=(2*(1-i)-1)*Math.PI,o=25,c=0,u=r*r;do{u=r*r;const _=u*u;c=(r*(1.007226+u*(.015085+_*(.028874*u-.044475-.005916*_)))-i)/(1.007226+u*(.045255+_*(.259866*u-.311325-.005916*11*_))),r=Ee(r-c,-em,em)}while(Math.abs(c)>1e-6&&--o>0);u=r*r;const p=Ee(at(e/(.8707+u*(u*(u*u*u*(.003971-.001529*u)-.013791)-.131979))),-180,180),f=at(r);return new xi(p,f)}}const tm=De(vn);class q_ extends qa{project(e,i){i=De(i),e=De(e);const r=Math.cos(i),o=2/Math.PI,c=Math.acos(r*Math.cos(e/2)),u=Math.sin(c)/c,p=.5*(e*o+2*r*Math.sin(e/2)/u)||0,f=.5*(i+Math.sin(i)/u)||0;return{x:.5*(p/Math.PI+.5),y:1-.5*(f/Math.PI+1),z:0}}unproject(e,i){let r=e=(2*e-.5)*Math.PI,o=i=(2*(1-i)-1)*Math.PI,c=25;const u=1e-6;let p=0,f=0;do{const _=Math.cos(o),x=Math.sin(o),w=2*x*_,E=x*x,C=_*_,D=Math.cos(r/2),L=Math.sin(r/2),V=2*D*L,H=L*L,te=1-C*D*D,Y=te?1/te:0,ee=te?Math.acos(_*D)*Math.sqrt(1/te):0,ae=.5*(2*ee*_*L+2*r/Math.PI)-e,ne=.5*(ee*x+o)-i,be=.5*Y*(C*H+ee*_*D*E)+1/Math.PI,ge=Y*(V*w/4-ee*x*L),Se=.125*Y*(w*L-ee*x*C*V),$e=.5*Y*(E*D+ee*H*_)+.5,Te=ge*Se-$e*be;p=(ne*ge-ae*$e)/Te,f=(ae*Se-ne*be)/Te,r=Ee(r-p,-Math.PI,Math.PI),o=Ee(o-f,-tm,tm)}while((Math.abs(p)>u||Math.abs(f)>u)&&--c>0);return new xi(at(r),at(o))}}class im extends qa{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(De(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){const{scale:r,cosPhi:o}=this;return{x:De(e)*o*r+.5,y:-Math.sin(De(i))/o*r+.5,z:0}}unproject(e,i){const{scale:r,cosPhi:o}=this,c=-(i-.5)/r,u=Ee(at((e-.5)/r)/o,-180,180),p=Math.asin(Ee(c*o,-1,1)),f=Ee(at(p),-vn,vn);return new xi(u,f)}}class $_ extends Qp{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,i,r){const o=Ll(e,i,r);return Gi(o,o,Rl(Jr(r))),{x:o[0],y:o[1],z:o[2]}}locationPoint(e,i){const r=_s(i.lat,i.lng),o=Mn([],r),c=e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(i),e._centerAltitude):e._centerAltitude;Il(r,r,o,jr(1,0)*vt*c);const u=Vr(new Float64Array(16));return Ao(u,e.pixelMatrix,e.globeMatrix),Gi(r,r,u),new Pe(r[0],r[1])}pixelsPerMeter(e,i){return jr(1,0)*i}pixelSpaceConversion(e,i,r){const o=jr(1,e)*i,c=ei(jr(1,45)*i,o,r);return this.pixelsPerMeter(e,i)/c}createTileMatrix(e,i,r){const o=hu(Jr(r.canonical));return Ao(new Float64Array(16),e.globeMatrix,o)}createInversionMatrix(e,i){const{center:r}=e,o=Rl(Jr(i));return Hc(o,o,De(r.lng)),eu(o,o,De(r.lat)),Co(o,o,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(o)}pointCoordinate(e,i,r,o){return Dd(e,i,r,!0)||new ys(0,0)}pointCoordinate3D(e,i,r){const o=this.pointCoordinate(e,i,r,0);return[o.x,o.y,o.z]}isPointAboveHorizon(e,i){return!Dd(e,i.x,i.y,!1)}farthestPixelDistance(e){const i=function(o,c){const u=o.cameraToCenterDistance,p=o._centerAltitude*c,f=o._camera,_=o._camera.forward(),x=ya([],dr([],_,-u),[0,0,p]),w=o.worldSize/(2*Math.PI),E=[0,0,-w],C=o.width/o.height,D=Math.tan(o.fovAboveCenter),L=dr([],f.up(),D),V=dr([],f.right(),D*C),H=Mn([],ya([],ya([],_,L),V)),te=[];let Y;if(new ru(x,H).closestPointOnSphere(E,w,te)){const ee=ya([],te,E),ae=Nr([],ee,x);Y=Math.cos(o.fovAboveCenter)*Cl(ae)}else{const ee=Nr([],x,E),ae=Nr([],E,x);Mn(ae,ae);const ne=Cl(ee)-w;Y=Math.sqrt(ne*(ne+2*w));const be=Math.acos(Y/(w+ne))-Math.acos(wr(_,ae));Y*=Math.cos(be)}return 1.01*Y}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),r=gs(e.zoom);if(r>0){const o=Jp(e,jr(1,e.center.lat)*e.worldSize),c=e.worldSize/(2*Math.PI),u=Math.max(e.width,e.height)/e.worldSize*Math.PI;return ei(i,o+c*(1-Math.cos(u)),Math.pow(r,10))}return i}upVector(e,i,r){return Ll(i,r,e,1)}upVectorScale(e){return{metersToTile:Yc(Kc(Jr(e)))}}}function nm(t){const e=t.parallels,i=!!e&&Math.abs(e[0]+e[1])<.01;switch(t.name){case"mercator":return new Qp(t);case"equirectangular":return new j_(t);case"naturalEarth":return new G_(t);case"equalEarth":return new N_(t);case"winkelTripel":return new q_(t);case"albers":return i?new im(t):new V_(t);case"lambertConformalConic":return i?new im(t):new Z_(t);case"globe":return new $_(t)}throw new Error(`Invalid projection name: ${t.name}`)}const W_=sh.types,H_=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function bh(t,e,i,r,o,c,u,p,f,_,x,w,E){const C=p?Math.min(Ga,Math.round(p[0])):0,D=p?Math.min(Ga,Math.round(p[1])):0;t.emplaceBack(e,i,Math.round(32*r),Math.round(32*o),c,u,(C<<1)+(f?1:0),D,16*_,16*x,256*w,256*E)}function wh(t,e,i,r,o,c,u){t.emplaceBack(e,i,r,o,c,u)}function Th(t,e,i,r,o){t.emplaceBack(e,i,r,o),t.emplaceBack(e,i,r,o),t.emplaceBack(e,i,r,o),t.emplaceBack(e,i,r,o)}function Y_(t){for(const e of t.sections)if(Yh(e.text))return!0;return!1}class Nu{constructor(e){this.layoutVertexArray=new Be,this.indexArray=new pt,this.programConfigurations=e,this.segments=new Hi,this.dynamicLayoutVertexArray=new Ze,this.opacityVertexArray=new gt,this.placedSymbolArray=new Wi,this.globeExtVertexArray=new He}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}upload(e,i,r,o){this.isEmpty()||(r&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,n_.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,i),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,a_.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,H_,!0),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,r_.members,!0)),this.opacityVertexBuffer.itemSize=1),(r||o)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}}ct(Nu,"SymbolBuffers");class ju{constructor(e,i,r){this.layoutVertexArray=new e,this.layoutAttributes=i,this.indexArray=new r,this.segments=new Hi,this.collisionVertexArray=new Wt,this.collisionVertexArrayExt=new qt}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,o_.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,s_.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}ct(ju,"CollisionBuffers");class $a{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(u=>u.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Vr([]),this.placementViewportMatrix=Vr([]);const i=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Iu(this.zoom,i["text-size"]),this.iconSizeData=Iu(this.zoom,i["icon-size"]);const r=this.layers[0].layout,o=r.get("symbol-sort-key"),c=r.get("symbol-z-order");this.canOverlap=r.get("text-allow-overlap")||r.get("icon-allow-overlap")||r.get("text-ignore-placement")||r.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==c&&void 0!==o.constantOr(1),this.sortFeaturesByY=("viewport-y"===c||"auto"===c&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=r.get("text-writing-mode").map(u=>mr[u]),this.stateDependentLayerIds=this.layers.filter(u=>u.isStateDependent()).map(u=>u.id),this.sourceID=e.sourceID,this.projection=e.projection}createArrays(){this.text=new Nu(new ko(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new Nu(new ko(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new Cn,this.lineVertexArray=new us,this.symbolInstances=new Mi}calculateGlyphDependencies(e,i,r,o,c){for(let u=0;u<e.length;u++)if(i[e.charCodeAt(u)]=!0,o&&c){const p=$l[e.charAt(u)];p&&(i[p.charCodeAt(0)]=!0)}}populate(e,i,r,o){const c=this.layers[0],u=c.layout,p="globe"===this.projection.name,f=u.get("text-font"),_=u.get("text-field"),x=u.get("icon-image"),w=("constant"!==_.value.kind||_.value.value instanceof An&&!_.value.value.isEmpty()||_.value.value.toString().length>0)&&("constant"!==f.value.kind||f.value.value.length>0),E="constant"!==x.value.kind||!!x.value.value||Object.keys(x.parameters).length>0,C=u.get("symbol-sort-key");if(this.features=[],!w&&!E)return;const D=i.iconDependencies,L=i.glyphDependencies,V=i.availableImages,H=new v(this.zoom);for(const{feature:te,id:Y,index:ee,sourceLayerIndex:ae}of e){const ne=c._featureFilter.needGeometry,be=So(te,ne);if(!c._featureFilter.filter(H,be,r))continue;if(ne||(be.geometry=xa(te,r,o)),p&&1!==te.type&&r.z<=5){const Te=be.geometry,Re=.98078528056,Oe=(Ve,Ye)=>wr(Ll(Ve.x,Ve.y,r,1),Ll(Ye.x,Ye.y,r,1))<Re;for(let Ve=0;Ve<Te.length;Ve++)Te[Ve]=af(Te[Ve],Oe)}let ge,Se;if(w){const Te=c.getValueAndResolveTokens("text-field",be,r,V),Re=An.factory(Te);Y_(Re)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===m()||this.hasRTLText&&y.isParsed())&&(ge=h_(Re,c,be))}if(E){const Te=c.getValueAndResolveTokens("icon-image",be,r,V);Se=Te instanceof er?Te:er.fromString(Te)}if(!ge&&!Se)continue;const $e=this.sortFeaturesByKey?C.evaluate(be,{},r):void 0;if(this.features.push({id:Y,text:ge,icon:Se,index:ee,sourceLayerIndex:ae,geometry:be.geometry,properties:te.properties,type:W_[te.type],sortKey:$e}),Se&&(D[Se.name]=!0),ge){const Te=f.evaluate(be,{},r).join(","),Re="map"===u.get("text-rotation-alignment")&&"point"!==u.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(mr.vertical)>=0;for(const Oe of ge.sections)if(Oe.image)D[Oe.image.name]=!0;else{const Ve=xl(ge.toString()),Ye=Oe.fontStack||Te,Ae=L[Ye]=L[Ye]||{};this.calculateGlyphDependencies(Oe.text,Ae,Re,this.allowVerticalPlacement,Ve)}}}"line"===u.get("symbol-placement")&&(this.features=function(te){const Y={},ee={},ae=[];let ne=0;function be(Te){ae.push(te[Te]),ne++}function ge(Te,Re,Oe){const Ve=ee[Te];return delete ee[Te],ee[Re]=Ve,ae[Ve].geometry[0].pop(),ae[Ve].geometry[0]=ae[Ve].geometry[0].concat(Oe[0]),Ve}function Se(Te,Re,Oe){const Ve=Y[Re];return delete Y[Re],Y[Te]=Ve,ae[Ve].geometry[0].shift(),ae[Ve].geometry[0]=Oe[0].concat(ae[Ve].geometry[0]),Ve}function $e(Te,Re,Oe){const Ve=Oe?Re[0][Re[0].length-1]:Re[0][0];return`${Te}:${Ve.x}:${Ve.y}`}for(let Te=0;Te<te.length;Te++){const Re=te[Te],Oe=Re.geometry,Ve=Re.text?Re.text.toString():null;if(!Ve){be(Te);continue}const Ye=$e(Ve,Oe),Ae=$e(Ve,Oe,!0);if(Ye in ee&&Ae in Y&&ee[Ye]!==Y[Ae]){const et=Se(Ye,Ae,Oe),ut=ge(Ye,Ae,ae[et].geometry);delete Y[Ye],delete ee[Ae],ee[$e(Ve,ae[ut].geometry,!0)]=ut,ae[et].geometry=null}else Ye in ee?ge(Ye,Ae,Oe):Ae in Y?Se(Ye,Ae,Oe):(be(Te),Y[Ye]=ne-1,ee[Ae]=ne-1)}return ae.filter(Te=>Te.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((te,Y)=>te.sortKey-Y.sortKey)}update(e,i,r,o){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,i,this.layers,r,o),this.icon.programConfigurations.updatePaintArrays(e,i,this.layers,r,o))}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=nm(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,i){const r=this.lineVertexArray.length;if(void 0!==e.segment)for(const{x:o,y:c}of i)this.lineVertexArray.emplaceBack(o,c);return{lineStartIndex:r,lineLength:this.lineVertexArray.length-r}}addSymbols(e,i,r,o,c,u,p,f,_,x,w,E,C,D){const L=e.indexArray,V=e.layoutVertexArray,H=e.globeExtVertexArray,te=e.segments.prepareSegment(4*i.length,V,L,this.canOverlap?u.sortKey:void 0),Y=this.glyphOffsetArray.length,ee=te.vertexLength,ae=this.allowVerticalPlacement&&p===mr.vertical?Math.PI/2:0,ne=u.text&&u.text.sections;for(let ge=0;ge<i.length;ge++){const{tl:Se,tr:$e,bl:Te,br:Re,tex:Oe,pixelOffsetTL:Ve,pixelOffsetBR:Ye,minFontScaleX:Ae,minFontScaleY:et,glyphOffset:ut,isSDF:tt,sectionIndex:Lt}=i[ge],Xe=te.vertexLength,xt=ut[1];if(bh(V,_.x,_.y,Se.x,xt+Se.y,Oe.x,Oe.y,r,tt,Ve.x,Ve.y,Ae,et),bh(V,_.x,_.y,$e.x,xt+$e.y,Oe.x+Oe.w,Oe.y,r,tt,Ye.x,Ve.y,Ae,et),bh(V,_.x,_.y,Te.x,xt+Te.y,Oe.x,Oe.y+Oe.h,r,tt,Ve.x,Ye.y,Ae,et),bh(V,_.x,_.y,Re.x,xt+Re.y,Oe.x+Oe.w,Oe.y+Oe.h,r,tt,Ye.x,Ye.y,Ae,et),f){const{x:Rt,y:ri,z:Ot}=f.anchor,[kt,Ci,Vt]=f.up;wh(H,Rt,ri,Ot,kt,Ci,Vt),wh(H,Rt,ri,Ot,kt,Ci,Vt),wh(H,Rt,ri,Ot,kt,Ci,Vt),wh(H,Rt,ri,Ot,kt,Ci,Vt),Th(e.dynamicLayoutVertexArray,Rt,ri,Ot,ae)}else Th(e.dynamicLayoutVertexArray,_.x,_.y,_.z,ae);L.emplaceBack(Xe,Xe+1,Xe+2),L.emplaceBack(Xe+1,Xe+2,Xe+3),te.vertexLength+=4,te.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(ut[0]),ge!==i.length-1&&Lt===i[ge+1].sectionIndex||e.programConfigurations.populatePaintArrays(V.length,u,u.index,{},C,D,ne&&ne[Lt])}const be=f?f.anchor:_;e.placedSymbolArray.emplaceBack(be.x,be.y,be.z,_.x,_.y,Y,this.glyphOffsetArray.length-Y,ee,x,w,_.segment,r?r[0]:0,r?r[1]:0,o[0],o[1],p,0,!1,0,E,0)}_commitLayoutVertex(e,i,r,o,c,u,p){e.emplaceBack(i,r,o,c,u,Math.round(p.x),Math.round(p.y))}_addCollisionDebugVertices(e,i,r,o,c,u,p){const f=r.segments.prepareSegment(4,r.layoutVertexArray,r.indexArray),_=f.vertexLength,x=p.tileAnchorX,w=p.tileAnchorY;for(let C=0;C<4;C++)r.collisionVertexArray.emplaceBack(0,0,0,0);r.collisionVertexArrayExt.emplaceBack(i,-e.padding,-e.padding),r.collisionVertexArrayExt.emplaceBack(i,e.padding,-e.padding),r.collisionVertexArrayExt.emplaceBack(i,e.padding,e.padding),r.collisionVertexArrayExt.emplaceBack(i,-e.padding,e.padding),this._commitLayoutVertex(r.layoutVertexArray,o,c,u,x,w,new Pe(e.x1,e.y1)),this._commitLayoutVertex(r.layoutVertexArray,o,c,u,x,w,new Pe(e.x2,e.y1)),this._commitLayoutVertex(r.layoutVertexArray,o,c,u,x,w,new Pe(e.x2,e.y2)),this._commitLayoutVertex(r.layoutVertexArray,o,c,u,x,w,new Pe(e.x1,e.y2)),f.vertexLength+=4;const E=r.indexArray;E.emplaceBack(_,_+1),E.emplaceBack(_+1,_+2),E.emplaceBack(_+2,_+3),E.emplaceBack(_+3,_),f.primitiveLength+=4}_addTextDebugCollisionBoxes(e,i,r,o,c,u){for(let p=o;p<c;p++){const f=r.get(p),_=this.getSymbolInstanceTextSize(e,u,i,p);this._addCollisionDebugVertices(f,_,this.textCollisionBox,f.projectedAnchorX,f.projectedAnchorY,f.projectedAnchorZ,u)}}_addIconDebugCollisionBoxes(e,i,r,o,c,u){for(let p=o;p<c;p++){const f=r.get(p),_=this.getSymbolInstanceIconSize(e,i,u.placedIconSymbolIndex);this._addCollisionDebugVertices(f,_,this.iconCollisionBox,f.projectedAnchorX,f.projectedAnchorY,f.projectedAnchorZ,u)}}generateCollisionDebugBuffers(e,i){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new ju(ht,wp.members,sn),this.iconCollisionBox=new ju(ht,wp.members,sn);const r=Ts(this.iconSizeData,e),o=Ts(this.textSizeData,e);for(let c=0;c<this.symbolInstances.length;c++){const u=this.symbolInstances.get(c);this._addTextDebugCollisionBoxes(o,e,i,u.textBoxStartIndex,u.textBoxEndIndex,u),this._addTextDebugCollisionBoxes(o,e,i,u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u),this._addIconDebugCollisionBoxes(r,e,i,u.iconBoxStartIndex,u.iconBoxEndIndex,u),this._addIconDebugCollisionBoxes(r,e,i,u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex,u)}}getSymbolInstanceTextSize(e,i,r,o){const c=this.text.placedSymbolArray.get(i.rightJustifiedTextSymbolIndex>=0?i.rightJustifiedTextSymbolIndex:i.centerJustifiedTextSymbolIndex>=0?i.centerJustifiedTextSymbolIndex:i.leftJustifiedTextSymbolIndex>=0?i.leftJustifiedTextSymbolIndex:i.verticalPlacedTextSymbolIndex>=0?i.verticalPlacedTextSymbolIndex:o),u=uh(this.textSizeData,e,c)/dn;return this.tilePixelRatio*u}getSymbolInstanceIconSize(e,i,r){const o=this.icon.placedSymbolArray.get(r),c=uh(this.iconSizeData,e,o);return this.tilePixelRatio*c}_commitDebugCollisionVertexUpdate(e,i,r){e.emplaceBack(i,-r,-r),e.emplaceBack(i,r,-r),e.emplaceBack(i,r,r),e.emplaceBack(i,-r,r)}_updateTextDebugCollisionBoxes(e,i,r,o,c,u){for(let p=o;p<c;p++){const f=r.get(p),_=this.getSymbolInstanceTextSize(e,u,i,p);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,_,f.padding)}}_updateIconDebugCollisionBoxes(e,i,r,o,c,u){for(let p=o;p<c;p++){const f=r.get(p),_=this.getSymbolInstanceIconSize(e,i,u);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,_,f.padding)}}updateCollisionDebugBuffers(e,i){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const r=Ts(this.iconSizeData,e),o=Ts(this.textSizeData,e);for(let c=0;c<this.symbolInstances.length;c++){const u=this.symbolInstances.get(c);this._updateTextDebugCollisionBoxes(o,e,i,u.textBoxStartIndex,u.textBoxEndIndex,u),this._updateTextDebugCollisionBoxes(o,e,i,u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u),this._updateIconDebugCollisionBoxes(r,e,i,u.iconBoxStartIndex,u.iconBoxEndIndex,u.placedIconSymbolIndex),this._updateIconDebugCollisionBoxes(r,e,i,u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex,u.placedIconSymbolIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,i,r,o,c,u,p,f,_){const x={};if(i<r){const{x1:w,y1:E,x2:C,y2:D,padding:L,projectedAnchorX:V,projectedAnchorY:H,projectedAnchorZ:te,tileAnchorX:Y,tileAnchorY:ee,featureIndex:ae}=e.get(i);x.textBox={x1:w,y1:E,x2:C,y2:D,padding:L,projectedAnchorX:V,projectedAnchorY:H,projectedAnchorZ:te,tileAnchorX:Y,tileAnchorY:ee},x.textFeatureIndex=ae}if(o<c){const{x1:w,y1:E,x2:C,y2:D,padding:L,projectedAnchorX:V,projectedAnchorY:H,projectedAnchorZ:te,tileAnchorX:Y,tileAnchorY:ee,featureIndex:ae}=e.get(o);x.verticalTextBox={x1:w,y1:E,x2:C,y2:D,padding:L,projectedAnchorX:V,projectedAnchorY:H,projectedAnchorZ:te,tileAnchorX:Y,tileAnchorY:ee},x.verticalTextFeatureIndex=ae}if(u<p){const{x1:w,y1:E,x2:C,y2:D,padding:L,projectedAnchorX:V,projectedAnchorY:H,projectedAnchorZ:te,tileAnchorX:Y,tileAnchorY:ee,featureIndex:ae}=e.get(u);x.iconBox={x1:w,y1:E,x2:C,y2:D,padding:L,projectedAnchorX:V,projectedAnchorY:H,projectedAnchorZ:te,tileAnchorX:Y,tileAnchorY:ee},x.iconFeatureIndex=ae}if(f<_){const{x1:w,y1:E,x2:C,y2:D,padding:L,projectedAnchorX:V,projectedAnchorY:H,projectedAnchorZ:te,tileAnchorX:Y,tileAnchorY:ee,featureIndex:ae}=e.get(f);x.verticalIconBox={x1:w,y1:E,x2:C,y2:D,padding:L,projectedAnchorX:V,projectedAnchorY:H,projectedAnchorZ:te,tileAnchorX:Y,tileAnchorY:ee},x.verticalIconFeatureIndex=ae}return x}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let i=0;i<this.symbolInstances.length;i++){const r=this.symbolInstances.get(i);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,r.textBoxStartIndex,r.textBoxEndIndex,r.verticalTextBoxStartIndex,r.verticalTextBoxEndIndex,r.iconBoxStartIndex,r.iconBoxEndIndex,r.verticalIconBoxStartIndex,r.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,i){const r=e.placedSymbolArray.get(i),o=r.vertexStartIndex+4*r.numGlyphs;for(let c=r.vertexStartIndex;c<o;c+=4)e.indexArray.emplaceBack(c,c+1,c+2),e.indexArray.emplaceBack(c+1,c+2,c+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const i=Math.sin(e),r=Math.cos(e),o=[],c=[],u=[];for(let p=0;p<this.symbolInstances.length;++p){u.push(p);const f=this.symbolInstances.get(p);o.push(0|Math.round(i*f.tileAnchorX+r*f.tileAnchorY)),c.push(f.featureIndex)}return u.sort((p,f)=>o[p]-o[f]||c[f]-c[p]),u}addToSortKeyRanges(e,i){const r=this.sortKeyRanges[this.sortKeyRanges.length-1];r&&r.sortKey===i?r.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:i,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const i of this.symbolInstanceIndexes){const r=this.symbolInstances.get(i);this.featureSortOrder.push(r.featureIndex);const{rightJustifiedTextSymbolIndex:o,centerJustifiedTextSymbolIndex:c,leftJustifiedTextSymbolIndex:u,verticalPlacedTextSymbolIndex:p,placedIconSymbolIndex:f,verticalPlacedIconSymbolIndex:_}=r;o>=0&&this.addIndicesForPlacedSymbol(this.text,o),c>=0&&c!==o&&this.addIndicesForPlacedSymbol(this.text,c),u>=0&&u!==c&&u!==o&&this.addIndicesForPlacedSymbol(this.text,u),p>=0&&this.addIndicesForPlacedSymbol(this.text,p),f>=0&&this.addIndicesForPlacedSymbol(this.icon,f),_>=0&&this.addIndicesForPlacedSymbol(this.icon,_)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}ct($a,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),$a.MAX_GLYPHS=65535,$a.addDynamicAttributes=Th;const X_=new J({"symbol-placement":new P(ke.layout_symbol["symbol-placement"]),"symbol-spacing":new P(ke.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new P(ke.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new N(ke.layout_symbol["symbol-sort-key"]),"symbol-z-order":new P(ke.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new P(ke.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new P(ke.layout_symbol["icon-ignore-placement"]),"icon-optional":new P(ke.layout_symbol["icon-optional"]),"icon-rotation-alignment":new P(ke.layout_symbol["icon-rotation-alignment"]),"icon-size":new N(ke.layout_symbol["icon-size"]),"icon-text-fit":new P(ke.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new P(ke.layout_symbol["icon-text-fit-padding"]),"icon-image":new N(ke.layout_symbol["icon-image"]),"icon-rotate":new N(ke.layout_symbol["icon-rotate"]),"icon-padding":new P(ke.layout_symbol["icon-padding"]),"icon-keep-upright":new P(ke.layout_symbol["icon-keep-upright"]),"icon-offset":new N(ke.layout_symbol["icon-offset"]),"icon-anchor":new N(ke.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new P(ke.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new P(ke.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new P(ke.layout_symbol["text-rotation-alignment"]),"text-field":new N(ke.layout_symbol["text-field"]),"text-font":new N(ke.layout_symbol["text-font"]),"text-size":new N(ke.layout_symbol["text-size"]),"text-max-width":new N(ke.layout_symbol["text-max-width"]),"text-line-height":new N(ke.layout_symbol["text-line-height"]),"text-letter-spacing":new N(ke.layout_symbol["text-letter-spacing"]),"text-justify":new N(ke.layout_symbol["text-justify"]),"text-radial-offset":new N(ke.layout_symbol["text-radial-offset"]),"text-variable-anchor":new P(ke.layout_symbol["text-variable-anchor"]),"text-anchor":new N(ke.layout_symbol["text-anchor"]),"text-max-angle":new P(ke.layout_symbol["text-max-angle"]),"text-writing-mode":new P(ke.layout_symbol["text-writing-mode"]),"text-rotate":new N(ke.layout_symbol["text-rotate"]),"text-padding":new P(ke.layout_symbol["text-padding"]),"text-keep-upright":new P(ke.layout_symbol["text-keep-upright"]),"text-transform":new N(ke.layout_symbol["text-transform"]),"text-offset":new N(ke.layout_symbol["text-offset"]),"text-allow-overlap":new P(ke.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new P(ke.layout_symbol["text-ignore-placement"]),"text-optional":new P(ke.layout_symbol["text-optional"])});var Zu={paint:new J({"icon-opacity":new N(ke.paint_symbol["icon-opacity"]),"icon-color":new N(ke.paint_symbol["icon-color"]),"icon-halo-color":new N(ke.paint_symbol["icon-halo-color"]),"icon-halo-width":new N(ke.paint_symbol["icon-halo-width"]),"icon-halo-blur":new N(ke.paint_symbol["icon-halo-blur"]),"icon-translate":new P(ke.paint_symbol["icon-translate"]),"icon-translate-anchor":new P(ke.paint_symbol["icon-translate-anchor"]),"text-opacity":new N(ke.paint_symbol["text-opacity"]),"text-color":new N(ke.paint_symbol["text-color"],{runtimeType:_t,getOverride:t=>t.textColor,hasOverride:t=>!!t.textColor}),"text-halo-color":new N(ke.paint_symbol["text-halo-color"]),"text-halo-width":new N(ke.paint_symbol["text-halo-width"]),"text-halo-blur":new N(ke.paint_symbol["text-halo-blur"]),"text-translate":new P(ke.paint_symbol["text-translate"]),"text-translate-anchor":new P(ke.paint_symbol["text-translate-anchor"])}),layout:X_};class rm{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:I,this.defaultValue=e}evaluate(e){if(e.formattedSection){const i=this.defaultValue.property.overrides;if(i&&i.hasOverride(e.formattedSection))return i.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}ct(rm,"FormatSectionOverride",{omit:["defaultValue"]});class Eh extends Ur{constructor(e){super(e,Zu)}recalculate(e,i){super.recalculate(e,i),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const r=this.layout.get("text-writing-mode");if(r){const o=[];for(const c of r)o.indexOf(c)<0&&o.push(c);this.layout._values["text-writing-mode"]=o}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(e,i,r,o){const c=this.layout.get(e).evaluate(i,{},r,o),u=this._unevaluatedLayout._values[e];return u.isDataDriven()||La(u.value)||!c?c:(p=i.properties,c.replace(/{([^{}]+)}/g,(_,x)=>x in p?String(p[x]):""));var p}createBucket(e){return new $a(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of Zu.paint.overridableProperties){if(!Eh.hasPaintOverride(this.layout,e))continue;const i=this.paint.get(e),r=new rm(i),o=new ns(r,i.property.specification);let c=null;c="constant"===i.value.kind||"source"===i.value.kind?new ll("source",o):new _o("composite",o,i.value.zoomStops,i.value._interpolationType),this.paint._values[e]=new Z(i.property,c,i.parameters)}}_handleOverridablePaintPropertyUpdate(e,i,r){return!(!this.layout||i.isDataDriven()||r.isDataDriven())&&Eh.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,i){const r=e.get("text-field"),o=Zu.paint.properties[i];let c=!1;const u=p=>{for(const f of p)if(o.overrides&&o.overrides.hasOverride(f))return void(c=!0)};if("constant"===r.value.kind&&r.value.value instanceof An)u(r.value.value.sections);else if("source"===r.value.kind){const p=_=>{c||(_ instanceof sa&&Vi(_.value)===Jn?u(_.value.sections):_ instanceof Hr?u(_.sections):_.eachChild(p))},f=r.value;f._styleExpression&&p(f._styleExpression.expression)}return c}getProgramConfiguration(e){return new Na(this,e)}}var K_={paint:new J({"background-color":new P(ke.paint_background["background-color"]),"background-pattern":new P(ke.paint_background["background-pattern"]),"background-opacity":new P(ke.paint_background["background-opacity"])})},J_={paint:new J({"raster-opacity":new P(ke.paint_raster["raster-opacity"]),"raster-hue-rotate":new P(ke.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new P(ke.paint_raster["raster-brightness-min"]),"raster-brightness-max":new P(ke.paint_raster["raster-brightness-max"]),"raster-saturation":new P(ke.paint_raster["raster-saturation"]),"raster-contrast":new P(ke.paint_raster["raster-contrast"]),"raster-resampling":new P(ke.paint_raster["raster-resampling"]),"raster-fade-duration":new P(ke.paint_raster["raster-fade-duration"])})};class Q_ extends Ur{constructor(e){super(e,{}),this.implementation=e}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}isLayerDraped(){return void 0!==this.implementation.renderToTile}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}var eg={paint:new J({"sky-type":new P(ke.paint_sky["sky-type"]),"sky-atmosphere-sun":new P(ke.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new P(ke.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new P(ke.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new P(ke.paint_sky["sky-gradient-radius"]),"sky-gradient":new X(ke.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new P(ke.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new P(ke.paint_sky["sky-atmosphere-color"]),"sky-opacity":new P(ke.paint_sky["sky-opacity"])})};function Gu(t,e,i){const r=[0,0,1],o=Td([]);return kd(o,o,i?-De(t)+Math.PI:De(t)),Ed(o,o,-De(e)),xd(r,r,o),Mn(r,r)}const tg={circle:class extends Ur{constructor(t){super(t,df)}createBucket(t){return new _u(t)}queryRadius(t){const e=t;return xs("circle-radius",this,e)+xs("circle-stroke-width",this,e)+eh(this.paint.get("circle-translate"))}queryIntersectsFeature(t,e,i,r,o,c,u,p){const f=Wd(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),c.angle,t.pixelToTileUnitsFactor),_=this.paint.get("circle-radius").evaluate(e,i)+this.paint.get("circle-stroke-width").evaluate(e,i);return Hd(t,r,c,u,p,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),f,_)}getProgramIds(){return["circle"]}getProgramConfiguration(t){return new Na(this,t)}},heatmap:class extends Ur{createBucket(t){return new Xd(t)}constructor(t){super(t,_f),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){"heatmap-color"===t&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=vu({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(t){return xs("heatmap-radius",this,t)}queryIntersectsFeature(t,e,i,r,o,c,u,p){const f=this.paint.get("heatmap-radius").evaluate(e,i);return Hd(t,r,c,u,p,!0,!0,new Pe(0,0),f)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(t){return new Na(this,t)}},hillshade:class extends Ur{constructor(t){super(t,gf)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends Ur{constructor(t){super(t,zf)}getProgramIds(){const t=this.paint.get("fill-pattern"),e=t&&t.constantOr(1),i=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&i.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),i}getProgramConfiguration(t){return new Na(this,t)}recalculate(t,e){super.recalculate(t,e);const i=this.paint._values["fill-outline-color"];"constant"===i.value.kind&&void 0===i.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new ah(t)}queryRadius(){return eh(this.paint.get("fill-translate"))}queryIntersectsFeature(t,e,i,r,o,c){return!t.queryGeometry.isAboveHorizon&&jd($d(t.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),c.angle,t.pixelToTileUnitsFactor),r)}isTileClipped(){return!0}},"fill-extrusion":class extends Ur{constructor(t){super(t,Yf)}createBucket(t){return new Zl(t)}queryRadius(){return eh(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(t){return new Na(this,t)}queryIntersectsFeature(t,e,i,r,o,c,u,p,f){const _=Wd(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),c.angle,t.pixelToTileUnitsFactor),x=this.paint.get("fill-extrusion-height").evaluate(e,i),w=this.paint.get("fill-extrusion-base").evaluate(e,i),E=[0,0],C=p&&c.elevation,D=c.elevation?c.elevation.exaggeration():1,L=t.tile.getBucket(this);if(C&&L instanceof Zl){const ee=L.centroidVertexArray,ae=f+1;ae<ee.length&&(E[0]=ee.geta_centroid_pos0(ae),E[1]=ee.geta_centroid_pos1(ae))}if(0===E[0]&&1===E[1])return!1;"globe"===c.projection.name&&(r=mp([r],[new Pe(0,0),new Pe(vt,vt)],t.tileID.canonical).map(ee=>ee.polygon).flat());const V=C?p:null,[H,te]=(ae=r,ne=w,be=x,ge=_,Se=u,$e=V,Te=E,Re=D,Oe=c.center.lat,"globe"===(ee=c).projection.name?function(Ye,Ae,et,ut,tt,Lt,Xe,xt,Rt,ri,Ot){const kt=[],Ci=[],Vt=Ye.projection.upVectorScale(Ot,Ye.center.lat,Ye.worldSize).metersToTile,Nt=[0,0,0,1],vi=[0,0,0,1],Ei=(bi,Oi,Ni,Xi)=>{bi[0]=Oi,bi[1]=Ni,bi[2]=Xi,bi[3]=1},ki=pp();et>0&&(et+=ki),ut+=ki;for(const bi of Ae){const Oi=[],Ni=[];for(const Xi of bi){const wi=Xi.x+tt.x,rn=Xi.y+tt.y,Ki=Ye.projection.projectTilePoint(wi,rn,Ot),Ui=Ye.projection.upVector(Ot,Xi.x,Xi.y);let si=et,Ji=ut;if(Xe){const Ai=yp(wi,rn,et,ut,Xe,xt,Rt,ri);si+=Ai.base,Ji+=Ai.top}0!==et?Ei(Nt,Ki.x+Ui[0]*Vt*si,Ki.y+Ui[1]*Vt*si,Ki.z+Ui[2]*Vt*si):Ei(Nt,Ki.x,Ki.y,Ki.z),Ei(vi,Ki.x+Ui[0]*Vt*Ji,Ki.y+Ui[1]*Vt*Ji,Ki.z+Ui[2]*Vt*Ji),Gi(Nt,Nt,Lt),Gi(vi,vi,Lt),Oi.push(new ws(Nt[0],Nt[1],Nt[2])),Ni.push(new ws(vi[0],vi[1],vi[2]))}kt.push(Oi),Ci.push(Ni)}return[kt,Ci]}(ee,ae,ne,be,ge,Se,$e,Te,Re,Oe,t.tileID.canonical):$e?function(Ye,Ae,et,ut,tt,Lt,Xe,xt,Rt){const ri=[],Ot=[],kt=[0,0,0,1];for(const Ci of Ye){const Vt=[],Nt=[];for(const vi of Ci){const Ei=vi.x+ut.x,ki=vi.y+ut.y,bi=yp(Ei,ki,Ae,et,Lt,Xe,xt,Rt);kt[0]=Ei,kt[1]=ki,kt[2]=bi.base,kt[3]=1,Mo(kt,kt,tt),kt[3]=Math.max(kt[3],1e-5);const Oi=new ws(kt[0]/kt[3],kt[1]/kt[3],kt[2]/kt[3]);kt[0]=Ei,kt[1]=ki,kt[2]=bi.top,kt[3]=1,Mo(kt,kt,tt),kt[3]=Math.max(kt[3],1e-5);const Ni=new ws(kt[0]/kt[3],kt[1]/kt[3],kt[2]/kt[3]);Vt.push(Oi),Nt.push(Ni)}ri.push(Vt),Ot.push(Nt)}return[ri,Ot]}(ae,ne,be,ge,Se,$e,Te,Re,Oe):function(Ye,Ae,et,ut,tt){const Lt=[],Xe=[],xt=tt[8]*Ae,Rt=tt[9]*Ae,ri=tt[10]*Ae,Ot=tt[11]*Ae,kt=tt[8]*et,Ci=tt[9]*et,Vt=tt[10]*et,Nt=tt[11]*et;for(const vi of Ye){const Ei=[],ki=[];for(const bi of vi){const Oi=bi.x+ut.x,Ni=bi.y+ut.y,Xi=tt[0]*Oi+tt[4]*Ni+tt[12],wi=tt[1]*Oi+tt[5]*Ni+tt[13],rn=tt[2]*Oi+tt[6]*Ni+tt[14],Ki=tt[3]*Oi+tt[7]*Ni+tt[15],Ui=Xi+xt,si=wi+Rt,Ji=rn+ri,Ai=Math.max(Ki+Ot,1e-5),Sn=Xi+kt,Qi=wi+Ci,pn=rn+Vt,ln=Math.max(Ki+Nt,1e-5);Ei.push(new ws(Ui/Ai,si/Ai,Ji/Ai)),ki.push(new ws(Sn/ln,Qi/ln,pn/ln))}Lt.push(Ei),Xe.push(ki)}return[Lt,Xe]}(ae,ne,be,ge,Se)),Y=t.queryGeometry;var ee,ae,ne,be,ge,Se,$e,Te,Re,Oe;return function(ee,ae,ne){let be=1/0;jd(ne,ae)&&(be=gp(ne,ae[0]));for(let ge=0;ge<ae.length;ge++){const Se=ae[ge],$e=ee[ge];for(let Te=0;Te<Se.length-1;Te++){const Re=Se[Te],Oe=[Re,Se[Te+1],$e[Te+1],$e[Te],Re];Nd(ne,Oe)&&(be=Math.min(be,gp(ne,Oe)))}}return be!==1/0&&be}(H,te,Y.isPointQuery()?Y.screenBounds:Y.screenGeometry)}},line:class extends Ur{constructor(t){super(t,xp),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(t){if("line-gradient"===t){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof Ys,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(t,e){super.recalculate(t,e),this.paint._values["line-floorwidth"]=vp.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new hh(t)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(t){return new Na(this,t)}queryRadius(t){const e=t,i=bp(xs("line-width",this,e),xs("line-gap-width",this,e)),r=xs("line-offset",this,e);return i/2+Math.abs(r)+eh(this.paint.get("line-translate"))}queryIntersectsFeature(t,e,i,r,o,c){if(t.queryGeometry.isAboveHorizon)return!1;const u=$d(t.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),c.angle,t.pixelToTileUnitsFactor),p=t.pixelToTileUnitsFactor/2*bp(this.paint.get("line-width").evaluate(e,i),this.paint.get("line-gap-width").evaluate(e,i)),f=this.paint.get("line-offset").evaluate(e,i);return f&&(r=function(_,x){const w=[],E=new Pe(0,0);for(let C=0;C<_.length;C++){const D=_[C],L=[];for(let V=0;V<D.length;V++){const H=D[V],te=D[V+1],Y=0===V?E:H.sub(D[V-1])._unit()._perp(),ee=V===D.length-1?E:te.sub(H)._unit()._perp(),ae=Y._add(ee)._unit();ae._mult(1/(ae.x*ee.x+ae.y*ee.y)),L.push(ae._mult(x)._add(H))}w.push(L)}return w}(r,f*t.pixelToTileUnitsFactor)),function(_,x,w){for(let E=0;E<x.length;E++){const C=x[E];if(_.length>=3)for(let D=0;D<C.length;D++)if(Po(_,C[D]))return!0;if(lf(_,C,w))return!0}return!1}(u,r,p)}isTileClipped(){return!0}},symbol:Eh,background:class extends Ur{constructor(t){super(t,K_)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends Ur{constructor(t){super(t,J_)}getProgramIds(){return["raster"]}},sky:class extends Ur{constructor(t){super(t,eg),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){"sky-gradient"===t?this._updateColorRamp():"sky-atmosphere-sun"!==t&&"sky-atmosphere-halo-color"!==t&&"sky-atmosphere-color"!==t&&"sky-atmosphere-sun-intensity"!==t||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=vu({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(t){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=t.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(t,e){if("atmosphere"===this.paint.get("sky-type")){const r=this.paint.get("sky-atmosphere-sun"),o=!r,c=t.style.light,u=c.properties.get("position");return o&&"viewport"===c.properties.get("anchor")&&ii("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),o?Gu(u.azimuthal,90-u.polar,e):Gu(r[0],90-r[1],e)}const i=this.paint.get("sky-gradient-center");return Gu(i[0],90-i[1],e)}is3D(){return!1}isSky(){return!0}markSkyboxValid(t){this._skyboxInvalidated=!1,this._lightPosition=t.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const t=this.paint.get("sky-type");return"atmosphere"===t?["skyboxCapture","skybox"]:"gradient"===t?["skyboxGradient"]:null}}};class ec{constructor(e,i,r,o){this.context=e,this.format=r,this.texture=e.gl.createTexture(),this.update(i,o)}update(e,i,r){const{width:o,height:c}=e,{context:u}=this,{gl:p}=u,{HTMLImageElement:f,HTMLCanvasElement:_,HTMLVideoElement:x,ImageData:w,ImageBitmap:E}=M;if(p.bindTexture(p.TEXTURE_2D,this.texture),u.pixelStoreUnpackFlipY.set(!1),u.pixelStoreUnpack.set(1),u.pixelStoreUnpackPremultiplyAlpha.set(this.format===p.RGBA&&(!i||!1!==i.premultiply)),r||this.size&&this.size[0]===o&&this.size[1]===c){const{x:C,y:D}=r||{x:0,y:0};e instanceof f||e instanceof _||e instanceof x||e instanceof w||E&&e instanceof E?p.texSubImage2D(p.TEXTURE_2D,0,C,D,p.RGBA,p.UNSIGNED_BYTE,e):p.texSubImage2D(p.TEXTURE_2D,0,C,D,o,c,p.RGBA,p.UNSIGNED_BYTE,e.data)}else this.size=[o,c],e instanceof f||e instanceof _||e instanceof x||e instanceof w||E&&e instanceof E?p.texImage2D(p.TEXTURE_2D,0,this.format,this.format,p.UNSIGNED_BYTE,e):p.texImage2D(p.TEXTURE_2D,0,this.format,o,c,0,this.format,p.UNSIGNED_BYTE,e.data);this.useMipmap=!!(i&&i.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&p.generateMipmap(p.TEXTURE_2D)}bind(e,i){const{context:r}=this,{gl:o}=r;o.bindTexture(o.TEXTURE_2D,this.texture),e!==this.filter&&(o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,e),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,this.useMipmap?e===o.NEAREST?o.NEAREST_MIPMAP_NEAREST:o.LINEAR_MIPMAP_NEAREST:e),this.filter=e),i!==this.wrap&&(o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,i),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,i),this.wrap=i)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class ig{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class ng{constructor(){this.tasks={},this.taskQueue=[],hn(["process"],this),this.invoker=new ig(this.process),this.nextId=0}add(e,i){const r=this.nextId++,o=function({type:c,isSymbolTile:u,zoom:p}){return p=p||0,"message"===c?0:"maybePrepare"!==c||u?"parseTile"!==c||u?"parseTile"===c&&u?300-p:"maybePrepare"===c&&u?400-p:500:200-p:100-p}(i);if(0===o){wn();try{e()}finally{}return{cancel:()=>{}}}return this.tasks[r]={fn:e,metadata:i,priority:o,id:r},this.taskQueue.push(r),this.invoker.trigger(),{cancel:()=>{delete this.tasks[r]}}}process(){wn();try{if(this.taskQueue=this.taskQueue.filter(r=>!!this.tasks[r]),!this.taskQueue.length)return;const e=this.pick();if(null===e)return;const i=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!i)return;i.fn()}finally{}}pick(){let e=null,i=1/0;for(let o=0;o<this.taskQueue.length;o++){const c=this.tasks[this.taskQueue[o]];c.priority<i&&(i=c.priority,e=o)}if(null===e)return null;const r=this.taskQueue[e];return this.taskQueue.splice(e,1),r}remove(){this.invoker.remove()}}class am{constructor(e){this._stringToNumber={},this._numberToString=[];for(let i=0;i<e.length;i++){const r=e[i];this._stringToNumber[r]=i,this._numberToString[i]=r}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}const rg=["tile","layer","source","sourceLayer","state"];class om{constructor(e,i,r,o,c){this.type="Feature",this._vectorTileFeature=e,this._z=i,this._x=r,this._y=o,this.properties=e.properties,this.id=c}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};void 0!==this.id&&(e.id=this.id);for(const i of rg)void 0!==this[i]&&(e[i]=this[i]);return e}}const Wa=new Uint16Array(8184);for(let t=0;t<2046;t++){let e=t+2,i=0,r=0,o=0,c=0,u=0,p=0;for(1&e?o=c=u=32:i=r=p=32;(e>>=1)>1;){const _=i+o>>1,x=r+c>>1;1&e?(o=i,c=r,i=u,r=p):(i=o,r=c,o=u,c=p),u=_,p=x}const f=4*t;Wa[f+0]=i,Wa[f+1]=r,Wa[f+2]=o,Wa[f+3]=c}const ia=new Uint16Array(2178),Ha=new Uint8Array(1089),kh=new Uint16Array(1089);function sm(t){return 0===t?-.03125:32===t?.03125:0}var lm=de([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const cm={type:2,extent:vt,loadGeometry:()=>[[new Pe(0,0),new Pe(vt+1,0),new Pe(vt+1,vt+1),new Pe(0,vt+1),new Pe(0,0)]]};class qu{constructor(e,i,r,o,c){this.tileID=e,this.uid=Qt(),this.uses=0,this.tileSize=i,this.tileZoom=r,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=c,this.expiredRequestCount=0,this.state="loading",o&&o.transform&&(this.projection=o.transform.projection)}registerFadeDuration(e){const i=e+this.timeAdded;i<Xn.now()||this.fadeEndTime&&i<this.fadeEndTime||(this.fadeEndTime=i)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}get tileTransform(){return this._tileTransform||(this._tileTransform=Lo(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(e,i,r){if(this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(o,c){const u={};if(!c)return u;for(const p of o){const f=p.layerIds.map(_=>c.getLayer(_)).filter(Boolean);if(0!==f.length){p.layers=f,p.stateDependentLayerIds&&(p.stateDependentLayers=p.stateDependentLayerIds.map(_=>f.filter(x=>x.id===_)[0]));for(const _ of f)u[_.id]=p}}return u}(e.buckets,i.style),this.hasSymbolBuckets=!1;for(const o in this.buckets){const c=this.buckets[o];if(c instanceof $a){if(this.hasSymbolBuckets=!0,!r)break;c.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const o in this.buckets){const c=this.buckets[o];if(c instanceof $a&&c.hasRTLText){this.hasRTLText=!0,y.isLoading()||y.isLoaded()||"deferred"!==m()||g();break}}this.queryPadding=0;for(const o in this.buckets){const c=this.buckets[o];this.queryPadding=Math.max(this.queryPadding,i.style.getLayer(o).queryRadius(c))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),e.lineAtlas&&(this.lineAtlas=e.lineAtlas)}else this.collisionBoxArray=new yi}unloadVectorData(){if(this.hasData()){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(e){return this.buckets[e.id]}upload(e){for(const r in this.buckets){const o=this.buckets[r];o.uploadPending()&&o.upload(e)}const i=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new ec(e,this.imageAtlas.image,i.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new ec(e,this.glyphAtlasImage,i.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new ec(e,this.lineAtlas.image,i.ALPHA),this.lineAtlas.uploaded=!0)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,i,r,o,c,u,p,f){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:o,pixelPosMatrix:p,transform:u,params:c,tileTransform:this.tileTransform},e,i,r):{}}querySourceFeatures(e,i){const r=this.latestFeatureIndex;if(!r||!r.rawTileData)return;const o=r.loadVTLayers(),c=i?i.sourceLayer:"",u=o._geojsonTileLayer||o[c];if(!u)return;const p=ss(i&&i.filter),{z:f,x:_,y:x}=this.tileID.canonical,w={z:f,x:_,y:x};for(let E=0;E<u.length;E++){const C=u.feature(E);if(p.needGeometry){const V=So(C,!0);if(!p.filter(new v(this.tileID.overscaledZ),V,this.tileID.canonical))continue}else if(!p.filter(new v(this.tileID.overscaledZ),C))continue;const D=r.getId(C,c),L=new om(C,f,_,x,D);L.tile=w,e.push(L)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const i=this.expirationTime;if(e.cacheControl){const r=tn(e.cacheControl);r["max-age"]&&(this.expirationTime=Date.now()+1e3*r["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const r=Date.now();let o=!1;if(this.expirationTime>r)o=!1;else if(i)if(this.expirationTime<i)o=!0;else{const c=this.expirationTime-i;c?this.expirationTime=r+Math.max(c,3e4):o=!0}else o=!0;o?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(e,i){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||0===Object.keys(e).length||!i)return;const r=this.latestFeatureIndex.loadVTLayers(),o=i.style.listImages();for(const c in this.buckets){if(!i.style.hasLayer(c))continue;const u=this.buckets[c],p=u.layers[0].sourceLayer||"_geojsonTileLayer",f=r[p],_=e[p];if(!f||!_||0===Object.keys(_).length)continue;if(u.update(_,f,o,this.imageAtlas&&this.imageAtlas.patternPositions||{}),u instanceof hh||u instanceof ah){const w=i.style._getSourceCache(u.layers[0].source);i._terrain&&i._terrain.enabled&&w&&u.programConfigurations.needsUpload&&i._terrain._clearRenderCacheForTile(w.id,this.tileID)}const x=i&&i.style&&i.style.getLayer(c);x&&(this.queryPadding=Math.max(this.queryPadding,x.queryRadius(u)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Xn.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=Xn.now()+e}setTexture(e,i){const r=i.context,o=r.gl;this.texture=this.texture||i.getTileTexture(e.width),this.texture?this.texture.update(e,{useMipmap:!0}):(this.texture=new ec(r,e,o.RGBA,{useMipmap:!0}),this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE))}setDependencies(e,i){const r={};for(const o of i)r[o]=!0;this.dependencies[e]=r}hasDependency(e,i){for(const r of e){const o=this.dependencies[r];if(o)for(const c of i)if(o[c])return!0}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(e,i){if(!i||"mercator"===i.name||this._tileDebugBuffer)return;const r=xa(cm,this.tileID.canonical,this.tileTransform)[0],o=new qe,c=new nr;for(let u=0;u<r.length;u++){const{x:p,y:f}=r[u];o.emplaceBack(p,f),c.emplaceBack(u)}c.emplaceBack(0),this._tileDebugIndexBuffer=e.createIndexBuffer(c),this._tileDebugBuffer=e.createVertexBuffer(o,Pl.members),this._tileDebugSegments=Hi.simpleSegment(0,0,o.length,c.length)}_makeTileBoundsBuffers(e,i){if(this._tileBoundsBuffer||!i||"mercator"===i.name)return;const r=xa(cm,this.tileID.canonical,this.tileTransform)[0];let o,c;if(this.isRaster){const u=function(p,f){const _=Lo(p,f),x=Math.pow(2,p.z);for(let V=0;V<33;V++)for(let H=0;H<33;H++){const te=pr((p.x+(H+sm(H))/32)/x),Y=xn((p.y+(V+sm(V))/32)/x),ee=f.project(te,Y),ae=33*V+H;ia[2*ae+0]=Math.round((ee.x*_.scale-_.x)*vt),ia[2*ae+1]=Math.round((ee.y*_.scale-_.y)*vt)}Ha.fill(0),kh.fill(0);for(let V=2045;V>=0;V--){const H=4*V,te=Wa[H+0],Y=Wa[H+1],ee=Wa[H+2],ae=Wa[H+3],ne=te+ee>>1,be=Y+ae>>1,ge=ne+be-Y,Se=be+te-ne,$e=33*Y+te,Te=33*ae+ee,Re=33*be+ne,Oe=Math.hypot((ia[2*$e+0]+ia[2*Te+0])/2-ia[2*Re+0],(ia[2*$e+1]+ia[2*Te+1])/2-ia[2*Re+1])>=16;Ha[Re]=Ha[Re]||(Oe?1:0),V<1022&&(Ha[Re]=Ha[Re]||Ha[33*(Y+Se>>1)+(te+ge>>1)]||Ha[33*(ae+Se>>1)+(ee+ge>>1)])}const w=new Le,E=new pt;let C=0;function D(V,H){const te=33*H+V;return 0===kh[te]&&(w.emplaceBack(ia[2*te+0],ia[2*te+1],V*vt/32,H*vt/32),kh[te]=++C),kh[te]-1}function L(V,H,te,Y,ee,ae){const ne=V+te>>1,be=H+Y>>1;if(Math.abs(V-ee)+Math.abs(H-ae)>1&&Ha[33*be+ne])L(ee,ae,V,H,ne,be),L(te,Y,ee,ae,ne,be);else{const ge=D(V,H),Se=D(te,Y),$e=D(ee,ae);E.emplaceBack(ge,Se,$e)}}return L(0,0,32,32,32,0),L(32,32,0,0,0,32),{vertices:w,indices:E}}(this.tileID.canonical,i);o=u.vertices,c=u.indices}else{o=new Le,c=new pt;for(const{x:p,y:f}of r)o.emplaceBack(p,f,0,0);const u=ku(o.int16,void 0,4);for(let p=0;p<u.length;p+=3)c.emplaceBack(u[p],u[p+1],u[p+2])}this._tileBoundsBuffer=e.createVertexBuffer(o,lm.members),this._tileBoundsIndexBuffer=e.createIndexBuffer(c),this._tileBoundsSegments=Hi.simpleSegment(0,0,o.length,c.length)}_makeGlobeTileDebugBuffers(e,i){const r=i.projection;if(!r||"globe"!==r.name||i.freezeTileCoverage)return;const o=this.tileID.canonical,c=Rl(Id(o,i)),u=gs(i.zoom);let p;u>0&&(p=Qh(new Float64Array(16),i.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(e,o,i,c,p,u),this._makeGlobeTileDebugTextBuffer(e,o,i,c,p,u)}_globePoint(e,i,r,o,c,u,p){let f=Ll(e,i,r);if(u){const _=1<<r.z,x=Qr(o.center.lng),w=ea(o.center.lat),E=(r.x+.5)/_-x;let C=0;E>.5?C=-1:E<-.5&&(C=1);let D=(e/vt+r.x)/_+C,L=(i/vt+r.y)/_;D=(D-x)*o._pixelsPerMercatorPixel+x,L=(L-w)*o._pixelsPerMercatorPixel+w;const V=[D*o.worldSize,L*o.worldSize,0];Gi(V,V,u),f=Io(f,V,p)}return Gi(f,f,c)}_makeGlobeTileDebugBorderBuffer(e,i,r,o,c,u){const p=new qe,f=new nr,_=new _e,x=(E,C,D,L,V)=>{const H=(D-E)/(V-1),te=(L-C)/(V-1),Y=p.length;for(let ee=0;ee<V;ee++){const ae=E+ee*H,ne=C+ee*te;p.emplaceBack(ae,ne);const be=this._globePoint(ae,ne,i,r,o,c,u);_.emplaceBack(be[0],be[1],be[2]),f.emplaceBack(Y+ee)}},w=vt;x(0,0,w,0,16),x(w,0,w,w,16),x(w,w,0,w,16),x(0,w,0,0,16),this._tileDebugIndexBuffer=e.createIndexBuffer(f),this._tileDebugBuffer=e.createVertexBuffer(p,Pl.members),this._globeTileDebugBorderBuffer=e.createVertexBuffer(_,Cd.members),this._tileDebugSegments=Hi.simpleSegment(0,0,p.length,f.length)}_makeGlobeTileDebugTextBuffer(e,i,r,o,c,u){const p=vt/4,f=new qe,_=new pt,x=new _e,w=25;_.reserve(32),f.reserve(w),x.reserve(w);const E=(C,D)=>w*C+D;for(let C=0;C<w;C++){const D=C*p;for(let L=0;L<w;L++){const V=L*p;f.emplaceBack(V,D);const H=this._globePoint(V,D,i,r,o,c,u);x.emplaceBack(H[0],H[1],H[2])}}for(let C=0;C<4;C++)for(let D=0;D<4;D++){const L=E(C,D),V=E(C,D+1),H=E(C+1,D),te=E(C+1,D+1);_.emplaceBack(L,V,H),_.emplaceBack(H,V,te)}this._tileDebugTextIndexBuffer=e.createIndexBuffer(_),this._tileDebugTextBuffer=e.createVertexBuffer(f,Pl.members),this._globeTileDebugTextBuffer=e.createVertexBuffer(x,Cd.members),this._tileDebugTextSegments=Hi.simpleSegment(0,0,w,32)}}class ag{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,i,r){const o=String(i);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][o]=this.stateChanges[e][o]||{},Mt(this.stateChanges[e][o],r),null===this.deletedStates[e]){this.deletedStates[e]={};for(const c in this.state[e])c!==o&&(this.deletedStates[e][c]=null)}else if(this.deletedStates[e]&&null===this.deletedStates[e][o]){this.deletedStates[e][o]={};for(const c in this.state[e][o])r[c]||(this.deletedStates[e][o][c]=null)}else for(const c in r)this.deletedStates[e]&&this.deletedStates[e][o]&&null===this.deletedStates[e][o][c]&&delete this.deletedStates[e][o][c]}removeFeatureState(e,i,r){if(null===this.deletedStates[e])return;const o=String(i);if(this.deletedStates[e]=this.deletedStates[e]||{},r&&void 0!==i)null!==this.deletedStates[e][o]&&(this.deletedStates[e][o]=this.deletedStates[e][o]||{},this.deletedStates[e][o][r]=null);else if(void 0!==i)if(this.stateChanges[e]&&this.stateChanges[e][o])for(r in this.deletedStates[e][o]={},this.stateChanges[e][o])this.deletedStates[e][o][r]=null;else this.deletedStates[e][o]=null;else this.deletedStates[e]=null}getState(e,i){const r=String(i),o=Mt({},(this.state[e]||{})[r],(this.stateChanges[e]||{})[r]);if(null===this.deletedStates[e])return{};if(this.deletedStates[e]){const c=this.deletedStates[e][i];if(null===c)return{};for(const u in c)delete o[u]}return o}initializeTileState(e,i){e.setFeatureState(this.state,i)}coalesceChanges(e,i){const r={};for(const o in this.stateChanges){this.state[o]=this.state[o]||{};const c={};for(const u in this.stateChanges[o])this.state[o][u]||(this.state[o][u]={}),Mt(this.state[o][u],this.stateChanges[o][u]),c[u]=this.state[o][u];r[o]=c}for(const o in this.deletedStates){this.state[o]=this.state[o]||{};const c={};if(null===this.deletedStates[o])for(const u in this.state[o])c[u]={},this.state[o][u]={};else for(const u in this.deletedStates[o]){if(null===this.deletedStates[o][u])this.state[o][u]={};else if(this.state[o][u])for(const p of Object.keys(this.deletedStates[o][u]))delete this.state[o][u][p];c[u]=this.state[o][u]}r[o]=r[o]||{},Mt(r[o],c)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(r).length)for(const o in e)e[o].setFeatureState(r,i)}}class hm{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,i){const r=this.toIdx(e,i);return{min:this.minimums[r],max:this.maximums[r]}}isLeaf(e,i){return this.leaves[this.toIdx(e,i)]}toIdx(e,i){return i*this.size+e}}function um(t,e,i,r){let o=0,c=Number.MAX_VALUE;for(let u=0;u<3;u++)if(Math.abs(r[u])<1e-15){if(i[u]<t[u]||i[u]>e[u])return null}else{const p=1/r[u];let f=(t[u]-i[u])*p,_=(e[u]-i[u])*p;if(f>_){const x=f;f=_,_=x}if(f>o&&(o=f),_<c&&(c=_),o>c)return null}return o}function dm(t,e,i,r,o,c,u,p,f,_,x){const w=r-t,E=o-e,C=c-i,D=u-t,L=p-e,V=f-i,H=x[1]*V-x[2]*L,te=x[2]*D-x[0]*V,Y=x[0]*L-x[1]*D,ee=w*H+E*te+C*Y;if(Math.abs(ee)<1e-15)return null;const ae=1/ee,ne=_[0]-t,be=_[1]-e,ge=_[2]-i,Se=(ne*H+be*te+ge*Y)*ae;if(Se<0||Se>1)return null;const $e=be*C-ge*E,Te=ge*w-ne*C,Re=ne*E-be*w,Oe=(x[0]*$e+x[1]*Te+x[2]*Re)*ae;return Oe<0||Se+Oe>1?null:(D*$e+L*Te+V*Re)*ae}function pm(t,e,i){return(t-e)/(i-e)}function mm(t,e,i,r,o,c,u,p,f){const _=1<<i,x=c-r,w=u-o,E=(t+1)/_*x+r,C=(e+0)/_*w+o,D=(e+1)/_*w+o;p[0]=(t+0)/_*x+r,p[1]=C,f[0]=E,f[1]=D}class fm{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const i=function(c){const u=Math.ceil(Math.log2(c.dim/8)),p=[];let f=Math.ceil(Math.pow(2,u));const _=1/f,x=(C,D,L,V,H)=>{const te=V?1:0,Y=(C+1)*L-te,ee=D*L,ae=(D+1)*L-te;H[0]=C*L,H[1]=ee,H[2]=Y,H[3]=ae};let w=new hm(f);const E=[];for(let C=0;C<f*f;C++){x(C%f,Math.floor(C/f),_,!1,E);const D=Ya(E[0],E[1],c),L=Ya(E[2],E[1],c),V=Ya(E[2],E[3],c),H=Ya(E[0],E[3],c);w.minimums.push(Math.min(D,L,V,H)),w.maximums.push(Math.max(D,L,V,H)),w.leaves.push(1)}for(p.push(w),f/=2;f>=1;f/=2){const C=p[p.length-1];w=new hm(f);for(let D=0;D<f*f;D++){x(D%f,Math.floor(D/f),2,!0,E);const L=C.getElevation(E[0],E[1]),V=C.getElevation(E[2],E[1]),H=C.getElevation(E[2],E[3]),te=C.getElevation(E[0],E[3]),Y=C.isLeaf(E[0],E[1]),ee=C.isLeaf(E[2],E[1]),ae=C.isLeaf(E[2],E[3]),ne=C.isLeaf(E[0],E[3]),be=Math.min(L.min,V.min,H.min,te.min),ge=Math.max(L.max,V.max,H.max,te.max),Se=Y&&ee&&ae&&ne;w.maximums.push(ge),w.minimums.push(be),w.leaves.push(ge-be<=5&&Se?1:0)}p.push(w)}return p}(this.dem),r=i.length-1,o=i[r];this._addNode(o.minimums[0],o.maximums[0],o.leaves[0]),this._construct(i,0,0,r,0)}raycastRoot(e,i,r,o,c,u,p=1){return um([e,i,-100],[r,o,this.maximums[0]*p],c,u)}raycast(e,i,r,o,c,u,p=1){if(!this.nodeCount)return null;const f=this.raycastRoot(e,i,r,o,c,u,p);if(null==f)return null;const _=[],x=[],w=[],E=[],C=[{idx:0,t:f,nodex:0,nodey:0,depth:0}];for(;C.length>0;){const{idx:D,t:L,nodex:V,nodey:H,depth:te}=C.pop();if(this.leaves[D]){mm(V,H,te,e,i,r,o,w,E);const ee=1<<te,ae=(V+0)/ee,ne=(V+1)/ee,be=(H+0)/ee,ge=(H+1)/ee,Se=Ya(ae,be,this.dem)*p,$e=Ya(ne,be,this.dem)*p,Te=Ya(ne,ge,this.dem)*p,Re=Ya(ae,ge,this.dem)*p,Oe=dm(w[0],w[1],Se,E[0],w[1],$e,E[0],E[1],Te,c,u),Ve=dm(E[0],E[1],Te,w[0],E[1],Re,w[0],w[1],Se,c,u),Ye=Math.min(null!==Oe?Oe:Number.MAX_VALUE,null!==Ve?Ve:Number.MAX_VALUE);if(Ye!==Number.MAX_VALUE)return Ye;{const Ae=Il([],c,u,L);if(_m(Se,$e,Re,Te,pm(Ae[0],w[0],E[0]),pm(Ae[1],w[1],E[1]))>=Ae[2])return L}continue}let Y=0;for(let ee=0;ee<this._siblingOffset.length;ee++){mm((V<<1)+this._siblingOffset[ee][0],(H<<1)+this._siblingOffset[ee][1],te+1,e,i,r,o,w,E),w[2]=-100,E[2]=this.maximums[this.childOffsets[D]+ee]*p;const ae=um(w,E,c,u);if(null!=ae){const ne=ae;_[ee]=ne;let be=!1;for(let ge=0;ge<Y&&!be;ge++)ne>=_[x[ge]]&&(x.splice(ge,0,ee),be=!0);be||(x[Y]=ee),Y++}}for(let ee=0;ee<Y;ee++){const ae=x[ee];C.push({idx:this.childOffsets[D]+ae,t:_[ae],nodex:(V<<1)+this._siblingOffset[ae][0],nodey:(H<<1)+this._siblingOffset[ae][1],depth:te+1})}}return null}_addNode(e,i,r){return this.minimums.push(e),this.maximums.push(i),this.leaves.push(r),this.childOffsets.push(0),this.nodeCount++}_construct(e,i,r,o,c){if(1===e[o].isLeaf(i,r))return;this.childOffsets[c]||(this.childOffsets[c]=this.nodeCount);const u=o-1,p=e[u];let f=0,_=0;for(let x=0;x<this._siblingOffset.length;x++){const w=2*i+this._siblingOffset[x][0],E=2*r+this._siblingOffset[x][1],C=p.getElevation(w,E),D=p.isLeaf(w,E),L=this._addNode(C.min,C.max,D);D&&(f|=1<<x),_||(_=L)}for(let x=0;x<this._siblingOffset.length;x++)f&1<<x||this._construct(e,2*i+this._siblingOffset[x][0],2*r+this._siblingOffset[x][1],u,_+x)}}function _m(t,e,i,r,o,c){return ei(ei(t,i,c),ei(e,r,c),o)}function Ya(t,e,i){const r=i.dim,o=Ee(t*r-.5,0,r-1),c=Ee(e*r-.5,0,r-1),u=Math.floor(o),p=Math.floor(c),f=Math.min(u+1,r-1),_=Math.min(p+1,r-1);return _m(i.get(u,p),i.get(f,p),i.get(u,_),i.get(f,_),o-u,c-p)}const gm={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function og(t,e,i){return(256*t*256+256*e+i)/10-1e4}function sg(t,e,i){return 256*t+e+i/256-32768}class Ah{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,i,r,o=!1,c=!1){if(this.uid=e,i.height!==i.width)throw new RangeError("DEM tiles must be square");if(r&&"mapbox"!==r&&"terrarium"!==r)return ii(`"${r}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=i.height;const u=this.dim=i.height-2,p=new Uint32Array(i.data.buffer);if(this.pixels=new Uint8Array(i.data.buffer),this.encoding=r||"mapbox",this.borderReady=o,!o){for(let f=0;f<u;f++)p[this._idx(-1,f)]=p[this._idx(0,f)],p[this._idx(u,f)]=p[this._idx(u-1,f)],p[this._idx(f,-1)]=p[this._idx(f,0)],p[this._idx(f,u)]=p[this._idx(f,u-1)];p[this._idx(-1,-1)]=p[this._idx(0,0)],p[this._idx(u,-1)]=p[this._idx(u-1,0)],p[this._idx(-1,u)]=p[this._idx(0,u-1)],p[this._idx(u,u)]=p[this._idx(u-1,u-1)],c&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new fm(this)}get(e,i,r=!1){r&&(e=Ee(e,-1,this.dim),i=Ee(i,-1,this.dim));const o=4*this._idx(e,i);return("terrarium"===this.encoding?sg:og)(this.pixels[o],this.pixels[o+1],this.pixels[o+2])}static getUnpackVector(e){return gm[e]}get unpackVector(){return gm[this.encoding]}_idx(e,i){if(e<-1||e>=this.dim+1||i<-1||i>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(i+1)*this.stride+(e+1)}static pack(e,i){const r=[0,0,0,0],o=Ah.getUnpackVector(i);let c=Math.floor((e+o[3])/o[2]);return r[2]=c%256,c=Math.floor(c/256),r[1]=c%256,c=Math.floor(c/256),r[0]=c,r}getPixels(){return new ar({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,i,r){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let o=i*this.dim,c=i*this.dim+this.dim,u=r*this.dim,p=r*this.dim+this.dim;switch(i){case-1:o=c-1;break;case 1:c=o+1}switch(r){case-1:u=p-1;break;case 1:p=u+1}const f=-i*this.dim,_=-r*this.dim;for(let x=u;x<p;x++)for(let w=o;w<c;w++){const E=4*this._idx(w,x),C=4*this._idx(w+f,x+_);this.pixels[E+0]=e.pixels[C+0],this.pixels[E+1]=e.pixels[C+1],this.pixels[E+2]=e.pixels[C+2],this.pixels[E+3]=e.pixels[C+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}ct(Ah,"DEMData"),ct(fm,"DemMinMaxQuadTree",{omit:["dem"]});class lg{constructor(e,i){this.max=e,this.onRemove=i,this.reset()}reset(){for(const e in this.data)for(const i of this.data[e])i.timeout&&clearTimeout(i.timeout),this.onRemove(i.value);return this.data={},this.order=[],this}add(e,i,r){const o=e.wrapped().key;void 0===this.data[o]&&(this.data[o]=[]);const c={value:i,timeout:void 0};if(void 0!==r&&(c.timeout=setTimeout(()=>{this.remove(e,c)},r)),this.data[o].push(c),this.order.push(o),this.order.length>this.max){const u=this._getAndRemoveByKey(this.order[0]);u&&this.onRemove(u)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const i=this.data[e].shift();return i.timeout&&clearTimeout(i.timeout),0===this.data[e].length&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),i.value}getByKey(e){const i=this.data[e];return i?i[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,i){if(!this.has(e))return this;const r=e.wrapped().key,o=void 0===i?0:this.data[r].indexOf(i),c=this.data[r][o];return this.data[r].splice(o,1),c.timeout&&clearTimeout(c.timeout),0===this.data[r].length&&delete this.data[r],this.onRemove(c.value),this.order.splice(this.order.indexOf(r),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const i=this._getAndRemoveByKey(this.order[0]);i&&this.onRemove(i)}return this}filter(e){const i=[];for(const r in this.data)for(const o of this.data[r])e(o.value)||i.push(o);for(const r of i)this.remove(r.value.tileID,r)}}class Ps{constructor(e,i,r){this.func=e,this.mask=i,this.range=r}}Ps.ReadOnly=!1,Ps.ReadWrite=!0,Ps.disabled=new Ps(519,Ps.ReadOnly,[0,1]);class Wu{constructor(e,i,r,o,c,u){this.test=e,this.ref=i,this.mask=r,this.fail=o,this.depthFail=c,this.pass=u}}Wu.disabled=new Wu({func:519,mask:0},0,0,7680,7680,7680);class na{constructor(e,i,r){this.blendFunction=e,this.blendColor=i,this.mask=r}}na.Replace=[1,0],na.disabled=new na(na.Replace,Zi.transparent,[!1,!1,!1,!1]),na.unblended=new na(na.Replace,Zi.transparent,[!0,!0,!0,!0]),na.alphaBlended=new na([1,771],Zi.transparent,[!0,!0,!0,!0]);class qr{constructor(e,i,r){this.enable=e,this.mode=i,this.frontFace=r}}qr.disabled=new qr(!1,1029,2305),qr.backCCW=new qr(!0,1029,2305),qr.backCW=new qr(!0,1029,2304),qr.frontCW=new qr(!0,1028,2304),qr.frontCCW=new qr(!0,1028,2305);class Ro extends Mr{constructor(e,i,r){super(),this.id=e,this._onlySymbols=r,i.on("data",o=>{"source"===o.dataType&&"metadata"===o.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===o.dataType&&"content"===o.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))}),i.on("error",()=>{this._sourceErrored=!0}),this._source=i,this._tiles={},this._cache=new lg(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=i.minTileCacheSize,this._maxTileCacheSize=i.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new ag,this._isRaster="raster"===this._source.type||"raster-dem"===this._source.type||"custom"===this._source.type&&"raster"===this._source._dataType}onAdd(e){this.map=e,this._minTileCacheSize=void 0===this._minTileCacheSize&&e?e._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=void 0===this._maxTileCacheSize&&e?e._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const e in this._tiles){const i=this._tiles[e];if("loaded"!==i.state&&"errored"!==i.state)return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,i){return e.isSymbolTile=this._onlySymbols,this._source.loadTile(e,i)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e,()=>{})}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e,()=>{})}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const i in this._tiles){const r=this._tiles[i];r.upload(e),r.prepare(this.map.style.imageManager)}}getIds(){return Pt(this._tiles).map(e=>e.tileID).sort(ym).map(e=>e.key)}getRenderableIds(e){const i=[];for(const r in this._tiles)this._isIdRenderable(+r,e)&&i.push(this._tiles[r]);return e?i.sort((r,o)=>{const c=r.tileID,u=o.tileID,p=new Pe(c.canonical.x,c.canonical.y)._rotate(this.transform.angle),f=new Pe(u.canonical.x,u.canonical.y)._rotate(this.transform.angle);return c.overscaledZ-u.overscaledZ||f.y-p.y||f.x-p.x}).map(r=>r.tileID.key):i.map(r=>r.tileID).sort(ym).map(r=>r.key)}hasRenderableParent(e){const i=this.findLoadedParent(e,0);return!!i&&this._isIdRenderable(i.tileID.key)}_isIdRenderable(e,i){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(i||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)"errored"!==this._tiles[e].state&&this._reloadTile(+e,"reloading")}}_reloadTile(e,i){const r=this._tiles[e];r&&("loading"!==r.state&&(r.state=i),this._loadTile(r,this._tileLoaded.bind(this,r,e,i)))}_tileLoaded(e,i,r,o){if(o)if(e.state="errored",404!==o.status)this._source.fire(new jn(o,{tile:e}));else if("raster-dem"===this._source.type&&this.usedForTerrain&&this.map.painter.terrain){const c=this.map.painter.terrain;this.update(this.transform,c.getScaledDemTileSize(),!0),c.resetTileLookupCache(this.id)}else this.update(this.transform);else e.timeAdded=Xn.now(),"expired"===r&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(i,e),"raster-dem"===this._source.type&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new cr("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}_backfillDEM(e){const i=this.getRenderableIds();for(let o=0;o<i.length;o++){const c=i[o];if(e.neighboringTiles&&e.neighboringTiles[c]){const u=this.getTileByID(c);r(e,u),r(u,e)}}function r(o,c){if(!o.dem||o.dem.borderReady)return;o.needsHillshadePrepare=!0,o.needsDEMTextureUpload=!0;let u=c.tileID.canonical.x-o.tileID.canonical.x;const p=c.tileID.canonical.y-o.tileID.canonical.y,f=Math.pow(2,o.tileID.canonical.z),_=c.tileID.key;0===u&&0===p||Math.abs(p)>1||(Math.abs(u)>1&&(1===Math.abs(u+f)?u+=f:1===Math.abs(u-f)&&(u-=f)),c.dem&&o.dem&&(o.dem.backfillBorder(c.dem,u,p),o.neighboringTiles&&o.neighboringTiles[_]&&(o.neighboringTiles[_].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,i,r,o){for(const c in this._tiles){let u=this._tiles[c];if(o[c]||!u.hasData()||u.tileID.overscaledZ<=i||u.tileID.overscaledZ>r)continue;let p=u.tileID;for(;u&&u.tileID.overscaledZ>i+1;){const _=u.tileID.scaledTo(u.tileID.overscaledZ-1);u=this._tiles[_.key],u&&u.hasData()&&(p=_)}let f=p;for(;f.overscaledZ>i;)if(f=f.scaledTo(f.overscaledZ-1),e[f.key]){o[p.key]=p;break}}}findLoadedParent(e,i){if(e.key in this._loadedParentTiles){const r=this._loadedParentTiles[e.key];return r&&r.tileID.overscaledZ>=i?r:null}for(let r=e.overscaledZ-1;r>=i;r--){const o=e.scaledTo(r),c=this._getLoadedTile(o);if(c)return c}}_getLoadedTile(e){const i=this._tiles[e.key];return i&&i.hasData()?i:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,i){i=i||this._source.tileSize;const r=Math.ceil(e.width/i)+1,o=Math.ceil(e.height/i)+1,c=Math.floor(r*o*5),u="number"==typeof this._minTileCacheSize?Math.max(this._minTileCacheSize,c):c,p="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,u):u;this._cache.setMaxSize(p)}handleWrapJump(e){const i=Math.round((e-(void 0===this._prevLng?e:this._prevLng))/360);if(this._prevLng=e,i){const r={};for(const o in this._tiles){const c=this._tiles[o];c.tileID=c.tileID.unwrapTo(c.tileID.wrap+i),r[c.tileID.key]=c}this._tiles=r;for(const o in this._timers)clearTimeout(this._timers[o]),delete this._timers[o];for(const o in this._tiles)this._setTileReloadTimer(+o,this._tiles[o])}}update(e,i,r){if(this.transform=e,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!r)return;let o;this.updateCacheSize(e,i),"globe"!==this.transform.projection.name&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?o=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(p=>new In(p.canonical.z,p.wrap,p.canonical.z,p.canonical.x,p.canonical.y)):(o=e.coveringTiles({tileSize:i||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!r,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(o=o.filter(p=>this._source.hasTile(p)))):o=[];const c=this._updateRetainedTiles(o);if(xm(this._source.type)&&0!==o.length){const p={},f={},_=Object.keys(c);for(const w of _){const E=c[w],C=this._tiles[w];if(!C||C.fadeEndTime&&C.fadeEndTime<=Xn.now())continue;const D=this.findLoadedParent(E,Math.max(E.overscaledZ-Ro.maxOverzooming,this._source.minzoom));D&&(this._addTile(D.tileID),p[D.tileID.key]=D.tileID),f[w]=E}const x=o[o.length-1].overscaledZ;for(const w in this._tiles){const E=this._tiles[w];if(c[w]||!E.hasData())continue;let C=E.tileID;for(;C.overscaledZ>x;){C=C.scaledTo(C.overscaledZ-1);const D=this._tiles[C.key];if(D&&D.hasData()&&f[C.key]){c[w]=E.tileID;break}}}for(const w in p)c[w]||(this._coveredTiles[w]=!0,c[w]=p[w])}for(const p in c)this._tiles[p].clearFadeHold();const u=function(p,f){const _=[];for(const x in p)x in f||_.push(x);return _}(this._tiles,c);for(const p of u){const f=this._tiles[p];f.hasSymbolBuckets&&!f.holdingForFade()?f.setHoldDuration(this.map._fadeDuration):f.hasSymbolBuckets&&!f.symbolFadeFinished()||this._removeTile(+p)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){const i={};if(0===e.length)return i;const r={},o=e.reduce((_,x)=>Math.min(_,x.overscaledZ),1/0),c=e[0].overscaledZ,u=Math.max(c-Ro.maxOverzooming,this._source.minzoom),p=Math.max(c+Ro.maxUnderzooming,this._source.minzoom),f={};for(const _ of e){const x=this._addTile(_);i[_.key]=_,x.hasData()||o<this._source.maxzoom&&(f[_.key]=_)}this._retainLoadedChildren(f,o,p,i);for(const _ of e){let x=this._tiles[_.key];if(x.hasData())continue;if(_.canonical.z>=this._source.maxzoom){const E=_.children(this._source.maxzoom)[0],C=this.getTile(E);if(C&&C.hasData()){i[E.key]=E;continue}}else{const E=_.children(this._source.maxzoom);if(i[E[0].key]&&i[E[1].key]&&i[E[2].key]&&i[E[3].key])continue}let w=x.wasRequested();for(let E=_.overscaledZ-1;E>=u;--E){const C=_.scaledTo(E);if(r[C.key]||(r[C.key]=!0,x=this.getTile(C),!x&&w&&(x=this._addTile(C)),x&&(i[C.key]=C,w=x.wasRequested(),x.hasData())))break}}return i}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const i=[];let r,o=this._tiles[e].tileID;for(;o.overscaledZ>0;){if(o.key in this._loadedParentTiles){r=this._loadedParentTiles[o.key];break}i.push(o.key);const c=o.scaledTo(o.overscaledZ-1);if(r=this._getLoadedTile(c),r)break;o=c}for(const c of i)this._loadedParentTiles[c]=r}}_addTile(e){let i=this._tiles[e.key];if(i)return i;i=this._cache.getAndRemove(e),i&&(this._setTileReloadTimer(e.key,i),i.tileID=e,this._state.initializeTileState(i,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,i)));const r=!!i;if(!r){const o=this.map?this.map.painter:null;i=new qu(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom,o,this._isRaster),this._loadTile(i,this._tileLoaded.bind(this,i,e.key,i.state))}return i?(i.uses++,this._tiles[e.key]=i,r||this._source.fire(new cr("dataloading",{tile:i,coord:i.tileID,dataType:"source"})),i):null}_setTileReloadTimer(e,i){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const r=i.getExpiryTimeout();r&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},r))}_removeTile(e){const i=this._tiles[e];i&&(i.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),i.uses>0||(i.hasData()&&"reloading"!==i.state?this._cache.add(i.tileID,i,i.getExpiryTimeout()):(i.aborted=!0,this._abortTile(i),this._unloadTile(i))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(e,i,r){const o=[],c=this.transform;if(!c)return o;const u="globe"===c.projection.name,p=Qr(c.center.lng);for(const f in this._tiles){const _=this._tiles[f];if(r&&_.clearQueryDebugViz(),_.holdingForFade())continue;let x;if(u){const w=_.tileID.canonical;if(0===w.z){const E=[Math.abs(Ee(p,...tc(w,-1))-p),Math.abs(Ee(p,...tc(w,1))-p)];x=[0,2*E.indexOf(Math.min(...E))-1]}else{const E=[Math.abs(Ee(p,...tc(w,-1))-p),Math.abs(Ee(p,...tc(w,0))-p),Math.abs(Ee(p,...tc(w,1))-p)];x=[E.indexOf(Math.min(...E))-1]}}else x=[0];for(const w of x){const E=e.containsTile(_,c,i,w);E&&o.push(E)}}return o}getVisibleCoordinates(e){const i=this.getRenderableIds(e).map(r=>this._tiles[r].tileID);for(const r of i)r.projMatrix=this.transform.calculateProjMatrix(r.toUnwrapped());return i}hasTransition(){if(this._source.hasTransition())return!0;if(xm(this._source.type))for(const e in this._tiles){const i=this._tiles[e];if(void 0!==i.fadeEndTime&&i.fadeEndTime>=Xn.now())return!0}return!1}setFeatureState(e,i,r){this._state.updateState(e=e||"_geojsonTileLayer",i,r)}removeFeatureState(e,i,r){this._state.removeFeatureState(e=e||"_geojsonTileLayer",i,r)}getFeatureState(e,i){return this._state.getState(e=e||"_geojsonTileLayer",i)}setDependencies(e,i,r){const o=this._tiles[e];o&&o.setDependencies(i,r)}reloadTilesForDependencies(e,i){for(const r in this._tiles)this._tiles[r].hasDependency(e,i)&&this._reloadTile(+r,"reloading");this._cache.filter(r=>!r.hasDependency(e,i))}_preloadTiles(e,i){if(!this._sourceLoaded){const p=()=>{this._sourceLoaded&&(this._source.off("data",p),this._preloadTiles(e,i))};return void this._source.on("data",p)}const r=new Map,o=Array.isArray(e)?e:[e],c=this.map.painter.terrain,u=this.usedForTerrain&&c?c.getScaledDemTileSize():this._source.tileSize;for(const p of o){const f=p.coveringTiles({tileSize:u,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const _ of f)r.set(_.key,_);this.usedForTerrain&&p.updateElevation(!1)}jt(Array.from(r.values()),(p,f)=>{const _=new qu(p,this._source.tileSize*p.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(_,x=>{"raster-dem"===this._source.type&&_.dem&&this._backfillDEM(_),f(x,_)})},i)}}function ym(t,e){const i=Math.abs(2*t.wrap)-+(t.wrap<0),r=Math.abs(2*e.wrap)-+(e.wrap<0);return t.overscaledZ-e.overscaledZ||r-i||e.canonical.y-t.canonical.y||e.canonical.x-t.canonical.x}function xm(t){return"raster"===t||"image"===t||"video"===t||"custom"===t}function tc(t,e){const i=1<<t.z;return[t.x/i+e,(t.x+1)/i+e]}Ro.maxOverzooming=10,Ro.maxUnderzooming=3;class Ch{constructor(e,i,r){this._demTile=e,this._dem=this._demTile.dem,this._scale=i,this._offset=r}static create(e,i,r){const o=r||e.findDEMTileFor(i);if(!o||!o.dem)return;const c=o.dem,u=o.tileID,p=1<<i.canonical.z-u.canonical.z;return new Ch(o,o.tileSize/vt/p,[(i.canonical.x/p-u.canonical.x)*c.dim,(i.canonical.y/p-u.canonical.y)*c.dim])}tileCoordToPixel(e,i){const r=i*this._scale+this._offset[1],o=Math.floor(e*this._scale+this._offset[0]),c=Math.floor(r);return new Pe(o,c)}getElevationAt(e,i,r,o){const c=e*this._scale+this._offset[0],u=i*this._scale+this._offset[1],p=Math.floor(c),f=Math.floor(u),_=this._dem;return o=!!o,r?ei(ei(_.get(p,f,o),_.get(p,f+1,o),u-f),ei(_.get(p+1,f,o),_.get(p+1,f+1,o),u-f),c-p):_.get(p,f,o)}getElevationAtPixel(e,i,r){return this._dem.get(e,i,!!r)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*jr(1,e)*this._dem.stride}}class vm{constructor(e,i){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new da(vt,16,0),this.featureIndexArray=new To,this.promoteId=i}insert(e,i,r,o,c,u=0){const p=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(r,o,c,u);const f=this.grid;for(let _=0;_<i.length;_++){const x=i[_],w=[1/0,1/0,-1/0,-1/0];for(let E=0;E<x.length;E++){const C=x[E];w[0]=Math.min(w[0],C.x),w[1]=Math.min(w[1],C.y),w[2]=Math.max(w[2],C.x),w[3]=Math.max(w[3],C.y)}w[0]<vt&&w[1]<vt&&w[2]>=0&&w[3]>=0&&f.insert(p,w[0],w[1],w[2],w[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Du(new ph(this.rawTileData)).layers,this.sourceLayerCoder=new am(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,i,r,o){this.loadVTLayers();const c=e.params||{},u=ss(c.filter),p=e.tileResult,f=e.transform,_=p.bufferedTilespaceBounds,x=this.grid.query(_.min.x,_.min.y,_.max.x,_.max.y,(D,L,V,H)=>qd(p.bufferedTilespaceGeometry,D,L,V,H));x.sort(cg);let w=null;f.elevation&&x.length>0&&(w=Ch.create(f.elevation,this.tileID));const E={};let C;for(let D=0;D<x.length;D++){const L=x[D];if(L===C)continue;C=L;const V=this.featureIndexArray.get(L);let H=null;this.loadMatchingFeature(E,V,u,c.layers,c.availableImages,i,r,o,(te,Y,ee,ae=0)=>(H||(H=xa(te,this.tileID.canonical,e.tileTransform)),Y.queryIntersectsFeature(p,te,ee,H,this.z,e.transform,e.pixelPosMatrix,w,ae)))}return E}loadMatchingFeature(e,i,r,o,c,u,p,f,_){const{featureIndex:x,bucketIndex:w,sourceLayerIndex:E,layoutVertexArrayOffset:C}=i,D=this.bucketLayerIDs[w];if(o&&!function(te,Y){for(let ee=0;ee<te.length;ee++)if(Y.indexOf(te[ee])>=0)return!0;return!1}(o,D))return;const L=this.sourceLayerCoder.decode(E),V=this.vtLayers[L].feature(x);if(r.needGeometry){const te=So(V,!0);if(!r.filter(new v(this.tileID.overscaledZ),te,this.tileID.canonical))return}else if(!r.filter(new v(this.tileID.overscaledZ),V))return;const H=this.getId(V,L);for(let te=0;te<D.length;te++){const Y=D[te];if(o&&o.indexOf(Y)<0)continue;const ee=u[Y];if(!ee)continue;let ae={};void 0!==H&&f&&(ae=f.getState(ee.sourceLayer||"_geojsonTileLayer",H));const ne=Mt({},p[Y]);ne.paint=bm(ne.paint,ee.paint,V,ae,c),ne.layout=bm(ne.layout,ee.layout,V,ae,c);const be=!_||_(V,ee,ae,C);if(!be)continue;const ge=new om(V,this.z,this.x,this.y,H);ge.layer=ne;let Se=e[Y];void 0===Se&&(Se=e[Y]=[]),Se.push({featureIndex:x,feature:ge,intersectionZ:be})}}lookupSymbolFeatures(e,i,r,o,c,u,p,f){const _={};this.loadVTLayers();const x=ss(c);for(const w of e)this.loadMatchingFeature(_,{bucketIndex:r,sourceLayerIndex:o,featureIndex:w,layoutVertexArrayOffset:0},x,u,p,f,i);return _}loadFeature(e){const{featureIndex:i,sourceLayerIndex:r}=e;this.loadVTLayers();const o=this.sourceLayerCoder.decode(r),c=this.vtFeatures[o];if(c[i])return c[i];const u=this.vtLayers[o].feature(i);return c[i]=u,u}hasLayer(e){for(const i of this.bucketLayerIDs)for(const r of i)if(e===r)return!0;return!1}getId(e,i){let r=e.id;if(this.promoteId){const o="string"==typeof this.promoteId?this.promoteId:this.promoteId[i];null!=o&&(r=e.properties[o]),"boolean"==typeof r&&(r=Number(r))}return r}}function bm(t,e,i,r,o){return yt(t,(c,u)=>{const p=e instanceof $?e.get(u):null;return p&&p.evaluate?p.evaluate(i,r,o):p})}function cg(t,e){return e-t}ct(vm,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class wm{constructor(e,i){this.width=e,this.height=i,this.nextRow=0,this.image=new va({width:e,height:i}),this.positions={},this.uploaded=!1}getDash(e,i){const r=this.getKey(e,i);return this.positions[r]}trim(){const e=this.width,i=this.height=ji(this.nextRow);this.image.resize({width:e,height:i})}getKey(e,i){return e.join(",")+i}getDashRanges(e,i,r){const o=[];let c=e.length%2==1?-e[e.length-1]*r:0,u=e[0]*r,p=!0;o.push({left:c,right:u,isDash:p,zeroLength:0===e[0]});let f=e[0];for(let _=1;_<e.length;_++){p=!p;const x=e[_];c=f*r,f+=x,u=f*r,o.push({left:c,right:u,isDash:p,zeroLength:0===x})}return o}addRoundDash(e,i,r){const o=i/2;for(let c=-r;c<=r;c++){const u=this.width*(this.nextRow+r+c);let p=0,f=e[p];for(let _=0;_<this.width;_++){_/f.right>1&&(f=e[++p]);const x=Math.abs(_-f.left),w=Math.abs(_-f.right),E=Math.min(x,w);let C;const D=c/r*(o+1);if(f.isDash){const L=o-Math.abs(D);C=Math.sqrt(E*E+L*L)}else C=o-Math.sqrt(E*E+D*D);this.image.data[u+_]=Math.max(0,Math.min(255,C+128))}}}addRegularDash(e,i){for(let f=e.length-1;f>=0;--f){const _=e[f],x=e[f+1];_.zeroLength?e.splice(f,1):x&&x.isDash===_.isDash&&(x.left=_.left,e.splice(f,1))}const r=e[0],o=e[e.length-1];r.isDash===o.isDash&&(r.left=o.left-this.width,o.right=r.right+this.width);const c=this.width*this.nextRow;let u=0,p=e[u];for(let f=0;f<this.width;f++){f/p.right>1&&(p=e[++u]);const _=Math.abs(f-p.left),x=Math.abs(f-p.right),w=Math.min(_,x);this.image.data[c+f]=Math.max(0,Math.min(255,(p.isDash?w:-w)+i+128))}}addDash(e,i){const r=this.getKey(e,i);if(this.positions[r])return this.positions[r];const o="round"===i,c=o?7:0,u=2*c+1;if(this.nextRow+u>this.height)return ii("LineAtlas out of space"),null;0===e.length&&e.push(1);let p=0;for(let x=0;x<e.length;x++)e[x]<0&&(ii("Negative value is found in line dasharray, replacing values with 0"),e[x]=0),p+=e[x];if(0!==p){const x=this.width/p,w=this.getDashRanges(e,this.width,x);o?this.addRoundDash(w,x,c):this.addRegularDash(w,"square"===i?.5*x:0)}const f=this.nextRow+c;this.nextRow+=u;const _={tl:[f,c],br:[p,0]};return this.positions[r]=_,_}}ct(wm,"LineAtlas");const Tm=1*Gr;class Em{constructor(e){const i={},r=[];for(const p in e){const f=e[p],_=i[p]={};for(const x in f.glyphs){const w=f.glyphs[+x];if(!w||0===w.bitmap.width||0===w.bitmap.height)continue;const E=w.metrics.localGlyph?Tm:1,C={x:0,y:0,w:w.bitmap.width+2*E,h:w.bitmap.height+2*E};r.push(C),_[x]=C}}const{w:o,h:c}=zu(r),u=new va({width:o||1,height:c||1});for(const p in e){const f=e[p];for(const _ in f.glyphs){const x=f.glyphs[+_];if(!x||0===x.bitmap.width||0===x.bitmap.height)continue;const w=i[p][_],E=x.metrics.localGlyph?Tm:1;va.copy(x.bitmap,u,{x:0,y:0},{x:w.x+E,y:w.y+E},x.bitmap)}}this.image=u,this.positions=i}}ct(Em,"GlyphAtlas");class hg{constructor(e){this.tileID=new In(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.tileZoom=e.tileZoom,this.uid=e.uid,this.zoom=e.zoom,this.canonical=e.tileID.canonical,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.returnDependencies=!!e.returnDependencies,this.promoteId=e.promoteId,this.enableTerrain=!!e.enableTerrain,this.isSymbolTile=e.isSymbolTile,this.tileTransform=Lo(e.tileID.canonical,e.projection),this.projection=e.projection}parse(e,i,r,o,c){this.status="parsing",this.data=e,this.collisionBoxArray=new yi;const u=new am(Object.keys(e.layers).sort()),p=new vm(this.tileID,this.promoteId);p.bucketLayerIDs=[];const f={},_=new wm(256,256),x={featureIndex:p,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:_,availableImages:r},w=i.familiesBySource[this.source];for(const ae in w){const ne=e.layers[ae];if(!ne)continue;let be=!1,ge=!1;for(const Te of w[ae])"symbol"===Te[0].type?be=!0:ge=!0;if(!0===this.isSymbolTile&&!be||!1===this.isSymbolTile&&!ge)continue;1===ne.version&&ii(`Vector tile source "${this.source}" layer "${ae}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Se=u.encode(ae),$e=[];for(let Te=0;Te<ne.length;Te++){const Re=ne.feature(Te),Oe=p.getId(Re,ae);$e.push({feature:Re,id:Oe,index:Te,sourceLayerIndex:Se})}for(const Te of w[ae]){const Re=Te[0];void 0!==this.isSymbolTile&&"symbol"===Re.type!==this.isSymbolTile||Re.minzoom&&this.zoom<Math.floor(Re.minzoom)||Re.maxzoom&&this.zoom>=Re.maxzoom||"none"!==Re.visibility&&(Xu(Te,this.zoom,r),(f[Re.id]=Re.createBucket({index:p.bucketLayerIDs.length,layers:Te,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Se,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.spec,availableImages:r})).populate($e,x,this.tileID.canonical,this.tileTransform),p.bucketLayerIDs.push(Te.map(Oe=>Oe.id)))}}let E,C,D,L;_.trim();const V={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},H=()=>{if(E)return c(E);if(C&&D&&L){const ae=new Em(C),ne=new Sp(D,L);for(const be in f){const ge=f[be];ge instanceof $a?(Xu(ge.layers,this.zoom,r),O_(ge,C,ae.positions,D,ne.iconPositions,this.showCollisionBoxes,r,this.tileID.canonical,this.tileZoom,this.projection)):ge.hasPattern&&(ge instanceof hh||ge instanceof ah||ge instanceof Zl)&&(Xu(ge.layers,this.zoom,r),ge.addFeatures(x,this.tileID.canonical,ne.patternPositions,r,this.tileTransform))}this.status="done",c(null,{buckets:Pt(f).filter(be=>!be.isEmpty()),featureIndex:p,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:ae.image,lineAtlas:_,imageAtlas:ne,glyphMap:this.returnDependencies?C:null,iconMap:this.returnDependencies?D:null,glyphPositions:this.returnDependencies?ae.positions:null})}},te=yt(x.glyphDependencies,ae=>Object.keys(ae).map(Number));Object.keys(te).length?o.send("getGlyphs",{uid:this.uid,stacks:te},(ae,ne)=>{E||(E=ae,C=ne,H())},void 0,!1,V):C={};const Y=Object.keys(x.iconDependencies);Y.length?o.send("getImages",{icons:Y,source:this.source,tileID:this.tileID,type:"icons"},(ae,ne)=>{E||(E=ae,D=ne,H())},void 0,!1,V):D={};const ee=Object.keys(x.patternDependencies);ee.length?o.send("getImages",{icons:ee,source:this.source,tileID:this.tileID,type:"patterns"},(ae,ne)=>{E||(E=ae,L=ne,H())},void 0,!1,V):L={},H()}}function Xu(t,e,i){const r=new v(e);for(const o of t)o.recalculate(r,i)}class km{constructor(e){this.entries={},this.scheduler=e}request(e,i,r,o){const c=this.entries[e]=this.entries[e]||{callbacks:[]};if(c.result){const[u,p]=c.result;return this.scheduler?this.scheduler.add(()=>{o(u,p)},i):o(u,p),()=>{}}return c.callbacks.push(o),c.cancel||(c.cancel=r((u,p)=>{c.result=[u,p];for(const f of c.callbacks)this.scheduler?this.scheduler.add(()=>{f(u,p)},i):f(u,p);setTimeout(()=>delete this.entries[e],3e3)})),()=>{c.result||(c.callbacks=c.callbacks.filter(u=>u!==o),c.callbacks.length||(c.cancel(),delete this.entries[e]))}}}function Am(t,e,i){const r=JSON.stringify(t.request);return t.data&&(this.deduped.entries[r]={result:[null,t.data]}),this.deduped.request(r,{type:"parseTile",isSymbolTile:t.isSymbolTile,zoom:t.tileZoom},o=>{const c=Hn(t.request,(u,p,f,_)=>{u?o(u):p&&o(null,{vectorTile:i?void 0:new Du(new ph(p)),rawData:p,cacheControl:f,expires:_})});return()=>{c.cancel(),o()}},e)}const Cm=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Ku{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[i,r]=new Uint8Array(e,0,2);if(219!==i)throw new Error("Data does not appear to be in a KDBush format.");const o=r>>4;if(1!==o)throw new Error(`Got v${o} data when expected v1.`);const c=Cm[15&r];if(!c)throw new Error("Unrecognized array type.");const[u]=new Uint16Array(e,2,1),[p]=new Uint32Array(e,4,1);return new Ku(p,u,c,e)}constructor(e,i=64,r=Float64Array,o){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+i,2),65535),this.ArrayType=r,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const c=Cm.indexOf(this.ArrayType),u=2*e*this.ArrayType.BYTES_PER_ELEMENT,p=e*this.IndexArrayType.BYTES_PER_ELEMENT,f=(8-p%8)%8;if(c<0)throw new Error(`Unexpected typed array class: ${r}.`);o&&o instanceof ArrayBuffer?(this.data=o,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+p+f,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+u+p+f),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+p+f,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+c]),new Uint16Array(this.data,2,1)[0]=i,new Uint32Array(this.data,4,1)[0]=e)}add(e,i){const r=this._pos>>1;return this.ids[r]=r,this.coords[this._pos++]=e,this.coords[this._pos++]=i,r}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return Ju(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,i,r,o){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:c,coords:u,nodeSize:p}=this,f=[0,c.length-1,0],_=[];for(;f.length;){const x=f.pop()||0,w=f.pop()||0,E=f.pop()||0;if(w-E<=p){for(let V=E;V<=w;V++){const H=u[2*V],te=u[2*V+1];H>=e&&H<=r&&te>=i&&te<=o&&_.push(c[V])}continue}const C=E+w>>1,D=u[2*C],L=u[2*C+1];D>=e&&D<=r&&L>=i&&L<=o&&_.push(c[C]),(0===x?e<=D:i<=L)&&(f.push(E),f.push(C-1),f.push(1-x)),(0===x?r>=D:o>=L)&&(f.push(C+1),f.push(w),f.push(1-x))}return _}within(e,i,r){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:o,coords:c,nodeSize:u}=this,p=[0,o.length-1,0],f=[],_=r*r;for(;p.length;){const x=p.pop()||0,w=p.pop()||0,E=p.pop()||0;if(w-E<=u){for(let V=E;V<=w;V++)Dm(c[2*V],c[2*V+1],e,i)<=_&&f.push(o[V]);continue}const C=E+w>>1,D=c[2*C],L=c[2*C+1];Dm(D,L,e,i)<=_&&f.push(o[C]),(0===x?e-r<=D:i-r<=L)&&(p.push(E),p.push(C-1),p.push(1-x)),(0===x?e+r>=D:i+r>=L)&&(p.push(C+1),p.push(w),p.push(1-x))}return f}}function Ju(t,e,i,r,o,c){if(o-r<=i)return;const u=r+o>>1;Mm(t,e,u,r,o,c),Ju(t,e,i,r,u-1,1-c),Ju(t,e,i,u+1,o,1-c)}function Mm(t,e,i,r,o,c){for(;o>r;){if(o-r>600){const _=o-r+1,x=i-r+1,w=Math.log(_),E=.5*Math.exp(2*w/3),C=.5*Math.sqrt(w*E*(_-E)/_)*(x-_/2<0?-1:1);Mm(t,e,i,Math.max(r,Math.floor(i-x*E/_+C)),Math.min(o,Math.floor(i+(_-x)*E/_+C)),c)}const u=e[2*i+c];let p=r,f=o;for(ic(t,e,r,i),e[2*o+c]>u&&ic(t,e,r,o);p<f;){for(ic(t,e,p,f),p++,f--;e[2*p+c]<u;)p++;for(;e[2*f+c]>u;)f--}e[2*r+c]===u?ic(t,e,r,f):(f++,ic(t,e,f,o)),f<=i&&(r=f+1),i<=f&&(o=f-1)}}function ic(t,e,i,r){Qu(t,i,r),Qu(e,2*i,2*r),Qu(e,2*i+1,2*r+1)}function Qu(t,e,i){const r=t[e];t[e]=t[i],t[i]=r}function Dm(t,e,i,r){const o=t-i,c=e-r;return o*o+c*c}s.ARRAY_TYPE=rr,s.AUTH_ERR_MSG=re,s.Aabb=Dn,s.Actor=class{constructor(t,e,i){this.target=t,this.parent=e,this.mapId=i,this.callbacks={},this.cancelCallbacks={},hn(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=wn()?t:M,this.scheduler=new ng}send(t,e,i,r,o=!1,c){const u=Math.round(1e18*Math.random()).toString(36).substring(0,10);i&&(i.metadata=c,this.callbacks[u]=i);const p=Rn(this.globalScope)?void 0:[];return this.target.postMessage({id:u,type:t,hasCallback:!!i,targetMapId:r,mustQueue:o,sourceMapId:this.mapId,data:Fa(e,p)},p),{cancel:()=>{i&&delete this.callbacks[u],this.target.postMessage({id:u,type:"<cancel>",targetMapId:r,sourceMapId:this.mapId})}}}receive(t){const e=t.data,i=e.id;if(i&&(!e.targetMapId||this.mapId===e.targetMapId))if("<cancel>"===e.type){const r=this.cancelCallbacks[i];delete this.cancelCallbacks[i],r&&r.cancel()}else if(e.mustQueue||wn()){const r=this.callbacks[i];this.cancelCallbacks[i]=this.scheduler.add(()=>this.processTask(i,e),r&&r.metadata||{type:"message"})}else this.processTask(i,e)}processTask(t,e){if("<response>"===e.type){const i=this.callbacks[t];delete this.callbacks[t],i&&(e.error?i(pa(e.error)):i(null,pa(e.data)))}else{const i=Rn(this.globalScope)?void 0:[],r=e.hasCallback?(c,u)=>{delete this.cancelCallbacks[t],this.target.postMessage({id:t,type:"<response>",sourceMapId:this.mapId,error:c?Fa(c):null,data:Fa(u,i)},i)}:c=>{},o=pa(e.data);if(this.parent[e.type])this.parent[e.type](e.sourceMapId,o,r);else if(this.parent.getWorkerSource){const c=e.type.split(".");this.parent.getWorkerSource(e.sourceMapId,c[0],o.source)[c[1]](o,r)}else r(new Error(`Could not find function ${e.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},s.CanonicalTileID=ch,s.Color=Zi,s.ColorMode=na,s.CullFaceMode=qr,s.DEMData=Ah,s.DataConstantProperty=P,s.DedupedRequest=km,s.DepthMode=Ps,s.EXTENT=vt,s.Elevation=class{isDataAvailableAtPoint(t){const e=this._source();if(this.isUsingMockSource()||!e||t.y<0||t.y>1)return!1;const i=e.getSource().maxzoom,r=1<<i,o=Math.floor(t.x),c=Math.floor((t.x-o)*r),u=Math.floor(t.y*r),p=this.findDEMTileFor(new In(i,o,i,c,u));return!(!p||!p.dem)}getAtPointOrZero(t,e=0){return this.getAtPoint(t,e)||0}getAtPoint(t,e,i=!0){if(this.isUsingMockSource())return null;null==e&&(e=null);const r=this._source();if(!r||t.y<0||t.y>1)return e;const o=r.getSource().maxzoom,c=1<<o,u=Math.floor(t.x),p=t.x-u,f=new In(o,u,o,Math.floor(p*c),Math.floor(t.y*c)),_=this.findDEMTileFor(f);if(!_||!_.dem)return e;const x=_.dem,w=1<<_.tileID.canonical.z,E=(p*w-_.tileID.canonical.x)*x.dim,C=(t.y*w-_.tileID.canonical.y)*x.dim,D=Math.floor(E),L=Math.floor(C);return(i?this.exaggeration():1)*ei(ei(x.get(D,L),x.get(D,L+1),C-L),ei(x.get(D+1,L),x.get(D+1,L+1),C-L),E-D)}getAtTileOffset(t,e,i){const r=1<<t.canonical.z;return this.getAtPointOrZero(new ys(t.wrap+(t.canonical.x+e/vt)/r,(t.canonical.y+i/vt)/r))}getAtTileOffsetFunc(t,e,i,r){return o=>{const c=this.getAtTileOffset(t,o.x,o.y),u=r.upVector(t.canonical,o.x,o.y);return dr(u,u,c*r.upVectorScale(t.canonical,e,i).metersToTile),u}}getForTilePoints(t,e,i,r){if(this.isUsingMockSource())return!1;const o=Ch.create(this,t,r);return!!o&&(e.forEach(c=>{c[2]=this.exaggeration()*o.getElevationAt(c[0],c[1],i)}),!0)}getMinMaxForTile(t){if(this.isUsingMockSource())return null;const e=this.findDEMTileFor(t);if(!e||!e.dem)return null;const i=e.dem.tree,r=e.tileID,o=1<<t.canonical.z-r.canonical.z;let c=t.canonical.x/o-r.canonical.x,u=t.canonical.y/o-r.canonical.y,p=0;for(let f=0;f<t.canonical.z-r.canonical.z&&!i.leaves[p];f++){c*=2,u*=2;const _=2*Math.floor(u)+Math.floor(c);p=i.childOffsets[p]+_,c%=1,u%=1}return{min:this.exaggeration()*i.minimums[p],max:this.exaggeration()*i.maximums[p]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(t,e,i){throw new Error("Pure virtual method called.")}pointCoordinate(t){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(t){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},s.ErrorEvent=jn,s.EvaluationParameters=v,s.Event=cr,s.Evented=Mr,s.FillExtrusionBucket=Zl,s.Frustum=ou,s.FrustumCorners=au,s.GLOBE_RADIUS=Kr,s.GLOBE_SCALE_MATCH_LATITUDE=45,s.GLOBE_ZOOM_THRESHOLD_MAX=Md,s.GLOBE_ZOOM_THRESHOLD_MIN=su,s.GlobeSharedBuffers=class{constructor(t){this._createGrid(t),this._createPoles(t)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const t of this._poleSegments)t.destroy();for(const t of this._gridSegments)t.withSkirts.destroy(),t.withoutSkirts.destroy();if(this._wireframeIndexBuffer){this._wireframeIndexBuffer.destroy();for(const t of this._wireframeSegments)t.destroy()}}_fillGridMeshWithLods(t,e){const i=new qe,r=new pt,o=[],c=t+1+2,u=e[0]+1,p=e[0]+1+(1+e.length),f=(_,x,w)=>{let E=_===c-1?_-2:0===_?_:_-1;return E+=w?24575:0,[E,x]};for(let _=0;_<c;++_)i.emplaceBack(...f(_,0,!0));for(let _=0;_<u;++_)for(let x=0;x<c;++x)i.emplaceBack(...f(x,_,(0===x||x===c-1)&&!0));for(let _=0;_<e.length;++_){const x=e[_];for(let w=0;w<c;++w)i.emplaceBack(...f(w,x,!0))}for(let _=0;_<e.length;++_){const x=r.length,w=e[_]+1+2,E=new pt;for(let L=0;L<w-1;L++){const V=L===w-2,H=V?c*(p-e.length+_-L):c;for(let te=0;te<c-1;te++){const Y=L*c+te;0===L||V||0===te||te===c-2?(E.emplaceBack(Y+1,Y,Y+H),E.emplaceBack(Y+H,Y+H+1,Y+1)):(r.emplaceBack(Y+1,Y,Y+H),r.emplaceBack(Y+H,Y+H+1,Y+1))}}const C=Hi.simpleSegment(0,x,i.length,r.length-x);for(let L=0;L<E.uint16.length;L+=3)r.emplaceBack(E.uint16[L],E.uint16[L+1],E.uint16[L+2]);const D=Hi.simpleSegment(0,x,i.length,r.length-x);o.push({withoutSkirts:C,withSkirts:D})}return{vertices:i,indices:r,segments:o}}_createGrid(t){const e=this._fillGridMeshWithLods(64,zl);this._gridSegments=e.segments,this._gridBuffer=t.createVertexBuffer(e.vertices,Pl.members),this._gridIndexBuffer=t.createIndexBuffer(e.indices,!0)}_createPoles(t){const e=new pt;for(let o=0;o<=64;o++)e.emplaceBack(0,o+1,o+2);this._poleIndexBuffer=t.createIndexBuffer(e,!0);const i=new gi,r=new gi;this._poleSegments=[];for(let o=0,c=0;o<su;o++){const u=360/(1<<o);i.emplaceBack(0,-Kr,0,.5,0),r.emplaceBack(0,-Kr,0,.5,1);for(let p=0;p<=64;p++){const f=p/64,_=ei(0,u,f),[x,w,E]=fs(nf,rf,_,Kr);i.emplaceBack(x,w,E,f,0),r.emplaceBack(x,w,E,f,1)}this._poleSegments.push(Hi.simpleSegment(c,0,66,64)),c+=66}this._poleNorthVertexBuffer=t.createVertexBuffer(i,Ad,!1),this._poleSouthVertexBuffer=t.createVertexBuffer(r,Ad,!1)}getGridBuffers(t,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[t].withSkirts:this._gridSegments[t].withoutSkirts]}getPoleBuffers(t){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[t]]}getWirefameBuffers(t,e){if(!this._wireframeSegments){const i=new sn,r=64,o=r+1+2,c=1;this._wireframeSegments=[];for(let u=0,p=0;u<zl.length;u++){const f=zl[u];for(let x=c;x<f+c;x++)for(let w=c;w<r+c;w++){const E=x*o+w;i.emplaceBack(E,E+1),i.emplaceBack(E,E+o),i.emplaceBack(E,E+o+1)}const _=f*r*3;this._wireframeSegments.push(Hi.simpleSegment(0,p,(f+1)*o,_)),p+=_}this._wireframeIndexBuffer=t.createIndexBuffer(i)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments[e]]}},s.GlyphManager=Cs,s.ImagePosition=Lu,s.KDBush=Ku,s.LivePerformanceUtils=Ka,s.LngLat=xi,s.LngLatBounds=ja,s.LocalGlyphMode=Bu,s.MAX_MERCATOR_LATITUDE=vn,s.MercatorCoordinate=ys,s.ONE_EM=dn,s.OverscaledTileID=In,s.PerformanceMarkers=Vn,s.Point=Pe,s.Properties=J,s.RGBAImage=ar,s.Ray=ru,s.RequestManager=class{constructor(t,e,i){this._transformRequestFn=t,this._customAccessToken=e,this._silenceAuthErrors=!!i,this._createSkuToken()}_createSkuToken(){const t=function(){let e="";for(let i=0;i<10;i++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Jt,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,e){return this._transformRequestFn&&this._transformRequestFn(t,e)||{url:t}}normalizeStyleURL(t,e){if(!ue(t))return t;const i=Ke(t);return i.path=`/styles/v1${i.path}`,this._makeAPIURL(i,this._customAccessToken||e)}normalizeGlyphsURL(t,e){if(!ue(t))return t;const i=Ke(t);return i.path=`/fonts/v1${i.path}`,this._makeAPIURL(i,this._customAccessToken||e)}normalizeSourceURL(t,e,i,r){if(!ue(t))return t;const o=Ke(t);return o.path=`/v4/${o.authority}.json`,o.params.push("secure"),i&&o.params.push(`language=${i}`),r&&o.params.push(`worldview=${r}`),this._makeAPIURL(o,this._customAccessToken||e)}normalizeSpriteURL(t,e,i,r){const o=Ke(t);return ue(t)?(o.path=`/styles/v1${o.path}/sprite${e}${i}`,this._makeAPIURL(o,this._customAccessToken||r)):(o.path+=`${e}${i}`,je(o))}normalizeTileURL(t,e,i){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!ue(t))return t;const r=Ke(t);r.path=r.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${e||i&&"raster"!==r.authority&&512===i?"@2x":""}${dt.supported?".webp":"$1"}`),"raster"===r.authority?r.path=`/${Fe.RASTER_URL_PREFIX}${r.path}`:(r.path=r.path.replace(/^.+\/v4\//,"/"),r.path=`/${Fe.TILE_URL_VERSION}${r.path}`);const o=this._customAccessToken||function(c){for(const u of c){const p=u.match(/^access_token=(.*)$/);if(p)return p[1]}return null}(r.params)||Fe.ACCESS_TOKEN;return Fe.REQUIRE_ACCESS_TOKEN&&o&&this._skuToken&&r.params.push(`sku=${this._skuToken}`),this._makeAPIURL(r,o)}canonicalizeTileURL(t,e){const i=Ke(t);if(!i.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!i.path.match(/\.[\w]+$/))return t;let r="mapbox://";i.path.match(/^\/raster\/v1\//)?r+=`raster/${i.path.replace(`/${Fe.RASTER_URL_PREFIX}/`,"")}`:r+=`tiles/${i.path.replace(`/${Fe.TILE_URL_VERSION}/`,"")}`;let o=i.params;return e&&(o=o.filter(c=>!c.match(/^access_token=/))),o.length&&(r+=`?${o.join("&")}`),r}canonicalizeTileset(t,e){const i=!!e&&ue(e),r=[];for(const o of t.tiles||[])me(o)?r.push(this.canonicalizeTileURL(o,i)):r.push(o);return r}_makeAPIURL(t,e){const i="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",r=Ke(Fe.API_URL);if(t.protocol=r.protocol,t.authority=r.authority,"http"===t.protocol){const o=t.params.indexOf("secure");o>=0&&t.params.splice(o,1)}if("/"!==r.path&&(t.path=`${r.path}${t.path}`),!Fe.REQUIRE_ACCESS_TOKEN)return je(t);if(e=e||Fe.ACCESS_TOKEN,!this._silenceAuthErrors){if(!e)throw new Error(`An API access token is required to use Mapbox GL. ${i}`);if("s"===e[0])throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${i}`)}return t.params=t.params.filter(o=>-1===o.indexOf("access_token")),t.params.push(`access_token=${e||""}`),je(t)}},s.ResourceType=Wn,s.SegmentVector=Hi,s.SourceCache=Ro,s.StencilMode=Wu,s.StructArrayLayout1ui2=nr,s.StructArrayLayout2f1f2i16=Et,s.StructArrayLayout2i4=qe,s.StructArrayLayout2ui4=sn,s.StructArrayLayout3f12=qt,s.StructArrayLayout3ui6=pt,s.StructArrayLayout4i8=Le,s.StructArrayLayout5f20=gi,s.Texture=ec,s.Tile=qu,s.Transitionable=S,s.Uniform1f=$c,s.Uniform1i=class extends _a{constructor(t){super(t),this.current=0}set(t,e,i){this.fetchUniformLocation(t,e)&&this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}},s.Uniform2f=class extends _a{constructor(t){super(t),this.current=[0,0]}set(t,e,i){this.fetchUniformLocation(t,e)&&(i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1])))}},s.Uniform3f=class extends _a{constructor(t){super(t),this.current=[0,0,0]}set(t,e,i){this.fetchUniformLocation(t,e)&&(i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2])))}},s.Uniform4f=cd,s.UniformColor=hd,s.UniformMatrix2f=class extends _a{constructor(t){super(t),this.current=Vm}set(t,e,i){if(this.fetchUniformLocation(t,e))for(let r=0;r<4;r++)if(i[r]!==this.current[r]){this.current=i,this.gl.uniformMatrix2fv(this.location,!1,i);break}}},s.UniformMatrix3f=class extends _a{constructor(t){super(t),this.current=Um}set(t,e,i){if(this.fetchUniformLocation(t,e))for(let r=0;r<9;r++)if(i[r]!==this.current[r]){this.current=i,this.gl.uniformMatrix3fv(this.location,!1,i);break}}},s.UniformMatrix4f=class extends _a{constructor(t){super(t),this.current=Fm}set(t,e,i){if(this.fetchUniformLocation(t,e)){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let r=1;r<16;r++)if(i[r]!==this.current[r]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}}},s.UnwrappedTileID=_p,s.ValidationError=ot,s.VectorTileFeature=sh,s.VectorTileWorkerSource=class extends Mr{constructor(t,e,i,r,o){super(),this.actor=t,this.layerIndex=e,this.availableImages=i,this.loadVectorData=o||Am,this.loading={},this.loaded={},this.deduped=new km(t.scheduler),this.isSpriteLoaded=r,this.scheduler=t.scheduler}loadTile(t,e){const i=t.uid,r=t&&t.request,o=r&&r.collectResourceTiming,c=this.loading[i]=new hg(t);c.abort=this.loadVectorData(t,(u,p)=>{const f=!this.loading[i];if(delete this.loading[i],f||u||!p)return c.status="done",f||(this.loaded[i]=c),e(u);const _=p.rawData,x={};p.expires&&(x.expires=p.expires),p.cacheControl&&(x.cacheControl=p.cacheControl),c.vectorTile=p.vectorTile||new Du(new ph(_));const w=()=>{c.parse(c.vectorTile,this.layerIndex,this.availableImages,this.actor,(E,C)=>{if(E||!C)return e(E);const D={};if(o){const L=Ar(r);L.length>0&&(D.resourceTiming=JSON.parse(JSON.stringify(L)))}e(null,Mt({rawTileData:_.slice(0)},C,x,D))})};this.isSpriteLoaded?w():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(w,{type:"parseTile",isSymbolTile:t.isSymbolTile,zoom:t.tileZoom}):w()}),this.loaded=this.loaded||{},this.loaded[i]=c})}reloadTile(t,e){const i=this.loaded,r=t.uid,o=this;if(i&&i[r]){const c=i[r];c.showCollisionBoxes=t.showCollisionBoxes,c.enableTerrain=!!t.enableTerrain,c.projection=t.projection,c.tileTransform=Lo(t.tileID.canonical,t.projection);const u=(p,f)=>{const _=c.reloadCallback;_&&(delete c.reloadCallback,c.parse(c.vectorTile,o.layerIndex,this.availableImages,o.actor,_)),e(p,f)};"parsing"===c.status?c.reloadCallback=u:"done"===c.status&&(c.vectorTile?c.parse(c.vectorTile,this.layerIndex,this.availableImages,this.actor,u):u())}}abortTile(t,e){const i=t.uid,r=this.loading[i];r&&(r.abort&&r.abort(),delete this.loading[i]),e()}removeTile(t,e){const i=this.loaded,r=t.uid;i&&i[r]&&delete i[r],e()}},s.WritingMode=mr,s.ZoomDependentExpression=_o,s.add=ya,s.addDynamicAttributes=Th,s.adjoint=function(t,e){var i=e[0],r=e[1],o=e[2],c=e[3],u=e[4],p=e[5],f=e[6],_=e[7],x=e[8];return t[0]=u*x-p*_,t[1]=o*_-r*x,t[2]=r*p-o*u,t[3]=p*f-c*x,t[4]=i*x-o*f,t[5]=o*c-i*p,t[6]=c*_-u*f,t[7]=r*f-i*_,t[8]=i*u-r*c,t},s.asyncAll=jt,s.bezier=Ce,s.bindAll=hn,s.boundsAttributes=lm,s.bufferConvexPolygon=function(t,e){const i=[];for(let r=0;r<t.length;r++){const o=st(r-1,-1,t.length-1),c=st(r+1,-1,t.length-1),u=t[r],p=t[c],f=t[o].sub(u).unit(),_=p.sub(u).unit(),x=_.angleWithSep(f.x,f.y),w=f.add(_).unit().mult(-1*e/Math.sin(x/2));i.push(u.add(w))}return i},s.cacheEntryPossiblyAdded=function(t){$n++,$n>fr&&(t.getActor().send("enforceCacheSizeLimit",mn),$n=0)},s.calculateGlobeLabelMatrix=function(t,e){const{x:i,y:r}=t.point,o=zd(i,r,t.worldSize/t._pixelsPerMercatorPixel,0,0);return Ao(o,o,hu(Jr(e)))},s.calculateGlobeMatrix=function(t){const{x:e,y:i}=t.point,{lng:r,lat:o}=t._center;return zd(e,i,t.worldSize,r,o)},s.calculateGlobeMercatorMatrix=function(t){const e=t.pixelsPerMeter,i=e/jr(1,t.center.lat),r=Vr(new Float64Array(16));return Al(r,r,[t.point.x,t.point.y,0]),Co(r,r,[i,i,e]),Float32Array.from(r)},s.circumferenceAtLatitude=du,s.clamp=Ee,s.clearTileCache=function(t){if(!_r())return;const e=M.caches.delete(Li);t&&e.catch(t).then(()=>t())},s.clipLine=Gp,s.clone=function(t){var e=new rr(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},s.clone$1=Di,s.collisionCircleLayout=l_,s.config=Fe,s.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},s.create=function(){var t=new rr(16);return rr!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},s.create$1=pd,s.createExpression=Ra,s.createLayout=de,s.createStyleLayer=function(t){return"custom"===t.type?new Q_(t):new tg[t.type](t)},s.cross=nu,s.degToRad=De,s.distance=function(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1],e[2]-t[2])},s.div=function(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t[2]=e[2]/i[2],t},s.dot=wr,s.earthRadius=Ol,s.ease=Ue,s.easeCubicInOut=Je,s.ecefToLatLng=function([t,e,i]){const r=Math.hypot(t,e,i),o=Math.atan2(t,i),c=.5*Math.PI-Math.acos(-e/r);return new xi(at(o),at(c))},s.emitValidationErrors=Vc,s.endsWith=$t,s.enforceCacheSizeLimit=function(t){Bn(),fn&&fn.then(e=>{e.keys().then(i=>{for(let r=0;r<i.length-t;r++)e.delete(i[r])})})},s.evaluateSizeForFeature=uh,s.evaluateSizeForZoom=Ts,s.evaluateVariableOffset=Yp,s.evented=d,s.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},s.exactEquals$1=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]},s.exported=Xn,s.exported$1=dt,s.extend=Mt,s.extend$1=Kn,s.fillExtrusionHeightLift=pp,s.filterObject=en,s.fromMat4=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},s.fromQuat=function(t,e){var i=e[0],r=e[1],o=e[2],c=e[3],u=i+i,p=r+r,f=o+o,_=i*u,x=r*u,w=r*p,E=o*u,C=o*p,D=o*f,L=c*u,V=c*p,H=c*f;return t[0]=1-w-D,t[1]=x+H,t[2]=E-V,t[3]=0,t[4]=x-H,t[5]=1-_-D,t[6]=C+L,t[7]=0,t[8]=E+V,t[9]=C-L,t[10]=1-_-w,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},s.fromRotation=function(t,e){var i=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=i,t[2]=0,t[3]=-i,t[4]=r,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},s.fromScaling=fd,s.furthestTileCorner=function(t){const e=Math.round((t+45+360)%360/90)%4;return Ie[e]},s.getAABBPointSquareDist=function(t,e,i){let r=0;for(let o=0;o<2;++o){const c=i?i[o]:0;t[o]>c&&(r+=(t[o]-c)*(t[o]-c)),e[o]<c&&(r+=(c-e[o])*(c-e[o]))}return r},s.getAnchorAlignment=Ou,s.getAnchorJustification=Uu,s.getBounds=function(t){let e=1/0,i=1/0,r=-1/0,o=-1/0;for(const c of t)e=Math.min(e,c.x),i=Math.min(i,c.y),r=Math.max(r,c.x),o=Math.max(o,c.y);return{min:new Pe(e,i),max:new Pe(r,o)}},s.getColumn=On,s.getDefaultExportFromCjs=Xt,s.getGridMatrix=function(t,e,i,r){const o=e.getNorth(),c=e.getSouth(),u=e.getWest(),p=e.getEast(),f=1<<t.z,_=p-u,x=o-c,w=_/64,E=-x/zl[i],C=[0,w,0,E,0,0,o,u,0];if(t.z>0){const D=180/r;md(C,C,[D/_+1,0,0,0,D/x+1,0,-.5*D/w,.5*D/E,1])}return C[2]=f,C[5]=t.x,C[8]=t.y,C},s.getImage=K,s.getJSON=function(t,e){return Un(Mt(t,{type:"json"}),e)},s.getLatitudinalLod=function(t){const e=vn-5;t=Ee(t,-e,e)/e*90;const i=Math.pow(Math.abs(Math.sin(De(t))),3);return Math.round(i*(zl.length-1))},s.getMapSessionAPI=Ri,s.getPerformanceMeasurement=Ar,s.getProjection=nm,s.getRTLTextPluginStatus=m,s.getReferrer=Fn,s.getTilePoint=function(t,{x:e,y:i},r=0){return new Pe(((e-r)*t.scale-t.x)*vt,(i*t.scale-t.y)*vt)},s.getTileVec3=function(t,e,i=0){return ms(((e.x-i)*t.scale-t.x)*vt,(e.y*t.scale-t.y)*vt,Bd(e.z,e.y))},s.getVideo=function(t,e){const i=M.document.createElement("video");i.muted=!0,i.onloadstart=function(){e(null,i)};for(let r=0;r<t.length;r++){const o=M.document.createElement("source");$i(t[r])||(i.crossOrigin="Anonymous"),o.src=t[r],i.appendChild(o)}return{cancel:()=>{}}},s.globeCenterToScreenPoint=function(t){const e=[0,0,0],i=Vr(new Float64Array(16));return Ao(i,t.pixelMatrix,t.globeMatrix),Gi(e,e,i),new Pe(e[0],e[1])},s.globeDenormalizeECEF=hu,s.globeECEFOrigin=function(t,e){const i=[0,0,0];return Gi(i,i,Rl(Jr(e.canonical))),Gi(i,i,t),i},s.globeMetersToEcef=Yc,s.globeNormalizeECEF=Rl,s.globePixelsToTileUnits=function(t,e){return vt/(512*Math.pow(2,t))*Kc(Jr(e))},s.globePoleMatrixForTile=function(t,e,i){const r=Vr(new Float64Array(16)),o=(e/(1<<t)-.5)*Math.PI*2;return Hc(r,i.globeMatrix,o),Float32Array.from(r)},s.globeTileBounds=Jr,s.globeTiltAtLngLat=Ld,s.globeToMercatorTransition=gs,s.globeUseCustomAntiAliasing=function(t,e,i){const r=gs(i.zoom),o=t.style.map._antialias,c=!!e.extStandardDerivatives,u=e.extStandardDerivativesForceOff||t.terrain&&t.terrain.exaggeration()>0;return 0===r&&!o&&!u&&c},s.identity=Vr,s.identity$1=Td,s.invert=Qh,s.isFullscreen=function(){return!!M.document.fullscreenElement||!!M.document.webkitFullscreenElement},s.isLngLatBehindGlobe=uu,s.isMapAuthenticated=function(t){return Bi.has(t)},s.isMapboxURL=ue,s.isSafariWithAntialiasingBug=function(t){const e=t.navigator?t.navigator.userAgent:null;return!!Rn(t)&&e&&(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},s.latFromMercatorY=xn,s.latLngToECEF=_s,s.len=Ym,s.length=Cl,s.length$1=function(t){return Math.hypot(t[0],t[1],t[2],t[3])},s.lngFromMercatorX=pr,s.loadVectorTile=Am,s.makeRequest=Un,s.mapValue=function(t,e,i,r,o){return Ee((t-e)/(i-e)*(o-r)+r,r,o)},s.mercatorScale=Fd,s.mercatorXfromLng=Qr,s.mercatorYfromLat=ea,s.mercatorZfromAltitude=jr,s.mul=Wm,s.mul$1=Hm,s.multiply=Ao,s.multiply$1=md,s.multiply$2=yd,s.nextPowerOfTwo=ji,s.normalize=Mn,s.normalize$1=Xm,s.normalize$2=bd,s.number=ei,s.ortho=function(t,e,i,r,o,c,u){var p=1/(e-i),f=1/(r-o),_=1/(c-u);return t[0]=-2*p,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*f,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*_,t[11]=0,t[12]=(e+i)*p,t[13]=(o+r)*f,t[14]=(u+c)*_,t[15]=1,t},s.pbf=Tp,s.perspective=function(t,e,i,r,o){var c,u=1/Math.tan(e/2);return t[0]=u/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=o&&o!==1/0?(t[10]=(o+r)*(c=1/(r-o)),t[14]=2*o*r*c):(t[10]=-1,t[14]=-2*r),t},s.pick=function(t,e){const i={};for(let r=0;r<e.length;r++){const o=e[r];o in t&&(i[o]=t[o])}return i},s.plugin=y,s.pointGeometry=Tt,s.polesInViewport=function(t){const e=Vr(new Float64Array(16));Ao(e,t.pixelMatrix,t.globeMatrix);const i=[0,Tr,0],r=[0,Er,0];return Gi(i,i,e),Gi(r,r,e),[i[0]>0&&i[0]<=t.width&&i[1]>0&&i[1]<=t.height&&!uu(t,new xi(t.center.lat,90)),r[0]>0&&r[0]<=t.width&&r[1]>0&&r[1]<=t.height&&!uu(t,new xi(t.center.lat,-90))]},s.polygonContainsPoint=Po,s.polygonIntersectsBox=qd,s.polygonIntersectsPolygon=Nd,s.polygonizeBounds=function(t,e,i=0,r=!0){const o=new Pe(i,i),c=t.sub(o),u=e.add(o),p=[c,new Pe(u.x,c.y),u,new Pe(c.x,u.y)];return r&&p.push(c.clone()),p},s.posAttributes=Pl,s.postMapLoadEvent=pi,s.postPerformanceEvent=ci,s.postTurnstileEvent=Zt,s.potpack=zu,s.prevPowerOfTwo=function(t){return t<=1?1:Math.pow(2,Math.floor(Math.log(t)/Math.LN2))},s.radToDeg=at,s.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],s.registerForPluginStateChange=function(t){return t({pluginStatus:l,pluginURL:n}),d.on("pluginStateChange",t),t},s.removeAuthState=function(t){Bi.delete(t)},s.renderColorRamp=vu,s.resample=Ud,s.rotateX=eu,s.rotateX$1=Ed,s.rotateY=Hc,s.rotateY$1=kd,s.rotateZ=function(t,e,i){var r=Math.sin(i),o=Math.cos(i),c=e[0],u=e[1],p=e[2],f=e[3],_=e[4],x=e[5],w=e[6],E=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=c*o+_*r,t[1]=u*o+x*r,t[2]=p*o+w*r,t[3]=f*o+E*r,t[4]=_*o-c*r,t[5]=x*o-u*r,t[6]=w*o-p*r,t[7]=E*o-f*r,t},s.rotateZ$1=function(t,e,i){i*=.5;var r=e[0],o=e[1],c=e[2],u=e[3],p=Math.sin(i),f=Math.cos(i);return t[0]=r*f+o*p,t[1]=o*f-r*p,t[2]=c*f+u*p,t[3]=u*f-c*p,t},s.scale=Co,s.scale$1=vd,s.scale$2=dr,s.scaleAndAdd=Il,s.set=function(t,e,i,r){return t[0]=e,t[1]=i,t[2]=r,t},s.setCacheLimits=function(t,e){mn=t,fr=e},s.setColumn=function(t,e,i){t[4*e+0]=i[0],t[4*e+1]=i[1],t[4*e+2]=i[2],t[4*e+3]=i[3]},s.setRTLTextPlugin=function(t,e,i=!1){if(l===bl||l===wl||l===Tl)throw new Error("setRTLTextPlugin cannot be called multiple times.");n=Xn.resolveURL(t),l=bl,Ua=e,h(),i||g()},s.smoothstep=Me,s.spec=ke,s.squaredLength=function(t){var e=t[0],i=t[1],r=t[2];return e*e+i*i+r*r},s.storeAuthState=function(t,e){e?Bi.add(t):Bi.delete(t)},s.sub=Nr,s.subtract=iu,s.symbolSize=c_,s.tileAABB=function(t,e,i,r,o,c,u,p,f){if("globe"===f.name)return function tf(t,e,i){const r=e/t.worldSize,o=t.globeMatrix;if(i.z<=1){const ge=Jr(i).getCorners();return Sd(ge,o,r),Dn.fromPoints(ge)}const c=Xc(i),u=cu(c);Sd(u,o,r);const p=Number.MAX_VALUE,f=[-p,-p,-p],_=[p,p,p];if(c.contains(t.center)){for(const $e of u)Ml(_,_,$e),Dl(f,f,$e);f[2]=0;const ge=t.point,Se=[ge.x*r,ge.y*r,0];return Ml(_,_,Se),Dl(f,f,Se),new Dn(_,f)}const x=[o[12]*r,o[13]*r,o[14]*r],w=c.getCenter(),E=Ee(t.center.lat,-vn,vn),C=Ee(w.lat,-vn,vn),D=Qr(t.center.lng),L=ea(E);let V=D-Qr(w.lng);const H=L-ea(C);V>.5?V-=1:V<-.5&&(V+=1);let te=0;Math.abs(V)>Math.abs(H)?te=V>=0?1:3:(te=H>=0?0:2,Il(x,x,[o[4]*r,o[5]*r,o[6]*r],-Math.sin(De(H>=0?c.getSouth():c.getNorth()))*Kr));const Y=u[te],ee=u[(te+1)%4],ae=new ef(Y,ee,x),ne=[lu(ae,0)||Y[0],lu(ae,1)||Y[1],lu(ae,2)||Y[2]],be=gs(t.zoom);if(be>0){const ge=function({x:$e,y:Te,z:Re},Oe,Ve,Ye,Ae){const et=1/(1<<Re);let ut=$e*et,tt=ut+et,Lt=Te*et,Xe=Lt+et,xt=0;const Rt=(ut+tt)/2-Ye;return Rt>.5?xt=-1:Rt<-.5&&(xt=1),ut=((ut+xt)*Oe-(Ye*=Oe))*Ve+Ye,tt=((tt+xt)*Oe-Ye)*Ve+Ye,Lt=(Lt*Oe-(Ae*=Oe))*Ve+Ae,Xe=(Xe*Oe-Ae)*Ve+Ae,[[ut,Xe,0],[tt,Xe,0],[tt,Lt,0],[ut,Lt,0]]}(i,e,t._pixelsPerMercatorPixel,D,L);for(let $e=0;$e<u.length;$e++)Io(u[$e],ge[$e],be);const Se=ya([],ge[te],ge[(te+1)%4]);dr(Se,Se,.5),Io(ne,Se,be)}for(const ge of u)Ml(_,_,ge),Dl(f,f,ge);return _[2]=Math.min(Y[2],ee[2]),Ml(_,_,ne),Dl(f,f,ne),new Dn(_,f)}(t,e,new ch(i,r,o));const _=Lo({z:i,x:r,y:o},f);return new Dn([(c+_.x/_.scale)*e,e*(_.y/_.scale),u],[(c+_.x2/_.scale)*e,e*(_.y2/_.scale),p])},s.tileCornersToBounds=Xc,s.tileTransform=Lo,s.transformMat3=function(t,e,i){var r=e[0],o=e[1],c=e[2];return t[0]=r*i[0]+o*i[3]+c*i[6],t[1]=r*i[1]+o*i[4]+c*i[7],t[2]=r*i[2]+o*i[5]+c*i[8],t},s.transformMat4=Gi,s.transformMat4$1=Mo,s.transformQuat=xd,s.transitionTileAABBinECEF=Id,s.translate=Al,s.transpose=function(t,e){if(t===e){var i=e[1],r=e[2],o=e[5];t[1]=e[3],t[2]=e[6],t[3]=i,t[5]=e[7],t[6]=r,t[7]=o}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t},s.triggerPluginCompletionEvent=a,s.uniqueId=Qt,s.updateGlobeVertexNormal=function(t,e,i,r,o){const c=5*e+2;t.float32[c+0]=i,t.float32[c+1]=r,t.float32[c+2]=o},s.validateCustomStyleLayer=function(t){const e=[],i=t.id;return void 0===i&&e.push({message:`layers.${i}: missing required property "id"`}),void 0===t.render&&e.push({message:`layers.${i}: missing required method "render"`}),t.renderingMode&&"2d"!==t.renderingMode&&"3d"!==t.renderingMode&&e.push({message:`layers.${i}: property "renderingMode" must be either "2d" or "3d"`}),e},s.validateFilter=t=>ir(bo(t)),s.validateFog=t=>ir(Bc(t)),s.validateLayer=t=>ir(zc(t)),s.validateLight=t=>ir(Oc(t)),s.validateSource=t=>ir(Rc(t)),s.validateStyle=Uc,s.validateTerrain=t=>ir(_l(t)),s.values=Pt,s.vectorTile=oh,s.version=wt,s.warnOnce=ii,s.window=M,s.wrap=st}),mt(0,function(s){function M(Q){if("number"==typeof Q||"boolean"==typeof Q||"string"==typeof Q||null==Q)return JSON.stringify(Q);if(Array.isArray(Q)){let B="[";for(const K of Q)B+=`${M(K)},`;return`${B}]`}let O="{";for(const B of Object.keys(Q).sort())O+=`${B}:${M(Q[B])},`;return`${O}}`}function wt(Q){let O="";for(const B of s.refProperties)O+=`/${M(Q[B])}`;return O}class nt{constructor(O){this.keyCache={},O&&this.replace(O)}replace(O){this._layerConfigs={},this._layers={},this.update(O,[])}update(O,B){for(const re of O)this._layerConfigs[re.id]=re,(this._layers[re.id]=s.createStyleLayer(re)).compileFilter(),this.keyCache[re.id]&&delete this.keyCache[re.id];for(const re of B)delete this.keyCache[re],delete this._layerConfigs[re],delete this._layers[re];this.familiesBySource={};const K=function(re,ue){const me={};for(let he=0;he<re.length;he++){const xe=ue&&ue[re[he].id]||wt(re[he]);ue&&(ue[re[he].id]=xe);let Ge=me[xe];Ge||(Ge=me[xe]=[]),Ge.push(re[he])}const fe=[];for(const he in me)fe.push(me[he]);return fe}(s.values(this._layerConfigs),this.keyCache);for(const re of K){const ue=re.map(Ke=>this._layers[Ke.id]),me=ue[0];if("none"===me.visibility)continue;const fe=me.source||"";let he=this.familiesBySource[fe];he||(he=this.familiesBySource[fe]={});const xe=me.sourceLayer||"_geojsonTileLayer";let Ge=he[xe];Ge||(Ge=he[xe]=[]),Ge.push(ue)}}}class Fe{loadTile(O,B){const{uid:K,encoding:re,rawImageData:ue,padding:me,buildQuadTree:fe}=O,he=s.window.ImageBitmap&&ue instanceof s.window.ImageBitmap?this.getImageData(ue,me):ue;B(null,new s.DEMData(K,he,re,me<1,fe))}getImageData(O,B){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(O.width,O.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=O.width,this.offscreenCanvas.height=O.height,this.offscreenCanvasContext.drawImage(O,0,0,O.width,O.height);const K=this.offscreenCanvasContext.getImageData(-B,-B,O.width+2*B,O.height+2*B);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),K}}function dt(Q,O){if(0!==Q.length){zt(Q[0],O);for(var B=1;B<Q.length;B++)zt(Q[B],!O)}}function zt(Q,O){for(var B=0,K=0,re=0,ue=Q.length,me=ue-1;re<ue;me=re++){var fe=(Q[re][0]-Q[me][0])*(Q[me][1]+Q[re][1]),he=B+fe;K+=Math.abs(B)>=Math.abs(fe)?B-he+fe:fe-he+B,B=he}B+K>=0!=!!O&&Q.reverse()}var Ht=s.getDefaultExportFromCjs(function Q(O,B){var K,re=O&&O.type;if("FeatureCollection"===re)for(K=0;K<O.features.length;K++)Q(O.features[K],B);else if("GeometryCollection"===re)for(K=0;K<O.geometries.length;K++)Q(O.geometries[K],B);else if("Feature"===re)Q(O.geometry,B);else if("Polygon"===re)dt(O.coordinates,B);else if("MultiPolygon"===re)for(K=0;K<O.coordinates.length;K++)dt(O.coordinates[K],B);return O});const ti=s.VectorTileFeature.prototype.toGeoJSON;var lt={exports:{}},Bt=s.pointGeometry,Jt=s.vectorTile.VectorTileFeature,Xt=ft;function ft(Q,O){this.options=O||{},this.features=Q,this.length=Q.length}function bt(Q,O){this.id="number"==typeof Q.id?Q.id:void 0,this.type=Q.type,this.rawGeometry=1===Q.type?[Q.geometry]:Q.geometry,this.properties=Q.tags,this.extent=O||4096}ft.prototype.feature=function(Q){return new bt(this.features[Q],this.options.extent)},bt.prototype.loadGeometry=function(){var Q=this.rawGeometry;this.geometry=[];for(var O=0;O<Q.length;O++){for(var B=Q[O],K=[],re=0;re<B.length;re++)K.push(new Bt(B[re][0],B[re][1]));this.geometry.push(K)}return this.geometry},bt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Q=this.geometry,O=1/0,B=-1/0,K=1/0,re=-1/0,ue=0;ue<Q.length;ue++)for(var me=Q[ue],fe=0;fe<me.length;fe++){var he=me[fe];O=Math.min(O,he.x),B=Math.max(B,he.x),K=Math.min(K,he.y),re=Math.max(re,he.y)}return[O,K,B,re]},bt.prototype.toGeoJSON=Jt.prototype.toGeoJSON;var Gt=s.pbf,Tt=Xt;function Qe(Q){var O=new Gt;return function(B,K){for(var re in B.layers)K.writeMessage(3,Pe,B.layers[re])}(Q,O),O.finish()}function Pe(Q,O){var B;O.writeVarintField(15,Q.version||1),O.writeStringField(1,Q.name||""),O.writeVarintField(5,Q.extent||4096);var K={keys:[],values:[],keycache:{},valuecache:{}};for(B=0;B<Q.length;B++)K.feature=Q.feature(B),O.writeMessage(2,ui,K);var re=K.keys;for(B=0;B<re.length;B++)O.writeStringField(3,re[B]);var ue=K.values;for(B=0;B<ue.length;B++)O.writeMessage(4,Je,ue[B])}function ui(Q,O){var B=Q.feature;void 0!==B.id&&O.writeVarintField(1,B.id),O.writeMessage(2,rt,Q),O.writeVarintField(3,B.type),O.writeMessage(4,Ie,B)}function rt(Q,O){var B=Q.feature,K=Q.keys,re=Q.values,ue=Q.keycache,me=Q.valuecache;for(var fe in B.properties){var he=B.properties[fe],xe=ue[fe];if(null!==he){void 0===xe&&(K.push(fe),ue[fe]=xe=K.length-1),O.writeVarint(xe);var Ge=typeof he;"string"!==Ge&&"boolean"!==Ge&&"number"!==Ge&&(he=JSON.stringify(he));var Ke=Ge+":"+he,je=me[Ke];void 0===je&&(re.push(he),me[Ke]=je=re.length-1),O.writeVarint(je)}}}function De(Q,O){return(O<<3)+(7&Q)}function at(Q){return Q<<1^Q>>31}function Ie(Q,O){for(var B=Q.loadGeometry(),K=Q.type,re=0,ue=0,me=B.length,fe=0;fe<me;fe++){var he=B[fe],xe=1;1===K&&(xe=he.length),O.writeVarint(De(1,xe));for(var Ge=3===K?he.length-1:he.length,Ke=0;Ke<Ge;Ke++){1===Ke&&1!==K&&O.writeVarint(De(2,Ge-1));var je=he[Ke].x-re,Ct=he[Ke].y-ue;O.writeVarint(at(je)),O.writeVarint(at(Ct)),re+=je,ue+=Ct}3===K&&O.writeVarint(De(7,1))}}function Je(Q,O){var B=typeof Q;"string"===B?O.writeStringField(1,Q):"boolean"===B?O.writeBooleanField(7,Q):"number"===B&&(Q%1!=0?O.writeDoubleField(3,Q):Q<0?O.writeSVarintField(6,Q):O.writeVarintField(5,Q))}lt.exports=Qe,lt.exports.fromVectorTileJs=Qe,lt.exports.fromGeojsonVt=function(Q,O){O=O||{};var B={};for(var K in Q)B[K]=new Tt(Q[K].features,O),B[K].name=K,B[K].version=O.version,B[K].extent=O.extent;return Qe({layers:B})},lt.exports.GeoJSONWrapper=Tt;var Ce=s.getDefaultExportFromCjs(lt.exports);const Ue={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Q=>Q},Ee=Math.fround||(Me=new Float32Array(1),Q=>(Me[0]=+Q,Me[0]));var Me;const st=3,jt=5,Pt=6;class Mt{constructor(O){this.options=Object.assign(Object.create(Ue),O),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(O){const{log:B,minZoom:K,maxZoom:re}=this.options;B&&console.time("total time");const ue=`prepare ${O.length} points`;B&&console.time(ue),this.points=O;const me=[];for(let he=0;he<O.length;he++){const xe=O[he];if(!xe.geometry)continue;const[Ge,Ke]=xe.geometry.coordinates,je=Ee(zi(Ge)),Ct=Ee(ji(Ke));me.push(je,Ct,1/0,he,-1,1),this.options.reduce&&me.push(0)}let fe=this.trees[re+1]=this._createTree(me);B&&console.timeEnd(ue);for(let he=re;he>=K;he--){const xe=+Date.now();fe=this.trees[he]=this._createTree(this._cluster(fe,he)),B&&console.log("z%d: %d clusters in %dms",he,fe.numItems,+Date.now()-xe)}return B&&console.timeEnd("total time"),this}getClusters(O,B){let K=((O[0]+180)%360+360)%360-180;const re=Math.max(-90,Math.min(90,O[1]));let ue=180===O[2]?180:((O[2]+180)%360+360)%360-180;const me=Math.max(-90,Math.min(90,O[3]));if(O[2]-O[0]>=360)K=-180,ue=180;else if(K>ue){const Ke=this.getClusters([K,re,180,me],B),je=this.getClusters([-180,re,ue,me],B);return Ke.concat(je)}const fe=this.trees[this._limitZoom(B)],he=fe.range(zi(K),ji(me),zi(ue),ji(re)),xe=fe.data,Ge=[];for(const Ke of he){const je=this.stride*Ke;Ge.push(xe[je+jt]>1?Dt(xe,je,this.clusterProps):this.points[xe[je+st]])}return Ge}getChildren(O){const B=this._getOriginId(O),K=this._getOriginZoom(O),re="No cluster with the specified id.",ue=this.trees[K];if(!ue)throw new Error(re);const me=ue.data;if(B*this.stride>=me.length)throw new Error(re);const fe=this.options.radius/(this.options.extent*Math.pow(2,K-1)),he=ue.within(me[B*this.stride],me[B*this.stride+1],fe),xe=[];for(const Ge of he){const Ke=Ge*this.stride;me[Ke+4]===O&&xe.push(me[Ke+jt]>1?Dt(me,Ke,this.clusterProps):this.points[me[Ke+st]])}if(0===xe.length)throw new Error(re);return xe}getLeaves(O,B,K){const re=[];return this._appendLeaves(re,O,B=B||10,K=K||0,0),re}getTile(O,B,K){const re=this.trees[this._limitZoom(O)],ue=Math.pow(2,O),{extent:me,radius:fe}=this.options,he=fe/me,xe=(K-he)/ue,Ge=(K+1+he)/ue,Ke={features:[]};return this._addTileFeatures(re.range((B-he)/ue,xe,(B+1+he)/ue,Ge),re.data,B,K,ue,Ke),0===B&&this._addTileFeatures(re.range(1-he/ue,xe,1,Ge),re.data,ue,K,ue,Ke),B===ue-1&&this._addTileFeatures(re.range(0,xe,he/ue,Ge),re.data,-1,K,ue,Ke),Ke.features.length?Ke:null}getClusterExpansionZoom(O){let B=this._getOriginZoom(O)-1;for(;B<=this.options.maxZoom;){const K=this.getChildren(O);if(B++,1!==K.length)break;O=K[0].properties.cluster_id}return B}_appendLeaves(O,B,K,re,ue){const me=this.getChildren(B);for(const fe of me){const he=fe.properties;if(he&&he.cluster?ue+he.point_count<=re?ue+=he.point_count:ue=this._appendLeaves(O,he.cluster_id,K,re,ue):ue<re?ue++:O.push(fe),O.length===K)break}return ue}_createTree(O){const B=new s.KDBush(O.length/this.stride|0,this.options.nodeSize,Float32Array);for(let K=0;K<O.length;K+=this.stride)B.add(O[K],O[K+1]);return B.finish(),B.data=O,B}_addTileFeatures(O,B,K,re,ue,me){for(const fe of O){const he=fe*this.stride,xe=B[he+jt]>1;let Ge,Ke,je;if(xe)Ge=Qt(B,he,this.clusterProps),Ke=B[he],je=B[he+1];else{const It=this.points[B[he+st]];Ge=It.properties;const[Ut,Zt]=It.geometry.coordinates;Ke=zi(Ut),je=ji(Zt)}const Ct={type:1,geometry:[[Math.round(this.options.extent*(Ke*ue-K)),Math.round(this.options.extent*(je*ue-re))]],tags:Ge};let Ft;Ft=xe||this.options.generateId?B[he+st]:this.points[B[he+st]].id,void 0!==Ft&&(Ct.id=Ft),me.features.push(Ct)}}_limitZoom(O){return Math.max(this.options.minZoom,Math.min(Math.floor(+O),this.options.maxZoom+1))}_cluster(O,B){const{radius:K,extent:re,reduce:ue,minPoints:me}=this.options,fe=K/(re*Math.pow(2,B)),he=O.data,xe=[],Ge=this.stride;for(let Ke=0;Ke<he.length;Ke+=Ge){if(he[Ke+2]<=B)continue;he[Ke+2]=B;const je=he[Ke],Ct=he[Ke+1],Ft=O.within(he[Ke],he[Ke+1],fe),It=he[Ke+jt];let Ut=It;for(const Zt of Ft){const di=Zt*Ge;he[di+2]>B&&(Ut+=he[di+jt])}if(Ut>It&&Ut>=me){let Zt,di=je*It,pi=Ct*It,nn=-1;const ci=((Ke/Ge|0)<<5)+(B+1)+this.points.length;for(const an of Ft){const Ri=an*Ge;if(he[Ri+2]<=B)continue;he[Ri+2]=B;const Bi=he[Ri+jt];di+=he[Ri]*Bi,pi+=he[Ri+1]*Bi,he[Ri+4]=ci,ue&&(Zt||(Zt=this._map(he,Ke,!0),nn=this.clusterProps.length,this.clusterProps.push(Zt)),ue(Zt,this._map(he,Ri)))}he[Ke+4]=ci,xe.push(di/Ut,pi/Ut,1/0,ci,-1,Ut),ue&&xe.push(nn)}else{for(let Zt=0;Zt<Ge;Zt++)xe.push(he[Ke+Zt]);if(Ut>1)for(const Zt of Ft){const di=Zt*Ge;if(!(he[di+2]<=B)){he[di+2]=B;for(let pi=0;pi<Ge;pi++)xe.push(he[di+pi])}}}}return xe}_getOriginId(O){return O-this.points.length>>5}_getOriginZoom(O){return(O-this.points.length)%32}_map(O,B,K){if(O[B+jt]>1){const me=this.clusterProps[O[B+Pt]];return K?Object.assign({},me):me}const re=this.points[O[B+st]].properties,ue=this.options.map(re);return K&&ue===re?Object.assign({},ue):ue}}function Dt(Q,O,B){return{type:"Feature",id:Q[O+st],properties:Qt(Q,O,B),geometry:{type:"Point",coordinates:[(K=Q[O],360*(K-.5)),Ln(Q[O+1])]}};var K}function Qt(Q,O,B){const K=Q[O+jt],re=K>=1e4?`${Math.round(K/1e3)}k`:K>=1e3?Math.round(K/100)/10+"k":K,ue=Q[O+Pt],me=-1===ue?{}:Object.assign({},B[ue]);return Object.assign(me,{cluster:!0,cluster_id:Q[O+st],point_count:K,point_count_abbreviated:re})}function zi(Q){return Q/360+.5}function ji(Q){const O=Math.sin(Q*Math.PI/180),B=.5-.25*Math.log((1+O)/(1-O))/Math.PI;return B<0?0:B>1?1:B}function Ln(Q){const O=(180-360*Q)*Math.PI/180;return 360*Math.atan(Math.exp(O))/Math.PI-90}function hn(Q,O,B,K){for(var re,ue=K,me=B-O>>1,fe=B-O,he=Q[O],xe=Q[O+1],Ge=Q[B],Ke=Q[B+1],je=O+3;je<B;je+=3){var Ct=$t(Q[je],Q[je+1],he,xe,Ge,Ke);if(Ct>ue)re=je,ue=Ct;else if(Ct===ue){var Ft=Math.abs(je-me);Ft<fe&&(re=je,fe=Ft)}}ue>K&&(re-O>3&&hn(Q,O,re,K),Q[re+2]=ue,B-re>3&&hn(Q,re,B,K))}function $t(Q,O,B,K,re,ue){var me=re-B,fe=ue-K;if(0!==me||0!==fe){var he=((Q-B)*me+(O-K)*fe)/(me*me+fe*fe);he>1?(B=re,K=ue):he>0&&(B+=me*he,K+=fe*he)}return(me=Q-B)*me+(fe=O-K)*fe}function yt(Q,O,B,K){var re={id:void 0===Q?null:Q,type:O,geometry:B,tags:K,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(ue){var me=ue.geometry,fe=ue.type;if("Point"===fe||"MultiPoint"===fe||"LineString"===fe)en(ue,me);else if("Polygon"===fe||"MultiLineString"===fe)for(var he=0;he<me.length;he++)en(ue,me[he]);else if("MultiPolygon"===fe)for(he=0;he<me.length;he++)for(var xe=0;xe<me[he].length;xe++)en(ue,me[he][xe])}(re),re}function en(Q,O){for(var B=0;B<O.length;B+=3)Q.minX=Math.min(Q.minX,O[B]),Q.minY=Math.min(Q.minY,O[B+1]),Q.maxX=Math.max(Q.maxX,O[B]),Q.maxY=Math.max(Q.maxY,O[B+1])}function Di(Q,O,B,K){if(O.geometry){var re=O.geometry.coordinates,ue=O.geometry.type,me=Math.pow(B.tolerance/((1<<B.maxZoom)*B.extent),2),fe=[],he=O.id;if(B.promoteId?he=O.properties[B.promoteId]:B.generateId&&(he=K||0),"Point"===ue)lr(re,fe);else if("MultiPoint"===ue)for(var xe=0;xe<re.length;xe++)lr(re[xe],fe);else if("LineString"===ue)ii(re,fe,me,!1);else if("MultiLineString"===ue){if(B.lineMetrics){for(xe=0;xe<re.length;xe++)ii(re[xe],fe=[],me,!1),Q.push(yt(he,"LineString",fe,O.properties));return}qi(re,fe,me,!1)}else if("Polygon"===ue)qi(re,fe,me,!0);else{if("MultiPolygon"!==ue){if("GeometryCollection"===ue){for(xe=0;xe<O.geometry.geometries.length;xe++)Di(Q,{id:he,geometry:O.geometry.geometries[xe],properties:O.properties},B,K);return}throw new Error("Input data is not a valid GeoJSON object.")}for(xe=0;xe<re.length;xe++){var Ge=[];qi(re[xe],Ge,me,!0),fe.push(Ge)}}Q.push(yt(he,ue,fe,O.properties))}}function lr(Q,O){O.push(bn(Q[0])),O.push(wn(Q[1])),O.push(0)}function ii(Q,O,B,K){for(var re,ue,me=0,fe=0;fe<Q.length;fe++){var he=bn(Q[fe][0]),xe=wn(Q[fe][1]);O.push(he),O.push(xe),O.push(0),fe>0&&(me+=K?(re*xe-he*ue)/2:Math.sqrt(Math.pow(he-re,2)+Math.pow(xe-ue,2))),re=he,ue=xe}var Ge=O.length-3;O[2]=1,hn(O,0,Ge,B),O[Ge+2]=1,O.size=Math.abs(me),O.start=0,O.end=O.size}function qi(Q,O,B,K){for(var re=0;re<Q.length;re++){var ue=[];ii(Q[re],ue,B,K),O.push(ue)}}function bn(Q){return Q/360+.5}function wn(Q){var O=Math.sin(Q*Math.PI/180),B=.5-.25*Math.log((1+O)/(1-O))/Math.PI;return B<0?0:B>1?1:B}function tn(Q,O,B,K,re,ue,me,fe){if(K/=O,ue>=(B/=O)&&me<K)return Q;if(me<B||ue>=K)return null;for(var he=[],xe=0;xe<Q.length;xe++){var Ge=Q[xe],Ke=Ge.geometry,je=Ge.type,Ct=0===re?Ge.minX:Ge.minY,Ft=0===re?Ge.maxX:Ge.maxY;if(Ct>=B&&Ft<K)he.push(Ge);else if(!(Ft<B||Ct>=K)){var It=[];if("Point"===je||"MultiPoint"===je)Gn(Ke,It,B,K,re);else if("LineString"===je)Rn(Ke,It,B,K,re,!1,fe.lineMetrics);else if("MultiLineString"===je)On(Ke,It,B,K,re,!1);else if("Polygon"===je)On(Ke,It,B,K,re,!0);else if("MultiPolygon"===je)for(var Ut=0;Ut<Ke.length;Ut++){var Zt=[];On(Ke[Ut],Zt,B,K,re,!0),Zt.length&&It.push(Zt)}if(It.length){if(fe.lineMetrics&&"LineString"===je){for(Ut=0;Ut<It.length;Ut++)he.push(yt(Ge.id,je,It[Ut],Ge.tags));continue}"LineString"!==je&&"MultiLineString"!==je||(1===It.length?(je="LineString",It=It[0]):je="MultiLineString"),"Point"!==je&&"MultiPoint"!==je||(je=3===It.length?"Point":"MultiPoint"),he.push(yt(Ge.id,je,It,Ge.tags))}}}return he.length?he:null}function Gn(Q,O,B,K,re){for(var ue=0;ue<Q.length;ue+=3){var me=Q[ue+re];me>=B&&me<=K&&(O.push(Q[ue]),O.push(Q[ue+1]),O.push(Q[ue+2]))}}function Rn(Q,O,B,K,re,ue,me){for(var fe,he,xe=En(Q),Ge=0===re?mn:fr,Ke=Q.start,je=0;je<Q.length-3;je+=3){var Ct=Q[je],Ft=Q[je+1],It=Q[je+2],Ut=Q[je+3],Zt=Q[je+4],di=0===re?Ct:Ft,pi=0===re?Ut:Zt,nn=!1;me&&(fe=Math.sqrt(Math.pow(Ct-Ut,2)+Math.pow(Ft-Zt,2))),di<B?pi>B&&(he=Ge(xe,Ct,Ft,Ut,Zt,B),me&&(xe.start=Ke+fe*he)):di>K?pi<K&&(he=Ge(xe,Ct,Ft,Ut,Zt,K),me&&(xe.start=Ke+fe*he)):Li(xe,Ct,Ft,It),pi<B&&di>=B&&(he=Ge(xe,Ct,Ft,Ut,Zt,B),nn=!0),pi>K&&di<=K&&(he=Ge(xe,Ct,Ft,Ut,Zt,K),nn=!0),!ue&&nn&&(me&&(xe.end=Ke+fe*he),O.push(xe),xe=En(Q)),me&&(Ke+=fe)}var ci=Q.length-3;Ct=Q[ci],Ft=Q[ci+1],It=Q[ci+2],(di=0===re?Ct:Ft)>=B&&di<=K&&Li(xe,Ct,Ft,It),ci=xe.length-3,ue&&ci>=3&&(xe[ci]!==xe[0]||xe[ci+1]!==xe[1])&&Li(xe,xe[0],xe[1],xe[2]),xe.length&&O.push(xe)}function En(Q){var O=[];return O.size=Q.size,O.start=Q.start,O.end=Q.end,O}function On(Q,O,B,K,re,ue){for(var me=0;me<Q.length;me++)Rn(Q[me],O,B,K,re,ue,!1)}function Li(Q,O,B,K){Q.push(O),Q.push(B),Q.push(K)}function mn(Q,O,B,K,re,ue){var me=(ue-O)/(K-O);return Q.push(ue),Q.push(B+(re-B)*me),Q.push(1),me}function fr(Q,O,B,K,re,ue){var me=(ue-B)/(re-B);return Q.push(O+(K-O)*me),Q.push(ue),Q.push(1),me}function fn(Q,O){for(var B=[],K=0;K<Q.length;K++){var re,ue=Q[K],me=ue.type;if("Point"===me||"MultiPoint"===me||"LineString"===me)re=qn(ue.geometry,O);else if("MultiLineString"===me||"Polygon"===me){re=[];for(var fe=0;fe<ue.geometry.length;fe++)re.push(qn(ue.geometry[fe],O))}else if("MultiPolygon"===me)for(re=[],fe=0;fe<ue.geometry.length;fe++){for(var he=[],xe=0;xe<ue.geometry[fe].length;xe++)he.push(qn(ue.geometry[fe][xe],O));re.push(he)}B.push(yt(ue.id,me,re,ue.tags))}return B}function qn(Q,O){var B=[];B.size=Q.size,void 0!==Q.start&&(B.start=Q.start,B.end=Q.end);for(var K=0;K<Q.length;K+=3)B.push(Q[K]+O,Q[K+1],Q[K+2]);return B}function _r(Q,O){if(Q.transformed)return Q;var B,K,re,ue=1<<Q.z,me=Q.x,fe=Q.y;for(B=0;B<Q.features.length;B++){var he=Q.features[B],xe=he.geometry,Ge=he.type;if(he.geometry=[],1===Ge)for(K=0;K<xe.length;K+=2)he.geometry.push(Bn(xe[K],xe[K+1],O,ue,me,fe));else for(K=0;K<xe.length;K++){var Ke=[];for(re=0;re<xe[K].length;re+=2)Ke.push(Bn(xe[K][re],xe[K][re+1],O,ue,me,fe));he.geometry.push(Ke)}}return Q.transformed=!0,Q}function Bn(Q,O,B,K,re,ue){return[Math.round(B*(Q*K-re)),Math.round(B*(O*K-ue))]}function gr(Q,O,B,K,re){for(var ue=O===re.maxZoom?0:re.tolerance/((1<<O)*re.extent),me={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:B,y:K,z:O,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},fe=0;fe<Q.length;fe++){me.numFeatures++,$n(me,Q[fe],ue,re);var he=Q[fe].minX,xe=Q[fe].minY,Ge=Q[fe].maxX,Ke=Q[fe].maxY;he<me.minX&&(me.minX=he),xe<me.minY&&(me.minY=xe),Ge>me.maxX&&(me.maxX=Ge),Ke>me.maxY&&(me.maxY=Ke)}return me}function $n(Q,O,B,K){var re=O.geometry,ue=O.type,me=[];if("Point"===ue||"MultiPoint"===ue)for(var fe=0;fe<re.length;fe+=3)me.push(re[fe]),me.push(re[fe+1]),Q.numPoints++,Q.numSimplified++;else if("LineString"===ue)Wn(me,re,Q,B,!1,!1);else if("MultiLineString"===ue||"Polygon"===ue)for(fe=0;fe<re.length;fe++)Wn(me,re[fe],Q,B,"Polygon"===ue,0===fe);else if("MultiPolygon"===ue)for(var he=0;he<re.length;he++){var xe=re[he];for(fe=0;fe<xe.length;fe++)Wn(me,xe[fe],Q,B,!0,0===fe)}if(me.length){var Ge=O.tags||null;if("LineString"===ue&&K.lineMetrics){for(var Ke in Ge={},O.tags)Ge[Ke]=O.tags[Ke];Ge.mapbox_clip_start=re.start/re.size,Ge.mapbox_clip_end=re.end/re.size}var je={geometry:me,type:"Polygon"===ue||"MultiPolygon"===ue?3:"LineString"===ue||"MultiLineString"===ue?2:1,tags:Ge};null!==O.id&&(je.id=O.id),Q.features.push(je)}}function Wn(Q,O,B,K,re,ue){var me=K*K;if(K>0&&O.size<(re?me:K))B.numPoints+=O.length/3;else{for(var fe=[],he=0;he<O.length;he+=3)(0===K||O[he+2]>me)&&(B.numSimplified++,fe.push(O[he]),fe.push(O[he+1])),B.numPoints++;re&&function(xe,Ge){for(var Ke=0,je=0,Ct=xe.length,Ft=Ct-2;je<Ct;Ft=je,je+=2)Ke+=(xe[je]-xe[Ft])*(xe[je+1]+xe[Ft+1]);if(Ke>0===Ge)for(je=0,Ct=xe.length;je<Ct/2;je+=2){var It=xe[je],Ut=xe[je+1];xe[je]=xe[Ct-2-je],xe[je+1]=xe[Ct-1-je],xe[Ct-2-je]=It,xe[Ct-1-je]=Ut}}(fe,ue),Q.push(fe)}}function _n(Q,O){var B=(O=this.options=function(re,ue){for(var me in ue)re[me]=ue[me];return re}(Object.create(this.options),O)).debug;if(B&&console.time("preprocess data"),O.maxZoom<0||O.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(O.promoteId&&O.generateId)throw new Error("promoteId and generateId cannot be used together.");var re,ue,me,fe,he,xe,K=function(re,ue){var me=[];if("FeatureCollection"===re.type)for(var fe=0;fe<re.features.length;fe++)Di(me,re.features[fe],ue,fe);else Di(me,"Feature"===re.type?re:{geometry:re},ue);return me}(Q,O);this.tiles={},this.tileCoords=[],B&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",O.indexMaxZoom,O.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),fe=re=K,he=tn(re,1,-1-(me=(ue=O).buffer/ue.extent),me,0,-1,2,ue),xe=tn(re,1,1-me,2+me,0,-1,2,ue),(he||xe)&&(fe=tn(re,1,-me,1+me,0,-1,2,ue)||[],he&&(fe=fn(he,1).concat(fe)),xe&&(fe=fe.concat(fn(xe,-1)))),(K=fe).length&&this.splitTile(K,0,0,0),B&&(K.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Fn(Q,O,B){return 32*((1<<Q)*B+O)+Q}function Un(Q,O){const B=Q.tileID.canonical;if(!this._geoJSONIndex)return O(null,null);const K=this._geoJSONIndex.getTile(B.z,B.x,B.y);if(!K)return O(null,null);const re=new class{constructor(me){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=s.EXTENT,this.length=me.length,this._features=me}feature(me){return new class{constructor(fe){this._feature=fe,this.extent=s.EXTENT,this.type=fe.type,this.properties=fe.tags,"id"in fe&&!isNaN(fe.id)&&(this.id=parseInt(fe.id,10))}loadGeometry(){if(1===this._feature.type){const fe=[];for(const he of this._feature.geometry)fe.push([new s.Point(he[0],he[1])]);return fe}{const fe=[];for(const he of this._feature.geometry){const xe=[];for(const Ge of he)xe.push(new s.Point(Ge[0],Ge[1]));fe.push(xe)}return fe}}toGeoJSON(fe,he,xe){return ti.call(this,fe,he,xe)}}(this._features[me])}}(K.features);let ue=Ce(re);0===ue.byteOffset&&ue.byteLength===ue.buffer.byteLength||(ue=new Uint8Array(ue)),O(null,{vectorTile:re,rawData:ue.buffer})}_n.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},_n.prototype.splitTile=function(Q,O,B,K,re,ue,me){for(var fe=[Q,O,B,K],he=this.options,xe=he.debug;fe.length;){K=fe.pop(),B=fe.pop(),O=fe.pop(),Q=fe.pop();var Ge=1<<O,Ke=Fn(O,B,K),je=this.tiles[Ke];if(!je&&(xe>1&&console.time("creation"),je=this.tiles[Ke]=gr(Q,O,B,K,he),this.tileCoords.push({z:O,x:B,y:K}),xe)){xe>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",O,B,K,je.numFeatures,je.numPoints,je.numSimplified),console.timeEnd("creation"));var Ct="z"+O;this.stats[Ct]=(this.stats[Ct]||0)+1,this.total++}if(je.source=Q,re){if(O===he.maxZoom||O===re)continue;var Ft=1<<re-O;if(B!==Math.floor(ue/Ft)||K!==Math.floor(me/Ft))continue}else if(O===he.indexMaxZoom||je.numPoints<=he.indexMaxPoints)continue;if(je.source=null,0!==Q.length){xe>1&&console.time("clipping");var It,Ut,Zt,di,pi,nn,ci=.5*he.buffer/he.extent,an=.5-ci,Ri=.5+ci,Bi=1+ci;It=Ut=Zt=di=null,pi=tn(Q,Ge,B-ci,B+Ri,0,je.minX,je.maxX,he),nn=tn(Q,Ge,B+an,B+Bi,0,je.minX,je.maxX,he),Q=null,pi&&(It=tn(pi,Ge,K-ci,K+Ri,1,je.minY,je.maxY,he),Ut=tn(pi,Ge,K+an,K+Bi,1,je.minY,je.maxY,he),pi=null),nn&&(Zt=tn(nn,Ge,K-ci,K+Ri,1,je.minY,je.maxY,he),di=tn(nn,Ge,K+an,K+Bi,1,je.minY,je.maxY,he),nn=null),xe>1&&console.timeEnd("clipping"),fe.push(It||[],O+1,2*B,2*K),fe.push(Ut||[],O+1,2*B,2*K+1),fe.push(Zt||[],O+1,2*B+1,2*K),fe.push(di||[],O+1,2*B+1,2*K+1)}}},_n.prototype.getTile=function(Q,O,B){var K=this.options,re=K.extent,ue=K.debug;if(Q<0||Q>24)return null;var me=1<<Q,fe=Fn(Q,O=(O%me+me)%me,B);if(this.tiles[fe])return _r(this.tiles[fe],re);ue>1&&console.log("drilling down to z%d-%d-%d",Q,O,B);for(var he,xe=Q,Ge=O,Ke=B;!he&&xe>0;)xe--,Ge=Math.floor(Ge/2),Ke=Math.floor(Ke/2),he=this.tiles[Fn(xe,Ge,Ke)];return he&&he.source?(ue>1&&console.log("found parent tile z%d-%d-%d",xe,Ge,Ke),ue>1&&console.time("drilling down"),this.splitTile(he.source,xe,Ge,Ke,Q,O,B),ue>1&&console.timeEnd("drilling down"),this.tiles[fe]?_r(this.tiles[fe],re):null):null};class Hn extends s.VectorTileWorkerSource{constructor(O,B,K,re,ue){super(O,B,K,re,Un),ue&&(this.loadGeoJSON=ue)}loadData(O,B){const K=O&&O.request,re=K&&K.collectResourceTiming;this.loadGeoJSON(O,(ue,me)=>{if(ue||!me)return B(ue);if("object"!=typeof me)return B(new Error(`Input data given to '${O.source}' is not a valid GeoJSON object.`));{Ht(me,!0);try{if(O.filter){const he=s.createExpression(O.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===he.result)throw new Error(he.value.map(Ge=>`${Ge.key}: ${Ge.message}`).join(", "));me={type:"FeatureCollection",features:me.features.filter(Ge=>he.value.evaluate({zoom:0},Ge))}}this._geoJSONIndex=O.cluster?new Mt(function({superclusterOptions:he,clusterProperties:xe}){if(!xe||!he)return he;const Ge={},Ke={},je={accumulated:null,zoom:0},Ct={properties:null},Ft=Object.keys(xe);for(const It of Ft){const[Ut,Zt]=xe[It],di=s.createExpression(Zt),pi=s.createExpression("string"==typeof Ut?[Ut,["accumulated"],["get",It]]:Ut);Ge[It]=di.value,Ke[It]=pi.value}return he.map=It=>{Ct.properties=It;const Ut={};for(const Zt of Ft)Ut[Zt]=Ge[Zt].evaluate(je,Ct);return Ut},he.reduce=(It,Ut)=>{Ct.properties=Ut;for(const Zt of Ft)je.accumulated=It[Zt],It[Zt]=Ke[Zt].evaluate(je,Ct)},he}(O)).load(me.features):new _n(he=me,O.geojsonVtOptions)}catch(he){return B(he)}this.loaded={};const fe={};if(re){const he=s.getPerformanceMeasurement(K);he&&(fe.resourceTiming={},fe.resourceTiming[O.source]=JSON.parse(JSON.stringify(he)))}B(null,fe)}var he})}reloadTile(O,B){const K=this.loaded;return K&&K[O.uid]?super.reloadTile(O,B):this.loadTile(O,B)}loadGeoJSON(O,B){if(O.request)s.getJSON(O.request,B);else{if("string"!=typeof O.data)return B(new Error(`Input data given to '${O.source}' is not a valid GeoJSON object.`));try{return B(null,JSON.parse(O.data))}catch{return B(new Error(`Input data given to '${O.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(O,B){try{B(null,this._geoJSONIndex.getClusterExpansionZoom(O.clusterId))}catch(K){B(K)}}getClusterChildren(O,B){try{B(null,this._geoJSONIndex.getChildren(O.clusterId))}catch(K){B(K)}}getClusterLeaves(O,B){try{B(null,this._geoJSONIndex.getLeaves(O.clusterId,O.limit,O.offset))}catch(K){B(K)}}}class $i{constructor(O){this.self=O,this.actor=new s.Actor(O,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=s.getProjection({name:"mercator"}),this.workerSourceTypes={vector:s.VectorTileWorkerSource,geojson:Hn},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(B,K)=>{if(this.workerSourceTypes[B])throw new Error(`Worker source with name "${B}" already registered.`);this.workerSourceTypes[B]=K},this.self.registerRTLTextPlugin=B=>{if(s.plugin.isParsed())throw new Error("RTL text plugin already registered.");s.plugin.applyArabicShaping=B.applyArabicShaping,s.plugin.processBidirectionalText=B.processBidirectionalText,s.plugin.processStyledBidirectionalText=B.processStyledBidirectionalText}}clearCaches(O,B,K){delete this.layerIndexes[O],delete this.availableImages[O],delete this.workerSources[O],delete this.demWorkerSources[O],K()}checkIfReady(O,B,K){K()}setReferrer(O,B){this.referrer=B}spriteLoaded(O,B){this.isSpriteLoaded[O]=B;for(const K in this.workerSources[O]){const re=this.workerSources[O][K];for(const ue in re)re[ue]instanceof s.VectorTileWorkerSource&&(re[ue].isSpriteLoaded=B,re[ue].fire(new s.Event("isSpriteLoaded")))}}setImages(O,B,K){this.availableImages[O]=B;for(const re in this.workerSources[O]){const ue=this.workerSources[O][re];for(const me in ue)ue[me].availableImages=B}K()}enableTerrain(O,B,K){this.terrain=B,K()}setProjection(O,B){this.projections[O]=s.getProjection(B)}setLayers(O,B,K){this.getLayerIndex(O).replace(B),K()}updateLayers(O,B,K){this.getLayerIndex(O).update(B.layers,B.removedIds),K()}loadTile(O,B,K){const re=this.enableTerrain?s.extend({enableTerrain:this.terrain},B):B;re.projection=this.projections[O]||this.defaultProjection,this.getWorkerSource(O,B.type,B.source).loadTile(re,K)}loadDEMTile(O,B,K){const re=this.enableTerrain?s.extend({buildQuadTree:this.terrain},B):B;this.getDEMWorkerSource(O,B.source).loadTile(re,K)}reloadTile(O,B,K){const re=this.enableTerrain?s.extend({enableTerrain:this.terrain},B):B;re.projection=this.projections[O]||this.defaultProjection,this.getWorkerSource(O,B.type,B.source).reloadTile(re,K)}abortTile(O,B,K){this.getWorkerSource(O,B.type,B.source).abortTile(B,K)}removeTile(O,B,K){this.getWorkerSource(O,B.type,B.source).removeTile(B,K)}removeSource(O,B,K){if(!this.workerSources[O]||!this.workerSources[O][B.type]||!this.workerSources[O][B.type][B.source])return;const re=this.workerSources[O][B.type][B.source];delete this.workerSources[O][B.type][B.source],void 0!==re.removeSource?re.removeSource(B,K):K()}loadWorkerSource(O,B,K){try{this.self.importScripts(B.url),K()}catch(re){K(re.toString())}}syncRTLPluginState(O,B,K){try{s.plugin.setState(B);const re=s.plugin.getPluginURL();if(s.plugin.isLoaded()&&!s.plugin.isParsed()&&null!=re){this.self.importScripts(re);const ue=s.plugin.isParsed();K(ue?void 0:new Error(`RTL Text Plugin failed to import scripts from ${re}`),ue)}}catch(re){K(re.toString())}}getAvailableImages(O){let B=this.availableImages[O];return B||(B=[]),B}getLayerIndex(O){let B=this.layerIndexes[O];return B||(B=this.layerIndexes[O]=new nt),B}getWorkerSource(O,B,K){return this.workerSources[O]||(this.workerSources[O]={}),this.workerSources[O][B]||(this.workerSources[O][B]={}),this.workerSources[O][B][K]||(this.workerSources[O][B][K]=new this.workerSourceTypes[B]({send:(ue,me,fe,he,xe,Ge)=>{this.actor.send(ue,me,fe,O,xe,Ge)},scheduler:this.actor.scheduler},this.getLayerIndex(O),this.getAvailableImages(O),this.isSpriteLoaded[O])),this.workerSources[O][B][K]}getDEMWorkerSource(O,B){return this.demWorkerSources[O]||(this.demWorkerSources[O]={}),this.demWorkerSources[O][B]||(this.demWorkerSources[O][B]=new Fe),this.demWorkerSources[O][B]}enforceCacheSizeLimit(O,B){s.enforceCacheSizeLimit(B)}getWorkerPerformanceMetrics(O,B,K){K(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new $i(self)),$i}),mt(0,function(s){function M(l,n){if(Array.isArray(l)){if(!Array.isArray(n)||l.length!==n.length)return!1;for(let a=0;a<l.length;a++)if(!M(l[a],n[a]))return!1;return!0}if("object"==typeof l&&null!==l&&null!==n){if("object"!=typeof n||Object.keys(l).length!==Object.keys(n).length)return!1;for(const a in l)if(!M(l[a],n[a]))return!1;return!0}return l===n}var wt=nt;function nt(l){return n=l,!(typeof window>"u"||typeof document>"u"||!(Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray)||!Function.prototype||!Function.prototype.bind||!(Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions)||!("JSON"in window&&"parse"in JSON&&"stringify"in JSON)||!function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var h,d,m=new Blob([""],{type:"text/javascript"}),g=URL.createObjectURL(m);try{d=new Worker(g),h=!0}catch{h=!1}return d&&d.terminate(),URL.revokeObjectURL(g),h}()||!("Uint8ClampedArray"in window)||!ArrayBuffer.isView||!function(){var h=document.createElement("canvas");h.width=h.height=1;var d=h.getContext("2d");if(!d)return!1;var m=d.getImageData(0,0,1,1);return m&&m.width===h.width}()||(void 0===Fe[a=n&&n.failIfMajorPerformanceCaveat]&&(Fe[a]=function(h){var d,g,y,v,m=(g=h,y=document.createElement("canvas"),(v=Object.create(nt.webGLContextAttributes)).failIfMajorPerformanceCaveat=g,y.getContext("webgl",v)||y.getContext("experimental-webgl",v));if(!m)return!1;try{d=m.createShader(m.VERTEX_SHADER)}catch{return!1}return!(!d||m.isContextLost())&&(m.shaderSource(d,"void main() {}"),m.compileShader(d),!0===m.getShaderParameter(d,m.COMPILE_STATUS))}(a)),!Fe[a]||document.documentMode));var n,a}var Fe={};function dt(l,n,a){const h=s.window.document.createElement(l);return void 0!==n&&(h.className=n),a&&a.appendChild(h),h}function zt(l,n,a){const h=s.window.document.createElementNS("http://www.w3.org/2000/svg",l);for(const d of Object.keys(n))h.setAttributeNS(null,d,n[d]);return a&&a.appendChild(h),h}nt.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const Ht=s.window.document&&s.window.document.documentElement.style,ti=Ht&&void 0!==Ht.userSelect?"userSelect":"WebkitUserSelect";let lt;function Bt(){Ht&&ti&&(lt=Ht[ti],Ht[ti]="none")}function Jt(){Ht&&ti&&(Ht[ti]=lt)}function Xt(l){l.preventDefault(),l.stopPropagation(),s.window.removeEventListener("click",Xt,!0)}function ft(){s.window.addEventListener("click",Xt,!0),s.window.setTimeout(()=>{s.window.removeEventListener("click",Xt,!0)},0)}function bt(l,n){const a=l.getBoundingClientRect();return Qe(l,a,n)}function Gt(l,n){const a=l.getBoundingClientRect(),h=[];for(let d=0;d<n.length;d++)h.push(Qe(l,a,n[d]));return h}function Tt(l){return void 0!==s.window.InstallTrigger&&2===l.button&&l.ctrlKey&&s.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:l.button}function Qe(l,n,a){const h=l.offsetWidth===n.width?1:l.offsetWidth/n.width;return new s.Point((a.clientX-n.left)*h,(a.clientY-n.top)*h)}function Pe(l,n){var a=n[0],h=n[1],d=n[2],m=n[3],g=a*m-d*h;return g?(l[0]=m*(g=1/g),l[1]=-h*g,l[2]=-d*g,l[3]=a*g,l):null}function ui(l){const{userImage:n}=l;return!!(n&&n.render&&n.render())&&(l.data.replace(new Uint8Array(n.data.buffer)),!0)}class rt extends s.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new s.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(n){if(this.loaded!==n&&(this.loaded=n,n)){for(const{ids:a,callback:h}of this.requestors)this._notify(a,h);this.requestors=[]}}hasImage(n){return!!this.getImage(n)}getImage(n){return this.images[n]}addImage(n,a){this._validate(n,a)&&(this.images[n]=a)}_validate(n,a){let h=!0;return this._validateStretch(a.stretchX,a.data&&a.data.width)||(this.fire(new s.ErrorEvent(new Error(`Image "${n}" has invalid "stretchX" value`))),h=!1),this._validateStretch(a.stretchY,a.data&&a.data.height)||(this.fire(new s.ErrorEvent(new Error(`Image "${n}" has invalid "stretchY" value`))),h=!1),this._validateContent(a.content,a)||(this.fire(new s.ErrorEvent(new Error(`Image "${n}" has invalid "content" value`))),h=!1),h}_validateStretch(n,a){if(!n)return!0;let h=0;for(const d of n){if(d[0]<h||d[1]<d[0]||a<d[1])return!1;h=d[1]}return!0}_validateContent(n,a){return!(n&&(4!==n.length||n[0]<0||a.data.width<n[0]||n[1]<0||a.data.height<n[1]||n[2]<0||a.data.width<n[2]||n[3]<0||a.data.height<n[3]||n[2]<n[0]||n[3]<n[1]))}updateImage(n,a){a.version=this.images[n].version+1,this.images[n]=a,this.updatedImages[n]=!0}removeImage(n){const a=this.images[n];delete this.images[n],delete this.patterns[n],a.userImage&&a.userImage.onRemove&&a.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(n,a){let h=!0;if(!this.isLoaded())for(const d of n)this.images[d]||(h=!1);this.isLoaded()||h?this._notify(n,a):this.requestors.push({ids:n,callback:a})}_notify(n,a){const h={};for(const d of n){this.images[d]||this.fire(new s.Event("styleimagemissing",{id:d}));const m=this.images[d];m?h[d]={data:m.data.clone(),pixelRatio:m.pixelRatio,sdf:m.sdf,version:m.version,stretchX:m.stretchX,stretchY:m.stretchY,content:m.content,hasRenderCallback:!(!m.userImage||!m.userImage.render)}:s.warnOnce(`Image "${d}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}a(null,h)}getPixelSize(){const{width:n,height:a}=this.atlasImage;return{width:n,height:a}}getPattern(n){const a=this.patterns[n],h=this.getImage(n);if(!h)return null;if(a&&a.position.version===h.version)return a.position;if(a)a.position.version=h.version;else{const d={w:h.data.width+2,h:h.data.height+2,x:0,y:0},m=new s.ImagePosition(d,h);this.patterns[n]={bin:d,position:m}}return this._updatePatternAtlas(),this.patterns[n].position}bind(n){const a=n.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new s.Texture(n,this.atlasImage,a.RGBA),this.atlasTexture&&this.atlasTexture.bind(a.LINEAR,a.CLAMP_TO_EDGE)}_updatePatternAtlas(){const n=[];for(const m in this.patterns)n.push(this.patterns[m].bin);const{w:a,h}=s.potpack(n),d=this.atlasImage;d.resize({width:a||1,height:h||1});for(const m in this.patterns){const{bin:g}=this.patterns[m],y=g.x+1,v=g.y+1,A=this.images[m].data,k=A.width,S=A.height;s.RGBAImage.copy(A,d,{x:0,y:0},{x:y,y:v},{width:k,height:S}),s.RGBAImage.copy(A,d,{x:0,y:S-1},{x:y,y:v-1},{width:k,height:1}),s.RGBAImage.copy(A,d,{x:0,y:0},{x:y,y:v+S},{width:k,height:1}),s.RGBAImage.copy(A,d,{x:k-1,y:0},{x:y-1,y:v},{width:1,height:S}),s.RGBAImage.copy(A,d,{x:0,y:0},{x:y+k,y:v},{width:1,height:S})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(n){for(const a of n){if(this.callbackDispatchedThisFrame[a])continue;this.callbackDispatchedThisFrame[a]=!0;const h=this.images[a];ui(h)&&this.updateImage(a,h)}}}const De=new s.Properties({anchor:new s.DataConstantProperty(s.spec.light.anchor),position:new class{constructor(){this.specification=s.spec.light.position}possiblyEvaluate(l,n){return function([a,h,d]){const m=s.degToRad(h+90),g=s.degToRad(d);return{x:a*Math.cos(m)*Math.sin(g),y:a*Math.sin(m)*Math.sin(g),z:a*Math.cos(g),azimuthal:h,polar:d}}(l.expression.evaluate(n))}interpolate(l,n,a){return{x:s.number(l.x,n.x,a),y:s.number(l.y,n.y,a),z:s.number(l.z,n.z,a),azimuthal:s.number(l.azimuthal,n.azimuthal,a),polar:s.number(l.polar,n.polar,a)}}},color:new s.DataConstantProperty(s.spec.light.color),intensity:new s.DataConstantProperty(s.spec.light.intensity)});class at extends s.Evented{constructor(n){super(),this._transitionable=new s.Transitionable(De),this.setLight(n),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(n,a={}){if(!this._validate(s.validateLight,n,a))for(const h in n){const d=n[h];s.endsWith(h,"-transition")?this._transitionable.setTransition(h.slice(0,-11),d):this._transitionable.setValue(h,d)}}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}_validate(n,a,h){return(!h||!1!==h.validate)&&s.emitValidationErrors(this,n.call(s.validateStyle,s.extend({value:a,style:{glyphs:!0,sprite:!0},styleSpec:s.spec})))}}const Ie=new s.Properties({source:new s.DataConstantProperty(s.spec.terrain.source),exaggeration:new s.DataConstantProperty(s.spec.terrain.exaggeration)});let Je=class extends s.Evented{constructor(l,n){super(),this._transitionable=new s.Transitionable(Ie),this.set(l),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=n}get(){return this._transitionable.serialize()}set(l){for(const n in l){const a=l[n];s.endsWith(n,"-transition")?this._transitionable.setTransition(n.slice(0,-11),a):this._transitionable.setValue(n,a)}}updateTransitions(l){this._transitioning=this._transitionable.transitioned(l,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(l){this.properties=this._transitioning.possiblyEvaluate(l)}};function Ce(l,n,a,h){const d=s.smoothstep(45,65,a),[m,g]=Ue(l,h),y=s.length(n);let v=1-Math.min(1,Math.exp((y-m)/(g-m)*-6));return v*=v*v,v=Math.min(1,1.00747*v),v*d*l.alpha}function Ue(l,n){const a=.5/Math.tan(.5*n);return[l.range[0]+a,l.range[1]+a]}const Ee=new s.Properties({range:new s.DataConstantProperty(s.spec.fog.range),color:new s.DataConstantProperty(s.spec.fog.color),"high-color":new s.DataConstantProperty(s.spec.fog["high-color"]),"space-color":new s.DataConstantProperty(s.spec.fog["space-color"]),"horizon-blend":new s.DataConstantProperty(s.spec.fog["horizon-blend"]),"star-intensity":new s.DataConstantProperty(s.spec.fog["star-intensity"])});class Me extends s.Evented{constructor(n,a){super(),this._transitionable=new s.Transitionable(Ee),this.set(n),this._transitioning=this._transitionable.untransitioned(),this._transform=a}get state(){const n=this._transform,a="globe"===n.projection.name,h=s.globeToMercatorTransition(n.zoom),d=this.properties.get("range"),m=[.5,3];return{range:a?[s.number(m[0],d[0],h),s.number(m[1],d[1],h)]:d,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(n,a={}){if(!this._validate(s.validateFog,n,a)){for(const h of Object.keys(s.spec.fog))n&&void 0===n[h]&&(n[h]=s.spec.fog[h].default);for(const h in n){const d=n[h];s.endsWith(h,"-transition")?this._transitionable.setTransition(h.slice(0,-11),d):this._transitionable.setValue(h,d)}}}getOpacity(n){if(!this._transform.projection.supportsFog)return 0;const a=this.properties&&this.properties.get("color")||1;return("globe"===this._transform.projection.name?1:s.smoothstep(45,65,n))*a.a}getOpacityAtLatLng(n,a){return this._transform.projection.supportsFog?function(h,d,m){const g=s.MercatorCoordinate.fromLngLat(d),y=m.elevation?m.elevation.getAtPointOrZero(g):0,v=[g.x,g.y,y];return s.transformMat4(v,v,m.mercatorFogMatrix),Ce(h,v,m.pitch,m._fov)}(this.state,n,a):0}getFovAdjustedRange(n){return this._transform.projection.supportsFog?Ue(this.state,n):[0,1]}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}_validate(n,a,h){return(!h||!1!==h.validate)&&s.emitValidationErrors(this,n.call(s.validateStyle,s.extend({value:a,style:{glyphs:!0,sprite:!0},styleSpec:s.spec})))}}class st{constructor(n,a){this.workerPool=n,this.actors=[],this.currentActor=0,this.id=s.uniqueId();const h=this.workerPool.acquire(this.id);for(let d=0;d<h.length;d++){const m=new st.Actor(h[d],a,this.id);m.name=`Worker ${d}`,this.actors.push(m)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(n,a,h){s.asyncAll(this.actors,(d,m)=>{d.send(n,a,m)},h=h||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(n=>{n.remove()}),this.actors=[],this.workerPool.release(this.id)}}function jt(l,n,a){return n*(s.EXTENT/(l.tileSize*Math.pow(2,a-l.tileID.overscaledZ)))}st.Actor=s.Actor;class Pt{constructor(n,a,h,d){this.screenBounds=n,this.cameraPoint=a,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=h,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,d)}static createFromScreenPoints(n,a){let h,d;if(n instanceof s.Point||"number"==typeof n[0]){const m=s.Point.convert(n);h=[m],d=a.isPointAboveHorizon(m)}else{const m=s.Point.convert(n[0]),g=s.Point.convert(n[1]);h=[m,g],d=s.polygonizeBounds(m,g).every(y=>a.isPointAboveHorizon(y))}return new Pt(h,a.getCameraPoint(),d,a)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(n){return s.polygonizeBounds(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],n)}bufferedCameraGeometry(n){const a=this.screenBounds[0],h=1===this.screenBounds.length?this.screenBounds[0].add(new s.Point(1,1)):this.screenBounds[1],d=s.polygonizeBounds(a,h,0,!1);return this.cameraPoint.y>h.y&&(this.cameraPoint.x>a.x&&this.cameraPoint.x<h.x?d.splice(3,0,this.cameraPoint):this.cameraPoint.x>=h.x?d[2]=this.cameraPoint:this.cameraPoint.x<=a.x&&(d[3]=this.cameraPoint)),s.bufferConvexPolygon(d,n)}bufferedCameraGeometryGlobe(n){const a=this.screenBounds[0],h=1===this.screenBounds.length?this.screenBounds[0].add(new s.Point(1,1)):this.screenBounds[1],d=s.polygonizeBounds(a,h,n),m=this.cameraPoint.clone();switch(3*((m.y>a.y)+(m.y>h.y))+((m.x>a.x)+(m.x>h.x))){case 0:d[0]=m,d[4]=m.clone();break;case 1:d.splice(1,0,m);break;case 2:d[1]=m;break;case 3:d.splice(4,0,m);break;case 5:d.splice(2,0,m);break;case 6:d[3]=m;break;case 7:d.splice(3,0,m);break;case 8:d[2]=m}return d}containsTile(n,a,h,d=0){const m=n.queryPadding/a._pixelsPerMercatorPixel+1,g=h?this._bufferedCameraMercator(m,a):this._bufferedScreenMercator(m,a);let y=n.tileID.wrap+(g.unwrapped?d:0);const v=g.polygon.map($=>s.getTilePoint(n.tileTransform,$,y));if(!s.polygonIntersectsBox(v,0,0,s.EXTENT,s.EXTENT))return;y=n.tileID.wrap+(this.screenGeometryMercator.unwrapped?d:0);const A=this.screenGeometryMercator.polygon.map($=>s.getTileVec3(n.tileTransform,$,y)),k=A.map($=>new s.Point($[0],$[1])),S=a.getFreeCameraOptions().position||new s.MercatorCoordinate(0,0,0),U=s.getTileVec3(n.tileTransform,S,y),j=A.map($=>{const P=s.sub($,$,U);return s.normalize(P,P),new s.Ray(U,P)}),G=jt(n,1,a.zoom)*a._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:k,tilespaceRays:j,bufferedTilespaceGeometry:v,bufferedTilespaceBounds:(Z=s.getBounds(v),Z.min.x=s.clamp(Z.min.x,0,s.EXTENT),Z.min.y=s.clamp(Z.min.y,0,s.EXTENT),Z.max.x=s.clamp(Z.max.x,0,s.EXTENT),Z.max.y=s.clamp(Z.max.y,0,s.EXTENT),Z),tile:n,tileID:n.tileID,pixelToTileUnitsFactor:G};var Z}_bufferedScreenMercator(n,a){const h=Qt(n);if(this._screenRaycastCache[h])return this._screenRaycastCache[h];{let d;return d="globe"===a.projection.name?this._projectAndResample(this.bufferedScreenGeometry(n),a):{polygon:this.bufferedScreenGeometry(n).map(m=>a.pointCoordinate3D(m)),unwrapped:!0},this._screenRaycastCache[h]=d,d}}_bufferedCameraMercator(n,a){const h=Qt(n);if(this._cameraRaycastCache[h])return this._cameraRaycastCache[h];{let d;return d="globe"===a.projection.name?this._projectAndResample(this.bufferedCameraGeometryGlobe(n),a):{polygon:this.bufferedCameraGeometry(n).map(m=>a.pointCoordinate3D(m)),unwrapped:!0},this._cameraRaycastCache[h]=d,d}}_projectAndResample(n,a){const h=function(m,g){const y=s.multiply([],g.pixelMatrix,g.globeMatrix),v=[0,-s.GLOBE_RADIUS,0,1],A=[0,s.GLOBE_RADIUS,0,1],k=[0,0,0,1];s.transformMat4$1(v,v,y),s.transformMat4$1(A,A,y),s.transformMat4$1(k,k,y);const S=new s.Point(v[0]/v[3],v[1]/v[3]),U=new s.Point(A[0]/A[3],A[1]/A[3]),j=s.polygonContainsPoint(m,S)&&v[3]<k[3],G=s.polygonContainsPoint(m,U)&&A[3]<k[3];if(!j&&!G)return null;const Z=function(le,pe,de){for(let ve=1;ve<le.length;ve++){const qe=Dt(pe.pointCoordinate3D(le[ve-1]).x),_e=Dt(pe.pointCoordinate3D(le[ve]).x);if(de<0){if(qe<_e)return{idx:ve,t:-qe/(_e-1-qe)}}else if(_e<qe)return{idx:ve,t:(1-qe)/(_e+1-qe)}}return null}(m,g,j?-1:1);if(!Z)return null;const{idx:$,t:P}=Z;let N=$>1?Mt(m.slice(0,$),g):[],X=$<m.length?Mt(m.slice($),g):[];N=N.map(le=>new s.Point(Dt(le.x),le.y)),X=X.map(le=>new s.Point(Dt(le.x),le.y));const J=[...N];0===J.length&&J.push(X[X.length-1]);const oe=s.number(J[J.length-1].y,(0===X.length?N[0]:X[0]).y,P);let ce;return ce=j?[new s.Point(0,oe),new s.Point(0,0),new s.Point(1,0),new s.Point(1,oe)]:[new s.Point(1,oe),new s.Point(1,1),new s.Point(0,1),new s.Point(0,oe)],J.push(...ce),0===X.length?J.push(N[0]):J.push(...X),{polygon:J.map(le=>new s.MercatorCoordinate(le.x,le.y)),unwrapped:!1}}(n,a);if(h)return h;const d=function(m,g){let y=!1,v=-1/0,A=0;for(let S=0;S<m.length-1;S++)m[S].x>v&&(v=m[S].x,A=S);for(let S=0;S<m.length-1;S++){const U=(A+S)%(m.length-1),j=m[U],G=m[U+1];Math.abs(j.x-G.x)>.5&&(j.x<G.x?(j.x+=1,0===U&&(m[m.length-1].x+=1)):(G.x+=1,U+1===m.length-1&&(m[0].x+=1)),y=!0)}const k=s.mercatorXfromLng(g.center.lng);return y&&k<Math.abs(k-1)&&m.forEach(S=>{S.x-=1}),{polygon:m,unwrapped:y}}(Mt(n,a).map(m=>new s.Point(Dt(m.x),m.y)),a);return{polygon:d.polygon.map(m=>new s.MercatorCoordinate(m.x,m.y)),unwrapped:d.unwrapped}}}function Mt(l,n){return s.resample(l,a=>{const h=n.pointCoordinate3D(a);a.x=h.x,a.y=h.y},1/256)}function Dt(l){return l<0?1+l%1:l%1}function Qt(l){return 100*l|0}function zi(l,n,a,h,d){const m=function(g,y){if(g)return d(g);if(y){l.url&&y.tiles&&l.tiles&&delete l.tiles;const v=s.pick(s.extend(y,l),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);y.vector_layers&&(v.vectorLayers=y.vector_layers,v.vectorLayerIds=v.vectorLayers.map(A=>A.id)),v.tiles=n.canonicalizeTileset(v,l.url),d(null,v)}};return l.url?s.getJSON(n.transformRequest(n.normalizeSourceURL(l.url,null,a,h),s.ResourceType.Source),m):s.exported.frame(()=>m(null,l))}class ji{constructor(n,a,h){this.bounds=s.LngLatBounds.convert(this.validateBounds(n)),this.minzoom=a||0,this.maxzoom=h||24}validateBounds(n){return Array.isArray(n)&&4===n.length?[Math.max(-180,n[0]),Math.max(-90,n[1]),Math.min(180,n[2]),Math.min(90,n[3])]:[-180,-90,180,90]}contains(n){const a=Math.pow(2,n.z),h=Math.floor(s.mercatorXfromLng(this.bounds.getWest())*a),d=Math.floor(s.mercatorYfromLat(this.bounds.getNorth())*a),m=Math.ceil(s.mercatorXfromLng(this.bounds.getEast())*a),g=Math.ceil(s.mercatorYfromLat(this.bounds.getSouth())*a);return n.x>=h&&n.x<m&&n.y>=d&&n.y<g}}class Ln{constructor(n,a,h){this.context=n;const d=n.gl;this.buffer=d.createBuffer(),this.dynamicDraw=!!h,this.context.unbindVAO(),n.bindElementBuffer.set(this.buffer),d.bufferData(d.ELEMENT_ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?d.DYNAMIC_DRAW:d.STATIC_DRAW),this.dynamicDraw||a.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(n){const a=this.context.gl;this.context.unbindVAO(),this.bind(),a.bufferSubData(a.ELEMENT_ARRAY_BUFFER,0,n.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const hn={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class $t{constructor(n,a,h,d){this.length=a.length,this.attributes=h,this.itemSize=a.bytesPerElement,this.dynamicDraw=d,this.context=n;const m=n.gl;this.buffer=m.createBuffer(),n.bindVertexBuffer.set(this.buffer),m.bufferData(m.ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?m.DYNAMIC_DRAW:m.STATIC_DRAW),this.dynamicDraw||a.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(n){const a=this.context.gl;this.bind(),a.bufferSubData(a.ARRAY_BUFFER,0,n.arrayBuffer)}enableAttributes(n,a){for(let h=0;h<this.attributes.length;h++){const d=a.attributes[this.attributes[h].name];void 0!==d&&n.enableVertexAttribArray(d)}}setVertexAttribPointers(n,a,h){for(let d=0;d<this.attributes.length;d++){const m=this.attributes[d],g=a.attributes[m.name];void 0!==g&&n.vertexAttribPointer(g,m.components,n[hn[m.type]],!1,this.itemSize,m.offset+this.itemSize*(h||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class yt{constructor(n){this.gl=n.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(n){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class en extends yt{getDefault(){return s.Color.transparent}set(n){const a=this.current;(n.r!==a.r||n.g!==a.g||n.b!==a.b||n.a!==a.a||this.dirty)&&(this.gl.clearColor(n.r,n.g,n.b,n.a),this.current=n,this.dirty=!1)}}class Di extends yt{getDefault(){return 1}set(n){(n!==this.current||this.dirty)&&(this.gl.clearDepth(n),this.current=n,this.dirty=!1)}}class lr extends yt{getDefault(){return 0}set(n){(n!==this.current||this.dirty)&&(this.gl.clearStencil(n),this.current=n,this.dirty=!1)}}class ii extends yt{getDefault(){return[!0,!0,!0,!0]}set(n){const a=this.current;(n[0]!==a[0]||n[1]!==a[1]||n[2]!==a[2]||n[3]!==a[3]||this.dirty)&&(this.gl.colorMask(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class qi extends yt{getDefault(){return!0}set(n){(n!==this.current||this.dirty)&&(this.gl.depthMask(n),this.current=n,this.dirty=!1)}}class bn extends yt{getDefault(){return 255}set(n){(n!==this.current||this.dirty)&&(this.gl.stencilMask(n),this.current=n,this.dirty=!1)}}class wn extends yt{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(n){const a=this.current;(n.func!==a.func||n.ref!==a.ref||n.mask!==a.mask||this.dirty)&&(this.gl.stencilFunc(n.func,n.ref,n.mask),this.current=n,this.dirty=!1)}}class tn extends yt{getDefault(){const n=this.gl;return[n.KEEP,n.KEEP,n.KEEP]}set(n){const a=this.current;(n[0]!==a[0]||n[1]!==a[1]||n[2]!==a[2]||this.dirty)&&(this.gl.stencilOp(n[0],n[1],n[2]),this.current=n,this.dirty=!1)}}class Gn extends yt{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;n?a.enable(a.STENCIL_TEST):a.disable(a.STENCIL_TEST),this.current=n,this.dirty=!1}}class Rn extends yt{getDefault(){return[0,1]}set(n){const a=this.current;(n[0]!==a[0]||n[1]!==a[1]||this.dirty)&&(this.gl.depthRange(n[0],n[1]),this.current=n,this.dirty=!1)}}class En extends yt{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;n?a.enable(a.DEPTH_TEST):a.disable(a.DEPTH_TEST),this.current=n,this.dirty=!1}}class On extends yt{getDefault(){return this.gl.LESS}set(n){(n!==this.current||this.dirty)&&(this.gl.depthFunc(n),this.current=n,this.dirty=!1)}}class Li extends yt{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;n?a.enable(a.BLEND):a.disable(a.BLEND),this.current=n,this.dirty=!1}}class mn extends yt{getDefault(){const n=this.gl;return[n.ONE,n.ZERO]}set(n){const a=this.current;(n[0]!==a[0]||n[1]!==a[1]||this.dirty)&&(this.gl.blendFunc(n[0],n[1]),this.current=n,this.dirty=!1)}}class fr extends yt{getDefault(){return s.Color.transparent}set(n){const a=this.current;(n.r!==a.r||n.g!==a.g||n.b!==a.b||n.a!==a.a||this.dirty)&&(this.gl.blendColor(n.r,n.g,n.b,n.a),this.current=n,this.dirty=!1)}}class fn extends yt{getDefault(){return this.gl.FUNC_ADD}set(n){(n!==this.current||this.dirty)&&(this.gl.blendEquation(n),this.current=n,this.dirty=!1)}}class qn extends yt{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;n?a.enable(a.CULL_FACE):a.disable(a.CULL_FACE),this.current=n,this.dirty=!1}}class _r extends yt{getDefault(){return this.gl.BACK}set(n){(n!==this.current||this.dirty)&&(this.gl.cullFace(n),this.current=n,this.dirty=!1)}}class Bn extends yt{getDefault(){return this.gl.CCW}set(n){(n!==this.current||this.dirty)&&(this.gl.frontFace(n),this.current=n,this.dirty=!1)}}let gr,$n=class extends yt{getDefault(){return null}set(l){(l!==this.current||this.dirty)&&(this.gl.useProgram(l),this.current=l,this.dirty=!1)}};class Wn extends yt{getDefault(){return this.gl.TEXTURE0}set(n){(n!==this.current||this.dirty)&&(this.gl.activeTexture(n),this.current=n,this.dirty=!1)}}class _n extends yt{getDefault(){const n=this.gl;return[0,0,n.drawingBufferWidth,n.drawingBufferHeight]}set(n){const a=this.current;(n[0]!==a[0]||n[1]!==a[1]||n[2]!==a[2]||n[3]!==a[3]||this.dirty)&&(this.gl.viewport(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class Fn extends yt{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;a.bindFramebuffer(a.FRAMEBUFFER,n),this.current=n,this.dirty=!1}}class Un extends yt{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;a.bindRenderbuffer(a.RENDERBUFFER,n),this.current=n,this.dirty=!1}}class Hn extends yt{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;a.bindTexture(a.TEXTURE_2D,n),this.current=n,this.dirty=!1}}class $i extends yt{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;a.bindBuffer(a.ARRAY_BUFFER,n),this.current=n,this.dirty=!1}}class Q extends yt{getDefault(){return null}set(n){const a=this.gl;a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,n),this.current=n,this.dirty=!1}}class O extends yt{constructor(n){super(n),this.vao=n.extVertexArrayObject}getDefault(){return null}set(n){this.vao&&(n!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(n),this.current=n,this.dirty=!1)}}class B extends yt{getDefault(){return 4}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_ALIGNMENT,n),this.current=n,this.dirty=!1}}class K extends yt{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n),this.current=n,this.dirty=!1}}class re extends yt{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,n),this.current=n,this.dirty=!1}}class ue extends yt{constructor(n,a){super(n),this.context=n,this.parent=a}getDefault(){return null}}class me extends ue{setDirty(){this.dirty=!0}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,n,0),this.current=n,this.dirty=!1}}class fe extends ue{attachment(){return this.gl.DEPTH_ATTACHMENT}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferRenderbuffer(a.FRAMEBUFFER,this.attachment(),a.RENDERBUFFER,n),this.current=n,this.dirty=!1}}class he extends fe{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class xe{constructor(n,a,h,d){this.context=n,this.width=a,this.height=h;const m=this.framebuffer=n.gl.createFramebuffer();this.colorAttachment=new me(n,m),d&&(this.depthAttachment=new fe(n,m))}destroy(){const n=this.context.gl,a=this.colorAttachment.get();if(a&&n.deleteTexture(a),this.depthAttachment){const h=this.depthAttachment.get();h&&n.deleteRenderbuffer(h)}n.deleteFramebuffer(this.framebuffer)}}class Ge{constructor(n,a=!1){if(this.gl=n,this.isWebGL2=a,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),a){const h=n;this.extVertexArrayObject={createVertexArrayOES:h.createVertexArray.bind(n),deleteVertexArrayOES:h.deleteVertexArray.bind(n),bindVertexArrayOES:h.bindVertexArray.bind(n)}}this.clearColor=new en(this),this.clearDepth=new Di(this),this.clearStencil=new lr(this),this.colorMask=new ii(this),this.depthMask=new qi(this),this.stencilMask=new bn(this),this.stencilFunc=new wn(this),this.stencilOp=new tn(this),this.stencilTest=new Gn(this),this.depthRange=new Rn(this),this.depthTest=new En(this),this.depthFunc=new On(this),this.blend=new Li(this),this.blendFunc=new mn(this),this.blendColor=new fr(this),this.blendEquation=new fn(this),this.cullFace=new qn(this),this.cullFaceSide=new _r(this),this.frontFace=new Bn(this),this.program=new $n(this),this.activeTexture=new Wn(this),this.viewport=new _n(this),this.bindFramebuffer=new Fn(this),this.bindRenderbuffer=new Un(this),this.bindTexture=new Hn(this),this.bindVertexBuffer=new $i(this),this.bindElementBuffer=new Q(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new O(this),this.pixelStoreUnpack=new B(this),this.pixelStoreUnpackPremultiplyAlpha=new K(this),this.pixelStoreUnpackFlipY=new re(this),this.extTextureFilterAnisotropic=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=n.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extDebugRendererInfo=n.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=n.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=n.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),a||(this.extTextureHalfFloat=n.getExtension("OES_texture_half_float")),(a||this.extTextureHalfFloat&&n.getExtension("OES_texture_half_float_linear"))&&(this.extRenderToTextureHalfFloat=n.getExtension("EXT_color_buffer_half_float")),this.extStandardDerivatives=a||n.getExtension("OES_standard_derivatives"),this.extTimerQuery=n.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=n.getParameter(n.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(n,a){return new Ln(this,n,a)}createVertexBuffer(n,a,h){return new $t(this,n,a,h)}createRenderbuffer(n,a,h){const d=this.gl,m=d.createRenderbuffer();return this.bindRenderbuffer.set(m),d.renderbufferStorage(d.RENDERBUFFER,n,a,h),this.bindRenderbuffer.set(null),m}createFramebuffer(n,a,h){return new xe(this,n,a,h)}clear({color:n,depth:a,stencil:h}){const d=this.gl;let m=0;n&&(m|=d.COLOR_BUFFER_BIT,this.clearColor.set(n),this.colorMask.set([!0,!0,!0,!0])),void 0!==a&&(m|=d.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(a),this.depthMask.set(!0)),void 0!==h&&(m|=d.STENCIL_BUFFER_BIT,this.clearStencil.set(h),this.stencilMask.set(255)),d.clear(m)}setCullFace(n){!1===n.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(n.mode),this.frontFace.set(n.frontFace))}setDepthMode(n){n.func!==this.gl.ALWAYS||n.mask?(this.depthTest.set(!0),this.depthFunc.set(n.func),this.depthMask.set(n.mask),this.depthRange.set(n.range)):this.depthTest.set(!1)}setStencilMode(n){n.test.func!==this.gl.ALWAYS||n.mask?(this.stencilTest.set(!0),this.stencilMask.set(n.mask),this.stencilOp.set([n.fail,n.depthFail,n.pass]),this.stencilFunc.set({func:n.test.func,ref:n.ref,mask:n.test.mask})):this.stencilTest.set(!1)}setColorMode(n){M(n.blendFunction,s.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(n.blendFunction),this.blendColor.set(n.blendColor)),this.colorMask.set(n.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class Ke extends s.Evented{constructor(n,a,h,d){if(super(),this.id=n,this.dispatcher=h,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,s.extend(this,s.pick(a,["url","scheme","tileSize","promoteId"])),this._options=s.extend({type:"vector"},a),this._collectResourceTiming=a.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(d),this._tileWorkers={},this._deduped=new s.DedupedRequest}load(n){this._loaded=!1,this.fire(new s.Event("dataloading",{dataType:"source"}));const a=Array.isArray(this.map._language)?this.map._language.join():this.map._language,h=this.map._worldview;this._tileJSONRequest=zi(this._options,this.map._requestManager,a,h,(d,m)=>{this._tileJSONRequest=null,this._loaded=!0,d?(a&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${a}`),h&&2!==h.length&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${h}`),this.fire(new s.ErrorEvent(d))):m&&(s.extend(this,m),m.bounds&&(this.tileBounds=new ji(m.bounds,this.minzoom,this.maxzoom)),s.postTurnstileEvent(m.tiles,this.map._requestManager._customAccessToken),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"content"}))),n&&n(d)})}loaded(){return this._loaded}hasTile(n){return!this.tileBounds||this.tileBounds.contains(n.canonical)}onAdd(n){this.map=n,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(n){return this._options.tiles=n,this.reload(),this}setUrl(n){return this.url=n,this._options.url=n,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return s.extend({},this._options)}loadTile(n,a){const h=this.map._requestManager.normalizeTileURL(n.tileID.canonical.url(this.tiles,this.scheme)),d={request:this.map._requestManager.transformRequest(h,s.ResourceType.Tile),data:void 0,uid:n.uid,tileID:n.tileID,tileZoom:n.tileZoom,zoom:n.tileID.overscaledZ,tileSize:this.tileSize*n.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:s.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:n.isSymbolTile};if(d.request.collectResourceTiming=this._collectResourceTiming,n.actor&&"expired"!==n.state)"loading"===n.state?n.reloadCallback=a:n.request=n.actor.send("reloadTile",d,m.bind(this));else if(n.actor=this._tileWorkers[h]=this._tileWorkers[h]||this.dispatcher.getActor(),this.dispatcher.ready)n.request=n.actor.send("loadTile",d,m.bind(this),void 0,!0);else{const g=s.loadVectorTile.call({deduped:this._deduped},d,(y,v)=>{y||!v?m.call(this,y):(d.data={cacheControl:v.cacheControl,expires:v.expires,rawData:v.rawData.slice(0)},n.actor&&n.actor.send("loadTile",d,m.bind(this),void 0,!0))},!0);n.request={cancel:g}}function m(g,y){return delete n.request,n.aborted?a(null):g&&404!==g.status?a(g):(y&&y.resourceTiming&&(n.resourceTiming=y.resourceTiming),this.map._refreshExpiredTiles&&y&&n.setExpiryData(y),n.loadVectorData(y,this.map.painter),s.cacheEntryPossiblyAdded(this.dispatcher),a(null),void(n.reloadCallback&&(this.loadTile(n,n.reloadCallback),n.reloadCallback=null)))}}abortTile(n){n.request&&(n.request.cancel(),delete n.request),n.actor&&n.actor.send("abortTile",{uid:n.uid,type:this.type,source:this.id})}unloadTile(n){n.unloadVectorData(),n.actor&&n.actor.send("removeTile",{uid:n.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class je extends s.Evented{constructor(n,a,h,d){super(),this.id=n,this.dispatcher=h,this.setEventedParent(d),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=s.extend({type:"raster"},a),s.extend(this,s.pick(a,["url","scheme","tileSize"]))}load(n){this._loaded=!1,this.fire(new s.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=zi(this._options,this.map._requestManager,null,null,(a,h)=>{this._tileJSONRequest=null,this._loaded=!0,a?this.fire(new s.ErrorEvent(a)):h&&(s.extend(this,h),h.bounds&&(this.tileBounds=new ji(h.bounds,this.minzoom,this.maxzoom)),s.postTurnstileEvent(h.tiles),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"content"}))),n&&n(a)})}loaded(){return this._loaded}onAdd(n){this.map=n,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(n){return this._options.tiles=n,this.reload(),this}setUrl(n){return this.url=n,this._options.url=n,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return s.extend({},this._options)}hasTile(n){return!this.tileBounds||this.tileBounds.contains(n.canonical)}loadTile(n,a){const h=s.exported.devicePixelRatio>=2,d=this.map._requestManager.normalizeTileURL(n.tileID.canonical.url(this.tiles,this.scheme),h,this.tileSize);n.request=s.getImage(this.map._requestManager.transformRequest(d,s.ResourceType.Tile),(m,g,y,v)=>(delete n.request,n.aborted?(n.state="unloaded",a(null)):m?(n.state="errored",a(m)):g?(this.map._refreshExpiredTiles&&n.setExpiryData({cacheControl:y,expires:v}),n.setTexture(g,this.map.painter),n.state="loaded",s.cacheEntryPossiblyAdded(this.dispatcher),void a(null)):a(null)))}static loadTileData(n,a,h){n.setTexture(a,h)}static unloadTileData(n,a){n.texture&&a.saveTileTexture(n.texture)}abortTile(n,a){n.request&&(n.request.cancel(),delete n.request),a()}unloadTile(n,a){n.texture&&this.map.painter.saveTileTexture(n.texture),a()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function Ct(l,n,a,h,d,m,g,y){const v=[l,a,d,n,h,m,1,1,1],A=[g,y,1],k=s.adjoint([],v),[S,U,j]=s.transformMat3(A,A,s.transpose(k,k));return s.multiply$1(v,[S,0,0,0,U,0,0,0,j],v)}class Ft extends s.Evented{constructor(n,a,h,d){super(),this.id=n,this.dispatcher=h,this.coordinates=a.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(d),this.options=a,this._dirty=!1}load(n,a){this._loaded=a||!1,this.fire(new s.Event("dataloading",{dataType:"source"})),this.url=this.options.url,this._imageRequest=s.getImage(this.map._requestManager.transformRequest(this.url,s.ResourceType.Image),(h,d)=>{if(this._imageRequest=null,this._loaded=!0,h)this.fire(new s.ErrorEvent(h));else if(d){const{HTMLImageElement:m}=s.window;this.image=d instanceof m?s.exported.getImageData(d):d,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,n&&(this.coordinates=n),this._finishLoading()}})}loaded(){return this._loaded}updateImage(n){return this.image&&n.url?(this._imageRequest&&n.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=n.url,this.load(n.coordinates,this._loaded),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(n){this.map=n,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),this.texture&&this.texture.destroy()}setCoordinates(n){this.coordinates=n,this._boundsArray=void 0;const a=n.map(s.MercatorCoordinate.fromLngLat);return this.tileID=function(h){let d=1/0,m=1/0,g=-1/0,y=-1/0;for(const S of h)d=Math.min(d,S.x),m=Math.min(m,S.y),g=Math.max(g,S.x),y=Math.max(y,S.y);const v=Math.max(g-d,y-m),A=Math.max(0,Math.floor(-Math.log(v)/Math.LN2)),k=Math.pow(2,A);return new s.CanonicalTileID(A,Math.floor((d+g)/2*k),Math.floor((m+y)/2*k))}(a),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new s.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(n){for(const v in this.tiles){const A=this.tiles[v];"loaded"!==A.state&&(A.state="loaded",A.texture=this.texture)}if(this._boundsArray)return;const a=s.tileTransform(this.tileID,this.map.transform.projection),[h,d,m,g]=this.coordinates.map(v=>{const A=a.projection.project(v[0],v[1]);return s.getTilePoint(a,A)._round()});this.perspectiveTransform=function(v,A,k,S,U,j,G,Z,$,P){const N=Ct(0,0,v,0,0,A,v,A),X=Ct(k,S,U,j,G,Z,$,P);return s.multiply$1(X,s.adjoint(N,N),X),[X[6]/X[8]*v/s.EXTENT,X[7]/X[8]*A/s.EXTENT]}(this.width,this.height,h.x,h.y,d.x,d.y,g.x,g.y,m.x,m.y);const y=this._boundsArray=new s.StructArrayLayout4i8;y.emplaceBack(h.x,h.y,0,0),y.emplaceBack(d.x,d.y,s.EXTENT,0),y.emplaceBack(g.x,g.y,0,s.EXTENT),y.emplaceBack(m.x,m.y,s.EXTENT,s.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=n.createVertexBuffer(y,s.boundsAttributes.members),this.boundsSegments=s.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(0===Object.keys(this.tiles).length||!this.image)return;const n=this.map.painter.context,a=n.gl;this._dirty&&(this.texture?this.texture.update(this.image):(this.texture=new s.Texture(n,this.image,a.RGBA),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE)),this._dirty=!1),this._prepareData(n)}loadTile(n,a){this.tileID&&this.tileID.equals(n.tileID.canonical)?(this.tiles[String(n.tileID.wrap)]=n,n.buckets={},a(null)):(n.state="errored",a(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const It={vector:Ke,raster:je,"raster-dem":class extends je{constructor(l,n,a,h){super(l,n,a,h),this.type="raster-dem",this.maxzoom=22,this._options=s.extend({type:"raster-dem"},n),this.encoding=n.encoding||"mapbox"}loadTile(l,n){const a=this.map._requestManager.normalizeTileURL(l.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function h(d,m){d&&(l.state="errored",n(d)),m&&(l.dem=m,l.dem.onDeserialize(),l.needsHillshadePrepare=!0,l.needsDEMTextureUpload=!0,l.state="loaded",n(null))}l.request=s.getImage(this.map._requestManager.transformRequest(a,s.ResourceType.Tile),function(d,m,g,y){if(delete l.request,l.aborted)l.state="unloaded",n(null);else if(d)l.state="errored",n(d);else if(m){this.map._refreshExpiredTiles&&l.setExpiryData({cacheControl:g,expires:y});const v=s.window.ImageBitmap&&m instanceof s.window.ImageBitmap&&(null==gr&&(gr=s.window.OffscreenCanvas&&new s.window.OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof s.window.createImageBitmap),gr),A=1-(m.width-s.prevPowerOfTwo(m.width))/2;A<1||l.neighboringTiles||(l.neighboringTiles=this._getNeighboringTiles(l.tileID));const k=v?m:s.exported.getImageData(m,A),S={uid:l.uid,coord:l.tileID,source:this.id,rawImageData:k,encoding:this.encoding,padding:A};l.actor&&"expired"!==l.state||(l.actor=this.dispatcher.getActor(),l.actor.send("loadDEMTile",S,h.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(l){const n=l.canonical,a=Math.pow(2,n.z),h=(n.x-1+a)%a,d=0===n.x?l.wrap-1:l.wrap,m=(n.x+1+a)%a,g=n.x+1===a?l.wrap+1:l.wrap,y={};return y[new s.OverscaledTileID(l.overscaledZ,d,n.z,h,n.y).key]={backfilled:!1},y[new s.OverscaledTileID(l.overscaledZ,g,n.z,m,n.y).key]={backfilled:!1},n.y>0&&(y[new s.OverscaledTileID(l.overscaledZ,d,n.z,h,n.y-1).key]={backfilled:!1},y[new s.OverscaledTileID(l.overscaledZ,l.wrap,n.z,n.x,n.y-1).key]={backfilled:!1},y[new s.OverscaledTileID(l.overscaledZ,g,n.z,m,n.y-1).key]={backfilled:!1}),n.y+1<a&&(y[new s.OverscaledTileID(l.overscaledZ,d,n.z,h,n.y+1).key]={backfilled:!1},y[new s.OverscaledTileID(l.overscaledZ,l.wrap,n.z,n.x,n.y+1).key]={backfilled:!1},y[new s.OverscaledTileID(l.overscaledZ,g,n.z,m,n.y+1).key]={backfilled:!1}),y}unloadTile(l){l.demTexture&&this.map.painter.saveTileTexture(l.demTexture),l.fbo&&(l.fbo.destroy(),delete l.fbo),l.dem&&delete l.dem,delete l.neighboringTiles,l.state="unloaded"}},geojson:class extends s.Evented{constructor(l,n,a,h){super(),this.id=l,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=a.getActor(),this.setEventedParent(h),this._data=n.data,this._options=s.extend({},n),this._collectResourceTiming=n.collectResourceTiming,void 0!==n.maxzoom&&(this.maxzoom=n.maxzoom),n.type&&(this.type=n.type),n.attribution&&(this.attribution=n.attribution),this.promoteId=n.promoteId;const d=s.EXTENT/this.tileSize;this.workerOptions=s.extend({source:this.id,cluster:n.cluster||!1,geojsonVtOptions:{buffer:(void 0!==n.buffer?n.buffer:128)*d,tolerance:(void 0!==n.tolerance?n.tolerance:.375)*d,extent:s.EXTENT,maxZoom:this.maxzoom,lineMetrics:n.lineMetrics||!1,generateId:n.generateId||!1},superclusterOptions:{maxZoom:void 0!==n.clusterMaxZoom?n.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,n.clusterMinPoints||2),extent:s.EXTENT,radius:(void 0!==n.clusterRadius?n.clusterRadius:50)*d,log:!1,generateId:n.generateId||!1},clusterProperties:n.clusterProperties,filter:n.filter},n.workerOptions)}onAdd(l){this.map=l,this.setData(this._data)}setData(l){return this._data=l,this._updateWorkerData(),this}getClusterExpansionZoom(l,n){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:l,source:this.id},n),this}getClusterChildren(l,n){return this.actor.send("geojson.getClusterChildren",{clusterId:l,source:this.id},n),this}getClusterLeaves(l,n,a,h){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:l,limit:n,offset:a},h),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new s.Event("dataloading",{dataType:"source"})),this._loaded=!1;const l=s.extend({},this.workerOptions),n=this._data;"string"==typeof n?(l.request=this.map._requestManager.transformRequest(s.exported.resolveURL(n),s.ResourceType.Source),l.request.collectResourceTiming=this._collectResourceTiming):l.data=JSON.stringify(n),this._pendingLoad=this.actor.send(`${this.type}.loadData`,l,(a,h)=>{if(this._loaded=!0,this._pendingLoad=null,a)this.fire(new s.ErrorEvent(a));else{const d={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&h&&h.resourceTiming&&h.resourceTiming[this.id]&&(d.resourceTiming=h.resourceTiming[this.id]),this.fire(new s.Event("data",d)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(l,n){const a=l.actor?"reloadTile":"loadTile";l.actor=this.actor,l.request=this.actor.send(a,{type:this.type,uid:l.uid,tileID:l.tileID,tileZoom:l.tileZoom,zoom:l.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:s.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(h,d)=>(delete l.request,l.unloadVectorData(),l.aborted?n(null):h?n(h):(l.loadVectorData(d,this.map.painter,"reloadTile"===a),n(null))),void 0,"loadTile"===a)}abortTile(l){l.request&&(l.request.cancel(),delete l.request),l.aborted=!0}unloadTile(l){l.unloadVectorData(),this.actor.send("removeTile",{uid:l.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return s.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends Ft{constructor(l,n,a,h){super(l,n,a,h),this.roundZoom=!0,this.type="video",this.options=n}load(){this._loaded=!1;const l=this.options;this.urls=[];for(const n of l.urls)this.urls.push(this.map._requestManager.transformRequest(n,s.ResourceType.Source).url);s.getVideo(this.urls,(n,a)=>{this._loaded=!0,n?this.fire(new s.ErrorEvent(n)):a&&(this.video=a,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(l){if(this.video){const n=this.video.seekable;l<n.start(0)||l>n.end(0)?this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${n.start(0)} and ${n.end(0)}-second mark.`))):this.video.currentTime=l}}getVideo(){return this.video}onAdd(l){this.map||(this.map=l,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const l=this.map.painter.context,n=l.gl;this.texture?this.video.paused||(this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,this.video)):(this.texture=new s.Texture(l,this.video,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(l)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:Ft,canvas:class extends Ft{constructor(l,n,a,h){super(l,n,a,h),n.coordinates?Array.isArray(n.coordinates)&&4===n.coordinates.length&&!n.coordinates.some(d=>!Array.isArray(d)||2!==d.length||d.some(m=>"number"!=typeof m))||this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${l}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${l}`,null,'missing required property "coordinates"'))),n.animate&&"boolean"!=typeof n.animate&&this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${l}`,null,'optional "animate" property must be a boolean value'))),n.canvas?"string"==typeof n.canvas||n.canvas instanceof s.window.HTMLCanvasElement||this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${l}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new s.ErrorEvent(new s.ValidationError(`sources.${l}`,null,'missing required property "canvas"'))),this.options=n,this.animate=void 0===n.animate||n.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof s.window.HTMLCanvasElement?this.options.canvas:s.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new s.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(l){this.map=l,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let l=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,l=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,l=!0),this._hasInvalidDimensions()||0===Object.keys(this.tiles).length)return;const n=this.map.painter.context;this.texture?(l||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new s.Texture(n,this.canvas,n.gl.RGBA,{premultiply:!0}),this._prepareData(n)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const l of[this.canvas.width,this.canvas.height])if(isNaN(l)||l<=0)return!0;return!1}},custom:class extends s.Evented{constructor(l,n,a,h){super(),this.id=l,this.type="custom",this._dataType="raster",this._dispatcher=a,this._implementation=n,this.setEventedParent(h),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new s.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new s.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new ji(this._implementation.bounds,this.minzoom,this.maxzoom)),n.update=this._update.bind(this),n.clearTiles=this._clearTiles.bind(this),n.coveringTiles=this._coveringTiles.bind(this),s.extend(this,s.pick(n,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return s.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new s.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(l){this._map=l,this._loaded=!1,this.fire(new s.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(l),this.load()}onRemove(l){this._implementation.onRemove&&this._implementation.onRemove(l)}hasTile(l){if(this._implementation.hasTile){const{x:n,y:a,z:h}=l.canonical;return this._implementation.hasTile({x:n,y:a,z:h})}return!this.tileBounds||this.tileBounds.contains(l.canonical)}loadTile(l,n){const{x:a,y:h,z:d}=l.tileID.canonical,m=new s.window.AbortController;l.request=Promise.resolve(this._implementation.loadTile({x:a,y:h,z:d},{signal:m.signal})).then(function(g){return delete l.request,l.aborted?(l.state="unloaded",n(null)):void 0===g?(l.state="errored",n(null)):null===g?(this.loadTileData(l,{width:this.tileSize,height:this.tileSize,data:null}),l.state="loaded",n(null)):(y=g)instanceof s.window.ImageData||y instanceof s.window.HTMLCanvasElement||y instanceof s.window.ImageBitmap||y instanceof s.window.HTMLImageElement?(this.loadTileData(l,g),l.state="loaded",void n(null)):(l.state="errored",n(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)));var y}.bind(this)).catch(g=>{20!==g.code&&(l.state="errored",n(g))}),l.request.cancel=()=>m.abort()}loadTileData(l,n){je.loadTileData(l,n,this._map.painter)}unloadTileData(l){je.unloadTileData(l,this._map.painter)}unloadTile(l,n){if(this.unloadTileData(l),this._implementation.unloadTile){const{x:a,y:h,z:d}=l.tileID.canonical;this._implementation.unloadTile({x:a,y:h,z:d})}n()}abortTile(l,n){l.request&&l.request.cancel&&(l.request.cancel(),delete l.request),n()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(l=>({x:l.canonical.x,y:l.canonical.y,z:l.canonical.z}))}_clearTiles(){this._map.style._clearSource(this.id)}_update(){this.fire(new s.Event("data",{dataType:"source",sourceDataType:"content"}))}}},Ut=function(l,n,a,h){const d=new It[n.type](l,n,a,h);if(d.id!==l)throw new Error(`Expected Source id to be ${l} instead of ${d.id}`);return s.bindAll(["load","abort","unload","serialize","prepare"],d),d};function Zt(l,n){const a=s.identity([]);return s.scale(a,a,[.5*l.width,.5*-l.height,1]),s.translate(a,a,[1,-1,0]),s.multiply(a,a,l.calculateProjMatrix(n.toUnwrapped())),Float32Array.from(a)}function di(l,n,a,h,d,m,g,y=!1){const v=l.tilesIn(h,g,y);v.sort(nn);const A=[];for(const S of v)A.push({wrappedTileID:S.tile.tileID.wrapped().key,queryResults:S.tile.queryRenderedFeatures(n,a,l._state,S,d,m,Zt(l.transform,S.tile.tileID),y)});const k=function(S){const U={},j={};for(const G of S){const Z=G.queryResults,$=G.wrappedTileID,P=j[$]=j[$]||{};for(const N in Z){const X=Z[N],J=P[N]=P[N]||{},oe=U[N]=U[N]||[];for(const ce of X)J[ce.featureIndex]||(J[ce.featureIndex]=!0,oe.push(ce))}}return U}(A);for(const S in k)k[S].forEach(U=>{const j=U.feature,G=j.layer;G&&"background"!==G.type&&"sky"!==G.type&&(j.source=G.source,G["source-layer"]&&(j.sourceLayer=G["source-layer"]),j.state=void 0!==j.id?l.getFeatureState(G["source-layer"],j.id):{})});return k}function pi(l,n){const a=l.getRenderableIds().map(m=>l.getTileByID(m)),h=[],d={};for(let m=0;m<a.length;m++){const g=a[m],y=g.tileID.canonical.key;d[y]||(d[y]=!0,g.querySourceFeatures(h,n))}return h}function nn(l,n){const a=l.tileID,h=n.tileID;return a.overscaledZ-h.overscaledZ||a.canonical.y-h.canonical.y||a.wrap-h.wrap||a.canonical.x-h.canonical.x}function ci(){return null!=Ua.workerClass?new Ua.workerClass:new s.window.Worker(Ua.workerUrl)}const an="mapboxgl_preloaded_worker_pool";class Ri{constructor(){this.active={}}acquire(n){if(!this.workers)for(this.workers=[];this.workers.length<Ri.workerCount;)this.workers.push(new ci);return this.active[n]=!0,this.workers.slice()}release(n){delete this.active[n],0===this.numActive()&&(this.workers.forEach(a=>{a.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[an]}numActive(){return Object.keys(this.active).length}}let Bi;function Vn(){return Bi||(Bi=new Ri),Bi}function Ka(l,n){const a={};for(const h in l)"ref"!==h&&(a[h]=l[h]);return s.refProperties.forEach(h=>{h in n&&(a[h]=n[h])}),a}function Ja(l){l=l.slice();const n=Object.create(null);for(let a=0;a<l.length;a++)n[l[a].id]=l[a];for(let a=0;a<l.length;a++)"ref"in l[a]&&(l[a]=Ka(l[a],n[l[a].ref]));return l}Ri.workerCount=2;const Yt={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function Ar(l,n,a){a.push({command:Yt.addSource,args:[l,n[l]]})}function Yn(l,n,a){n.push({command:Yt.removeSource,args:[l]}),a[l]=!0}function Cr(l,n,a,h){Yn(l,a,h),Ar(l,n,a)}function Wr(l,n,a){let h;for(h in l[a])if(l[a].hasOwnProperty(h)&&"data"!==h&&!M(l[a][h],n[a][h]))return!1;for(h in n[a])if(n[a].hasOwnProperty(h)&&"data"!==h&&!M(l[a][h],n[a][h]))return!1;return!0}function Nn(l,n,a,h,d,m){let g;for(g in n=n||{},l=l||{})l.hasOwnProperty(g)&&(M(l[g],n[g])||a.push({command:m,args:[h,g,n[g],d]}));for(g in n)n.hasOwnProperty(g)&&!l.hasOwnProperty(g)&&(M(l[g],n[g])||a.push({command:m,args:[h,g,n[g],d]}))}function Xn(l){return l.id}function aa(l,n){return l[n.id]=n,l}class oa{constructor(n,a){this.reset(n,a)}reset(n,a){this.points=n||[],this._distances=[0];for(let h=1;h<this.points.length;h++)this._distances[h]=this._distances[h-1]+this.points[h].dist(this.points[h-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(a||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(n){if(1===this.points.length)return this.points[0];n=s.clamp(n,0,1);let a=1,h=this._distances[a];const d=n*this.paddedLength+this.padding;for(;h<d&&a<this._distances.length;)h=this._distances[++a];const m=a-1,g=this._distances[m],y=h-g,v=y>0?(d-g)/y:0;return this.points[m].mult(1-v).add(this.points[a].mult(v))}}class cr{constructor(n,a,h){const d=this.boxCells=[],m=this.circleCells=[];this.xCellCount=Math.ceil(n/h),this.yCellCount=Math.ceil(a/h);for(let g=0;g<this.xCellCount*this.yCellCount;g++)d.push([]),m.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=n,this.height=a,this.xScale=this.xCellCount/n,this.yScale=this.yCellCount/a,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(n,a,h,d,m){this._forEachCell(a,h,d,m,this._insertBoxCell,this.boxUid++),this.boxKeys.push(n),this.bboxes.push(a),this.bboxes.push(h),this.bboxes.push(d),this.bboxes.push(m)}insertCircle(n,a,h,d){this._forEachCell(a-d,h-d,a+d,h+d,this._insertCircleCell,this.circleUid++),this.circleKeys.push(n),this.circles.push(a),this.circles.push(h),this.circles.push(d)}_insertBoxCell(n,a,h,d,m,g){this.boxCells[m].push(g)}_insertCircleCell(n,a,h,d,m,g){this.circleCells[m].push(g)}_query(n,a,h,d,m,g){if(h<0||n>this.width||d<0||a>this.height)return!m&&[];const y=[];if(n<=0&&a<=0&&this.width<=h&&this.height<=d){if(m)return!0;for(let v=0;v<this.boxKeys.length;v++)y.push({key:this.boxKeys[v],x1:this.bboxes[4*v],y1:this.bboxes[4*v+1],x2:this.bboxes[4*v+2],y2:this.bboxes[4*v+3]});for(let v=0;v<this.circleKeys.length;v++){const A=this.circles[3*v],k=this.circles[3*v+1],S=this.circles[3*v+2];y.push({key:this.circleKeys[v],x1:A-S,y1:k-S,x2:A+S,y2:k+S})}return g?y.filter(g):y}return this._forEachCell(n,a,h,d,this._queryCell,y,{hitTest:m,seenUids:{box:{},circle:{}}},g),m?y.length>0:y}_queryCircle(n,a,h,d,m){const g=n-h,y=n+h,v=a-h,A=a+h;if(y<0||g>this.width||A<0||v>this.height)return!d&&[];const k=[];return this._forEachCell(g,v,y,A,this._queryCellCircle,k,{hitTest:d,circle:{x:n,y:a,radius:h},seenUids:{box:{},circle:{}}},m),d?k.length>0:k}query(n,a,h,d,m){return this._query(n,a,h,d,!1,m)}hitTest(n,a,h,d,m){return this._query(n,a,h,d,!0,m)}hitTestCircle(n,a,h,d){return this._queryCircle(n,a,h,!0,d)}_queryCell(n,a,h,d,m,g,y,v){const A=y.seenUids,k=this.boxCells[m];if(null!==k){const U=this.bboxes;for(const j of k)if(!A.box[j]){A.box[j]=!0;const G=4*j;if(n<=U[G+2]&&a<=U[G+3]&&h>=U[G+0]&&d>=U[G+1]&&(!v||v(this.boxKeys[j]))){if(y.hitTest)return g.push(!0),!0;g.push({key:this.boxKeys[j],x1:U[G],y1:U[G+1],x2:U[G+2],y2:U[G+3]})}}}const S=this.circleCells[m];if(null!==S){const U=this.circles;for(const j of S)if(!A.circle[j]){A.circle[j]=!0;const G=3*j;if(this._circleAndRectCollide(U[G],U[G+1],U[G+2],n,a,h,d)&&(!v||v(this.circleKeys[j]))){if(y.hitTest)return g.push(!0),!0;{const Z=U[G],$=U[G+1],P=U[G+2];g.push({key:this.circleKeys[j],x1:Z-P,y1:$-P,x2:Z+P,y2:$+P})}}}}}_queryCellCircle(n,a,h,d,m,g,y,v){const A=y.circle,k=y.seenUids,S=this.boxCells[m];if(null!==S){const j=this.bboxes;for(const G of S)if(!k.box[G]){k.box[G]=!0;const Z=4*G;if(this._circleAndRectCollide(A.x,A.y,A.radius,j[Z+0],j[Z+1],j[Z+2],j[Z+3])&&(!v||v(this.boxKeys[G])))return g.push(!0),!0}}const U=this.circleCells[m];if(null!==U){const j=this.circles;for(const G of U)if(!k.circle[G]){k.circle[G]=!0;const Z=3*G;if(this._circlesCollide(j[Z],j[Z+1],j[Z+2],A.x,A.y,A.radius)&&(!v||v(this.circleKeys[G])))return g.push(!0),!0}}}_forEachCell(n,a,h,d,m,g,y,v){const A=this._convertToXCellCoord(n),k=this._convertToYCellCoord(a),S=this._convertToXCellCoord(h),U=this._convertToYCellCoord(d);for(let j=A;j<=S;j++)for(let G=k;G<=U;G++)if(m.call(this,n,a,h,d,this.xCellCount*G+j,g,y,v))return}_convertToXCellCoord(n){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(n*this.xScale)))}_convertToYCellCoord(n){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(n*this.yScale)))}_circlesCollide(n,a,h,d,m,g){const y=d-n,v=m-a,A=h+g;return A*A>y*y+v*v}_circleAndRectCollide(n,a,h,d,m,g,y){const v=(g-d)/2,A=Math.abs(n-(d+v));if(A>v+h)return!1;const k=(y-m)/2,S=Math.abs(a-(m+k));if(S>k+h)return!1;if(A<=v||S<=k)return!0;const U=A-v,j=S-k;return U*U+j*j<=h*h}}const jn={unknown:0,flipRequired:1,flipNotRequired:2},Mr=Math.tan(85*Math.PI/180);function ke(l,n,a,h,d,m,g){const y=s.create();if(a)if("globe"===m.name){const v=s.calculateGlobeLabelMatrix(d,n);s.multiply(y,y,v)}else{const v=Pe([],g);y[0]=v[0],y[1]=v[1],y[4]=v[2],y[5]=v[3],h||s.rotateZ(y,y,d.angle)}else s.multiply(y,d.labelPlaneMatrix,l);return y}function Kn(l,n,a,h,d,m,g){const y=ke(l,n,a,h,d,m,g);return"globe"===m.name&&a||(y[2]=y[6]=y[10]=y[14]=0),y}function Fi(l,n,a,h,d,m,g){if(a){if("globe"===m.name){const y=ke(l,n,a,h,d,m,g);return s.invert(y,y),s.multiply(y,l,y),y}{const y=s.clone(l),v=s.identity([]);return v[0]=g[0],v[1]=g[1],v[4]=g[2],v[5]=g[3],s.multiply(y,y,v),h||s.rotateZ(y,y,-d.angle),y}}return d.glCoordMatrix}function F(l,n,a,h){const d=[l,n,a,1];a?s.transformMat4$1(d,d,h):At(d,d,h);const m=d[3];return d[0]/=m,d[1]/=m,d[2]/=m,d}function R(l,n){return Math.min(.5+l/n*.5,1.5)}function ie(l,n){const a=l[0]/l[3],h=l[1]/l[3];return a>=-n[0]&&a<=n[0]&&h>=-n[1]&&h<=n[1]}function q(l,n,a,h,d,m,g,y,v,A){const k=a.transform,S=h?l.textSizeData:l.iconSizeData,U=s.evaluateSizeForZoom(S,a.transform.zoom),j="globe"===k.projection.name,G=[256/a.width*2+1,256/a.height*2+1],Z=h?l.text.dynamicLayoutVertexArray:l.icon.dynamicLayoutVertexArray;Z.clear();let $=null;j&&($=h?l.text.globeExtVertexArray:l.icon.globeExtVertexArray);const P=l.lineVertexArray,N=h?l.text.placedSymbolArray:l.icon.placedSymbolArray,X=a.transform.width/a.transform.height;let J,oe=!1;for(let ce=0;ce<N.length;ce++){const le=N.get(ce),{numGlyphs:pe,writingMode:de}=le;if(de!==s.WritingMode.vertical||oe||J===s.WritingMode.horizontal||(oe=!0),J=de,(le.hidden||de===s.WritingMode.vertical)&&!oe){Kt(pe,Z);continue}oe=!1;const ve=new s.Point(le.tileAnchorX,le.tileAnchorY);let{x:qe,y:_e,z:Le}=k.projection.projectTilePoint(ve.x,ve.y,A.canonical);if(v){const[St,ht,Et]=v(ve);qe+=St,_e+=ht,Le+=Et}const we=[qe,_e,Le,1];if(s.transformMat4$1(we,we,n),!ie(we,G)){Kt(pe,Z);continue}const Ze=R(a.transform.cameraToCenterDistance,we[3]),ye=s.evaluateSizeForFeature(S,U,le),ze=g?ye/Ze:ye*Ze,We=F(qe,_e,Le,d);if(We[3]<=0){Kt(pe,Z);continue}let Be={};const He=g?null:v,gt=z(le,ze,!1,y,n,d,m,l.glyphOffsetArray,P,Z,$,We,ve,Be,X,He,k.projection,A,g);oe=gt.useVertical,He&&gt.needsFlipping&&(Be={}),(gt.notEnoughRoom||oe||gt.needsFlipping&&z(le,ze,!0,y,n,d,m,l.glyphOffsetArray,P,Z,$,We,ve,Be,X,He,k.projection,A,g).notEnoughRoom)&&Kt(pe,Z)}h?(l.text.dynamicLayoutVertexBuffer.updateData(Z),$&&l.text.globeExtVertexBuffer.updateData($)):(l.icon.dynamicLayoutVertexBuffer.updateData(Z),$&&l.icon.globeExtVertexBuffer.updateData($))}function b(l,n,a,h,d,m,g,y,v,A,k,S,U,j,G,Z){const{lineStartIndex:$,glyphStartIndex:P,segment:N}=y,X=P+y.numGlyphs,J=$+y.lineLength,oe=n.getoffsetX(P),ce=n.getoffsetX(X-1),le=_t(l*oe,a,h,d,m,g,N,$,J,v,A,k,S,U,!0,j,G,Z);if(!le)return null;const pe=_t(l*ce,a,h,d,m,g,N,$,J,v,A,k,S,U,!0,j,G,Z);return pe?{first:le,last:pe}:null}function I(l,n,a,h){return l===s.WritingMode.horizontal&&Math.abs(h)>Math.abs(a)?{useVertical:!0}:l===s.WritingMode.vertical?h>0?{needsFlipping:!0}:null:n!==jn.unknown&&(0===(d=a)||Math.abs(h/d)>Mr)?n===jn.flipRequired?{needsFlipping:!0}:null:a<0?{needsFlipping:!0}:null;var d}function z(l,n,a,h,d,m,g,y,v,A,k,S,U,j,G,Z,$,P,N){const X=n/24,J=l.lineOffsetX*X,oe=l.lineOffsetY*X,{lineStartIndex:ce,glyphStartIndex:le,numGlyphs:pe,segment:de,writingMode:ve,flipState:qe}=l,_e=ce+l.lineLength,Le=we=>{if(k){const[We,Be,He]=we.up,gt=A.length;s.updateGlobeVertexNormal(k,gt+0,We,Be,He),s.updateGlobeVertexNormal(k,gt+1,We,Be,He),s.updateGlobeVertexNormal(k,gt+2,We,Be,He),s.updateGlobeVertexNormal(k,gt+3,We,Be,He)}const[Ze,ye,ze]=we.point;s.addDynamicAttributes(A,Ze,ye,ze,we.angle)};if(pe>1){const we=b(X,y,J,oe,a,S,U,l,v,m,j,Z,!1,$,P,N);if(!we)return{notEnoughRoom:!0};if(h&&!a){let[Ze,ye,ze]=we.first.point,[We,Be,He]=we.last.point;[Ze,ye]=F(Ze,ye,ze,g),[We,Be]=F(We,Be,He,g);const gt=I(ve,qe,(We-Ze)*G,Be-ye);if(l.flipState=gt&&gt.needsFlipping?jn.flipRequired:jn.flipNotRequired,gt)return gt}Le(we.first);for(let Ze=le+1;Ze<le+pe-1;Ze++){const ye=_t(X*y.getoffsetX(Ze),J,oe,a,S,U,de,ce,_e,v,m,j,Z,!1,!1,$,P,N);if(!ye)return A.length-=4*(Ze-le),{notEnoughRoom:!0};Le(ye)}Le(we.last)}else{if(h&&!a){const Ze=F(U.x,U.y,0,d),ye=ce+de+1,ze=new s.Point(v.getx(ye),v.gety(ye)),We=F(ze.x,ze.y,0,d),Be=We[3]>0?We:se(U,ze,Ze,1,d,void 0,$,P.canonical),He=I(ve,qe,(Be[0]-Ze[0])*G,Be[1]-Ze[1]);if(l.flipState=He&&He.needsFlipping?jn.flipRequired:jn.flipNotRequired,He)return He}const we=_t(X*y.getoffsetX(le),J,oe,a,S,U,de,ce,_e,v,m,j,Z,!1,!1,$,P,N);if(!we)return{notEnoughRoom:!0};Le(we)}return{}}function W(l,n,a,h,d){const{x:m,y:g,z:y}=h.projectTilePoint(l.x,l.y,n);if(!d)return F(m,g,y,a);const[v,A,k]=d(l);return F(m+v,g+A,y+k,a)}function se(l,n,a,h,d,m,g,y){const v=W(l.sub(n)._unit()._add(l),y,d,g,m);return s.sub(v,a,v),s.normalize(v,v),s.scaleAndAdd(v,a,v,h)}function _t(l,n,a,h,d,m,g,y,v,A,k,S,U,j,G,Z,$,P){const N=h?l-n:l+n;let X=N>0?1:-1,J=0;h&&(X*=-1,J=Math.PI),X<0&&(J+=Math.PI);let oe=y+g+(X>0?0:1)|0,ce=d,le=d,pe=0,de=0;const ve=Math.abs(N),qe=[],_e=[];let Le=m,we=Le;const Ze=()=>se(we,Le,le,ve-pe+1,k,U,Z,$.canonical);for(;pe+de<=ve;){if(oe+=X,oe<y||oe>=v)return null;if(le=ce,we=Le,qe.push(le),j&&_e.push(we),Le=new s.Point(A.getx(oe),A.gety(oe)),ce=S[oe],!ce){const Et=W(Le,$.canonical,k,Z,U);ce=Et[3]>0?S[oe]=Et:Ze()}pe+=de,de=s.distance(le,ce)}G&&U&&(S[oe]&&(ce=Ze(),de=s.distance(le,ce)),S[oe]=ce);const ye=(ve-pe)/de,ze=Le.sub(we)._mult(ye)._add(we),We=s.sub([],ce,le),Be=s.scaleAndAdd([],le,We,ye);let He=[0,0,1],gt=We[0],St=We[1];if(P&&(He=Z.upVector($.canonical,ze.x,ze.y),0!==He[0]||0!==He[1]||1!==He[2])){const Et=[He[2],0,-He[0]],Wt=s.cross([],He,Et);s.normalize(Et,Et),s.normalize(Wt,Wt),gt=s.dot(We,Et),St=s.dot(We,Wt)}if(a){const Et=s.cross([],He,We);s.normalize(Et,Et),s.scaleAndAdd(Be,Be,Et,a*X)}const ht=J+Math.atan2(St,gt);return qe.push(Be),j&&_e.push(ze),{point:Be,angle:ht,path:qe,tilePath:_e,up:He}}function Kt(l,n){const a=n.length,h=a+4*l;n.resize(h),n.float32.fill(-1/0,4*a,4*h)}function At(l,n,a){const h=n[0],d=n[1];return l[0]=a[0]*h+a[4]*d+a[12],l[1]=a[1]*h+a[5]*d+a[13],l[3]=a[3]*h+a[7]*d+a[15],l}const mi=100;class Jn{constructor(n,a,h=new cr(n.width+200,n.height+200,25),d=new cr(n.width+200,n.height+200,25)){this.transform=n,this.grid=h,this.ignoredGrid=d,this.pitchfactor=Math.cos(n._pitch)*n.cameraToCenterDistance,this.screenRightBoundary=n.width+mi,this.screenBottomBoundary=n.height+mi,this.gridRightBoundary=n.width+200,this.gridBottomBoundary=n.height+200,this.fogState=a}placeCollisionBox(n,a,h,d,m,g,y,v){let A=h.projectedAnchorX,k=h.projectedAnchorY,S=h.projectedAnchorZ;const U=h.elevation,j=h.tileID,G=n.getProjection();if(U&&j){const[ce,le,pe]=G.upVector(j.canonical,h.tileAnchorX,h.tileAnchorY),de=G.upVectorScale(j.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;A+=ce*U*de,k+=le*U*de,S+=pe*U*de}const Z=this.projectAndGetPerspectiveRatio(y,A,k,S,h.tileID,"globe"===G.name||!!U||this.transform.pitch>0,G),$=g*Z.perspectiveRatio,P=(h.x1*a+d.x-h.padding)*$+Z.point.x,N=(h.y1*a+d.y-h.padding)*$+Z.point.y,X=(h.x2*a+d.x+h.padding)*$+Z.point.x,J=(h.y2*a+d.y+h.padding)*$+Z.point.y,oe=Z.perspectiveRatio<=.55||Z.occluded;return!this.isInsideGrid(P,N,X,J)||!m&&this.grid.hitTest(P,N,X,J,v)||oe?{box:[],offscreen:!1,occluded:Z.occluded}:{box:[P,N,X,J],offscreen:this.isOffscreen(P,N,X,J),occluded:!1}}placeCollisionCircles(n,a,h,d,m,g,y,v,A,k,S,U,j,G,Z){const $=[],P=this.transform.elevation,N=n.getProjection(),X=P?P.getAtTileOffsetFunc(Z,this.transform.center.lat,this.transform.worldSize,N):null,J=new s.Point(h.tileAnchorX,h.tileAnchorY);let{x:oe,y:ce,z:le}=N.projectTilePoint(J.x,J.y,Z.canonical);if(X){const[ze,We,Be]=X(J);oe+=ze,ce+=We,le+=Be}const pe="globe"===N.name,de=this.projectAndGetPerspectiveRatio(y,oe,ce,le,Z,pe||!!P||this.transform.pitch>0,N),{perspectiveRatio:ve}=de,qe=(S?g/ve:g*ve)/s.ONE_EM,_e=F(oe,ce,le,v),Le=de.signedDistanceFromCamera>0?b(qe,m,h.lineOffsetX*qe,h.lineOffsetY*qe,!1,_e,J,h,d,v,{},P&&!S?X:null,S&&!!P,N,Z,S):null;let we=!1,Ze=!1,ye=!0;if(Le&&!de.occluded){const ze=.5*j*ve+G,We=new s.Point(-100,-100),Be=new s.Point(this.screenRightBoundary,this.screenBottomBoundary),He=new oa,{first:gt,last:St}=Le,ht=gt.path.length;let Et=[];for(let pt=ht-1;pt>=1;pt--)Et.push(gt.path[pt]);for(let pt=1;pt<St.path.length;pt++)Et.push(St.path[pt]);const Wt=2.5*ze;A&&(Et=Et.map(([pt,hi,fi],_i)=>(X&&!pe&&(fi=X(_i<ht-1?gt.tilePath[ht-1-_i]:St.tilePath[_i-ht+2])[2]),F(pt,hi,fi,A))),Et.some(pt=>pt[3]<=0)&&(Et=[]));let qt=[];if(Et.length>0){let pt=1/0,hi=-1/0,fi=1/0,_i=-1/0;for(const gi of Et)pt=Math.min(pt,gi[0]),fi=Math.min(fi,gi[1]),hi=Math.max(hi,gi[0]),_i=Math.max(_i,gi[1]);hi>=We.x&&pt<=Be.x&&_i>=We.y&&fi<=Be.y&&(qt=[Et.map(gi=>new s.Point(gi[0],gi[1]))],(pt<We.x||hi>Be.x||fi<We.y||_i>Be.y)&&(qt=s.clipLine(qt,We.x,We.y,Be.x,Be.y)))}for(const pt of qt){He.reset(pt,.25*ze);let hi=0;hi=He.length<=.5*ze?1:Math.ceil(He.paddedLength/Wt)+1;for(let fi=0;fi<hi;fi++){const _i=fi/Math.max(hi-1,1),gi=He.lerp(_i),yn=gi.x+mi,sn=gi.y+mi;$.push(yn,sn,ze,0);const nr=yn-ze,br=sn-ze,Si=yn+ze,yi=sn+ze;if(ye=ye&&this.isOffscreen(nr,br,Si,yi),Ze=Ze||this.isInsideGrid(nr,br,Si,yi),!a&&this.grid.hitTestCircle(yn,sn,ze,U)&&(we=!0,!k))return{circles:[],offscreen:!1,collisionDetected:we,occluded:!1}}}}return{circles:!k&&we||!Ze?[]:$,offscreen:ye,collisionDetected:we,occluded:de.occluded}}queryRenderedSymbols(n){if(0===n.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const a=[];let h=1/0,d=1/0,m=-1/0,g=-1/0;for(const k of n){const S=new s.Point(k.x+mi,k.y+mi);h=Math.min(h,S.x),d=Math.min(d,S.y),m=Math.max(m,S.x),g=Math.max(g,S.y),a.push(S)}const y=this.grid.query(h,d,m,g).concat(this.ignoredGrid.query(h,d,m,g)),v={},A={};for(const k of y){const S=k.key;if(void 0===v[S.bucketInstanceId]&&(v[S.bucketInstanceId]={}),v[S.bucketInstanceId][S.featureIndex])continue;const U=[new s.Point(k.x1,k.y1),new s.Point(k.x2,k.y1),new s.Point(k.x2,k.y2),new s.Point(k.x1,k.y2)];s.polygonIntersectsPolygon(a,U)&&(v[S.bucketInstanceId][S.featureIndex]=!0,void 0===A[S.bucketInstanceId]&&(A[S.bucketInstanceId]=[]),A[S.bucketInstanceId].push(S.featureIndex))}return A}insertCollisionBox(n,a,h,d,m){(a?this.ignoredGrid:this.grid).insert({bucketInstanceId:h,featureIndex:d,collisionGroupID:m},n[0],n[1],n[2],n[3])}insertCollisionCircles(n,a,h,d,m){const g=a?this.ignoredGrid:this.grid,y={bucketInstanceId:h,featureIndex:d,collisionGroupID:m};for(let v=0;v<n.length;v+=4)g.insertCircle(y,n[v],n[v+1],n[v+2])}projectAndGetPerspectiveRatio(n,a,h,d,m,g,y){const v=[a,h,d,1];let A=!1;d||this.transform.pitch>0?(s.transformMat4$1(v,v,n),this.fogState&&m&&"globe"!==y.name&&(A=function(U,j,G,Z,$,P){const N=P.calculateFogTileMatrix($),X=[j,G,Z];return s.transformMat4(X,X,N),Ce(U,X,P.pitch,P._fov)}(this.fogState,a,h,d,m.toUnwrapped(),this.transform)>.9)):At(v,v,n);const k=v[3];return{point:new s.Point((v[0]/k+1)/2*this.transform.width+mi,(-v[1]/k+1)/2*this.transform.height+mi),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(y)/k*.5,1.5),signedDistanceFromCamera:k,occluded:g&&v[2]>k||A}}isOffscreen(n,a,h,d){return h<mi||n>=this.screenRightBoundary||d<mi||a>this.screenBottomBoundary}isInsideGrid(n,a,h,d){return h>=0&&n<this.gridRightBoundary&&d>=0&&a<this.gridBottomBoundary}getViewportMatrix(){const n=s.identity([]);return s.translate(n,n,[-100,-100,0]),n}}function Dr(l,n,a){const h=n.createTileMatrix(l,l.worldSize,a.toUnwrapped());return s.multiply(new Float32Array(16),l.projMatrix,h)}function Qn(l,n,a){if(n.projection.name===a.projection.name)return l.projMatrix;const h=a.clone();return h.setProjection(n.projection),Dr(h,n.getProjection(),l)}function Ii(l,n,a){return n.name===a.projection.name?l.projMatrix:Dr(a,n,l)}class oc{constructor(n,a,h,d){this.opacity=n?Math.max(0,Math.min(1,n.opacity+(n.placed?a:-a))):d&&h?1:0,this.placed=h}isHidden(){return 0===this.opacity&&!this.placed}}class Ir{constructor(n,a,h,d,m,g=!1){this.text=new oc(n?n.text:null,a,h,m),this.icon=new oc(n?n.icon:null,a,d,m),this.clipped=g}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Qa{constructor(n,a,h,d=!1){this.text=n,this.icon=a,this.skipFade=h,this.clipped=d}}class eo{constructor(){this.invProjMatrix=s.create(),this.viewportMatrix=s.create(),this.circles=[]}}class Ls{constructor(n,a,h,d,m){this.bucketInstanceId=n,this.featureIndex=a,this.sourceLayerIndex=h,this.bucketIndex=d,this.tileID=m}}class sc{constructor(n){this.crossSourceCollisions=n,this.maxGroupID=0,this.collisionGroups={}}get(n){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[n]){const a=++this.maxGroupID;this.collisionGroups[n]={ID:a,predicate:h=>h.collisionGroupID===a}}return this.collisionGroups[n]}}function to(l,n,a,h,d){const{horizontalAlign:m,verticalAlign:g}=s.getAnchorAlignment(l),y=-(m-.5)*n,v=-(g-.5)*a,A=s.evaluateVariableOffset(l,h);return new s.Point(y+A[0]*d,v+A[1]*d)}function io(l,n,a,h,d){const m=new s.Point(l,n);return a&&m._rotate(h?d:-d),m}class Fo{constructor(n,a,h,d,m){this.transform=n.clone(),this.projection=n.projection.name,this.collisionIndex=new Jn(this.transform,m),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=a,this.retainedQueryData={},this.collisionGroups=new sc(h),this.collisionCircleArrays={},this.prevPlacement=d,d&&(d.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(n,a,h,d){const m=h.getBucket(a),g=h.latestFeatureIndex;if(!m||!g||a.id!==m.layerIds[0])return;const y=m.layers[0].layout,v=h.collisionBoxArray,A=Math.pow(2,this.transform.zoom-h.tileID.overscaledZ),k=h.tileSize/s.EXTENT,S=h.tileID.toUnwrapped();this.transform.setProjection(m.projection);const U=(j=h.tileID,G=m.getProjection(),Z=this.transform,G.name===this.projection?Z.calculateProjMatrix(j.toUnwrapped()):Dr(Z,G,j));var j,G,Z;const $="map"===y.get("text-pitch-alignment"),P="map"===y.get("text-rotation-alignment");a.compileFilter();const N=a.dynamicFilter(),X=a.dynamicFilterNeedsFeature(),J=this.transform.calculatePixelsToTileUnitsMatrix(h),oe=Kn(U,h.tileID.canonical,$,P,this.transform,m.getProjection(),J);let ce=null;if($){const de=Fi(U,h.tileID.canonical,$,P,this.transform,m.getProjection(),J);ce=s.multiply([],this.transform.labelPlaneMatrix,de)}let le=null;N&&h.latestFeatureIndex&&(le={unwrappedTileID:S,dynamicFilter:N,dynamicFilterNeedsFeature:X,featureIndex:h.latestFeatureIndex}),this.retainedQueryData[m.bucketInstanceId]=new Ls(m.bucketInstanceId,g,m.sourceLayerIndex,m.index,h.tileID);const pe={bucket:m,layout:y,posMatrix:U,textLabelPlaneMatrix:oe,labelToScreenMatrix:ce,clippingData:le,scale:A,textPixelRatio:k,holdingForFade:h.holdingForFade(),collisionBoxArray:v,partiallyEvaluatedTextSize:s.evaluateSizeForZoom(m.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:s.evaluateSizeForZoom(m.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(m.sourceID)};if(d)for(const de of m.sortKeyRanges){const{sortKey:ve,symbolInstanceStart:qe,symbolInstanceEnd:_e}=de;n.push({sortKey:ve,symbolInstanceStart:qe,symbolInstanceEnd:_e,parameters:pe})}else n.push({symbolInstanceStart:0,symbolInstanceEnd:m.symbolInstances.length,parameters:pe})}attemptAnchorPlacement(n,a,h,d,m,g,y,v,A,k,S,U,j,G,Z,$,P,N){const{textOffset0:X,textOffset1:J,crossTileID:oe}=U,ce=[X,J],le=to(n,h,d,ce,m),pe=this.collisionIndex.placeCollisionBox(G,m,a,io(le.x,le.y,g,y,this.transform.angle),S,v,A,k.predicate);if($){const de=G.getSymbolInstanceIconSize(N,this.transform.zoom,U.placedIconSymbolIndex);if(0===this.collisionIndex.placeCollisionBox(G,de,$,io(le.x,le.y,g,y,this.transform.angle),S,v,A,k.predicate).box.length)return}if(pe.box.length>0){let de;return this.prevPlacement&&this.prevPlacement.variableOffsets[oe]&&this.prevPlacement.placements[oe]&&this.prevPlacement.placements[oe].text&&(de=this.prevPlacement.variableOffsets[oe].anchor),this.variableOffsets[oe]={textOffset:ce,width:h,height:d,anchor:n,textScale:m,prevAnchor:de},this.markUsedJustification(G,n,U,Z),G.allowVerticalPlacement&&(this.markUsedOrientation(G,Z,U),this.placedOrientations[oe]=Z),{shift:le,placedGlyphBoxes:pe}}}placeLayerBucketPart(n,a,h,d){const{bucket:m,layout:g,posMatrix:y,textLabelPlaneMatrix:v,labelToScreenMatrix:A,clippingData:k,textPixelRatio:S,holdingForFade:U,collisionBoxArray:j,partiallyEvaluatedTextSize:G,partiallyEvaluatedIconSize:Z,collisionGroup:$}=n.parameters,P=g.get("text-optional"),N=g.get("icon-optional"),X=g.get("text-allow-overlap"),J=g.get("icon-allow-overlap"),oe="map"===g.get("text-rotation-alignment"),ce="map"===g.get("text-pitch-alignment"),le="none"!==g.get("icon-text-fit"),pe="viewport-y"===g.get("symbol-z-order");this.transform.setProjection(m.projection);let de=X&&(J||!m.hasIconData()||N),ve=J&&(X||!m.hasTextData()||P);!m.collisionArrays&&j&&m.deserializeCollisionBoxes(j),h&&d&&m.updateCollisionDebugBuffers(this.transform.zoom,j);const qe=(_e,Le,we)=>{const{crossTileID:Ze,numVerticalGlyphVertices:ye}=_e;if(k){const Si={zoom:this.transform.zoom,pitch:this.transform.pitch};let yi=null;if(k.dynamicFilterNeedsFeature){const oi=this.retainedQueryData[m.bucketInstanceId];yi=k.featureIndex.loadFeature({featureIndex:_e.featureIndex,bucketIndex:oi.bucketIndex,sourceLayerIndex:oi.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,k.dynamicFilter)(Si,yi,this.retainedQueryData[m.bucketInstanceId].tileID.canonical,new s.Point(_e.tileAnchorX,_e.tileAnchorY),this.transform.calculateDistanceTileData(k.unwrappedTileID)))return this.placements[Ze]=new Qa(!1,!1,!1,!0),void a.add(Ze)}if(a.has(Ze))return;if(U)return void(this.placements[Ze]=new Qa(!1,!1,!1));let ze=!1,We=!1,Be=!0,He=!1,gt=!1,St=null,ht={box:null,offscreen:null,occluded:null},Et={box:null,offscreen:null,occluded:null},Wt=null,qt=null,pt=null,hi=0,fi=0,_i=0;we.textFeatureIndex?hi=we.textFeatureIndex:_e.useRuntimeCollisionCircles&&(hi=_e.featureIndex),we.verticalTextFeatureIndex&&(fi=we.verticalTextFeatureIndex);const gi=Si=>{Si.tileID=this.retainedQueryData[m.bucketInstanceId].tileID;const yi=this.transform.elevation;(yi||Si.elevation)&&(Si.elevation=yi?yi.getAtTileOffset(Si.tileID,Si.tileAnchorX,Si.tileAnchorY):0)},yn=we.textBox;if(yn){gi(yn);const Si=oi=>{let Wi=s.WritingMode.horizontal;if(m.allowVerticalPlacement&&!oi&&this.prevPlacement){const Tn=this.prevPlacement.placedOrientations[Ze];Tn&&(this.placedOrientations[Ze]=Tn,Wi=Tn,this.markUsedOrientation(m,Wi,_e))}return Wi},yi=(oi,Wi)=>{if(m.allowVerticalPlacement&&ye>0&&we.verticalTextBox){for(const Tn of m.writingModes)if(Tn===s.WritingMode.vertical?(ht=Wi(),Et=ht):ht=oi(),ht&&ht.box&&ht.box.length)break}else ht=oi()};if(g.get("text-variable-anchor")){let oi=g.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Ze]){const Mi=this.prevPlacement.variableOffsets[Ze];oi.indexOf(Mi.anchor)>0&&(oi=oi.filter(Cn=>Cn!==Mi.anchor),oi.unshift(Mi.anchor))}const Wi=(Mi,Cn,us)=>{const ma=m.getSymbolInstanceTextSize(G,_e,this.transform.zoom,Le),To=(Mi.x2-Mi.x1)*ma+2*Mi.padding,Br=(Mi.y2-Mi.y1)*ma+2*Mi.padding,Xr=le&&!J?Cn:null;Xr&&gi(Xr);let fa={box:[],offscreen:!1,occluded:!1};const ds=X?2*oi.length:oi.length;for(let Eo=0;Eo<ds;++Eo){const El=this.attemptAnchorPlacement(oi[Eo%oi.length],Mi,To,Br,ma,oe,ce,S,y,$,Eo>=oi.length,_e,Le,m,us,Xr,G,Z);if(El&&(fa=El.placedGlyphBoxes,fa&&fa.box&&fa.box.length)){ze=!0,St=El.shift;break}}return fa};yi(()=>Wi(yn,we.iconBox,s.WritingMode.horizontal),()=>{const Mi=we.verticalTextBox;return Mi&&gi(Mi),m.allowVerticalPlacement&&!(ht&&ht.box&&ht.box.length)&&ye>0&&Mi?Wi(Mi,we.verticalIconBox,s.WritingMode.vertical):{box:null,offscreen:null,occluded:null}}),ht&&(ze=ht.box,Be=ht.offscreen,He=ht.occluded);const Tn=Si(!(!ht||!ht.box));if(!ze&&this.prevPlacement){const Mi=this.prevPlacement.variableOffsets[Ze];Mi&&(this.variableOffsets[Ze]=Mi,this.markUsedJustification(m,Mi.anchor,_e,Tn))}}else{const oi=(Wi,Tn)=>{const Mi=m.getSymbolInstanceTextSize(G,_e,this.transform.zoom,Le),Cn=this.collisionIndex.placeCollisionBox(m,Mi,Wi,new s.Point(0,0),X,S,y,$.predicate);return Cn&&Cn.box&&Cn.box.length&&(this.markUsedOrientation(m,Tn,_e),this.placedOrientations[Ze]=Tn),Cn};yi(()=>oi(yn,s.WritingMode.horizontal),()=>{const Wi=we.verticalTextBox;return m.allowVerticalPlacement&&ye>0&&Wi?(gi(Wi),oi(Wi,s.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}}),Si(!!(ht&&ht.box&&ht.box.length))}}if(Wt=ht,ze=Wt&&Wt.box&&Wt.box.length>0,Be=Wt&&Wt.offscreen,He=Wt&&Wt.occluded,_e.useRuntimeCollisionCircles){const Si=m.text.placedSymbolArray.get(_e.centerJustifiedTextSymbolIndex>=0?_e.centerJustifiedTextSymbolIndex:_e.verticalPlacedTextSymbolIndex),yi=s.evaluateSizeForFeature(m.textSizeData,G,Si),oi=g.get("text-padding");qt=this.collisionIndex.placeCollisionCircles(m,X,Si,m.lineVertexArray,m.glyphOffsetArray,yi,y,v,A,h,ce,$.predicate,_e.collisionCircleDiameter*yi/s.ONE_EM,oi,this.retainedQueryData[m.bucketInstanceId].tileID),ze=X||qt.circles.length>0&&!qt.collisionDetected,Be=Be&&qt.offscreen,He=qt.occluded}if(we.iconFeatureIndex&&(_i=we.iconFeatureIndex),we.iconBox){const Si=yi=>{gi(yi);const oi=le&&St?io(St.x,St.y,oe,ce,this.transform.angle):new s.Point(0,0),Wi=m.getSymbolInstanceIconSize(Z,this.transform.zoom,_e.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(m,Wi,yi,oi,J,S,y,$.predicate)};Et&&Et.box&&Et.box.length&&we.verticalIconBox?(pt=Si(we.verticalIconBox),We=pt.box.length>0):(pt=Si(we.iconBox),We=pt.box.length>0),Be=Be&&pt.offscreen,gt=pt.occluded}const sn=P||0===_e.numHorizontalGlyphVertices&&0===ye,nr=N||0===_e.numIconVertices;if(sn||nr?nr?sn||(We=We&&ze):ze=We&&ze:We=ze=We&&ze,ze&&Wt&&Wt.box&&this.collisionIndex.insertCollisionBox(Wt.box,g.get("text-ignore-placement"),m.bucketInstanceId,Et&&Et.box&&fi?fi:hi,$.ID),We&&pt&&this.collisionIndex.insertCollisionBox(pt.box,g.get("icon-ignore-placement"),m.bucketInstanceId,_i,$.ID),qt&&(ze&&this.collisionIndex.insertCollisionCircles(qt.circles,g.get("text-ignore-placement"),m.bucketInstanceId,hi,$.ID),h)){const Si=m.bucketInstanceId;let yi=this.collisionCircleArrays[Si];void 0===yi&&(yi=this.collisionCircleArrays[Si]=new eo);for(let oi=0;oi<qt.circles.length;oi+=4)yi.circles.push(qt.circles[oi+0]),yi.circles.push(qt.circles[oi+1]),yi.circles.push(qt.circles[oi+2]),yi.circles.push(qt.collisionDetected?1:0)}const br="globe"!==m.projection.name;de=de&&(br||!He),ve=ve&&(br||!gt),this.placements[Ze]=new Qa(ze||de,We||ve,Be||m.justReloaded),a.add(Ze)};if(pe){const _e=m.getSortedSymbolIndexes(this.transform.angle);for(let Le=_e.length-1;Le>=0;--Le){const we=_e[Le];qe(m.symbolInstances.get(we),we,m.collisionArrays[we])}}else for(let _e=n.symbolInstanceStart;_e<n.symbolInstanceEnd;_e++)qe(m.symbolInstances.get(_e),_e,m.collisionArrays[_e]);if(h&&m.bucketInstanceId in this.collisionCircleArrays){const _e=this.collisionCircleArrays[m.bucketInstanceId];s.invert(_e.invProjMatrix,y),_e.viewportMatrix=this.collisionIndex.getViewportMatrix()}m.justReloaded=!1}markUsedJustification(n,a,h,d){const{leftJustifiedTextSymbolIndex:m,centerJustifiedTextSymbolIndex:g,rightJustifiedTextSymbolIndex:y,verticalPlacedTextSymbolIndex:v,crossTileID:A}=h,k=s.getAnchorJustification(a),S=d===s.WritingMode.vertical?v:"left"===k?m:"center"===k?g:"right"===k?y:-1;m>=0&&(n.text.placedSymbolArray.get(m).crossTileID=S>=0&&m!==S?0:A),g>=0&&(n.text.placedSymbolArray.get(g).crossTileID=S>=0&&g!==S?0:A),y>=0&&(n.text.placedSymbolArray.get(y).crossTileID=S>=0&&y!==S?0:A),v>=0&&(n.text.placedSymbolArray.get(v).crossTileID=S>=0&&v!==S?0:A)}markUsedOrientation(n,a,h){const d=a===s.WritingMode.horizontal||a===s.WritingMode.horizontalOnly?a:0,m=a===s.WritingMode.vertical?a:0,{leftJustifiedTextSymbolIndex:g,centerJustifiedTextSymbolIndex:y,rightJustifiedTextSymbolIndex:v,verticalPlacedTextSymbolIndex:A}=h,k=n.text.placedSymbolArray;g>=0&&(k.get(g).placedOrientation=d),y>=0&&(k.get(y).placedOrientation=d),v>=0&&(k.get(v).placedOrientation=d),A>=0&&(k.get(A).placedOrientation=m)}commit(n){this.commitTime=n,this.zoomAtLastRecencyCheck=this.transform.zoom;const a=this.prevPlacement;let h=!1;this.prevZoomAdjustment=a?a.zoomAdjustment(this.transform.zoom):0;const d=a?a.symbolFadeChange(n):1,m=a?a.opacities:{},g=a?a.variableOffsets:{},y=a?a.placedOrientations:{};for(const v in this.placements){const A=this.placements[v],k=m[v];k?(this.opacities[v]=new Ir(k,d,A.text,A.icon,null,A.clipped),h=h||A.text!==k.text.placed||A.icon!==k.icon.placed):(this.opacities[v]=new Ir(null,d,A.text,A.icon,A.skipFade,A.clipped),h=h||A.text||A.icon)}for(const v in m){const A=m[v];if(!this.opacities[v]){const k=new Ir(A,d,!1,!1);k.isHidden()||(this.opacities[v]=k,h=h||A.text.placed||A.icon.placed)}}for(const v in g)this.variableOffsets[v]||!this.opacities[v]||this.opacities[v].isHidden()||(this.variableOffsets[v]=g[v]);for(const v in y)this.placedOrientations[v]||!this.opacities[v]||this.opacities[v].isHidden()||(this.placedOrientations[v]=y[v]);h?this.lastPlacementChangeTime=n:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=a?a.lastPlacementChangeTime:n)}updateLayerOpacities(n,a){const h=new Set;for(const d of a){const m=d.getBucket(n);m&&d.latestFeatureIndex&&n.id===m.layerIds[0]&&this.updateBucketOpacities(m,h,d.collisionBoxArray)}}updateBucketOpacities(n,a,h){n.hasTextData()&&n.text.opacityVertexArray.clear(),n.hasIconData()&&n.icon.opacityVertexArray.clear(),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexArray.clear(),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexArray.clear();const d=n.layers[0].layout,m=!!n.layers[0].dynamicFilter(),g=new Ir(null,0,!1,!1,!0),y=d.get("text-allow-overlap"),v=d.get("icon-allow-overlap"),A=d.get("text-variable-anchor"),k="map"===d.get("text-rotation-alignment"),S="map"===d.get("text-pitch-alignment"),U="none"!==d.get("icon-text-fit"),j=new Ir(null,0,y&&(v||!n.hasIconData()||d.get("icon-optional")),v&&(y||!n.hasTextData()||d.get("text-optional")),!0);!n.collisionArrays&&h&&(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData())&&n.deserializeCollisionBoxes(h);const G=($,P,N)=>{for(let X=0;X<P/4;X++)$.opacityVertexArray.emplaceBack(N)};let Z=0;for(let $=0;$<n.symbolInstances.length;$++){const P=n.symbolInstances.get($),{numHorizontalGlyphVertices:N,numVerticalGlyphVertices:X,crossTileID:J,numIconVertices:oe}=P,ce=a.has(J);let le=this.opacities[J];ce?le=g:le||(le=j,this.opacities[J]=le),a.add(J);const pe=N>0||X>0,de=oe>0,ve=this.placedOrientations[J],qe=ve===s.WritingMode.vertical,_e=ve===s.WritingMode.horizontal||ve===s.WritingMode.horizontalOnly;if(!pe&&!de||le.isHidden()||Z++,pe){const Le=no(le.text);G(n.text,N,qe?Vi:Le),G(n.text,X,_e?Vi:Le);const we=le.text.isHidden(),{leftJustifiedTextSymbolIndex:Ze,centerJustifiedTextSymbolIndex:ye,rightJustifiedTextSymbolIndex:ze,verticalPlacedTextSymbolIndex:We}=P,Be=n.text.placedSymbolArray,He=we||qe?1:0;Ze>=0&&(Be.get(Ze).hidden=He),ye>=0&&(Be.get(ye).hidden=He),ze>=0&&(Be.get(ze).hidden=He),We>=0&&(Be.get(We).hidden=we||_e?1:0);const gt=this.variableOffsets[J];gt&&this.markUsedJustification(n,gt.anchor,P,ve);const St=this.placedOrientations[J];St&&(this.markUsedJustification(n,"left",P,St),this.markUsedOrientation(n,St,P))}if(de){const Le=no(le.icon),{placedIconSymbolIndex:we,verticalPlacedIconSymbolIndex:Ze}=P,ye=n.icon.placedSymbolArray,ze=le.icon.isHidden()?1:0;we>=0&&(G(n.icon,oe,qe?Vi:Le),ye.get(we).hidden=ze),Ze>=0&&(G(n.icon,P.numVerticalIconVertices,_e?Vi:Le),ye.get(Ze).hidden=ze)}if(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData()){const Le=n.collisionArrays[$];if(Le){let we=new s.Point(0,0),Ze=!0;if(Le.textBox||Le.verticalTextBox){if(A){const ze=this.variableOffsets[J];ze?(we=to(ze.anchor,ze.width,ze.height,ze.textOffset,ze.textScale),k&&we._rotate(S?this.transform.angle:-this.transform.angle)):Ze=!1}m&&(Ze=!le.clipped),Le.textBox&&Ta(n.textCollisionBox.collisionVertexArray,le.text.placed,!Ze||qe,we.x,we.y),Le.verticalTextBox&&Ta(n.textCollisionBox.collisionVertexArray,le.text.placed,!Ze||_e,we.x,we.y)}const ye=Ze&&!(_e||!Le.verticalIconBox);Le.iconBox&&Ta(n.iconCollisionBox.collisionVertexArray,le.icon.placed,ye,U?we.x:0,U?we.y:0),Le.verticalIconBox&&Ta(n.iconCollisionBox.collisionVertexArray,le.icon.placed,!ye,U?we.x:0,U?we.y:0)}}}if(n.fullyClipped=0===Z,n.sortFeatures(this.transform.angle),this.retainedQueryData[n.bucketInstanceId]&&(this.retainedQueryData[n.bucketInstanceId].featureSortOrder=n.featureSortOrder),n.hasTextData()&&n.text.opacityVertexBuffer&&n.text.opacityVertexBuffer.updateData(n.text.opacityVertexArray),n.hasIconData()&&n.icon.opacityVertexBuffer&&n.icon.opacityVertexBuffer.updateData(n.icon.opacityVertexArray),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexBuffer&&n.iconCollisionBox.collisionVertexBuffer.updateData(n.iconCollisionBox.collisionVertexArray),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexBuffer&&n.textCollisionBox.collisionVertexBuffer.updateData(n.textCollisionBox.collisionVertexArray),n.bucketInstanceId in this.collisionCircleArrays){const $=this.collisionCircleArrays[n.bucketInstanceId];n.placementInvProjMatrix=$.invProjMatrix,n.placementViewportMatrix=$.viewportMatrix,n.collisionCircleArray=$.circles,delete this.collisionCircleArrays[n.bucketInstanceId]}}symbolFadeChange(n){return 0===this.fadeDuration?1:(n-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(n){return Math.max(0,(this.transform.zoom-n)/1.5)}hasTransitions(n){return this.stale||n-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(n,a){const h=this.zoomAtLastRecencyCheck===a?1-this.zoomAdjustment(a):1;return this.zoomAtLastRecencyCheck=a,this.commitTime+this.fadeDuration*h>n}setStale(){this.stale=!0}}function Ta(l,n,a,h,d){l.emplaceBack(n?1:0,a?1:0,h||0,d||0),l.emplaceBack(n?1:0,a?1:0,h||0,d||0),l.emplaceBack(n?1:0,a?1:0,h||0,d||0),l.emplaceBack(n?1:0,a?1:0,h||0,d||0)}const kn=Math.pow(2,25),Zi=Math.pow(2,24),Rs=Math.pow(2,17),Os=Math.pow(2,16),An=Math.pow(2,9),er=Math.pow(2,8),lc=Math.pow(2,1);function no(l){if(0===l.opacity&&!l.placed)return 0;if(1===l.opacity&&l.placed)return 4294967295;const n=l.placed?1:0,a=Math.floor(127*l.opacity);return a*kn+n*Zi+a*Rs+n*Os+a*An+n*er+a*lc+n}const Vi=0;class ro{constructor(n){this._sortAcrossTiles="viewport-y"!==n.layout.get("symbol-z-order")&&void 0!==n.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(n,a,h,d,m){const g=this._bucketParts;for(;this._currentTileIndex<n.length;)if(a.getBucketParts(g,d,n[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,m())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,g.sort((y,v)=>y.sortKey-v.sortKey));this._currentPartIndex<g.length;){const y=g[this._currentPartIndex];if(a.placeLayerBucketPart(y,this._seenCrossTileIDs,h,0===y.symbolInstanceStart),this._currentPartIndex++,m())return!0}return!1}}class Bs{constructor(n,a,h,d,m,g,y,v){this.placement=new Fo(n,m,g,y,v),this._currentPlacementIndex=a.length-1,this._forceFullPlacement=h,this._showCollisionBoxes=d,this._done=!1}isDone(){return this._done}continuePlacement(n,a,h){const d=s.exported.now(),m=()=>{const g=s.exported.now()-d;return!this._forceFullPlacement&&g>2};for(;this._currentPlacementIndex>=0;){const g=a[n[this._currentPlacementIndex]],y=this.placement.collisionIndex.transform.zoom;if("symbol"===g.type&&(!g.minzoom||g.minzoom<=y)&&(!g.maxzoom||g.maxzoom>y)){if(this._inProgressLayer||(this._inProgressLayer=new ro(g)),this._inProgressLayer.continuePlacement(h[g.source],this.placement,this._showCollisionBoxes,g,m))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(n){return this.placement.commit(n),this.placement}}const sa=512/s.EXTENT/2;class un{constructor(n,a,h){this.tileID=n,this.bucketInstanceId=h,this.index=new s.KDBush(a.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const d=n.canonical.x*s.EXTENT,m=n.canonical.y*s.EXTENT;for(let g=0;g<a.length;g++){const{key:y,crossTileID:v,tileAnchorX:A,tileAnchorY:k}=a.get(g),S=Math.floor((d+A)*sa),U=Math.floor((m+k)*sa);this.index.add(S,U),this.keys.push(y),this.crossTileIDs.push(v)}this.index.finish()}findMatches(n,a,h){const d=this.tileID.canonical.z<a.canonical.z?1:Math.pow(2,this.tileID.canonical.z-a.canonical.z),m=sa/Math.pow(2,a.canonical.z-this.tileID.canonical.z),g=a.canonical.x*s.EXTENT,y=a.canonical.y*s.EXTENT;for(let v=0;v<n.length;v++){const A=n.get(v);if(A.crossTileID)continue;const{key:k,tileAnchorX:S,tileAnchorY:U}=A,j=Math.floor((g+S)*m),G=Math.floor((y+U)*m),Z=this.index.range(j-d,G-d,j+d,G+d);for(const $ of Z){const P=this.crossTileIDs[$];if(this.keys[$]===k&&!h.has(P)){h.add(P),A.crossTileID=P;break}}}}}class Fs{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Us{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(n){const a=Math.round((n-this.lng)/360);if(0!==a)for(const h in this.indexes){const d=this.indexes[h],m={};for(const g in d){const y=d[g];y.tileID=y.tileID.unwrapTo(y.tileID.wrap+a),m[y.tileID.key]=y}this.indexes[h]=m}this.lng=n}addBucket(n,a,h){if(this.indexes[n.overscaledZ]&&this.indexes[n.overscaledZ][n.key]){if(this.indexes[n.overscaledZ][n.key].bucketInstanceId===a.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(n.overscaledZ,this.indexes[n.overscaledZ][n.key])}for(let m=0;m<a.symbolInstances.length;m++)a.symbolInstances.get(m).crossTileID=0;this.usedCrossTileIDs[n.overscaledZ]||(this.usedCrossTileIDs[n.overscaledZ]=new Set);const d=this.usedCrossTileIDs[n.overscaledZ];for(const m in this.indexes){const g=this.indexes[m];if(Number(m)>n.overscaledZ)for(const y in g){const v=g[y];v.tileID.isChildOf(n)&&v.findMatches(a.symbolInstances,n,d)}else{const y=g[n.scaledTo(Number(m)).key];y&&y.findMatches(a.symbolInstances,n,d)}}for(let m=0;m<a.symbolInstances.length;m++){const g=a.symbolInstances.get(m);g.crossTileID||(g.crossTileID=h.generate(),d.add(g.crossTileID))}return void 0===this.indexes[n.overscaledZ]&&(this.indexes[n.overscaledZ]={}),this.indexes[n.overscaledZ][n.key]=new un(n,a.symbolInstances,a.bucketInstanceId),!0}removeBucketCrossTileIDs(n,a){for(const h of a.crossTileIDs)this.usedCrossTileIDs[n].delete(h)}removeStaleBuckets(n){let a=!1;for(const h in this.indexes){const d=this.indexes[h];for(const m in d)n[d[m].bucketInstanceId]||(this.removeBucketCrossTileIDs(h,d[m]),delete d[m],a=!0)}return a}}class Sr{constructor(){this.layerIndexes={},this.crossTileIDs=new Fs,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(n,a,h,d){let m=this.layerIndexes[n.id];void 0===m&&(m=this.layerIndexes[n.id]=new Us);let g=!1;const y={};"globe"!==d.name&&m.handleWrapJump(h);for(const v of a){const A=v.getBucket(n);A&&n.id===A.layerIds[0]&&(A.bucketInstanceId||(A.bucketInstanceId=++this.maxBucketInstanceId),m.addBucket(v.tileID,A,this.crossTileIDs)&&(g=!0),y[A.bucketInstanceId]=!0)}return m.removeStaleBuckets(y)&&(g=!0),g}pruneUnusedLayers(n){const a={};n.forEach(h=>{a[h]=!0});for(const h in this.layerIndexes)a[h]||delete this.layerIndexes[h]}}const Hr=(l,n)=>s.emitValidationErrors(l,n&&n.filter(a=>"source.canvas"!==a.identifier)),Uo=s.pick(Yt,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),Mh=s.pick(Yt,["setCenter","setZoom","setBearing","setPitch"]),Vs={version:8,layers:[],sources:{}},Ea={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class yr extends s.Evented{constructor(n,a={}){super(),this.map=n,this.dispatcher=new st(Vn(),this),this.imageManager=new rt,this.imageManager.setEventedParent(this),this.glyphManager=new s.GlyphManager(n._requestManager,a.localFontFamily?s.LocalGlyphMode.all:a.localIdeographFontFamily?s.LocalGlyphMode.ideographs:s.LocalGlyphMode.none,a.localFontFamily||a.localIdeographFontFamily),this.crossTileSymbolIndex=new Sr,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",s.getReferrer());const h=this;this._rtlTextPluginCallback=yr.registerForPluginStateChange(d=>{h.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:d.pluginStatus,pluginURL:d.pluginURL},(m,g)=>{if(s.triggerPluginCompletionEvent(m),g&&g.every(y=>y))for(const y in h._sourceCaches){const v=h._sourceCaches[y],A=v.getSource().type;"vector"!==A&&"geojson"!==A||v.reload()}})}),this.on("data",d=>{if("source"!==d.dataType||"metadata"!==d.sourceDataType)return;const m=this.getSource(d.sourceId);if(m&&m.vectorLayerIds)for(const g in this._layers){const y=this._layers[g];y.source===m.id&&this._validateLayer(y)}})}loadURL(n,a={}){this.fire(new s.Event("dataloading",{dataType:"style"}));const h="boolean"==typeof a.validate?a.validate:!s.isMapboxURL(n);n=this.map._requestManager.normalizeStyleURL(n,a.accessToken);const d=this.map._requestManager.transformRequest(n,s.ResourceType.Style);this._request=s.getJSON(d,(m,g)=>{this._request=null,m?this.fire(new s.ErrorEvent(m)):g&&this._load(g,h)})}loadJSON(n,a={}){this.fire(new s.Event("dataloading",{dataType:"style"})),this._request=s.exported.frame(()=>{this._request=null,this._load(n,!1!==a.validate)})}loadEmpty(){this.fire(new s.Event("dataloading",{dataType:"style"})),this._load(Vs,!1)}_updateLayerCount(n,a){const h=a?1:-1;n.is3D()&&(this._num3DLayers+=h),"circle"===n.type&&(this._numCircleLayers+=h),"symbol"===n.type&&(this._numSymbolLayers+=h)}_load(n,a){if(a&&Hr(this,s.validateStyle(n)))return;this._loaded=!0,this.stylesheet=s.clone$1(n),this._updateMapProjection();for(const d in n.sources)this.addSource(d,n.sources[d],{validate:!1});this._changed=!1,n.sprite?this._loadSprite(n.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(n.glyphs);const h=Ja(this.stylesheet.layers);this._order=h.map(d=>d.id),this._layers={},this._serializedLayers={};for(const d of h){const m=s.createStyleLayer(d);m.setEventedParent(this,{layer:{id:m.id}}),this._layers[m.id]=m,this._serializedLayers[m.id]=m.serialize(),this._updateLayerCount(m,!0)}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new at(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new s.Event("data",{dataType:"style"})),this.fire(new s.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&0===this.terrain.drapeRenderMode}setProjection(n){n?this.stylesheet.projection=n:delete this.stylesheet.projection,this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.stylesheet.projection)}_loadSprite(n){this._spriteRequest=function(a,h,d){let m,g,y;const v=s.exported.devicePixelRatio>1?"@2x":"";let A=s.getJSON(h.transformRequest(h.normalizeSpriteURL(a,v,".json"),s.ResourceType.SpriteJSON),(U,j)=>{A=null,y||(y=U,m=j,S())}),k=s.getImage(h.transformRequest(h.normalizeSpriteURL(a,v,".png"),s.ResourceType.SpriteImage),(U,j)=>{k=null,y||(y=U,g=j,S())});function S(){if(y)d(y);else if(m&&g){const U=s.exported.getImageData(g),j={};for(const G in m){const{width:Z,height:$,x:P,y:N,sdf:X,pixelRatio:J,stretchX:oe,stretchY:ce,content:le}=m[G],pe=new s.RGBAImage({width:Z,height:$});s.RGBAImage.copy(U,pe,{x:P,y:N},{x:0,y:0},{width:Z,height:$}),j[G]={data:pe,pixelRatio:J,sdf:X,stretchX:oe,stretchY:ce,content:le}}d(null,j)}}return{cancel(){A&&(A.cancel(),A=null),k&&(k.cancel(),k=null)}}}(n,this.map._requestManager,(a,h)=>{if(this._spriteRequest=null,a)this.fire(new s.ErrorEvent(a));else if(h)for(const d in h)this.imageManager.addImage(d,h[d]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new s.Event("data",{dataType:"style"}))})}_validateLayer(n){const a=this.getSource(n.source);if(!a)return;const h=n.sourceLayer;h&&("geojson"===a.type||a.vectorLayerIds&&-1===a.vectorLayerIds.indexOf(h))&&this.fire(new s.ErrorEvent(new Error(`Source layer "${h}" does not exist on source "${a.id}" as specified by style layer "${n.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const n in this._sourceCaches)if(!this._sourceCaches[n].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(n){const a=[];for(const h of n){const d=this._layers[h];"custom"!==d.type&&a.push(d.serialize())}return a}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const n in this._sourceCaches)if(this._sourceCaches[n].hasTransition())return!0;for(const n in this._layers)if(this._layers[n].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(n){return!!this.terrain&&("function"==typeof n.isLayerDraped?n.isLayerDraped():Ea[n.type])}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(n){if(!this._loaded)return;const a=this._changed;if(this._changed){const d=Object.keys(this._updatedLayers),m=Object.keys(this._removedLayers);(d.length||m.length)&&this._updateWorkerLayers(d,m);for(const g in this._updatedSources){const y=this._updatedSources[g];"reload"===y?this._reloadSource(g):"clear"===y&&this._clearSource(g)}this._updateTilesForChangedImages();for(const g in this._updatedPaintProps)this._layers[g].updateTransitions(n);this.light.updateTransitions(n),this.fog&&this.fog.updateTransitions(n),this._resetUpdates()}const h={};for(const d in this._sourceCaches){const m=this._sourceCaches[d];h[d]=m.used,m.used=!1}for(const d of this._order){const m=this._layers[d];if(m.recalculate(n,this._availableImages),!m.isHidden(n.zoom)){const y=this._getLayerSourceCache(m);y&&(y.used=!0)}const g=this.map.painter;if(g){const y=m.getProgramIds();if(!y)continue;const v=m.getProgramConfiguration(n.zoom);for(const A of y)g.useProgram(A,v)}}for(const d in h){const m=this._sourceCaches[d];h[d]!==m.used&&m.getSource().fire(new s.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:m.getSource().id}))}this.light.recalculate(n),this.terrain&&this.terrain.recalculate(n),this.fog&&this.fog.recalculate(n),this.z=n.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),a&&this.fire(new s.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const n=Object.keys(this._changedImages);if(n.length){for(const a in this._sourceCaches)this._sourceCaches[a].reloadTilesForDependencies(["icons","patterns"],n);this._changedImages={}}}_updateWorkerLayers(n,a){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(n),removedIds:a})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(n){if(this._checkLoaded(),Hr(this,s.validateStyle(n)))return!1;(n=s.clone$1(n)).layers=Ja(n.layers);const a=function(d,m){if(!d)return[{command:Yt.setStyle,args:[m]}];let g=[];try{if(!M(d.version,m.version))return[{command:Yt.setStyle,args:[m]}];M(d.center,m.center)||g.push({command:Yt.setCenter,args:[m.center]}),M(d.zoom,m.zoom)||g.push({command:Yt.setZoom,args:[m.zoom]}),M(d.bearing,m.bearing)||g.push({command:Yt.setBearing,args:[m.bearing]}),M(d.pitch,m.pitch)||g.push({command:Yt.setPitch,args:[m.pitch]}),M(d.sprite,m.sprite)||g.push({command:Yt.setSprite,args:[m.sprite]}),M(d.glyphs,m.glyphs)||g.push({command:Yt.setGlyphs,args:[m.glyphs]}),M(d.transition,m.transition)||g.push({command:Yt.setTransition,args:[m.transition]}),M(d.light,m.light)||g.push({command:Yt.setLight,args:[m.light]}),M(d.fog,m.fog)||g.push({command:Yt.setFog,args:[m.fog]}),M(d.projection,m.projection)||g.push({command:Yt.setProjection,args:[m.projection]});const y={},v=[];!function(S,U,j,G){let Z;for(Z in U=U||{},S=S||{})S.hasOwnProperty(Z)&&(U.hasOwnProperty(Z)||Yn(Z,j,G));for(Z in U){if(!U.hasOwnProperty(Z))continue;const $=U[Z];S.hasOwnProperty(Z)?M(S[Z],$)||("geojson"===S[Z].type&&"geojson"===$.type&&Wr(S,U,Z)?j.push({command:Yt.setGeoJSONSourceData,args:[Z,$.data]}):Cr(Z,U,j,G)):Ar(Z,U,j)}}(d.sources,m.sources,v,y);const A=[];d.layers&&d.layers.forEach(S=>{S.source&&y[S.source]?g.push({command:Yt.removeLayer,args:[S.id]}):A.push(S)});let k=d.terrain;k&&y[k.source]&&(g.push({command:Yt.setTerrain,args:[void 0]}),k=void 0),g=g.concat(v),M(k,m.terrain)||g.push({command:Yt.setTerrain,args:[m.terrain]}),function(S,U,j){U=U||[];const G=(S=S||[]).map(Xn),Z=U.map(Xn),$=S.reduce(aa,{}),P=U.reduce(aa,{}),N=G.slice(),X=Object.create(null);let J,oe,ce,le,pe,de,ve;for(J=0,oe=0;J<G.length;J++)ce=G[J],P.hasOwnProperty(ce)?oe++:(j.push({command:Yt.removeLayer,args:[ce]}),N.splice(N.indexOf(ce,oe),1));for(J=0,oe=0;J<Z.length;J++)ce=Z[Z.length-1-J],N[N.length-1-J]!==ce&&($.hasOwnProperty(ce)?(j.push({command:Yt.removeLayer,args:[ce]}),N.splice(N.lastIndexOf(ce,N.length-oe),1)):oe++,de=N[N.length-J],j.push({command:Yt.addLayer,args:[P[ce],de]}),N.splice(N.length-J,0,ce),X[ce]=!0);for(J=0;J<Z.length;J++)if(ce=Z[J],le=$[ce],pe=P[ce],!X[ce]&&!M(le,pe))if(M(le.source,pe.source)&&M(le["source-layer"],pe["source-layer"])&&M(le.type,pe.type)){for(ve in Nn(le.layout,pe.layout,j,ce,null,Yt.setLayoutProperty),Nn(le.paint,pe.paint,j,ce,null,Yt.setPaintProperty),M(le.filter,pe.filter)||j.push({command:Yt.setFilter,args:[ce,pe.filter]}),M(le.minzoom,pe.minzoom)&&M(le.maxzoom,pe.maxzoom)||j.push({command:Yt.setLayerZoomRange,args:[ce,pe.minzoom,pe.maxzoom]}),le)le.hasOwnProperty(ve)&&"layout"!==ve&&"paint"!==ve&&"filter"!==ve&&"metadata"!==ve&&"minzoom"!==ve&&"maxzoom"!==ve&&(0===ve.indexOf("paint.")?Nn(le[ve],pe[ve],j,ce,ve.slice(6),Yt.setPaintProperty):M(le[ve],pe[ve])||j.push({command:Yt.setLayerProperty,args:[ce,ve,pe[ve]]}));for(ve in pe)pe.hasOwnProperty(ve)&&!le.hasOwnProperty(ve)&&"layout"!==ve&&"paint"!==ve&&"filter"!==ve&&"metadata"!==ve&&"minzoom"!==ve&&"maxzoom"!==ve&&(0===ve.indexOf("paint.")?Nn(le[ve],pe[ve],j,ce,ve.slice(6),Yt.setPaintProperty):M(le[ve],pe[ve])||j.push({command:Yt.setLayerProperty,args:[ce,ve,pe[ve]]}))}else j.push({command:Yt.removeLayer,args:[ce]}),de=N[N.lastIndexOf(ce)+1],j.push({command:Yt.addLayer,args:[pe,de]})}(A,m.layers,g)}catch(y){console.warn("Unable to compute style diff:",y),g=[{command:Yt.setStyle,args:[m]}]}return g}(this.serialize(),n).filter(d=>!(d.command in Mh));if(0===a.length)return!1;const h=a.filter(d=>!(d.command in Uo));if(h.length>0)throw new Error(`Unimplemented: ${h.map(d=>d.command).join(", ")}.`);return a.forEach(d=>{"setTransition"!==d.command&&"setProjection"!==d.command&&this[d.command].apply(this,d.args)}),this.stylesheet=n,this._updateMapProjection(),!0}addImage(n,a){return this.getImage(n)?this.fire(new s.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(n,a),this._afterImageUpdated(n),this)}updateImage(n,a){this.imageManager.updateImage(n,a)}getImage(n){return this.imageManager.getImage(n)}removeImage(n){return this.getImage(n)?(this.imageManager.removeImage(n),this._afterImageUpdated(n),this):this.fire(new s.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(n){this._availableImages=this.imageManager.listImages(),this._changedImages[n]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new s.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(n,a,h={}){if(this._checkLoaded(),void 0!==this.getSource(n))throw new Error("There is already a source with this ID");if(!a.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(a).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(a.type)>=0&&this._validate(s.validateSource,`sources.${n}`,a,null,h))return;this.map&&this.map._collectResourceTiming&&(a.collectResourceTiming=!0);const d=Ut(n,a,this.dispatcher,this);d.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(n),source:d.serialize(),sourceId:n}));const m=g=>{const y=(g?"symbol:":"other:")+n,v=this._sourceCaches[y]=new s.SourceCache(y,d,g);(g?this._symbolSourceCaches:this._otherSourceCaches)[n]=v,v.style=this,v.onAdd(this.map)};m(!1),"vector"!==a.type&&"geojson"!==a.type||m(!0),d.onAdd&&d.onAdd(this.map),this._changed=!0}removeSource(n){this._checkLoaded();const a=this.getSource(n);if(!a)throw new Error("There is no source with this ID");for(const d in this._layers)if(this._layers[d].source===n)return this.fire(new s.ErrorEvent(new Error(`Source "${n}" cannot be removed while layer "${d}" is using it.`)));if(this.terrain&&this.terrain.get().source===n)return this.fire(new s.ErrorEvent(new Error(`Source "${n}" cannot be removed while terrain is using it.`)));const h=this._getSourceCaches(n);for(const d of h)delete this._sourceCaches[d.id],delete this._updatedSources[d.id],d.fire(new s.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:d.getSource().id})),d.setEventedParent(null),d.clearTiles();return delete this._otherSourceCaches[n],delete this._symbolSourceCaches[n],a.setEventedParent(null),a.onRemove&&a.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(n,a){this._checkLoaded(),this.getSource(n).setData(a),this._changed=!0}getSource(n){const a=this._getSourceCache(n);return a&&a.getSource()}_getSources(){const n=[];for(const a in this._otherSourceCaches){const h=this._getSourceCache(a);h&&n.push(h.getSource())}return n}addLayer(n,a,h={}){this._checkLoaded();const d=n.id;if(this.getLayer(d))return void this.fire(new s.ErrorEvent(new Error(`Layer with id "${d}" already exists on this map`)));let m;if("custom"===n.type){if(Hr(this,s.validateCustomStyleLayer(n)))return;m=s.createStyleLayer(n)}else{if("object"==typeof n.source&&(this.addSource(d,n.source),n=s.clone$1(n),n=s.extend(n,{source:d})),this._validate(s.validateLayer,`layers.${d}`,n,{arrayIndex:-1},h))return;m=s.createStyleLayer(n),this._validateLayer(m),m.setEventedParent(this,{layer:{id:d}}),this._serializedLayers[m.id]=m.serialize(),this._updateLayerCount(m,!0)}const g=a?this._order.indexOf(a):this._order.length;if(a&&-1===g)return void this.fire(new s.ErrorEvent(new Error(`Layer with id "${a}" does not exist on this map.`)));this._order.splice(g,0,d),this._layerOrderChanged=!0,this._layers[d]=m;const y=this._getLayerSourceCache(m);if(this._removedLayers[d]&&m.source&&y&&"custom"!==m.type){const v=this._removedLayers[d];delete this._removedLayers[d],v.type!==m.type?this._updatedSources[m.source]="clear":(this._updatedSources[m.source]="reload",y.pause())}this._updateLayer(m),m.onAdd&&m.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(n,a){if(this._checkLoaded(),this._changed=!0,!this._layers[n])return void this.fire(new s.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be moved.`)));if(n===a)return;const h=this._order.indexOf(n);this._order.splice(h,1);const d=a?this._order.indexOf(a):this._order.length;a&&-1===d?this.fire(new s.ErrorEvent(new Error(`Layer with id "${a}" does not exist on this map.`))):(this._order.splice(d,0,n),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(n){this._checkLoaded();const a=this._layers[n];if(!a)return void this.fire(new s.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be removed.`)));a.setEventedParent(null),this._updateLayerCount(a,!1);const h=this._order.indexOf(n);this._order.splice(h,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[n]=a,delete this._layers[n],delete this._serializedLayers[n],delete this._updatedLayers[n],delete this._updatedPaintProps[n],a.onRemove&&a.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(n){return this._layers[n]}hasLayer(n){return n in this._layers}hasLayerType(n){for(const a in this._layers)if(this._layers[a].type===n)return!0;return!1}setLayerZoomRange(n,a,h){this._checkLoaded();const d=this.getLayer(n);d?d.minzoom===a&&d.maxzoom===h||(null!=a&&(d.minzoom=a),null!=h&&(d.maxzoom=h),this._updateLayer(d)):this.fire(new s.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(n,a,h={}){this._checkLoaded();const d=this.getLayer(n);if(d){if(!M(d.filter,a))return null==a?(d.filter=void 0,void this._updateLayer(d)):void(this._validate(s.validateFilter,`layers.${d.id}.filter`,a,{layerType:d.type},h)||(d.filter=s.clone$1(a),this._updateLayer(d)))}else this.fire(new s.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be filtered.`)))}getFilter(n){const a=this.getLayer(n);return a&&s.clone$1(a.filter)}setLayoutProperty(n,a,h,d={}){this._checkLoaded();const m=this.getLayer(n);m?M(m.getLayoutProperty(a),h)||(m.setLayoutProperty(a,h,d),this._updateLayer(m)):this.fire(new s.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(n,a){const h=this.getLayer(n);if(h)return h.getLayoutProperty(a);this.fire(new s.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style.`)))}setPaintProperty(n,a,h,d={}){this._checkLoaded();const m=this.getLayer(n);m?M(m.getPaintProperty(a),h)||(m.setPaintProperty(a,h,d)&&this._updateLayer(m),this._changed=!0,this._updatedPaintProps[n]=!0):this.fire(new s.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(n,a){const h=this.getLayer(n);return h&&h.getPaintProperty(a)}setFeatureState(n,a){this._checkLoaded();const h=n.source,d=n.sourceLayer,m=this.getSource(h);if(!m)return void this.fire(new s.ErrorEvent(new Error(`The source '${h}' does not exist in the map's style.`)));const g=m.type;if("geojson"===g&&d)return void this.fire(new s.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===g&&!d)return void this.fire(new s.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));void 0===n.id&&this.fire(new s.ErrorEvent(new Error("The feature id parameter must be provided.")));const y=this._getSourceCaches(h);for(const v of y)v.setFeatureState(d,n.id,a)}removeFeatureState(n,a){this._checkLoaded();const h=n.source,d=this.getSource(h);if(!d)return void this.fire(new s.ErrorEvent(new Error(`The source '${h}' does not exist in the map's style.`)));const m=d.type,g="vector"===m?n.sourceLayer:void 0;if("vector"===m&&!g)return void this.fire(new s.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(a&&"string"!=typeof n.id&&"number"!=typeof n.id)return void this.fire(new s.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const y=this._getSourceCaches(h);for(const v of y)v.removeFeatureState(g,n.id,a)}getFeatureState(n){this._checkLoaded();const a=n.source,h=n.sourceLayer,d=this.getSource(a);if(d){if("vector"!==d.type||h)return void 0===n.id&&this.fire(new s.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(a)[0].getFeatureState(h,n.id);this.fire(new s.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new s.ErrorEvent(new Error(`The source '${a}' does not exist in the map's style.`)))}getTransition(){return s.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const n={};for(const a in this._sourceCaches){const h=this._sourceCaches[a].getSource();n[h.id]||(n[h.id]=h.serialize())}return s.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.getTerrain()||void 0,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:n,layers:this._serializeLayers(this._order)},a=>void 0!==a)}_updateLayer(n){this._updatedLayers[n.id]=!0;const a=this._getLayerSourceCache(n);n.source&&!this._updatedSources[n.source]&&a&&"raster"!==a.getSource().type&&(this._updatedSources[n.source]="reload",a.pause()),this._changed=!0,n.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(n){const a=g=>"fill-extrusion"===this._layers[g].type,h={},d=[];for(let g=this._order.length-1;g>=0;g--){const y=this._order[g];if(a(y)){h[y]=g;for(const v of n){const A=v[y];if(A)for(const k of A)d.push(k)}}}d.sort((g,y)=>y.intersectionZ-g.intersectionZ);const m=[];for(let g=this._order.length-1;g>=0;g--){const y=this._order[g];if(a(y))for(let v=d.length-1;v>=0;v--){const A=d[v].feature;if(h[A.layer.id]<g)break;m.push(A),d.pop()}else for(const v of n){const A=v[y];if(A)for(const k of A)m.push(k.feature)}}return m}queryRenderedFeatures(n,a,h){a&&a.filter&&this._validate(s.validateFilter,"queryRenderedFeatures.filter",a.filter,null,a);const d={};if(a&&a.layers){if(!Array.isArray(a.layers))return this.fire(new s.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const v of a.layers){const A=this._layers[v];if(!A)return this.fire(new s.ErrorEvent(new Error(`The layer '${v}' does not exist in the map's style and cannot be queried for features.`))),[];d[A.source]=!0}}const m=[];a.availableImages=this._availableImages;const g=a&&a.layers?a.layers.some(v=>{const A=this.getLayer(v);return A&&A.is3D()}):this.has3DLayers(),y=Pt.createFromScreenPoints(n,h);for(const v in this._sourceCaches){const A=this._sourceCaches[v].getSource().id;a.layers&&!d[A]||m.push(di(this._sourceCaches[v],this._layers,this._serializedLayers,y,a,h,g,!!this.map._showQueryGeometry))}return this.placement&&m.push(function(v,A,k,S,U,j,G){const Z={},$=j.queryRenderedSymbols(S),P=[];for(const N of Object.keys($).map(Number))P.push(G[N]);P.sort(nn);for(const N of P){const X=N.featureIndex.lookupSymbolFeatures($[N.bucketInstanceId],A,N.bucketIndex,N.sourceLayerIndex,U.filter,U.layers,U.availableImages,v);for(const J in X){const oe=Z[J]=Z[J]||[],ce=X[J];ce.sort((le,pe)=>{const de=N.featureSortOrder;if(de){const ve=de.indexOf(le.featureIndex);return de.indexOf(pe.featureIndex)-ve}return pe.featureIndex-le.featureIndex});for(const le of ce)oe.push(le)}}for(const N in Z)Z[N].forEach(X=>{const J=X.feature,oe=k(v[N]);if(!oe)return;const ce=oe.getFeatureState(J.layer["source-layer"],J.id);J.source=J.layer.source,J.layer["source-layer"]&&(J.sourceLayer=J.layer["source-layer"]),J.state=ce});return Z}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),y.screenGeometry,a,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(m)}querySourceFeatures(n,a){a&&a.filter&&this._validate(s.validateFilter,"querySourceFeatures.filter",a.filter,null,a);const h=this._getSourceCaches(n);let d=[];for(const m of h)d=d.concat(pi(m,a));return d}addSourceType(n,a,h){return yr.getSourceType(n)?h(new Error(`A source type called "${n}" already exists.`)):(yr.setSourceType(n,a),a.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:n,url:a.workerSourceURL},h):h(null,null))}getLight(){return this.light.getLight()}setLight(n,a={}){this._checkLoaded();const h=this.light.getLight();let d=!1;for(const g in n)if(!M(n[g],h[g])){d=!0;break}if(!d)return;const m=this._setTransitionParameters({duration:300,delay:0});this.light.setLight(n,a),this.light.updateTransitions(m)}getTerrain(){return this.terrain&&1===this.terrain.drapeRenderMode?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(n,a=1){if(this._checkLoaded(),!n)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);let h=n;if(1===a){if("object"==typeof h.source){const d="terrain-dem-src";this.addSource(d,h.source),h=s.clone$1(h),h=s.extend(h,{source:d})}if(this._validate(s.validateTerrain,"terrain",h))return}if(!this.terrain||this.terrain&&a!==this.terrain.drapeRenderMode){if(!h)return;this._createTerrain(h,a)}else{const d=this.terrain,m=d.get();for(const g of Object.keys(s.spec.terrain))!h.hasOwnProperty(g)&&s.spec.terrain[g].default&&(h[g]=s.spec.terrain[g].default);for(const g in h)if(!M(h[g],m[g])){d.set(h),this.stylesheet.terrain=h;const y=this._setTransitionParameters({duration:0});d.updateTransitions(y);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(n){const a=this.fog=new Me(n,this.map.transform);this.stylesheet.fog=n;const h=this._setTransitionParameters({duration:0});a.updateTransitions(h)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask(()=>{for(const n of this.map._markers)n._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(n){if(this._checkLoaded(),!n)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const a=this.fog,h=a.get();0===Object.keys(n).length&&a.set(n);for(const d in n)if(!M(n[d],h[d])){a.set(n),this.stylesheet.fog=n;const m=this._setTransitionParameters({duration:0});a.updateTransitions(m);break}}else this._createFog(n);this._markersNeedUpdate=!0}_setTransitionParameters(n){return{now:s.exported.now(),transition:s.extend(n,this.stylesheet.transition)}}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const n=this._order.filter(h=>this.isLayerDraped(this._layers[h])),a=this._order.filter(h=>!this.isLayerDraped(this._layers[h]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...n),this._drapedFirstOrder.push(...a)}_createTerrain(n,a){const h=this.terrain=new Je(n,a);this.stylesheet.terrain=n,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const d=this._setTransitionParameters({duration:0});h.updateTransitions(d)}_force3DLayerUpdate(){for(const n in this._layers){const a=this._layers[n];"fill-extrusion"===a.type&&this._updateLayer(a)}}_forceSymbolLayerUpdate(){for(const n in this._layers){const a=this._layers[n];"symbol"===a.type&&this._updateLayer(a)}}_validate(n,a,h,d,m={}){return(!m||!1!==m.validate)&&Hr(this,n.call(s.validateStyle,s.extend({key:a,style:this.serialize(),value:h,styleSpec:s.spec},d)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),s.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const n in this._layers)this._layers[n].setEventedParent(null);for(const n in this._sourceCaches)this._sourceCaches[n].clearTiles(),this._sourceCaches[n].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(n){const a=this._getSourceCaches(n);for(const h of a)h.clearTiles()}_reloadSource(n){const a=this._getSourceCaches(n);for(const h of a)h.resume(),h.reload()}_reloadSources(){for(const n of this._getSources())n.reload&&n.reload()}_updateSources(n){for(const a in this._sourceCaches)this._sourceCaches[a].update(n)}_generateCollisionBoxes(){for(const n in this._sourceCaches){const a=this._sourceCaches[n];a.resume(),a.reload()}}_updatePlacement(n,a,h,d,m=!1){let g=!1,y=!1;const v={};for(const A of this._order){const k=this._layers[A];if("symbol"!==k.type)continue;if(!v[k.source]){const U=this._getLayerSourceCache(k);if(!U)continue;v[k.source]=U.getRenderableIds(!0).map(j=>U.getTileByID(j)).sort((j,G)=>G.tileID.overscaledZ-j.tileID.overscaledZ||(j.tileID.isLessThan(G.tileID)?-1:1))}const S=this.crossTileSymbolIndex.addLayer(k,v[k.source],n.center.lng,n.projection);g=g||S}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),m=m||this._layerOrderChanged||0===h,this._layerOrderChanged&&this.fire(new s.Event("neworder")),(m||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(s.exported.now(),n.zoom))&&(this.pauseablePlacement=new Bs(n,this._order,m,a,h,d,this.placement,this.fog&&n.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,v),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(s.exported.now()),y=!0),g&&this.pauseablePlacement.placement.setStale()),y||g)for(const A of this._order){const k=this._layers[A];"symbol"===k.type&&this.placement.updateLayerOpacities(k,v[k.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(s.exported.now())}_releaseSymbolFadeTiles(){for(const n in this._sourceCaches)this._sourceCaches[n].releaseSymbolFadeTiles()}getImages(n,a,h){this.imageManager.getImages(a.icons,h),this._updateTilesForChangedImages();const d=m=>{m&&m.setDependencies(a.tileID.key,a.type,a.icons)};d(this._otherSourceCaches[a.source]),d(this._symbolSourceCaches[a.source])}getGlyphs(n,a,h){this.glyphManager.getGlyphs(a.stacks,h)}getResource(n,a,h){return s.makeRequest(a,h)}_getSourceCache(n){return this._otherSourceCaches[n]}_getLayerSourceCache(n){return"symbol"===n.type?this._symbolSourceCaches[n.source]:this._otherSourceCaches[n.source]}_getSourceCaches(n){const a=[];return this._otherSourceCaches[n]&&a.push(this._otherSourceCaches[n]),this._symbolSourceCaches[n]&&a.push(this._symbolSourceCaches[n]),a}_isSourceCacheLoaded(n){const a=this._getSourceCaches(n);return 0===a.length?(this.fire(new s.ErrorEvent(new Error(`There is no source with ID '${n}'`))),!1):a.every(h=>h.loaded())}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}yr.getSourceType=function(l){return It[l]},yr.setSourceType=function(l,n){It[l]=n},yr.registerForPluginStateChange=s.registerForPluginStateChange;var Ns="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#define EXTENT 8192.0\n#define HALF_PI PI/2.0\n#define QUARTER_PI PI/4.0\n#define RAD_TO_DEG 180.0/PI\n#define DEG_TO_RAD PI/180.0\n#define GLOBE_RADIUS EXTENT/PI/2.0",la="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Pr="\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}\n#else\nvec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif\nconst float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)\n{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}\n#ifdef TERRAIN\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;\n#else\nuniform sampler2D u_dem;uniform sampler2D u_dem_prev;\n#endif\nuniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));\n#ifdef TERRAIN_DEM_NEAREST_FILTER\nreturn u_exaggeration*tl;\n#endif\nfloat tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nfloat nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nreturn currentElevation(apos);}\n#endif\nhighp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(\nunpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))\n);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nfloat tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;\n#else\nvec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);\n#endif\nreturn vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }\n#endif",ao="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",zr="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif";let Vo={},ka={};const oo=[];Aa(Ns,oo),Aa(Pr,oo),Aa(ao,oo),Aa(zr,oo),Vo=li("",Pr),ka=li(zr,ao);const cc=li("\n#if __VERSION__ >=300\n#define varying in\n#define gl_FragColor glFragColor\n#define texture2D texture\n#define textureCube texture\nout vec4 glFragColor;\n#endif\nhighp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}highp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}","\n#if __VERSION__ >=300\n#define attribute in\n#define varying out\n#define texture2D texture\n#endif\nfloat wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {\n#ifndef PROJECTED_POS_ON_VIEWPORT\nfloat tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;\n#else\nreturn vec3(0.0);\n#endif\n}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered."),No=Ns,js="\n#ifdef GL_ES\nprecision mediump float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif";var Zs={background:li("uniform vec4 u_color;uniform float u_opacity;\n#ifdef LIGHTING_3D_MODE\nvarying vec4 v_color;\n#endif\nvoid main() {vec4 out_color;\n#ifdef LIGHTING_3D_MODE\nout_color=v_color;\n#else\nout_color=u_color;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#ifdef LIGHTING_3D_MODE\nuniform vec4 u_color;varying vec4 v_color;\n#endif\nvoid main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef LIGHTING_3D_MODE\nv_color=apply_lighting(u_color);\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),backgroundPattern:li("uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),circle:li("varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\ngl_FragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\n#ifdef PROJECTION_GLOBE_VIEW\nreturn u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );\n#else\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#endif\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);\n#else \nsurface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);\n#endif\nvec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nocclusion_world_center=world_center;occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}"),clippingMask:li("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:li("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\nif (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#else\npos=vec3(tilePos+extrude,elevation(tilePos));\n#endif\ngl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),heatmapTexture:li("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:li("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}","attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:li("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:li("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;\n#endif\nvarying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\ngl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);\n#else\ngl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);\n#endif\n}"),fill:li("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutline:li("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutlinePattern:li("uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;varying vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;varying vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillPattern:li("uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillExtrusion:li("varying vec4 v_color;\n#ifdef RENDER_SHADOWS\nvarying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef ZERO_ROOF_RADIUS\nvarying vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvarying highp vec3 v_normal;\n#endif\nvoid main() {\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvec3 normal=v_normal;\n#endif\nfloat z;vec4 color;\n#ifdef ZERO_ROOF_RADIUS\nz=float(normal.z > 0.00001);color=mix(v_color,v_roof_color,z);\n#else\ncolor=v_color;\n#endif\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;\n#ifdef ZERO_ROOF_RADIUS\nconcave*=(1.0-z);\n#endif\nfloat x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);color.rgb=color.rgb*shade;\n#endif\n#ifdef RENDER_SHADOWS\n#ifdef ZERO_ROOF_RADIUS\nnormal=mix(normal,vec3(0.0,0.0,1.0),z);\n#endif\ncolor.xyz=shadowed_color_normal(color.xyz,normalize(normal),v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec4 v_color;\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;\n#endif\n#ifdef ZERO_ROOF_RADIUS\nvarying vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvarying highp vec3 v_normal;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nv_normal=normal;\n#endif\nbase=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=0.0;float c_ele;vec3 pos;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);\n#else\nh=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);\n#ifdef RENDER_SHADOWS\nv_pos_light_view_0=u_light_matrix_0*vec4(pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1);v_depth=gl_Position.w;\n#endif\nfloat NdotL=0.0;float colorvalue=0.0;\n#ifdef LIGHTING_3D_MODE\nNdotL=calculate_NdotL(normal);\n#else\ncolorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);\n#endif\nif (normal.y !=0.0) {float r=0.84;\n#ifndef LIGHTING_3D_MODE\nr=mix(0.7,0.98,1.0-u_lightintensity);\n#endif\nNdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}v_color=vec4(0.0,0.0,0.0,1.0);\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\nv_color=apply_lighting(color,NdotL);\n#else\nv_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));\n#endif\nv_color*=u_opacity;\n#ifdef ZERO_ROOF_RADIUS\nv_roof_color=vec4(0.0,0.0,0.0,1.0);\n#ifdef LIGHTING_3D_MODE\nv_roof_color=apply_lighting(color,calculate_NdotL(vec3(0.0,0.0,1.0)));\n#else\nfloat roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));\n#endif\nv_roof_color*=u_opacity;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),fillExtrusionPattern:li("uniform vec2 u_texsize;uniform sampler2D u_image;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nvarying float v_NdotL;\n#endif\nvarying vec2 v_pos;varying vec4 v_lighting;uniform lowp float u_opacity;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color,v_NdotL)*u_opacity;\n#else\nout_color=out_color*v_lighting;\n#endif\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec2 v_pos;varying vec4 v_lighting;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nvarying float v_NdotL;\n#endif\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=z;vec3 p;float c_ele;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);\n#else\np=vec3(pos_nx.xy,z);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;\n#ifdef LIGHTING_3D_MODE\nNdotL=calculate_NdotL(normal);\n#else\nNdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);\n#endif\nif (normal.y !=0.0) {float r=0.84;\n#ifndef LIGHTING_3D_MODE\nr=mix(0.7,0.98,1.0-u_lightintensity);\n#endif\nNdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\nv_NdotL=NdotL;\n#else\nv_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#endif \n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}"),hillshadePrepare:li("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nreturn texture2D(u_image,coord).a/4.0;\n#else\nvec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;\n#endif\n}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:li("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef LIGHTING_3D_MODE\ngl_FragColor=apply_lighting(gl_FragColor);\n#endif\n#ifdef FOG\ngl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),line:li("uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;varying vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;\n#endif\nuniform float u_border_width;uniform vec4 u_border_color;float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nfloat linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef RENDER_LINE_DASH\nfloat sdfdist=texture2D(u_dash_image,v_tex).a;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);\n#endif\nhighp vec4 out_color;\n#ifdef RENDER_LINE_GRADIENT\nout_color=texture2D(u_gradient_image,v_uv.xy);\n#else\nout_color=color;\n#endif\nfloat trimmed=1.0;\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);trimmed=0.0;}}\n#endif\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\n#ifdef RENDER_LINE_ALPHA_DISCARD\nif (alpha < u_alpha_discard_threshold) {discard;}\n#endif\n#ifdef RENDER_LINE_BORDER\nfloat edgeBlur=(u_border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);\n#ifdef RENDER_LINE_BORDER_AUTO\nfloat Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}\n#else\nout_color.rgb=mix(u_border_color.rgb*u_border_color.a*trimmed,out_color.rgb,smoothAlpha);\n#endif\n}\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define EXTRUDE_SCALE 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nattribute highp vec4 a_packed;\n#endif\n#ifdef RENDER_LINE_DASH\nattribute float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform float u_tile_units_to_pixels;varying vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nfloat a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];\n#ifdef RENDER_LINE_GRADIENT\nhighp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);\n#else\nv_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);\n#endif\n#endif\n#ifdef RENDER_LINE_DASH\nfloat scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),linePattern:li("uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x=mod(v_linesofar/pattern_size.x*aspect,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec4 color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\ncolor=apply_lighting(color);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),raster:li("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply(out_color,v_fog_pos));\n#endif\ngl_FragColor=vec4(out_color*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),symbolIcon:li("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}"),symbolSDF:li("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat gamma_scale=gl_Position.w;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}"),symbolTextAndIcon:li("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}"),terrainRaster:li("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nvarying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;\n#endif\nvoid main() {vec4 color=texture2D(u_image0,v_pos0);\n#ifdef RENDER_SHADOWS\ncolor.xyz=shadowed_color(color.xyz,v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#endif\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#else\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;\n#endif\nconst float wireframeOffset=0.00015;void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;\n#ifdef TERRAIN_WIREFRAME\nelevation+=wireframeOffset;\n#endif\nv_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\nv_fog_pos=fog_position(decodedPos);\n#else\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n#endif\n#ifdef RENDER_SHADOWS\nvec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;\n#endif\n}"),terrainDepth:li("#ifdef GL_ES\nprecision highp float;\n#endif\nvarying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}","uniform mat4 u_matrix;attribute vec2 a_pos;varying float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:li("\nvarying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",la),skyboxGradient:li("varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",la),skyboxCapture:li("\nvarying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;\n#ifdef GL_ES\nprecision highp float;\n#endif\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}","attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:li("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifndef FOG\nuniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;\n#endif\nvoid main() {vec4 color;\n#ifdef CUSTOM_ANTIALIASING\nvec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);color=vec4(raster.rgb*antialias,raster.a*antialias);\n#else\ncolor=texture2D(u_image0,v_pos0);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;\n#ifdef GLOBE_POLES\nattribute vec3 a_globe_pos;attribute vec2 a_uv;\n#else\nattribute vec2 a_pos;\n#endif\nvarying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;vec2 uv=a_uv;\n#else\nfloat tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);\n#endif\nv_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;\n#ifdef GLOBE_POLES\nvec3 up_vector=globe_derived_up_vector;\n#else\nvec3 up_vector=elevationVector(tile_pos);\n#endif\nfloat height=elevation(tile_pos);\n#ifdef TERRAIN_WIREFRAME\nheight+=wireframeOffset;\n#endif\nglobe_pos+=up_vector*height;\n#ifndef GLOBE_POLES\nglobe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;\n#endif\n#ifdef GLOBE_POLES\nvec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);\n#else\nvec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);\n#endif\ngl_Position=u_proj_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n}"),globeAtmosphere:li("uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec3 u_start_color;uniform vec4 u_color;uniform vec4 u_space_color;uniform vec4 u_high_color;uniform float u_star_intensity;uniform float u_star_size;uniform float u_star_density;uniform float u_horizon_angle;uniform mat4 u_rotation_matrix;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;highp float random(highp vec3 p) {p=fract(p*vec3(23.2342,97.1231,91.2342));p+=dot(p.zxy,p.yxz+123.1234);return fract(p.x*p.y);}float stars(vec3 p,float scale,vec2 offset) {vec2 uv_scale=(u_viewport/u_star_size)*scale;vec3 position=vec3(p.xy*uv_scale+offset*u_viewport,p.z);vec3 q=fract(position)-0.5;vec3 id=floor(position);float random_visibility=step(random(id),u_star_density);float circle=smoothstep(0.5+u_star_intensity,0.5,length(q));return circle*random_visibility;}void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;\n#ifdef PROJECTION_GLOBE_VIEW\nglobe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {discard;return;}\n#endif\nhighp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?\n0.0 : max(acos(dot(dir,horizon_dir)),0.0);float horizon_angle;\n#ifdef PROJECTION_GLOBE_VIEW\nhighp vec3 closest_point=globe_pos_dot_dir*dir;float closest_point_to_center=length(closest_point-u_globe_pos);float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?\nPI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);\n#else\nhorizon_angle=horizon_angle_mercator;\n#endif\nhorizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c =mix(color_stop_2,c2,t);float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);vec2 uv=gl_FragCoord.xy/u_viewport-0.5;float aspect_ratio=u_viewport.x/u_viewport.y;vec4 uv_dir=vec4(normalize(vec3(uv.x*aspect_ratio,uv.y,1.0)),1.0);uv_dir=u_rotation_matrix*uv_dir;vec3 n=abs(uv_dir.xyz);vec2 uv_remap=(n.x > n.y && n.x > n.z) ? uv_dir.yz/uv_dir.x:\n(n.y > n.x && n.y > n.z) ? uv_dir.zx/uv_dir.y:\nuv_dir.xy/uv_dir.z;uv_remap.x/=aspect_ratio;vec3 D=vec3(uv_remap,1.0);highp float star_field=0.0;if (u_star_intensity > 0.0) {star_field+=stars(D,1.2,vec2(0.0,0.0));star_field+=stars(D,1.0,vec2(1.0,0.0));star_field+=stars(D,0.8,vec2(0.0,1.0));star_field+=stars(D,0.6,vec2(1.0,1.0));star_field*=(1.0-pow(t,0.25+(1.0-u_high_color.a)*0.75));c+=star_field*alpha_2;}c=dither(c,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=vec4(c,a);}","attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(\nmix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}")};function Aa(l,n){const a=l.replace(/\s*\/\/[^\n]*\n/g,"\n").split("\n");for(let h of a)if(h=h.trim(),"#"===h[0]&&h.includes("if")&&!h.includes("endif")){h=h.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const d=h.split(" ");for(const m of d)n.includes(m)||n.push(m)}}function li(l,n){const a=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,h=n.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),d={},m=[...oo];return Aa(l,m),Aa(n,m),{fragmentSource:l=l.replace(a,(g,y,v,A,k)=>(d[k]=!0,"define"===y?`\n#ifndef HAS_UNIFORM_u_${k}\nvarying ${v} ${A} ${k};\n#else\nuniform ${v} ${A} u_${k};\n#endif\n`:`\n#ifdef HAS_UNIFORM_u_${k}\n    ${v} ${A} ${k} = u_${k};\n#endif\n`)),vertexSource:n=n.replace(a,(g,y,v,A,k)=>{const S="float"===A?"vec2":"vec4",U=k.match(/color/)?"color":S;return d[k]?"define"===y?`\n#ifndef HAS_UNIFORM_u_${k}\nuniform lowp float u_${k}_t;\nattribute ${v} ${S} a_${k};\nvarying ${v} ${A} ${k};\n#else\nuniform ${v} ${A} u_${k};\n#endif\n`:"vec4"===U?`\n#ifndef HAS_UNIFORM_u_${k}\n    ${k} = a_${k};\n#else\n    ${v} ${A} ${k} = u_${k};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${k}\n    ${k} = unpack_mix_${U}(a_${k}, u_${k}_t);\n#else\n    ${v} ${A} ${k} = u_${k};\n#endif\n`:"define"===y?`\n#ifndef HAS_UNIFORM_u_${k}\nuniform lowp float u_${k}_t;\nattribute ${v} ${S} a_${k};\n#else\nuniform ${v} ${A} u_${k};\n#endif\n`:"vec4"===U?`\n#ifndef HAS_UNIFORM_u_${k}\n    ${v} ${A} ${k} = a_${k};\n#else\n    ${v} ${A} ${k} = u_${k};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${k}\n    ${v} ${A} ${k} = unpack_mix_${U}(a_${k}, u_${k}_t);\n#else\n    ${v} ${A} ${k} = u_${k};\n#endif\n`}),staticAttributes:h,usedDefines:m}}class Dh{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(n,a,h,d,m,g,y){this.context=n;let v=this.boundPaintVertexBuffers.length!==d.length;for(let k=0;!v&&k<d.length;k++)this.boundPaintVertexBuffers[k]!==d[k]&&(v=!0);let A=this.boundDynamicVertexBuffers.length!==y.length;for(let k=0;!A&&k<y.length;k++)this.boundDynamicVertexBuffers[k]!==y[k]&&(A=!0);if(!n.extVertexArrayObject||!this.vao||this.boundProgram!==a||this.boundLayoutVertexBuffer!==h||v||A||this.boundIndexBuffer!==m||this.boundVertexOffset!==g)this.freshBind(a,h,d,m,g,y);else{n.bindVertexArrayOES.set(this.vao);for(const k of y)k&&k.bind();m&&m.dynamicDraw&&m.bind()}}freshBind(n,a,h,d,m,g){let y;const v=n.numAttributes,A=this.context,k=A.gl;if(A.extVertexArrayObject)this.vao&&this.destroy(),this.vao=A.extVertexArrayObject.createVertexArrayOES(),A.bindVertexArrayOES.set(this.vao),y=0,this.boundProgram=n,this.boundLayoutVertexBuffer=a,this.boundPaintVertexBuffers=h,this.boundIndexBuffer=d,this.boundVertexOffset=m,this.boundDynamicVertexBuffers=g;else{y=A.currentNumAttributes||0;for(let S=v;S<y;S++)k.disableVertexAttribArray(S)}a.enableAttributes(k,n),a.bind(),a.setVertexAttribPointers(k,n,m);for(const S of h)S.enableAttributes(k,n),S.bind(),S.setVertexAttribPointers(k,n,m);for(const S of g)S&&(S.enableAttributes(k,n),S.bind(),S.setVertexAttribPointers(k,n,m));d&&d.bind(),A.currentNumAttributes=v}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function Gs(l,n){const a=Math.pow(2,n.canonical.z),h=n.canonical.y;return[new s.MercatorCoordinate(0,h/a).toLngLat().lat,new s.MercatorCoordinate(0,(h+1)/a).toLngLat().lat]}function hc(l,n,a,h,d,m,g){const y=l.context,v=y.gl,A=a.fbo;if(!A)return;l.prepareDrawTile();const k=l.useProgram("hillshade");y.activeTexture.set(v.TEXTURE0),v.bindTexture(v.TEXTURE_2D,A.colorAttachment.get());const S=((Z,$,P,N)=>{const X=P.paint.get("hillshade-shadow-color"),J=P.paint.get("hillshade-highlight-color"),oe=P.paint.get("hillshade-accent-color");let ce=P.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===P.paint.get("hillshade-illumination-anchor")&&(ce-=Z.transform.angle);const le=!Z.options.moving;return{u_matrix:N||Z.transform.calculateProjMatrix($.tileID.toUnwrapped(),le),u_image:0,u_latrange:Gs(0,$.tileID),u_light:[P.paint.get("hillshade-exaggeration"),ce],u_shadow:X,u_highlight:J,u_accent:oe}})(l,a,h,l.terrain?n.projMatrix:null);l.prepareDrawProgram(y,k,n.toUnwrapped());const{tileBoundsBuffer:U,tileBoundsIndexBuffer:j,tileBoundsSegments:G}=l.getTileBoundsBuffers(a);k.draw(y,v.TRIANGLES,d,m,g,s.CullFaceMode.disabled,S,h.id,U,j,G)}function qs(l,n,a){if(!n.needsDEMTextureUpload)return;const h=l.context,d=h.gl;h.pixelStoreUnpackPremultiplyAlpha.set(!1),n.demTexture=n.demTexture||l.getTileTexture(a.stride);const m=a.getPixels();n.demTexture?n.demTexture.update(m,{premultiply:!1}):n.demTexture=new s.Texture(h,m,d.RGBA,{premultiply:!1}),n.needsDEMTextureUpload=!1}function uc(l,n,a,h,d,m){const g=l.context,y=g.gl;if(!n.dem)return;const v=n.dem;if(g.activeTexture.set(y.TEXTURE1),qs(l,n,v),!n.demTexture)return;n.demTexture.bind(y.NEAREST,y.CLAMP_TO_EDGE);const A=v.dim;g.activeTexture.set(y.TEXTURE0);let k=n.fbo;if(!k){const G=new s.Texture(g,{width:A,height:A,data:null},y.RGBA);G.bind(y.LINEAR,y.CLAMP_TO_EDGE),k=n.fbo=g.createFramebuffer(A,A,!0),k.colorAttachment.set(G.texture)}g.bindFramebuffer.set(k.framebuffer),g.viewport.set([0,0,A,A]);const{tileBoundsBuffer:S,tileBoundsIndexBuffer:U,tileBoundsSegments:j}=l.getMercatorTileBoundsBuffers();l.useProgram("hillshadePrepare").draw(g,y.TRIANGLES,h,d,m,s.CullFaceMode.disabled,((G,Z)=>{const $=Z.stride,P=s.create();return s.ortho(P,0,s.EXTENT,-s.EXTENT,0,0,1),s.translate(P,P,[0,-s.EXTENT,0]),{u_matrix:P,u_image:1,u_dimension:[$,$],u_zoom:G.overscaledZ,u_unpack:Z.unpackVector}})(n.tileID,v),a.id,S,U,j),n.needsHillshadePrepare=!1}const $s=l=>({u_matrix:new s.UniformMatrix4f(l),u_image0:new s.Uniform1i(l),u_skirt_height:new s.Uniform1f(l)}),Ca=(l,n)=>({u_matrix:l,u_image0:0,u_skirt_height:n}),jo=(l,n,a,h,d,m,g,y,v,A,k,S,U,j,G)=>({u_proj_matrix:Float32Array.from(l),u_globe_matrix:n,u_normalize_matrix:Float32Array.from(h),u_merc_matrix:a,u_zoom_transition:d,u_merc_center:m,u_image0:0,u_frustum_tl:g,u_frustum_tr:y,u_frustum_br:v,u_frustum_bl:A,u_globe_pos:k,u_globe_radius:S,u_viewport:U,u_grid_matrix:G?Float32Array.from(G):new Float32Array(9),u_skirt_height:j});function Ma(l,n){return null!=l&&null!=n&&!(!l.hasData()||!n.hasData())&&null!=l.demTexture&&null!=n.demTexture&&l.tileID.key!==n.tileID.key}const Lr=new class{constructor(){this.operations={}}newMorphing(l,n,a,h,d){if(l in this.operations){const m=this.operations[l];m.to.tileID.key!==a.tileID.key&&(m.queued=a)}else this.operations[l]={startTime:h,phase:0,duration:d,from:n,to:a,queued:null}}getMorphValuesForProxy(l){if(!(l in this.operations))return null;const n=this.operations[l];return{from:n.from,to:n.to,phase:n.phase}}update(l){for(const n in this.operations){const a=this.operations[n];for(a.phase=(l-a.startTime)/a.duration;a.phase>=1||!this._validOp(a);)if(!this._nextOp(a,l)){delete this.operations[n];break}}}_nextOp(l,n){return!!l.queued&&(l.from=l.to,l.to=l.queued,l.queued=null,l.phase=0,l.startTime=n,!0)}_validOp(l){return l.from.hasData()&&l.to.hasData()}},ca={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function Zo(l){return 6*Math.pow(1.5,22-l)}function dc(l,n){const a=1<<l.z;return!n&&(0===l.x||l.x===a-1)||0===l.y||l.y===a-1}const so=l=>({u_matrix:l});function Ws(l,n,a,h,d){if(d>0){const m=s.exported.now(),g=(m-l.timeAdded)/d,y=n?(m-n.timeAdded)/d:-1,v=a.getSource(),A=h.coveringZoomLevel({tileSize:v.tileSize,roundZoom:v.roundZoom}),k=!n||Math.abs(n.tileID.overscaledZ-A)>Math.abs(l.tileID.overscaledZ-A),S=k&&l.refreshedUponExpiration?1:s.clamp(k?g:1-y,0,1);return l.refreshedUponExpiration&&g>=1&&(l.refreshedUponExpiration=!1),n?{opacity:1,mix:1-S}:{opacity:S,mix:0}}return{opacity:1,mix:0}}class Hs extends s.SourceCache{constructor(n){const a={type:"raster-dem",maxzoom:n.transform.maxZoom},h=new st(Vn(),null),d=Ut("mock-dem",a,h,n.style);super("mock-dem",d,!1),d.setEventedParent(this),this._sourceLoaded=!0}_loadTile(n,a){n.state="loaded",a(null)}}class Go extends s.SourceCache{constructor(n){const a=Ut("proxy",{type:"geojson",maxzoom:n.transform.maxZoom},new st(Vn(),null),n.style);super("proxy",a,!1),a.setEventedParent(this),this.map=this.getSource().map=n,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(n,a,h){if(n.freezeTileCoverage)return;this.transform=n;const d=n.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((m,g)=>{if(m[g.key]="",!this._tiles[g.key]){const y=new s.Tile(g,this._source.tileSize*g.overscaleFactor(),n.tileZoom);y.state="loaded",this._tiles[g.key]=y}return m},{});for(const m in this._tiles)m in d||(this.freeFBO(m),this._tiles[m].unloadVectorData(),delete this._tiles[m])}freeFBO(n){const a=this.proxyCachedFBO[n];if(void 0!==a){const h=Object.values(a);this.renderCachePool.push(...h),delete this.proxyCachedFBO[n]}}deallocRenderCache(){this.renderCache.forEach(n=>n.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class qo extends s.OverscaledTileID{constructor(n,a,h){super(n.overscaledZ,n.wrap,n.canonical.z,n.canonical.x,n.canonical.y),this.proxyTileKey=a,this.projMatrix=h}}class Ys extends s.Elevation{constructor(n,a){super(),this.painter=n,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[h,d,m]=function(v){const A=new s.StructArrayLayout2i4,k=new s.StructArrayLayout3ui6,S=131;A.reserve(17161),k.reserve(33800);const U=s.EXTENT/128,j=s.EXTENT+U/2,G=j+U;for(let $=-U;$<G;$+=U)for(let P=-U;P<G;P+=U){const N=P<0||P>j||$<0||$>j?24575:0,X=s.clamp(Math.round(P),0,s.EXTENT),J=s.clamp(Math.round($),0,s.EXTENT);A.emplaceBack(X+N,J)}const Z=($,P)=>{const N=P*S+$;k.emplaceBack(N+1,N,N+S),k.emplaceBack(N+S,N+S+1,N+1)};for(let $=1;$<129;$++)for(let P=1;P<129;P++)Z(P,$);return[0,129].forEach($=>{for(let P=0;P<130;P++)Z(P,$),Z($,P)}),[A,k,32768]}(),g=n.context;this.gridBuffer=g.createVertexBuffer(h,s.posAttributes.members),this.gridIndexBuffer=g.createIndexBuffer(d),this.gridSegments=s.SegmentVector.simpleSegment(0,0,h.length,d.length),this.gridNoSkirtSegments=s.SegmentVector.simpleSegment(0,0,h.length,m),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Go(a.map),this.orthoMatrix=s.create(),s.ortho(this.orthoMatrix,"globe"===this.painter.transform.projection.name?.015:0,s.EXTENT,0,s.EXTENT,0,1);const y=g.gl;this._overlapStencilMode=new s.StencilMode({func:y.GEQUAL,mask:255},0,255,y.KEEP,y.KEEP,y.REPLACE),this._previousZoom=n.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=a,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Hs(a.map)}set style(n){n.on("data",this._onStyleDataEvent.bind(this)),n.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=n,this._checkRenderCacheEfficiency(),this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(n,a,h){if(n&&n.terrain){this._style!==n&&(this.style=n),this.enabled=!0;const d=n.terrain.properties;this.sourceCache=0===n.terrain.drapeRenderMode?this._mockSourceCache:n._getSourceCache(d.get("source")),this._exaggeration=d.get("exaggeration");const m=()=>{this.sourceCache.used&&s.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const g=this.getScaledDemTileSize();this.sourceCache.update(a,g,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,m(),this._initializing=!0),m(),a.updateElevation(!0,h),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(a),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(n){this._findCoveringTileCache[n]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const n=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||100!==n.efficiency&&s.warnOnce(`Terrain render cache efficiency is not optimal (${n.efficiency}%) and performance\n                may be affected negatively, consider placing all background, fill and line layers before layer\n                with id '${n.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(n){n.coord&&"source"===n.dataType?this._clearRenderCacheForTile(n.sourceCacheId,n.coord):"style"===n.dataType&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const n in this._style._sourceCaches)this._style._sourceCaches[n].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(n=>n.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const n=2*this.proxySourceCache.getSource().tileSize;return[n,n]}set useVertexMorphing(n){this._useVertexMorphing=n}updateTileBinding(n){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const a=this.proxySourceCache,h=this.painter.transform;this._initializing&&(this._initializing=0===h._centerAltitude&&-1===this.getAtPointOrZero(s.MercatorCoordinate.fromLngLat(h.center),-1),this._emptyDEMTextureDirty=!this._initializing);const d=this.proxyCoords=a.getIds().map(v=>{const A=a.getTileByID(v).tileID;return A.projMatrix=h.calculateProjMatrix(A.toUnwrapped()),A});(function(v,A){const k=A.transform.pointCoordinate(A.transform.getCameraPoint()),S=new s.Point(k.x,k.y);v.sort((U,j)=>{if(j.overscaledZ-U.overscaledZ)return j.overscaledZ-U.overscaledZ;const G=new s.Point(U.canonical.x+(1<<U.canonical.z)*U.wrap,U.canonical.y),Z=new s.Point(j.canonical.x+(1<<j.canonical.z)*j.wrap,j.canonical.y),$=S.mult(1<<U.canonical.z);return $.x-=.5,$.y-=.5,$.distSqr(G)-$.distSqr(Z)})})(d,this.painter),this._previousZoom=h.zoom;const m=this.proxyToSource||{};this.proxyToSource={},d.forEach(v=>{this.proxyToSource[v.key]={}}),this.terrainTileForTile={};const g=this._style._sourceCaches;for(const v in g){const A=g[v];if(!A.used||(A!==this.sourceCache&&this.resetTileLookupCache(A.id),this._setupProxiedCoordsForOrtho(A,n[v],m),A.usedForTerrain))continue;const k=n[v];A.getSource().reparseOverscaled&&this._assignTerrainTiles(k)}this.proxiedCoords[a.id]=d.map(v=>new qo(v,v.key,this.orthoMatrix)),this._assignTerrainTiles(d),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(m),this.renderingToTexture=!1,this._updateTimestamp=s.exported.now();const y={};this._visibleDemTiles=[];for(const v of this.proxyCoords){const A=this.terrainTileForTile[v.key];if(!A)continue;const k=A.tileID.key;k in y||(this._visibleDemTiles.push(A),y[k]=k)}}_assignTerrainTiles(n){this._initializing||n.forEach(a=>{if(this.terrainTileForTile[a.key])return;const h=this._findTileCoveringTileID(a,this.sourceCache);h&&(this.terrainTileForTile[a.key]=h)})}_prepareDEMTextures(){const n=this.painter.context,a=n.gl;for(const h in this.terrainTileForTile){const d=this.terrainTileForTile[h],m=d.dem;!m||d.demTexture&&!d.needsDEMTextureUpload||(n.activeTexture.set(a.TEXTURE1),qs(this.painter,d,m))}}_prepareDemTileUniforms(n,a,h,d){if(!a||null==a.demTexture)return!1;const m=n.tileID.canonical,g=Math.pow(2,a.tileID.canonical.z-m.z),y=d||"";return h[`u_dem_tl${y}`]=[m.x*g%1,m.y*g%1],h[`u_dem_scale${y}`]=g,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const n=this.painter.context,a=n.gl;if(!this._emptyDepthBufferTexture){const h=new s.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new s.Texture(n,h,a.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let n=0;const a=this._visibleDemTiles.reduce((h,d)=>{if(!d.dem)return h;const m=d.dem.tree.minimums[0];return m>0&&n++,h+m},0);return n?a/n:0}_updateEmptyDEMTexture(){const n=this.painter.context,a=n.gl;n.activeTexture.set(a.TEXTURE2);const h=this._getLoadedAreaMinimum(),d=new s.RGBAImage({width:1,height:1},new Uint8Array(s.DEMData.pack(h,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let m=this._emptyDEMTexture;return m?m.update(d,{premultiply:!1}):m=this._emptyDEMTexture=new s.Texture(n,d,a.RGBA,{premultiply:!1}),m}setupElevationDraw(n,a,h){const d=this.painter.context,m=d.gl,g=(y=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:s.DEMData.getUnpackVector(y),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0});var y;g.u_dem_size=this.sourceCache.getSource().tileSize,g.u_exaggeration=this.exaggeration();let v=null,A=null,k=1;if(h&&h.morphing&&this._useVertexMorphing){const S=h.morphing.srcDemTile,U=h.morphing.dstDemTile;k=h.morphing.phase,S&&U&&(this._prepareDemTileUniforms(n,S,g,"_prev")&&(A=S),this._prepareDemTileUniforms(n,U,g)&&(v=U))}if(A&&v?(d.activeTexture.set(m.TEXTURE2),v.demTexture.bind(m.NEAREST,m.CLAMP_TO_EDGE,m.NEAREST),d.activeTexture.set(m.TEXTURE4),A.demTexture.bind(m.NEAREST,m.CLAMP_TO_EDGE,m.NEAREST),g.u_dem_lerp=k):(v=this.terrainTileForTile[n.tileID.key],d.activeTexture.set(m.TEXTURE2),(this._prepareDemTileUniforms(n,v,g)?v.demTexture:this.emptyDEMTexture).bind(m.NEAREST,m.CLAMP_TO_EDGE)),d.activeTexture.set(m.TEXTURE3),h&&h.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(m.NEAREST,m.CLAMP_TO_EDGE),this._depthFBO&&(g.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(m.NEAREST,m.CLAMP_TO_EDGE),g.u_depth_size_inv=[1,1]),h&&h.useMeterToDem&&v){const S=(1<<v.tileID.canonical.z)*s.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;g.u_meter_to_dem=S}if(h&&h.labelPlaneMatrixInv&&(g.u_label_plane_matrix_inv=h.labelPlaneMatrixInv),a.setTerrainUniformValues(d,g),"globe"===this.painter.transform.projection.name){const S=this.globeUniformValues(this.painter.transform,n.tileID.canonical,h&&h.useDenormalizedUpVectorScale);a.setGlobeUniformValues(d,S)}}globeUniformValues(n,a,h){const d=n.projection;return{u_tile_tl_up:d.upVector(a,0,0),u_tile_tr_up:d.upVector(a,s.EXTENT,0),u_tile_br_up:d.upVector(a,s.EXTENT,s.EXTENT),u_tile_bl_up:d.upVector(a,0,s.EXTENT),u_tile_up_scale:h?s.globeMetersToEcef(1):d.upVectorScale(a,n.center.lat,n.worldSize).metersToTile}}renderToBackBuffer(n){const a=this.painter,h=this.painter.context;0!==n.length&&(h.bindFramebuffer.set(null),h.viewport.set([0,0,a.width,a.height]),a.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(d,m,g,y,v){if("globe"===d.transform.projection.name)!function(A,k,S,U,j){const G=A.context,Z=G.gl;let $,P;const N=A.options.showTerrainWireframe?2:0,X=A.transform,J=s.globeUseCustomAntiAliasing(A,G,X),oe=(Ze,ye)=>{if(P===Ze)return;const ze=[ca[Ze],"PROJECTION_GLOBE_VIEW"];J&&ze.push("CUSTOM_ANTIALIASING"),ye&&ze.push(ca[N]),$=A.useProgram("globeRaster",null,ze),P=Ze},ce=A.colorModeForRenderPass(),le=new s.DepthMode(Z.LEQUAL,s.DepthMode.ReadWrite,A.depthRangeFor3D);Lr.update(j);const pe=s.calculateGlobeMercatorMatrix(X),de=[s.mercatorXfromLng(X.center.lng),s.mercatorYfromLat(X.center.lat)],ve=N?[!1,!0]:[!1],qe=A.globeSharedBuffers,_e=[X.width*s.exported.devicePixelRatio,X.height*s.exported.devicePixelRatio],Le=Float32Array.from(X.globeMatrix),we={useDenormalizedUpVectorScale:!0};if(ve.forEach(Ze=>{const ye=A.transform,ze=Zo(ye.zoom)*k.exaggeration();P=-1;const We=Ze?Z.LINES:Z.TRIANGLES;for(const Be of U){const He=S.getTile(Be),gt=s.StencilMode.disabled,St=k.prevTerrainTileForTile[Be.key],ht=k.terrainTileForTile[Be.key];Ma(St,ht)&&Lr.newMorphing(Be.key,St,ht,j,250),G.activeTexture.set(Z.TEXTURE0),He.texture.bind(Z.LINEAR,Z.CLAMP_TO_EDGE);const Et=Lr.getMorphValuesForProxy(Be.key),Wt=Et?1:0;Et&&s.extend$1(we,{morphing:{srcDemTile:Et.from,dstDemTile:Et.to,phase:s.easeCubicInOut(Et.phase)}});const qt=s.tileCornersToBounds(Be.canonical),pt=s.getLatitudinalLod(qt.getCenter().lat),hi=s.getGridMatrix(Be.canonical,qt,pt,ye.worldSize/ye._pixelsPerMercatorPixel),fi=s.globeNormalizeECEF(s.globeTileBounds(Be.canonical)),_i=jo(ye.projMatrix,Le,pe,fi,s.globeToMercatorTransition(ye.zoom),de,ye.frustumCorners.TL,ye.frustumCorners.TR,ye.frustumCorners.BR,ye.frustumCorners.BL,ye.globeCenterInViewSpace,ye.globeRadius,_e,ze,hi);if(oe(Wt,Ze),k.setupElevationDraw(He,$,we),A.prepareDrawProgram(G,$,Be.toUnwrapped()),qe){const[gi,yn,sn]=Ze?qe.getWirefameBuffers(A.context,pt):qe.getGridBuffers(pt,0!==ze);$.draw(G,We,le,gt,ce,s.CullFaceMode.backCCW,_i,"globe_raster",gi,yn,sn)}}}),qe){const Ze=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];J&&Ze.push("CUSTOM_ANTIALIASING"),$=A.useProgram("globeRaster",null,Ze);for(const ye of U){const{x:ze,y:We,z:Be}=ye.canonical,He=0===We,gt=We===(1<<Be)-1,[St,ht,Et,Wt]=qe.getPoleBuffers(Be);if(Wt&&(He||gt)){const qt=S.getTile(ye);G.activeTexture.set(Z.TEXTURE0),qt.texture.bind(Z.LINEAR,Z.CLAMP_TO_EDGE);let pt=s.globePoleMatrixForTile(Be,ze,X);const hi=s.globeNormalizeECEF(s.globeTileBounds(ye.canonical)),fi=(_i,gi)=>_i.draw(G,Z.TRIANGLES,le,s.StencilMode.disabled,ce,s.CullFaceMode.disabled,jo(X.projMatrix,pt,pt,hi,0,de,X.frustumCorners.TL,X.frustumCorners.TR,X.frustumCorners.BR,X.frustumCorners.BL,X.globeCenterInViewSpace,X.globeRadius,_e,0),"globe_pole_raster",gi,Et,Wt);k.setupElevationDraw(qt,$,we),A.prepareDrawProgram(G,$,ye.toUnwrapped()),He&&fi($,St),gt&&(pt=s.scale(s.create(),pt,[1,-1,1]),fi($,ht))}}}}(d,m,g,y,v);else{const A=d.context,k=A.gl;let S,U;const j=d.options.showTerrainWireframe?2:0,G=(X,J)=>{if(U===X)return;const oe=[ca[X]];J&&oe.push(ca[j]),S=d.useProgram("terrainRaster",null,oe),U=X},Z=d.colorModeForRenderPass(),$=new s.DepthMode(k.LEQUAL,s.DepthMode.ReadWrite,d.depthRangeFor3D);Lr.update(v);const P=d.transform,N=Zo(P.zoom)*m.exaggeration();(j?[!1,!0]:[!1]).forEach(X=>{U=-1;const J=X?k.LINES:k.TRIANGLES,[oe,ce]=X?m.getWirefameBuffer():[m.gridIndexBuffer,m.gridSegments];for(const le of y){const pe=g.getTile(le),de=s.StencilMode.disabled,ve=m.prevTerrainTileForTile[le.key],qe=m.terrainTileForTile[le.key];Ma(ve,qe)&&Lr.newMorphing(le.key,ve,qe,v,250),A.activeTexture.set(k.TEXTURE0),pe.texture.bind(k.LINEAR,k.CLAMP_TO_EDGE,k.LINEAR_MIPMAP_NEAREST);const _e=Lr.getMorphValuesForProxy(le.key),Le=_e?1:0;let we;_e&&(we={morphing:{srcDemTile:_e.from,dstDemTile:_e.to,phase:s.easeCubicInOut(_e.phase)}});const Ze=Ca(le.projMatrix,dc(le.canonical,P.renderWorldCopies)?N/10:N);G(Le,X),m.setupElevationDraw(pe,S,we),d.prepareDrawProgram(A,S,le.toUnwrapped()),S.draw(A,J,$,de,Z,s.CullFaceMode.backCCW,Ze,"terrain_raster",m.gridBuffer,oe,ce)}})}}(a,this,this.proxySourceCache,n,this._updateTimestamp),this.renderingToTexture=!0,a.gpuTimingDeferredRenderEnd(),n.splice(0,n.length))}renderBatch(n){if(0===this._drapedRenderBatches.length)return n+1;this.renderingToTexture=!0;const a=this.painter,h=this.painter.context,d=this.proxySourceCache,m=this.proxiedCoords[d.id],g=this._drapedRenderBatches.shift(),y=[],v=a.style.order;let A=0;for(const k of m){const S=d.getTileByID(k.proxyTileKey),U=d.proxyCachedFBO[k.key]?d.proxyCachedFBO[k.key][n]:void 0,j=void 0!==U?d.renderCache[U]:this.pool[A++],G=void 0!==U;if(S.texture=j.tex,G&&!j.dirty){y.push(S.tileID);continue}let Z;h.bindFramebuffer.set(j.fb.framebuffer),this.renderedToTile=!1,j.dirty&&(h.clear({color:s.Color.transparent,stencil:0}),j.dirty=!1);for(let $=g.start;$<=g.end;++$){const P=a.style._layers[v[$]];if(P.isHidden(a.transform.zoom))continue;const N=a.style._getLayerSourceCache(P),X=N?this.proxyToSource[k.key][N.id]:[k];if(!X)continue;const J=X;h.viewport.set([0,0,j.fb.width,j.fb.height]),Z!==(N?N.id:null)&&(this._setupStencil(j,X,P,N),Z=N?N.id:null),a.renderLayer(a,N,P,J)}this.renderedToTile?(j.dirty=!0,y.push(S.tileID)):G||--A,5===A&&(A=0,this.renderToBackBuffer(y))}return this.renderToBackBuffer(y),this.renderingToTexture=!1,h.bindFramebuffer.set(null),h.viewport.set([0,0,a.width,a.height]),g.end+1}postRender(){}renderCacheEfficiency(n){const a=n.order.length;if(0===a)return{efficiency:100};let h,d=0,m=0,g=!1;for(let y=0;y<a;++y){const v=n._layers[n.order[y]];this._style.isLayerDraped(v)?(g&&++d,++m):g||(g=!0,h=v.id)}return 0===m?{efficiency:100}:{efficiency:100*(1-d/m),firstUndrapedLayer:h}}getMinElevationBelowMSL(){let n=0;return this._visibleDemTiles.filter(a=>a.dem).forEach(a=>{n=Math.min(n,a.dem.tree.minimums[0])}),0===n?n:(n-30)*this._exaggeration}raycast(n,a,h){if(!this._visibleDemTiles)return null;const d=this._visibleDemTiles.filter(m=>m.dem).map(m=>{const g=m.tileID,y=1<<g.overscaledZ,{x:v,y:A}=g.canonical,k=v/y,S=(v+1)/y,U=A/y,j=(A+1)/y;return{minx:k,miny:U,maxx:S,maxy:j,t:m.dem.tree.raycastRoot(k,U,S,j,n,a,h),tile:m}});d.sort((m,g)=>(null!==m.t?m.t:Number.MAX_VALUE)-(null!==g.t?g.t:Number.MAX_VALUE));for(const m of d){if(null==m.t)return null;const g=m.tile.dem.tree.raycast(m.minx,m.miny,m.maxx,m.maxy,n,a,h);if(null!=g)return g}return null}_createFBO(){const n=this.painter.context,a=n.gl,h=this.drapeBufferSize;n.activeTexture.set(a.TEXTURE0);const d=new s.Texture(n,{width:h[0],height:h[1],data:null},a.RGBA);d.bind(a.LINEAR,a.CLAMP_TO_EDGE);const m=n.createFramebuffer(h[0],h[1],!1);return m.colorAttachment.set(d.texture),m.depthAttachment=new he(n,m.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=n.createRenderbuffer(n.gl.DEPTH_STENCIL,h[0],h[1]),this._stencilRef=0,m.depthAttachment.set(this._sharedDepthStencil),n.clear({stencil:0})):m.depthAttachment.set(this._sharedDepthStencil),n.extTextureFilterAnisotropic&&!n.extTextureFilterAnisotropicForceOff&&a.texParameterf(a.TEXTURE_2D,n.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,n.extTextureFilterAnisotropicMax),{fb:m,tex:d,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const n in this._style._sourceCaches)if(this._style._sourceCaches[n].hasTransition())return!0;return this._style.order.some(n=>{const a=this._style._layers[n],h=a.isHidden(this.painter.transform.zoom);return"custom"===a.type?!h&&a.shouldRedrape():!h&&a.hasTransition()})}_clearLineLayersFromRenderCache(){let n=!1;for(const h of this._style._getSources())if(h instanceof Ke){n=!0;break}if(!n)return;const a={};for(let h=0;h<this._style.order.length;++h){const d=this._style._layers[this._style.order[h]],m=this._style._getLayerSourceCache(d);if(m&&!a[m.id]&&!d.isHidden(this.painter.transform.zoom)&&"line"===d.type&&d.widthExpression()instanceof s.ZoomDependentExpression){a[m.id]=!0;for(const g of this.proxyCoords){const y=this.proxyToSource[g.key][m.id];if(y)for(const v of y)this._clearRenderCacheForTile(m.id,v)}}}}_clearRasterLayersFromRenderCache(){let n=!1;for(const h in this._style._sourceCaches)if(this._style._sourceCaches[h]._source instanceof je){n=!0;break}if(!n)return;const a={};for(let h=0;h<this._style.order.length;++h){const d=this._style._layers[this._style.order[h]],m=this._style._getLayerSourceCache(d);if(!m||a[m.id]||d.isHidden(this.painter.transform.zoom)||"raster"!==d.type)continue;const g=d.paint.get("raster-fade-duration");for(const y of this.proxyCoords){const v=this.proxyToSource[y.key][m.id];if(v)for(const A of v){const k=Ws(m.getTile(A),m.findLoadedParent(A,0),m,this.painter.transform,g);(1!==k.opacity||0!==k.mix)&&this._clearRenderCacheForTile(m.id,A)}}}}_setupDrapedRenderBatches(){const n=this._style.order,a=n.length;if(0===a)return;const h=[];let d,m=0,g=this._style._layers[n[m]];for(;!this._style.isLayerDraped(g)&&g.isHidden(this.painter.transform.zoom)&&++m<a;)g=this._style._layers[n[m]];for(;m<a;++m){const y=this._style._layers[n[m]];y.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(y)?void 0===d&&(d=m):void 0!==d&&(h.push({start:d,end:m-1}),d=void 0))}void 0!==d&&h.push({start:d,end:m-1}),this._drapedRenderBatches=h}_setupRenderCache(n){const a=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,a.renderCache.length>a.renderCachePool.length){const g=Object.values(a.proxyCachedFBO);a.proxyCachedFBO={};for(let y=0;y<g.length;++y){const v=Object.values(g[y]);a.renderCachePool.push(...v)}}return}this._clearRasterLayersFromRenderCache();const h=this.proxyCoords,d=this._tilesDirty;for(let g=h.length-1;g>=0;g--){const y=h[g];if(a.getTileByID(y.key),void 0!==a.proxyCachedFBO[y.key]){const v=n[y.key],A=this.proxyToSource[y.key];let k=0;for(const S in A){const U=A[S],j=v[S];if(!j||j.length!==U.length||U.some((G,Z)=>G!==j[Z]||d[S]&&d[S].hasOwnProperty(G.key))){k=-1;break}++k}for(const S in a.proxyCachedFBO[y.key])a.renderCache[a.proxyCachedFBO[y.key][S]].dirty=k<0||k!==Object.values(v).length}}const m=[...this._drapedRenderBatches];m.sort((g,y)=>y.end-y.start-(g.end-g.start));for(const g of m)for(const y of h){if(a.proxyCachedFBO[y.key])continue;let v=a.renderCachePool.pop();void 0===v&&a.renderCache.length<50&&(v=a.renderCache.length,a.renderCache.push(this._createFBO())),void 0!==v&&(a.proxyCachedFBO[y.key]={},a.proxyCachedFBO[y.key][g.start]=v,a.renderCache[v].dirty=!0)}this._tilesDirty={}}_setupStencil(n,a,h,d){if(!d||!this._sourceTilesOverlap[d.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const m=this.painter.context,g=m.gl;if(a.length<=1)return void(this._overlapStencilType=!1);let y;if(h.isTileClipped())y=a.length,this._overlapStencilMode.test={func:g.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(a[0].overscaledZ>a[a.length-1].overscaledZ))return void(this._overlapStencilType=!1);y=1,this._overlapStencilMode.test={func:g.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+y>255&&(m.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=y,this._overlapStencilMode.ref=this._stencilRef,h.isTileClipped()&&this._renderTileClippingMasks(a,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return"Clip"===this._overlapStencilType||"Mask"===this._overlapStencilType}stencilModeForRTTOverlap(n){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[n.key]),this._overlapStencilMode):s.StencilMode.disabled}_renderTileClippingMasks(n,a){const h=this.painter,d=this.painter.context,m=d.gl;h._tileClippingMaskIDs={},d.setColorMode(s.ColorMode.disabled),d.setDepthMode(s.DepthMode.disabled);const g=h.useProgram("clippingMask");for(const y of n){const v=h._tileClippingMaskIDs[y.key]=--a;g.draw(d,m.TRIANGLES,s.DepthMode.disabled,new s.StencilMode({func:m.ALWAYS,mask:0},v,255,m.KEEP,m.KEEP,m.REPLACE),s.ColorMode.disabled,s.CullFaceMode.disabled,so(y.projMatrix),"$clipping",h.tileExtentBuffer,h.quadTriangleIndexBuffer,h.tileExtentSegments)}}pointCoordinate(n){const a=this.painter.transform;if(n.x<0||n.x>a.width||n.y<0||n.y>a.height)return null;const h=[n.x,n.y,1,1];s.transformMat4$1(h,h,a.pixelMatrixInverse),s.scale$1(h,h,1/h[3]),h[0]/=a.worldSize,h[1]/=a.worldSize;const d=a._camera.position,m=s.mercatorZfromAltitude(1,a.center.lat),g=[d[0],d[1],d[2]/m,0],y=s.subtract([],h.slice(0,3),g);s.normalize(y,y);const v=this.raycast(g,y,this._exaggeration);return null!==v&&v?(s.scaleAndAdd(g,g,y,v),g[3]=g[2],g[2]*=m,g):null}drawDepth(){const n=this.painter,a=n.context,h=this.proxySourceCache,d=Math.ceil(n.width),m=Math.ceil(n.height);if(!this._depthFBO||this._depthFBO.width===d&&this._depthFBO.height===m||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const g=a.gl,y=a.createFramebuffer(d,m,!0);a.activeTexture.set(g.TEXTURE0);const v=new s.Texture(a,{width:d,height:m,data:null},g.RGBA);v.bind(g.NEAREST,g.CLAMP_TO_EDGE),y.colorAttachment.set(v.texture);const A=a.createRenderbuffer(a.gl.DEPTH_COMPONENT16,d,m);y.depthAttachment.set(A),this._depthFBO=y,this._depthTexture=v}a.bindFramebuffer.set(this._depthFBO.framebuffer),a.viewport.set([0,0,d,m]),function(g,y,v,A){if("globe"===g.transform.projection.name)return;const k=g.context,S=k.gl;k.clear({depth:1});const U=g.useProgram("terrainDepth"),j=new s.DepthMode(S.LESS,s.DepthMode.ReadWrite,g.depthRangeFor3D);for(const G of A){const Z=v.getTile(G),$=Ca(G.projMatrix,0);y.setupElevationDraw(Z,U),U.draw(k,S.TRIANGLES,j,s.StencilMode.disabled,s.ColorMode.unblended,s.CullFaceMode.backCCW,$,"terrain_depth",y.gridBuffer,y.gridIndexBuffer,y.gridNoSkirtSegments)}}(n,this,h,this.proxyCoords)}_setupProxiedCoordsForOrtho(n,a,h){if(n.getSource()instanceof Ft)return this._setupProxiedCoordsForImageSource(n,a,h);this._findCoveringTileCache[n.id]=this._findCoveringTileCache[n.id]||{};const d=this.proxiedCoords[n.id]=[],m=this.proxyCoords;for(let y=0;y<m.length;y++){const v=m[y],A=this._findTileCoveringTileID(v,n);if(A){const k=this._createProxiedId(v,A,h[v.key]&&h[v.key][n.id]);d.push(k),this.proxyToSource[v.key][n.id]=[k]}}let g=!1;for(let y=0;y<a.length;y++){const v=n.getTile(a[y]);if(!v||!v.hasData())continue;const A=this._findTileCoveringTileID(v.tileID,this.proxySourceCache);if(A&&A.tileID.canonical.z!==v.tileID.canonical.z){const k=this.proxyToSource[A.tileID.key][n.id],S=this._createProxiedId(A.tileID,v,h[A.tileID.key]&&h[A.tileID.key][n.id]);k?k.splice(k.length-1,0,S):this.proxyToSource[A.tileID.key][n.id]=[S],d.push(S),g=!0}}this._sourceTilesOverlap[n.id]=g}_setupProxiedCoordsForImageSource(n,a,h){if(!n.getSource().loaded())return;const d=this.proxiedCoords[n.id]=[],m=this.proxyCoords,g=n.getSource(),y=new s.Point(g.tileID.x,g.tileID.y)._div(1<<g.tileID.z),v=g.coordinates.map(s.MercatorCoordinate.fromLngLat).reduce((k,S)=>(k.min.x=Math.min(k.min.x,S.x-y.x),k.min.y=Math.min(k.min.y,S.y-y.y),k.max.x=Math.max(k.max.x,S.x-y.x),k.max.y=Math.max(k.max.y,S.y-y.y),k),{min:new s.Point(Number.MAX_VALUE,Number.MAX_VALUE),max:new s.Point(-Number.MAX_VALUE,-Number.MAX_VALUE)}),A=(k,S)=>{const U=k.wrap+k.canonical.x/(1<<k.canonical.z),j=k.canonical.y/(1<<k.canonical.z),G=s.EXTENT/(1<<k.canonical.z),Z=S.wrap+S.canonical.x/(1<<S.canonical.z),$=S.canonical.y/(1<<S.canonical.z);return U+G<Z+v.min.x||U>Z+v.max.x||j+G<$+v.min.y||j>$+v.max.y};for(let k=0;k<m.length;k++){const S=m[k];for(let U=0;U<a.length;U++){const j=n.getTile(a[U]);if(!j||!j.hasData()||A(S,j.tileID))continue;const G=this._createProxiedId(S,j,h[S.key]&&h[S.key][n.id]),Z=this.proxyToSource[S.key][n.id];Z?Z.push(G):this.proxyToSource[S.key][n.id]=[G],d.push(G)}}}_createProxiedId(n,a,h){let d=this.orthoMatrix;if(h){const m=h.find(g=>g.key===a.tileID.key);if(m)return m}if(a.tileID.key!==n.key){const m=n.canonical.z-a.tileID.canonical.z;let g,y,v;d=s.create();const A=a.tileID.wrap-n.wrap<<n.overscaledZ;m>0?(g=s.EXTENT>>m,y=g*((a.tileID.canonical.x<<m)-n.canonical.x+A),v=g*((a.tileID.canonical.y<<m)-n.canonical.y)):(g=s.EXTENT<<-m,y=s.EXTENT*(a.tileID.canonical.x-(n.canonical.x+A<<-m)),v=s.EXTENT*(a.tileID.canonical.y-(n.canonical.y<<-m))),s.ortho(d,0,g,0,g,0,1),s.translate(d,d,[y,v,0])}return new qo(a.tileID,n.key,d)}_findTileCoveringTileID(n,a){let h=a.getTile(n);if(h&&h.hasData())return h;const d=this._findCoveringTileCache[a.id],m=d[n.key];if(h=m?a.getTileByID(m):null,h&&h.hasData()||null===m)return h;let g=h?h.tileID:n,y=g.overscaledZ;const v=a.getSource().minzoom,A=[];if(!m){const S=a.getSource().maxzoom;if(n.canonical.z>=S){const U=n.canonical.z-S;a.getSource().reparseOverscaled?(y=Math.max(n.canonical.z+2,a.transform.tileZoom),g=new s.OverscaledTileID(y,n.wrap,S,n.canonical.x>>U,n.canonical.y>>U)):0!==U&&(y=S,g=new s.OverscaledTileID(y,n.wrap,S,n.canonical.x>>U,n.canonical.y>>U))}g.key!==n.key&&(A.push(g.key),h=a.getTile(g))}const k=S=>{A.forEach(U=>{d[U]=S}),A.length=0};for(y-=1;y>=v&&(!h||!h.hasData());y--){h&&k(h.tileID.key);const S=g.calculateScaledKey(y);if(h=a.getTileByID(S),h&&h.hasData())break;const U=d[S];if(null===U)break;void 0===U?A.push(S):h=a.getTileByID(U)}return k(h?h.tileID.key:null),h&&h.hasData()?h:null}findDEMTileFor(n){return this.enabled?this._findTileCoveringTileID(n,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(n,a){let h=this._tilesDirty[n];h||(h=this._tilesDirty[n]={}),h[a.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const n=function(a){let h=0;const d=new s.StructArrayLayout2ui4,m=131;for(let g=1;g<129;g++){for(let y=1;y<129;y++)h=g*m+y,d.emplaceBack(h,h+1),d.emplaceBack(h,h+m),d.emplaceBack(h+1,h+m),128===g&&d.emplaceBack(h+m,h+m+1);d.emplaceBack(h+1,h+1+m)}return d}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(n),this.wireframeSegments=s.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,n.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}class ei{static cacheKey(n,a,h,d){let m=`${a}${d?d.cacheKey:""}`;for(const g of h)n.usedDefines.includes(g)&&(m+=`/${g}`);return m}constructor(n,a,h,d,m,g){const y=n.gl;this.program=y.createProgram();const v=function(P){const N=[];for(let X=0;X<P.length;X++){if(null===P[X])continue;const J=P[X].split(" ");N.push(J.pop())}return N}(h.staticAttributes),A=d?d.getBinderAttributes():[],k=v.concat(A);let S=d?d.defines():[];S=S.concat(g.map(P=>`#define ${P}`));const U=n.isWebGL2?"#version 300 es\n":"",j=U+S.concat(n.extStandardDerivatives&&0===U.length?"#extension GL_OES_standard_derivatives : enable\n".concat(js):js,js,No,cc.fragmentSource,ka.fragmentSource,h.fragmentSource).join("\n"),G=U+S.concat("\n#ifdef GL_ES\nprecision highp float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif",No,cc.vertexSource,ka.vertexSource,Vo.vertexSource,h.vertexSource).join("\n"),Z=y.createShader(y.FRAGMENT_SHADER);if(y.isContextLost())return void(this.failedToCreate=!0);y.shaderSource(Z,j),y.compileShader(Z),y.attachShader(this.program,Z);const $=y.createShader(y.VERTEX_SHADER);if(y.isContextLost())this.failedToCreate=!0;else{y.shaderSource($,G),y.compileShader($),y.attachShader(this.program,$),this.attributes={},this.numAttributes=k.length;for(let P=0;P<this.numAttributes;P++)k[P]&&(y.bindAttribLocation(this.program,P,k[P]),this.attributes[k[P]]=P);y.linkProgram(this.program),y.deleteShader($),y.deleteShader(Z),this.fixedUniforms=m(n),this.binderUniforms=d?d.getUniforms(n):[],g.includes("TERRAIN")&&(this.terrainUniforms={u_dem:new s.Uniform1i(P=n),u_dem_prev:new s.Uniform1i(P),u_dem_unpack:new s.Uniform4f(P),u_dem_tl:new s.Uniform2f(P),u_dem_scale:new s.Uniform1f(P),u_dem_tl_prev:new s.Uniform2f(P),u_dem_scale_prev:new s.Uniform1f(P),u_dem_size:new s.Uniform1f(P),u_dem_lerp:new s.Uniform1f(P),u_exaggeration:new s.Uniform1f(P),u_depth:new s.Uniform1i(P),u_depth_size_inv:new s.Uniform2f(P),u_meter_to_dem:new s.Uniform1f(P),u_label_plane_matrix_inv:new s.UniformMatrix4f(P)}),g.includes("GLOBE")&&(this.globeUniforms=(P=>({u_tile_tl_up:new s.Uniform3f(P),u_tile_tr_up:new s.Uniform3f(P),u_tile_br_up:new s.Uniform3f(P),u_tile_bl_up:new s.Uniform3f(P),u_tile_up_scale:new s.Uniform1f(P)}))(n)),g.includes("FOG")&&(this.fogUniforms=(P=>({u_fog_matrix:new s.UniformMatrix4f(P),u_fog_range:new s.Uniform2f(P),u_fog_color:new s.Uniform4f(P),u_fog_horizon_blend:new s.Uniform1f(P),u_fog_temporal_offset:new s.Uniform1f(P),u_frustum_tl:new s.Uniform3f(P),u_frustum_tr:new s.Uniform3f(P),u_frustum_br:new s.Uniform3f(P),u_frustum_bl:new s.Uniform3f(P),u_globe_pos:new s.Uniform3f(P),u_globe_radius:new s.Uniform1f(P),u_globe_transition:new s.Uniform1f(P),u_is_globe:new s.Uniform1i(P),u_viewport:new s.Uniform2f(P)}))(n))}var P}setTerrainUniformValues(n,a){if(!this.terrainUniforms)return;const h=this.terrainUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const d in a)h[d]&&h[d].set(this.program,d,a[d])}}setGlobeUniformValues(n,a){if(!this.globeUniforms)return;const h=this.globeUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const d in a)h[d]&&h[d].set(this.program,d,a[d])}}setFogUniformValues(n,a){if(!this.fogUniforms)return;const h=this.fogUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const d in a)h[d].set(this.program,d,a[d])}}draw(n,a,h,d,m,g,y,v,A,k,S,U,j,G,Z){const $=n.gl;if(this.failedToCreate)return;n.program.set(this.program),n.setDepthMode(h),n.setStencilMode(d),n.setColorMode(m),n.setCullFace(g);for(const N of Object.keys(this.fixedUniforms))this.fixedUniforms[N].set(this.program,N,y[N]);G&&G.setUniforms(this.program,n,this.binderUniforms,U,{zoom:j});const P={[$.LINES]:2,[$.TRIANGLES]:3,[$.LINE_STRIP]:1}[a];for(const N of S.get()){const X=N.vaos||(N.vaos={});(X[v]||(X[v]=new Dh)).bind(n,this,A,G?G.getPaintVertexBuffers():[],k,N.vertexOffset,Z||[]),$.drawElements(a,N.primitiveLength*P,$.UNSIGNED_SHORT,N.primitiveOffset*P*2)}}}function lo(l,n){const a=Math.pow(2,n.tileID.overscaledZ),h=n.tileSize*Math.pow(2,l.transform.tileZoom)/a,d=h*(n.tileID.canonical.x+n.tileID.wrap*a),m=h*n.tileID.canonical.y;return{u_image:0,u_texsize:n.imageAtlasTexture.size,u_tile_units_to_pixels:1/jt(n,1,l.transform.tileZoom),u_pixel_coord_upper:[d>>16,m>>16],u_pixel_coord_lower:[65535&d,65535&m]}}const pc=s.create(),Xs=(l,n,a,h,d,m,g,y,v,A,k)=>{const S=n.style.light,U=S.properties.get("position"),j=[U.x,U.y,U.z],G=s.create$1();"viewport"===S.properties.get("anchor")&&(s.fromRotation(G,-n.transform.angle),s.transformMat3(j,j,G));const Z=S.properties.get("color"),$=n.transform,P={u_matrix:l,u_lightpos:j,u_lightintensity:S.properties.get("intensity"),u_lightcolor:[Z.r,Z.g,Z.b],u_vertical_gradient:+a,u_opacity:h,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:pc,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:d,u_edge_radius:m};return"globe"===$.projection.name&&(P.u_tile_id=[g.canonical.x,g.canonical.y,1<<g.canonical.z],P.u_zoom_transition=v,P.u_inv_rot_matrix=k,P.u_merc_center=A,P.u_up_dir=$.projection.upVector(new s.CanonicalTileID(0,0,0),A[0]*s.EXTENT,A[1]*s.EXTENT),P.u_height_lift=y),P},mc=(l,n,a,h,d,m,g,y,v,A,k,S)=>{const U=Xs(l,n,a,h,d,m,g,v,A,k,S),j={u_height_factor:-Math.pow(2,g.overscaledZ)/y.tileSize/8};return s.extend(U,lo(n,y),j)},ha=l=>({u_matrix:l}),Ks=(l,n,a)=>s.extend(ha(l),lo(n,a)),Ih=(l,n)=>({u_matrix:l,u_world:n}),Sh=(l,n,a,h)=>s.extend(Ks(l,n,a),{u_world:h}),Ph=s.create(),Js=(l,n,a,h,d,m)=>{const g=l.transform,y="globe"===g.projection.name;let v;if("map"===m.paint.get("circle-pitch-alignment"))if(y){const k=s.globePixelsToTileUnits(g.zoom,n.canonical)*g._pixelsPerMercatorPixel;v=Float32Array.from([k,0,0,k])}else v=g.calculatePixelsToTileUnitsMatrix(a);else v=new Float32Array([g.pixelsToGLUnits[0],0,0,g.pixelsToGLUnits[1]]);const A={u_camera_to_center_distance:g.cameraToCenterDistance,u_matrix:l.translatePosMatrix(n.projMatrix,a,m.paint.get("circle-translate"),m.paint.get("circle-translate-anchor")),u_device_pixel_ratio:s.exported.devicePixelRatio,u_extrude_scale:v,u_inv_rot_matrix:Ph,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(y){A.u_inv_rot_matrix=h,A.u_merc_center=d,A.u_tile_id=[n.canonical.x,n.canonical.y,1<<n.canonical.z],A.u_zoom_transition=s.globeToMercatorTransition(g.zoom);const k=d[0]*s.EXTENT,S=d[1]*s.EXTENT;A.u_up_dir=g.projection.upVector(new s.CanonicalTileID(0,0,0),k,S)}return A},Qs=l=>{const n=[];return"map"===l.paint.get("circle-pitch-alignment")&&n.push("PITCH_WITH_MAP"),"map"===l.paint.get("circle-pitch-scale")&&n.push("SCALE_WITH_MAP"),n},el=(l,n,a,h)=>{const d=s.EXTENT/a.tileSize;return{u_matrix:l,u_camera_to_center_distance:n.getCameraToCenterDistance(h),u_extrude_scale:[n.pixelsToGLUnits[0]/d,n.pixelsToGLUnits[1]/d]}},$o=(l,n,a=1)=>({u_matrix:l,u_color:n,u_overlay:0,u_overlay_scale:a}),fc=s.create(),_c=(l,n,a,h,d,m,g)=>{const y=l.transform,v="globe"===y.projection.name,A=v?s.globePixelsToTileUnits(y.zoom,n.canonical)*y._pixelsPerMercatorPixel:jt(a,1,m),k={u_matrix:n.projMatrix,u_extrude_scale:A,u_intensity:g,u_inv_rot_matrix:fc,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(v){k.u_inv_rot_matrix=h,k.u_merc_center=d,k.u_tile_id=[n.canonical.x,n.canonical.y,1<<n.canonical.z],k.u_zoom_transition=s.globeToMercatorTransition(y.zoom);const S=d[0]*s.EXTENT,U=d[1]*s.EXTENT;k.u_up_dir=y.projection.upVector(new s.CanonicalTileID(0,0,0),S,U)}return k},zh=(l,n,a,h,d,m,g)=>{const y=l.transform,v=y.calculatePixelsToTileUnitsMatrix(n);return{u_matrix:tl(l,n,a,h),u_pixels_to_tile_units:v,u_device_pixel_ratio:m,u_units_to_pixels:[1/y.pixelsToGLUnits[0],1/y.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:d,u_texsize:ho(a)?n.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:Da(n,l.transform),u_alpha_discard_threshold:0,u_trim_offset:g}},co=(l,n,a,h,d)=>{const m=l.transform;return{u_matrix:tl(l,n,a,h),u_texsize:n.imageAtlasTexture.size,u_pixels_to_tile_units:m.calculatePixelsToTileUnitsMatrix(n),u_device_pixel_ratio:d,u_image:0,u_tile_units_to_pixels:Da(n,m),u_units_to_pixels:[1/m.pixelsToGLUnits[0],1/m.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function Da(l,n){return 1/jt(l,1,n.tileZoom)}function tl(l,n,a,h){return l.translatePosMatrix(h||n.tileID.projMatrix,n,a.paint.get("line-translate"),a.paint.get("line-translate-anchor"))}function ho(l){const n=l.paint.get("line-dasharray").value;return n.value||"constant"!==n.kind}const il=(l,n,a,h,d,m)=>{return{u_matrix:l,u_tl_parent:n,u_scale_parent:a,u_fade_t:h.mix,u_opacity:h.opacity*d.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:d.paint.get("raster-brightness-min"),u_brightness_high:d.paint.get("raster-brightness-max"),u_saturation_factor:(y=d.paint.get("raster-saturation"),y>0?1-1/(1.001-y):-y),u_contrast_factor:(g=d.paint.get("raster-contrast"),g>0?1/(1-g):1+g),u_spin_weights:xr(d.paint.get("raster-hue-rotate")),u_perspective_transform:m};var g,y};function xr(l){l*=Math.PI/180;const n=Math.sin(l),a=Math.cos(l);return[(2*a+1)/3,(-Math.sqrt(3)*n-a+1)/3,(Math.sqrt(3)*n-a+1)/3]}const Wo=s.create(),nl=(l,n,a,h,d,m,g,y,v,A,k,S,U,j,G,Z)=>{const $=d.transform,P={u_is_size_zoom_constant:+("constant"===l||"source"===l),u_is_size_feature_constant:+("constant"===l||"camera"===l),u_size_t:n?n.uSizeT:0,u_size:n?n.uSize:0,u_camera_to_center_distance:$.cameraToCenterDistance,u_rotate_symbol:+a,u_aspect_ratio:$.width/$.height,u_fade_change:d.options.fadeDuration?d.symbolFadeChange:1,u_matrix:m,u_label_plane_matrix:g,u_coord_matrix:y,u_is_text:+v,u_pitch_with_map:+h,u_texsize:A,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Wo,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Wo,u_up_vector:[0,-1,0]};return"globe"===Z.name&&(P.u_tile_id=[k.canonical.x,k.canonical.y,1<<k.canonical.z],P.u_zoom_transition=S,P.u_inv_rot_matrix=j,P.u_merc_center=U,P.u_camera_forward=$._camera.forward(),P.u_ecef_origin=s.globeECEFOrigin($.globeMatrix,k.toUnwrapped()),P.u_tile_matrix=Float32Array.from($.globeMatrix),P.u_up_vector=G),P},Ho=(l,n,a,h,d,m,g,y,v,A,k,S,U,j,G,Z,$)=>s.extend(nl(l,n,a,h,d,m,g,y,v,A,S,U,j,G,Z,$),{u_gamma_scale:h?d.transform.cameraToCenterDistance*Math.cos(d.terrain?0:d.transform._pitch):1,u_device_pixel_ratio:s.exported.devicePixelRatio,u_is_halo:+k}),gc=(l,n,a,h,d,m,g,y,v,A,k,S,U,j,G,Z)=>s.extend(Ho(l,n,a,h,d,m,g,y,!0,v,!0,k,S,U,j,G,Z),{u_texsize_icon:A,u_texture_icon:1}),rl=(l,n,a)=>({u_matrix:l,u_opacity:n,u_color:a}),Lh=(l,n,a,h,d)=>s.extend(function(m,g,y){const v=g.imageManager.getPattern(m.toString()),{width:A,height:k}=g.imageManager.getPixelSize(),S=Math.pow(2,y.tileID.overscaledZ),U=y.tileSize*Math.pow(2,g.transform.tileZoom)/S,j=U*(y.tileID.canonical.x+y.tileID.wrap*S),G=U*y.tileID.canonical.y;return{u_image:0,u_pattern_tl:v.tl,u_pattern_br:v.br,u_texsize:[A,k],u_pattern_size:v.displaySize,u_tile_units_to_pixels:1/jt(y,1,g.transform.tileZoom),u_pixel_coord_upper:[j>>16,G>>16],u_pixel_coord_lower:[65535&j,65535&G]}}(h,a,d),{u_matrix:l,u_opacity:n}),al={fillExtrusion:l=>({u_matrix:new s.UniformMatrix4f(l),u_lightpos:new s.Uniform3f(l),u_lightintensity:new s.Uniform1f(l),u_lightcolor:new s.Uniform3f(l),u_vertical_gradient:new s.Uniform1f(l),u_opacity:new s.Uniform1f(l),u_edge_radius:new s.Uniform1f(l),u_ao:new s.Uniform2f(l),u_tile_id:new s.Uniform3f(l),u_zoom_transition:new s.Uniform1f(l),u_inv_rot_matrix:new s.UniformMatrix4f(l),u_merc_center:new s.Uniform2f(l),u_up_dir:new s.Uniform3f(l),u_height_lift:new s.Uniform1f(l)}),fillExtrusionPattern:l=>({u_matrix:new s.UniformMatrix4f(l),u_lightpos:new s.Uniform3f(l),u_lightintensity:new s.Uniform1f(l),u_lightcolor:new s.Uniform3f(l),u_vertical_gradient:new s.Uniform1f(l),u_height_factor:new s.Uniform1f(l),u_edge_radius:new s.Uniform1f(l),u_ao:new s.Uniform2f(l),u_tile_id:new s.Uniform3f(l),u_zoom_transition:new s.Uniform1f(l),u_inv_rot_matrix:new s.UniformMatrix4f(l),u_merc_center:new s.Uniform2f(l),u_up_dir:new s.Uniform3f(l),u_height_lift:new s.Uniform1f(l),u_image:new s.Uniform1i(l),u_texsize:new s.Uniform2f(l),u_pixel_coord_upper:new s.Uniform2f(l),u_pixel_coord_lower:new s.Uniform2f(l),u_tile_units_to_pixels:new s.Uniform1f(l),u_opacity:new s.Uniform1f(l)}),fill:l=>({u_matrix:new s.UniformMatrix4f(l)}),fillPattern:l=>({u_matrix:new s.UniformMatrix4f(l),u_image:new s.Uniform1i(l),u_texsize:new s.Uniform2f(l),u_pixel_coord_upper:new s.Uniform2f(l),u_pixel_coord_lower:new s.Uniform2f(l),u_tile_units_to_pixels:new s.Uniform1f(l)}),fillOutline:l=>({u_matrix:new s.UniformMatrix4f(l),u_world:new s.Uniform2f(l)}),fillOutlinePattern:l=>({u_matrix:new s.UniformMatrix4f(l),u_world:new s.Uniform2f(l),u_image:new s.Uniform1i(l),u_texsize:new s.Uniform2f(l),u_pixel_coord_upper:new s.Uniform2f(l),u_pixel_coord_lower:new s.Uniform2f(l),u_tile_units_to_pixels:new s.Uniform1f(l)}),circle:l=>({u_camera_to_center_distance:new s.Uniform1f(l),u_extrude_scale:new s.UniformMatrix2f(l),u_device_pixel_ratio:new s.Uniform1f(l),u_matrix:new s.UniformMatrix4f(l),u_inv_rot_matrix:new s.UniformMatrix4f(l),u_merc_center:new s.Uniform2f(l),u_tile_id:new s.Uniform3f(l),u_zoom_transition:new s.Uniform1f(l),u_up_dir:new s.Uniform3f(l)}),collisionBox:l=>({u_matrix:new s.UniformMatrix4f(l),u_camera_to_center_distance:new s.Uniform1f(l),u_extrude_scale:new s.Uniform2f(l)}),collisionCircle:l=>({u_matrix:new s.UniformMatrix4f(l),u_inv_matrix:new s.UniformMatrix4f(l),u_camera_to_center_distance:new s.Uniform1f(l),u_viewport_size:new s.Uniform2f(l)}),debug:l=>({u_color:new s.UniformColor(l),u_matrix:new s.UniformMatrix4f(l),u_overlay:new s.Uniform1i(l),u_overlay_scale:new s.Uniform1f(l)}),clippingMask:l=>({u_matrix:new s.UniformMatrix4f(l)}),heatmap:l=>({u_extrude_scale:new s.Uniform1f(l),u_intensity:new s.Uniform1f(l),u_matrix:new s.UniformMatrix4f(l),u_inv_rot_matrix:new s.UniformMatrix4f(l),u_merc_center:new s.Uniform2f(l),u_tile_id:new s.Uniform3f(l),u_zoom_transition:new s.Uniform1f(l),u_up_dir:new s.Uniform3f(l)}),heatmapTexture:l=>({u_image:new s.Uniform1i(l),u_color_ramp:new s.Uniform1i(l),u_opacity:new s.Uniform1f(l)}),hillshade:l=>({u_matrix:new s.UniformMatrix4f(l),u_image:new s.Uniform1i(l),u_latrange:new s.Uniform2f(l),u_light:new s.Uniform2f(l),u_shadow:new s.UniformColor(l),u_highlight:new s.UniformColor(l),u_accent:new s.UniformColor(l)}),hillshadePrepare:l=>({u_matrix:new s.UniformMatrix4f(l),u_image:new s.Uniform1i(l),u_dimension:new s.Uniform2f(l),u_zoom:new s.Uniform1f(l),u_unpack:new s.Uniform4f(l)}),line:l=>({u_matrix:new s.UniformMatrix4f(l),u_pixels_to_tile_units:new s.UniformMatrix2f(l),u_device_pixel_ratio:new s.Uniform1f(l),u_units_to_pixels:new s.Uniform2f(l),u_dash_image:new s.Uniform1i(l),u_gradient_image:new s.Uniform1i(l),u_image_height:new s.Uniform1f(l),u_texsize:new s.Uniform2f(l),u_tile_units_to_pixels:new s.Uniform1f(l),u_alpha_discard_threshold:new s.Uniform1f(l),u_trim_offset:new s.Uniform2f(l)}),linePattern:l=>({u_matrix:new s.UniformMatrix4f(l),u_texsize:new s.Uniform2f(l),u_pixels_to_tile_units:new s.UniformMatrix2f(l),u_device_pixel_ratio:new s.Uniform1f(l),u_image:new s.Uniform1i(l),u_units_to_pixels:new s.Uniform2f(l),u_tile_units_to_pixels:new s.Uniform1f(l),u_alpha_discard_threshold:new s.Uniform1f(l)}),raster:l=>({u_matrix:new s.UniformMatrix4f(l),u_tl_parent:new s.Uniform2f(l),u_scale_parent:new s.Uniform1f(l),u_fade_t:new s.Uniform1f(l),u_opacity:new s.Uniform1f(l),u_image0:new s.Uniform1i(l),u_image1:new s.Uniform1i(l),u_brightness_low:new s.Uniform1f(l),u_brightness_high:new s.Uniform1f(l),u_saturation_factor:new s.Uniform1f(l),u_contrast_factor:new s.Uniform1f(l),u_spin_weights:new s.Uniform3f(l),u_perspective_transform:new s.Uniform2f(l)}),symbolIcon:l=>({u_is_size_zoom_constant:new s.Uniform1i(l),u_is_size_feature_constant:new s.Uniform1i(l),u_size_t:new s.Uniform1f(l),u_size:new s.Uniform1f(l),u_camera_to_center_distance:new s.Uniform1f(l),u_rotate_symbol:new s.Uniform1i(l),u_aspect_ratio:new s.Uniform1f(l),u_fade_change:new s.Uniform1f(l),u_matrix:new s.UniformMatrix4f(l),u_label_plane_matrix:new s.UniformMatrix4f(l),u_coord_matrix:new s.UniformMatrix4f(l),u_is_text:new s.Uniform1i(l),u_pitch_with_map:new s.Uniform1i(l),u_texsize:new s.Uniform2f(l),u_tile_id:new s.Uniform3f(l),u_zoom_transition:new s.Uniform1f(l),u_inv_rot_matrix:new s.UniformMatrix4f(l),u_merc_center:new s.Uniform2f(l),u_camera_forward:new s.Uniform3f(l),u_tile_matrix:new s.UniformMatrix4f(l),u_up_vector:new s.Uniform3f(l),u_ecef_origin:new s.Uniform3f(l),u_texture:new s.Uniform1i(l)}),symbolSDF:l=>({u_is_size_zoom_constant:new s.Uniform1i(l),u_is_size_feature_constant:new s.Uniform1i(l),u_size_t:new s.Uniform1f(l),u_size:new s.Uniform1f(l),u_camera_to_center_distance:new s.Uniform1f(l),u_rotate_symbol:new s.Uniform1i(l),u_aspect_ratio:new s.Uniform1f(l),u_fade_change:new s.Uniform1f(l),u_matrix:new s.UniformMatrix4f(l),u_label_plane_matrix:new s.UniformMatrix4f(l),u_coord_matrix:new s.UniformMatrix4f(l),u_is_text:new s.Uniform1i(l),u_pitch_with_map:new s.Uniform1i(l),u_texsize:new s.Uniform2f(l),u_texture:new s.Uniform1i(l),u_gamma_scale:new s.Uniform1f(l),u_device_pixel_ratio:new s.Uniform1f(l),u_tile_id:new s.Uniform3f(l),u_zoom_transition:new s.Uniform1f(l),u_inv_rot_matrix:new s.UniformMatrix4f(l),u_merc_center:new s.Uniform2f(l),u_camera_forward:new s.Uniform3f(l),u_tile_matrix:new s.UniformMatrix4f(l),u_up_vector:new s.Uniform3f(l),u_ecef_origin:new s.Uniform3f(l),u_is_halo:new s.Uniform1i(l)}),symbolTextAndIcon:l=>({u_is_size_zoom_constant:new s.Uniform1i(l),u_is_size_feature_constant:new s.Uniform1i(l),u_size_t:new s.Uniform1f(l),u_size:new s.Uniform1f(l),u_camera_to_center_distance:new s.Uniform1f(l),u_rotate_symbol:new s.Uniform1i(l),u_aspect_ratio:new s.Uniform1f(l),u_fade_change:new s.Uniform1f(l),u_matrix:new s.UniformMatrix4f(l),u_label_plane_matrix:new s.UniformMatrix4f(l),u_coord_matrix:new s.UniformMatrix4f(l),u_is_text:new s.Uniform1i(l),u_pitch_with_map:new s.Uniform1i(l),u_texsize:new s.Uniform2f(l),u_texsize_icon:new s.Uniform2f(l),u_texture:new s.Uniform1i(l),u_texture_icon:new s.Uniform1i(l),u_gamma_scale:new s.Uniform1f(l),u_device_pixel_ratio:new s.Uniform1f(l),u_is_halo:new s.Uniform1i(l)}),background:l=>({u_matrix:new s.UniformMatrix4f(l),u_opacity:new s.Uniform1f(l),u_color:new s.UniformColor(l)}),backgroundPattern:l=>({u_matrix:new s.UniformMatrix4f(l),u_opacity:new s.Uniform1f(l),u_image:new s.Uniform1i(l),u_pattern_tl:new s.Uniform2f(l),u_pattern_br:new s.Uniform2f(l),u_texsize:new s.Uniform2f(l),u_pattern_size:new s.Uniform2f(l),u_pixel_coord_upper:new s.Uniform2f(l),u_pixel_coord_lower:new s.Uniform2f(l),u_tile_units_to_pixels:new s.Uniform1f(l)}),terrainRaster:$s,terrainDepth:$s,skybox:l=>({u_matrix:new s.UniformMatrix4f(l),u_sun_direction:new s.Uniform3f(l),u_cubemap:new s.Uniform1i(l),u_opacity:new s.Uniform1f(l),u_temporal_offset:new s.Uniform1f(l)}),skyboxGradient:l=>({u_matrix:new s.UniformMatrix4f(l),u_color_ramp:new s.Uniform1i(l),u_center_direction:new s.Uniform3f(l),u_radius:new s.Uniform1f(l),u_opacity:new s.Uniform1f(l),u_temporal_offset:new s.Uniform1f(l)}),skyboxCapture:l=>({u_matrix_3f:new s.UniformMatrix3f(l),u_sun_direction:new s.Uniform3f(l),u_sun_intensity:new s.Uniform1f(l),u_color_tint_r:new s.Uniform4f(l),u_color_tint_m:new s.Uniform4f(l),u_luminance:new s.Uniform1f(l)}),globeRaster:l=>({u_proj_matrix:new s.UniformMatrix4f(l),u_globe_matrix:new s.UniformMatrix4f(l),u_normalize_matrix:new s.UniformMatrix4f(l),u_merc_matrix:new s.UniformMatrix4f(l),u_zoom_transition:new s.Uniform1f(l),u_merc_center:new s.Uniform2f(l),u_image0:new s.Uniform1i(l),u_grid_matrix:new s.UniformMatrix3f(l),u_skirt_height:new s.Uniform1f(l),u_frustum_tl:new s.Uniform3f(l),u_frustum_tr:new s.Uniform3f(l),u_frustum_br:new s.Uniform3f(l),u_frustum_bl:new s.Uniform3f(l),u_globe_pos:new s.Uniform3f(l),u_globe_radius:new s.Uniform1f(l),u_viewport:new s.Uniform2f(l)}),globeAtmosphere:l=>({u_frustum_tl:new s.Uniform3f(l),u_frustum_tr:new s.Uniform3f(l),u_frustum_br:new s.Uniform3f(l),u_frustum_bl:new s.Uniform3f(l),u_horizon:new s.Uniform1f(l),u_transition:new s.Uniform1f(l),u_fadeout_range:new s.Uniform1f(l),u_color:new s.Uniform4f(l),u_high_color:new s.Uniform4f(l),u_space_color:new s.Uniform4f(l),u_star_intensity:new s.Uniform1f(l),u_star_density:new s.Uniform1f(l),u_star_size:new s.Uniform1f(l),u_temporal_offset:new s.Uniform1f(l),u_horizon_angle:new s.Uniform1f(l),u_rotation_matrix:new s.UniformMatrix4f(l)})};let Yo;function uo(l,n,a,h,d,m,g){const y=l.context,v=y.gl,A=l.transform,k=l.useProgram("collisionBox"),S=[];let U=0,j=0;for(let J=0;J<h.length;J++){const oe=h[J],ce=n.getTile(oe),le=ce.getBucket(a);if(!le)continue;const pe=Qn(oe,le,A);let de=pe;0===d[0]&&0===d[1]||(de=l.translatePosMatrix(pe,ce,d,m));const ve=g?le.textCollisionBox:le.iconCollisionBox,qe=le.collisionCircleArray;if(qe.length>0){const _e=s.create(),Le=de;s.mul(_e,le.placementInvProjMatrix,A.glCoordMatrix),s.mul(_e,_e,le.placementViewportMatrix),S.push({circleArray:qe,circleOffset:j,transform:Le,invTransform:_e,projection:le.getProjection()}),U+=qe.length/4,j=U}ve&&(l.terrain&&l.terrain.setupElevationDraw(ce,k),k.draw(y,v.LINES,s.DepthMode.disabled,s.StencilMode.disabled,l.colorModeForRenderPass(),s.CullFaceMode.disabled,el(de,A,ce,le.getProjection()),a.id,ve.layoutVertexBuffer,ve.indexBuffer,ve.segments,null,A.zoom,null,[ve.collisionVertexBuffer,ve.collisionVertexBufferExt]))}if(!g||!S.length)return;const G=l.useProgram("collisionCircle"),Z=new s.StructArrayLayout2f1f2i16;Z.resize(4*U),Z._trim();let $=0;for(const J of S)for(let oe=0;oe<J.circleArray.length/4;oe++){const ce=4*oe,le=J.circleArray[ce+0],pe=J.circleArray[ce+1],de=J.circleArray[ce+2],ve=J.circleArray[ce+3];Z.emplace($++,le,pe,de,ve,0),Z.emplace($++,le,pe,de,ve,1),Z.emplace($++,le,pe,de,ve,2),Z.emplace($++,le,pe,de,ve,3)}(!Yo||Yo.length<2*U)&&(Yo=function(J){const oe=2*J,ce=new s.StructArrayLayout3ui6;ce.resize(oe),ce._trim();for(let le=0;le<oe;le++){const pe=6*le;ce.uint16[pe+0]=4*le+0,ce.uint16[pe+1]=4*le+1,ce.uint16[pe+2]=4*le+2,ce.uint16[pe+3]=4*le+2,ce.uint16[pe+4]=4*le+3,ce.uint16[pe+5]=4*le+0}return ce}(U));const P=y.createIndexBuffer(Yo,!0),N=y.createVertexBuffer(Z,s.collisionCircleLayout.members,!0);for(const J of S){const oe={u_matrix:J.transform,u_inv_matrix:J.invTransform,u_camera_to_center_distance:(X=A).getCameraToCenterDistance(J.projection),u_viewport_size:[X.width,X.height]};G.draw(y,v.TRIANGLES,s.DepthMode.disabled,s.StencilMode.disabled,l.colorModeForRenderPass(),s.CullFaceMode.disabled,oe,a.id,N,P,s.SegmentVector.simpleSegment(0,2*J.circleOffset,J.circleArray.length,J.circleArray.length/2),null,A.zoom)}var X;N.destroy(),P.destroy()}const yc=s.create();function ol({width:l,height:n,anchor:a,textOffset:h,textScale:d},m){const{horizontalAlign:g,verticalAlign:y}=s.getAnchorAlignment(a),v=-(g-.5)*l,A=-(y-.5)*n,k=s.evaluateVariableOffset(a,h);return new s.Point((v/d+k[0])*m,(A/d+k[1])*m)}function Rh(l,n,a,h,d,m,g,y,v,A,k){const S=l.text.placedSymbolArray,U=l.text.dynamicLayoutVertexArray,j=l.icon.dynamicLayoutVertexArray,G={},Z=l.getProjection(),$=Ii(y,Z,m),P=m.elevation,N=Z.upVectorScale(y.canonical,m.center.lat,m.worldSize).metersToTile;U.clear();for(let X=0;X<S.length;X++){const J=S.get(X),{tileAnchorX:oe,tileAnchorY:ce,numGlyphs:le}=J,pe=J.hidden||!J.crossTileID||l.allowVerticalPlacement&&!J.placedOrientation?null:h[J.crossTileID];if(pe){let de=0,ve=0,qe=0;if(P){const He=P?P.getAtTileOffset(y,oe,ce):0,[gt,St,ht]=Z.upVector(y.canonical,oe,ce);de=He*gt*N,ve=He*St*N,qe=He*ht*N}let[_e,Le,we,Ze]=F(J.projectedAnchorX+de,J.projectedAnchorY+ve,J.projectedAnchorZ+qe,a?$:g);const ye=R(m.getCameraToCenterDistance(Z),Ze);let ze=d.evaluateSizeForFeature(l.textSizeData,A,J)*ye/s.ONE_EM;a&&(ze*=l.tilePixelRatio/v);const We=ol(pe,ze);a?(({x:_e,y:Le,z:we}=Z.projectTilePoint(oe+We.x,ce+We.y,y.canonical)),[_e,Le,we]=F(_e+de,Le+ve,we+qe,g)):(n&&We._rotate(-m.angle),_e+=We.x,Le+=We.y,we=0);const Be=l.allowVerticalPlacement&&J.placedOrientation===s.WritingMode.vertical?Math.PI/2:0;for(let He=0;He<le;He++)s.addDynamicAttributes(U,_e,Le,we,Be);k&&J.associatedIconIndex>=0&&(G[J.associatedIconIndex]={x:_e,y:Le,z:we,angle:Be})}else Kt(le,U)}if(k){j.clear();const X=l.icon.placedSymbolArray;for(let J=0;J<X.length;J++){const oe=X.get(J),{numGlyphs:ce}=oe,le=G[J];if(oe.hidden||!le)Kt(ce,j);else{const{x:pe,y:de,z:ve,angle:qe}=le;for(let _e=0;_e<ce;_e++)s.addDynamicAttributes(j,pe,de,ve,qe)}}l.icon.dynamicLayoutVertexBuffer.updateData(j)}l.text.dynamicLayoutVertexBuffer.updateData(U)}function sl(l,n,a){return a.iconsInText&&n?"symbolTextAndIcon":l?"symbolSDF":"symbolIcon"}function xc(l,n,a,h,d,m,g,y,v,A,k,S){const U=l.context,j=U.gl,G=l.transform,Z="map"===y,$="map"===v,P=Z&&"point"!==a.layout.get("symbol-placement"),N=Z&&!$&&!P,X=void 0!==a.layout.get("symbol-sort-key").constantOr(1);let J=!1;const oe=l.depthModeForSublayer(0,s.DepthMode.ReadOnly),ce=[s.mercatorXfromLng(G.center.lng),s.mercatorYfromLat(G.center.lat)],le=a.layout.get("text-variable-anchor"),pe="globe"===G.projection.name,de=[],ve=[0,-1,0];let qe=ve;!pe&&!G.mercatorFromTransition||Z||(qe=function(_e){const Le=_e._camera.getWorldToCamera(_e.worldSize,1),we=s.multiply([],Le,_e.globeMatrix);s.invert(we,we);const Ze=[0,0,0],ye=[0,1,0,0];return s.transformMat4$1(ye,ye,we),Ze[0]=ye[0],Ze[1]=ye[1],Ze[2]=ye[2],s.normalize(Ze,Ze),Ze}(G));for(const _e of h){const Le=n.getTile(_e),we=Le.getBucket(a);if(!we||"mercator"===we.projection.name&&pe)continue;const Ze=d?we.text:we.icon;if(!Ze||we.fullyClipped||!Ze.segments.get().length)continue;const ye=Ze.programConfigurations.get(a.id),ze=d||we.sdfIcons,We=d?we.textSizeData:we.iconSizeData,Be=$||0!==G.pitch,He=s.evaluateSizeForZoom(We,G.zoom);let gt,St,ht,Et,Wt=[0,0],qt=null;if(d)St=Le.glyphAtlasTexture,ht=j.LINEAR,gt=Le.glyphAtlasTexture.size,we.iconsInText&&(Wt=Le.imageAtlasTexture.size,qt=Le.imageAtlasTexture,Et=Be||l.options.rotating||l.options.zooming||"composite"===We.kind||"camera"===We.kind?j.LINEAR:j.NEAREST);else{const Br=1!==a.layout.get("icon-size").constantOr(0)||we.iconsNeedLinear;St=Le.imageAtlasTexture,ht=ze||l.options.rotating||l.options.zooming||Br||Be?j.LINEAR:j.NEAREST,gt=Le.imageAtlasTexture.size}const pt="globe"===we.projection.name,hi=pt?qe:ve,fi=pt?s.globeToMercatorTransition(G.zoom):0,_i=Ii(_e,we.getProjection(),G),gi=G.calculatePixelsToTileUnitsMatrix(Le),yn=ke(_i,Le.tileID.canonical,$,Z,G,we.getProjection(),gi),sn=l.terrain&&$&&P?s.invert(s.create(),yn):yc,nr=Fi(_i,Le.tileID.canonical,$,Z,G,we.getProjection(),gi),br=le&&we.hasTextData(),Si="none"!==a.layout.get("icon-text-fit")&&br&&we.hasIconData();if(P){const Br=G.elevation,Xr=Br?Br.getAtTileOffsetFunc(_e,G.center.lat,G.worldSize,we.getProjection()):null,fa=Kn(_i,Le.tileID.canonical,$,Z,G,we.getProjection(),gi);q(we,_i,l,d,fa,nr,$,A,Xr,_e)}const yi=P||d&&le||Si,oi=l.translatePosMatrix(_i,Le,m,g),Wi=yi?yc:yn,Tn=l.translatePosMatrix(nr,Le,m,g,!0),Mi=we.getProjection().createInversionMatrix(G,_e.canonical),Cn=[];l.terrainRenderModeElevated()&&$&&Cn.push("PITCH_WITH_MAP_TERRAIN"),pt&&Cn.push("PROJECTION_GLOBE_VIEW"),yi&&Cn.push("PROJECTED_POS_ON_VIEWPORT");const us=ze&&0!==a.paint.get(d?"text-halo-width":"icon-halo-width").constantOr(1);let ma;ma=ze?we.iconsInText?gc(We.kind,He,N,$,l,oi,Wi,Tn,gt,Wt,_e,fi,ce,Mi,hi,we.getProjection()):Ho(We.kind,He,N,$,l,oi,Wi,Tn,d,gt,!0,_e,fi,ce,Mi,hi,we.getProjection()):nl(We.kind,He,N,$,l,oi,Wi,Tn,d,gt,_e,fi,ce,Mi,hi,we.getProjection());const To={program:l.useProgram(sl(ze,d,we),ye,Cn),buffers:Ze,uniformValues:ma,atlasTexture:St,atlasTextureIcon:qt,atlasInterpolation:ht,atlasInterpolationIcon:Et,isSDF:ze,hasHalo:us,tile:Le,labelPlaneMatrixInv:sn};if(X&&we.canOverlap){J=!0;const Br=Ze.segments.get();for(const Xr of Br)de.push({segments:new s.SegmentVector([Xr]),sortKey:Xr.sortKey,state:To})}else de.push({segments:Ze.segments,sortKey:0,state:To})}J&&de.sort((_e,Le)=>_e.sortKey-Le.sortKey);for(const _e of de){const Le=_e.state;if(l.terrain&&l.terrain.setupElevationDraw(Le.tile,Le.program,{useDepthForOcclusion:!pe,labelPlaneMatrixInv:Le.labelPlaneMatrixInv}),U.activeTexture.set(j.TEXTURE0),Le.atlasTexture.bind(Le.atlasInterpolation,j.CLAMP_TO_EDGE),Le.atlasTextureIcon&&(U.activeTexture.set(j.TEXTURE1),Le.atlasTextureIcon&&Le.atlasTextureIcon.bind(Le.atlasInterpolationIcon,j.CLAMP_TO_EDGE)),Le.isSDF){const we=Le.uniformValues;Le.hasHalo&&(we.u_is_halo=1,po(Le.buffers,_e.segments,a,l,Le.program,oe,k,S,we)),we.u_is_halo=0}po(Le.buffers,_e.segments,a,l,Le.program,oe,k,S,Le.uniformValues)}}function po(l,n,a,h,d,m,g,y,v){const A=h.context,k=[l.dynamicLayoutVertexBuffer,l.opacityVertexBuffer,l.globeExtVertexBuffer];d.draw(A,A.gl.TRIANGLES,m,g,y,s.CullFaceMode.disabled,v,a.id,l.layoutVertexBuffer,l.indexBuffer,n,a.paint,h.transform.zoom,l.programConfigurations.get(a.id),k)}function vc(l,n,a,h,d,m,g){const y=l.context.gl,v=a.paint.get("fill-pattern"),A=v&&v.constantOr(1);let k,S,U,j,G;g?(S=A&&!a.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",k=y.LINES):(S=A?"fillPattern":"fill",k=y.TRIANGLES);for(const Z of h){const $=n.getTile(Z);if(A&&!$.patternsLoaded())continue;const P=$.getBucket(a);if(!P)continue;l.prepareDrawTile();const N=P.programConfigurations.get(a.id),X=l.useProgram(S,N);A&&(l.context.activeTexture.set(y.TEXTURE0),$.imageAtlasTexture.bind(y.LINEAR,y.CLAMP_TO_EDGE),N.updatePaintBuffers());const J=v.constantOr(null);if(J&&$.imageAtlas){const ce=$.imageAtlas.patternPositions[J.toString()];ce&&N.setConstantPatternPositions(ce)}const oe=l.translatePosMatrix(Z.projMatrix,$,a.paint.get("fill-translate"),a.paint.get("fill-translate-anchor"));if(g){j=P.indexBuffer2,G=P.segments2;const ce=l.terrain&&l.terrain.renderingToTexture?l.terrain.drapeBufferSize:[y.drawingBufferWidth,y.drawingBufferHeight];U="fillOutlinePattern"===S&&A?Sh(oe,l,$,ce):Ih(oe,ce)}else j=P.indexBuffer,G=P.segments,U=A?Ks(oe,l,$):ha(oe);l.prepareDrawProgram(l.context,X,Z.toUnwrapped()),X.draw(l.context,k,d,l.stencilModeForClipping(Z),m,s.CullFaceMode.disabled,U,a.id,P.layoutVertexBuffer,j,G,a.paint,l.transform.zoom,N)}}function Xo(l,n,a,h,d,m,g){const y=l.context,v=y.gl,A=l.transform,k=a.paint.get("fill-extrusion-pattern"),S=k.constantOr(1),U=a.paint.get("fill-extrusion-opacity"),j=[a.paint.get("fill-extrusion-ambient-occlusion-intensity"),a.paint.get("fill-extrusion-ambient-occlusion-radius")],G=a.layout.get("fill-extrusion-edge-radius"),Z=G>0&&!a.paint.get("fill-extrusion-rounded-roof"),$=Z?0:G,P="globe"===A.projection.name?s.fillExtrusionHeightLift():0,N="globe"===A.projection.name,X=N?s.globeToMercatorTransition(A.zoom):0,J=[s.mercatorXfromLng(A.center.lng),s.mercatorYfromLat(A.center.lat)],oe=[];N&&oe.push("PROJECTION_GLOBE_VIEW"),j[0]>0&&oe.push("FAUX_AO"),Z&&oe.push("ZERO_ROOF_RADIUS");for(const ce of h){const le=n.getTile(ce),pe=le.getBucket(a);if(!pe||pe.projection.name!==A.projection.name)continue;const de=pe.programConfigurations.get(a.id),ve=l.useProgram(S?"fillExtrusionPattern":"fillExtrusion",de,oe);if(l.terrain){const ze=l.terrain;if(l.style.terrainSetForDrapingOnly())ze.setupElevationDraw(le,ve,{useMeterToDem:!0});else{if(!pe.enableTerrain)continue;if(ze.setupElevationDraw(le,ve,{useMeterToDem:!0}),bc(y,n,ce,pe,a,ze),!pe.centroidVertexBuffer){const We=ve.attributes.a_centroid_pos;void 0!==We&&v.vertexAttrib2f(We,0,0)}}}S&&(l.context.activeTexture.set(v.TEXTURE0),le.imageAtlasTexture.bind(v.LINEAR,v.CLAMP_TO_EDGE),de.updatePaintBuffers());const qe=k.constantOr(null);if(qe&&le.imageAtlas){const ze=le.imageAtlas.patternPositions[qe.toString()];ze&&de.setConstantPatternPositions(ze)}const _e=l.translatePosMatrix(ce.projMatrix,le,a.paint.get("fill-extrusion-translate"),a.paint.get("fill-extrusion-translate-anchor")),Le=A.projection.createInversionMatrix(A,ce.canonical),we=a.paint.get("fill-extrusion-vertical-gradient"),Ze=S?mc(_e,l,we,U,j,$,ce,le,P,X,J,Le):Xs(_e,l,we,U,j,$,ce,P,X,J,Le);l.prepareDrawProgram(y,ve,ce.toUnwrapped());const ye=[];l.terrain&&ye.push(pe.centroidVertexBuffer),N&&ye.push(pe.layoutVertexExtBuffer),ve.draw(y,y.gl.TRIANGLES,d,m,g,s.CullFaceMode.backCCW,Ze,a.id,pe.layoutVertexBuffer,pe.indexBuffer,pe.segments,a.paint,l.transform.zoom,de,ye)}}function bc(l,n,a,h,d,m){const g=[P=>{let N=P.canonical.x-1,X=P.wrap;return N<0&&(N=(1<<P.canonical.z)-1,X--),new s.OverscaledTileID(P.overscaledZ,X,P.canonical.z,N,P.canonical.y)},P=>{let N=P.canonical.x+1,X=P.wrap;return N===1<<P.canonical.z&&(N=0,X++),new s.OverscaledTileID(P.overscaledZ,X,P.canonical.z,N,P.canonical.y)},P=>new s.OverscaledTileID(P.overscaledZ,P.wrap,P.canonical.z,P.canonical.x,(0===P.canonical.y?1<<P.canonical.z:P.canonical.y)-1),P=>new s.OverscaledTileID(P.overscaledZ,P.wrap,P.canonical.z,P.canonical.x,P.canonical.y===(1<<P.canonical.z)-1?0:P.canonical.y+1)],y=P=>{const N=n.getSource().minzoom,X=oe=>{const ce=n.getTileByID(oe);if(ce&&ce.hasData())return ce.getBucket(d)},J=[0,-1,1];for(const oe of J){if(P.overscaledZ+oe<N)continue;const ce=X(P.calculateScaledKey(P.overscaledZ+oe));if(ce)return ce}},v=[0,0,0],A=(P,N)=>(v[0]=Math.min(P.min.y,N.min.y),v[1]=Math.max(P.max.y,N.max.y),v[2]=s.EXTENT-N.min.x>P.max.x?N.min.x-s.EXTENT:P.max.x,v),k=(P,N)=>(v[0]=Math.min(P.min.x,N.min.x),v[1]=Math.max(P.max.x,N.max.x),v[2]=s.EXTENT-N.min.y>P.max.y?N.min.y-s.EXTENT:P.max.y,v),S=[(P,N)=>A(P,N),(P,N)=>A(N,P),(P,N)=>k(P,N),(P,N)=>k(N,P)],U=new s.Point(0,0);let j,G,Z;const $=(P,N,X,J,oe)=>{const ce=[[J?X:P,J?P:X,0],[J?X:N,J?N:X,0]],le=oe<0?s.EXTENT+oe:oe,pe=[J?le:(P+N)/2,J?(P+N)/2:le,0];return 0===X&&oe<0||0!==X&&oe>0?m.getForTilePoints(Z,[pe],!0,G):ce.push(pe),m.getForTilePoints(a,ce,!0,j),Math.max(ce[0][2],ce[1][2],pe[2])/m.exaggeration()};for(let P=0;P<4;P++){const N=(P<2?1:5)-P,X=h.borders[P];if(0===X.length)continue;const J=Z=g[P](a),oe=y(J);if(!(oe&&oe instanceof s.FillExtrusionBucket&&oe.enableTerrain)||h.borderDoneWithNeighborZ[P]===oe.canonical.z&&oe.borderDoneWithNeighborZ[N]===h.canonical.z||(G=m.findDEMTileFor(J),!G||!G.dem))continue;if(!j){const de=m.findDEMTileFor(a);if(!de||!de.dem)return;j=de}const ce=oe.borders[N];let le=0;const pe=oe.borderDoneWithNeighborZ[N]!==h.canonical.z;if(h.canonical.z===oe.canonical.z){for(let de=0;de<X.length;de++){const ve=h.featuresOnBorder[X[de]],qe=ve.borders[P];let _e;for(;le<ce.length&&(_e=oe.featuresOnBorder[ce[le]],!(_e.borders[N][1]>qe[0]+3));)pe&&oe.encodeCentroid(void 0,_e,!1),le++;if(_e&&le<ce.length){const Le=le;let we=0;for(;!(_e.borders[N][0]>qe[1]-3)&&(we++,++le!==ce.length);)_e=oe.featuresOnBorder[ce[le]];if(_e=oe.featuresOnBorder[ce[Le]],ve.intersectsCount()>1||_e.intersectsCount()>1||1!==we){1!==we&&(le=Le),h.encodeCentroid(void 0,ve,!1),pe&&oe.encodeCentroid(void 0,_e,!1);continue}const Ze=S[P](ve,_e),ye=P%2?s.EXTENT-1:0;U.x=$(Ze[0],Math.min(s.EXTENT-1,Ze[1]),ye,P<2,Ze[2]),U.y=0,h.encodeCentroid(U,ve,!1),pe&&oe.encodeCentroid(U,_e,!1)}else h.encodeCentroid(void 0,ve,!1)}h.borderDoneWithNeighborZ[P]=oe.canonical.z,h.needsCentroidUpdate=!0,pe&&(oe.borderDoneWithNeighborZ[N]=h.canonical.z,oe.needsCentroidUpdate=!0)}else{for(const de of X)h.encodeCentroid(void 0,h.featuresOnBorder[de],!1);if(pe){for(const de of ce)oe.encodeCentroid(void 0,oe.featuresOnBorder[de],!1);oe.borderDoneWithNeighborZ[N]=h.canonical.z,oe.needsCentroidUpdate=!0}h.borderDoneWithNeighborZ[P]=oe.canonical.z,h.needsCentroidUpdate=!0}}(h.needsCentroidUpdate||!h.centroidVertexBuffer&&0!==h.centroidVertexArray.length)&&h.uploadCentroid(l)}const Ia=new s.Color(1,0,0,1),Oh=new s.Color(0,1,0,1),Bh=new s.Color(0,0,1,1),Fh=new s.Color(1,0,1,1),Uh=new s.Color(0,1,1,1);function Vh(l,n,a){const h=l.context,d=l.transform,m=h.gl,g="globe"===d.projection.name,y=g?["PROJECTION_GLOBE_VIEW"]:null;let v=a.projMatrix;if(g&&s.globeToMercatorTransition(d.zoom)>0){const ve=s.transitionTileAABBinECEF(a.canonical,d),qe=s.globeDenormalizeECEF(ve);v=s.multiply(new Float32Array(16),d.globeMatrix,qe),s.multiply(v,d.projMatrix,v)}const A=l.useProgram("debug",null,y),k=n.getTileByID(a.key);l.terrain&&l.terrain.setupElevationDraw(k,A);const S=s.DepthMode.disabled,U=s.StencilMode.disabled,j=l.colorModeForRenderPass(),G="$debug";h.activeTexture.set(m.TEXTURE0),l.emptyTexture.bind(m.LINEAR,m.CLAMP_TO_EDGE),g?k._makeGlobeTileDebugBuffers(l.context,d):k._makeDebugTileBoundsBuffers(l.context,d.projection);const Z=k._tileDebugBuffer||l.debugBuffer,$=k._tileDebugIndexBuffer||l.debugIndexBuffer,P=k._tileDebugSegments||l.debugSegments;A.draw(h,m.LINE_STRIP,S,U,j,s.CullFaceMode.disabled,$o(v,s.Color.red),G,Z,$,P,null,null,null,[k._globeTileDebugBorderBuffer]);const N=k.latestRawTileData,X=Math.floor((N&&N.byteLength||0)/1024),J=n.getTile(a).tileSize,oe=512/Math.min(J,512)*(a.overscaledZ/d.zoom)*.5;let ce=a.canonical.toString();a.overscaledZ!==a.canonical.z&&(ce+=` => ${a.overscaledZ}`),ce+=` ${X}kb`,function(ve,qe){ve.initDebugOverlayCanvas();const _e=ve.debugOverlayCanvas,Le=ve.context.gl,we=ve.debugOverlayCanvas.getContext("2d");we.clearRect(0,0,_e.width,_e.height),we.shadowColor="white",we.shadowBlur=2,we.lineWidth=1.5,we.strokeStyle="white",we.textBaseline="top",we.font="bold 36px Open Sans, sans-serif",we.fillText(qe,5,5),we.strokeText(qe,5,5),ve.debugOverlayTexture.update(_e),ve.debugOverlayTexture.bind(Le.LINEAR,Le.CLAMP_TO_EDGE)}(l,ce);const le=k._tileDebugTextBuffer||l.debugBuffer,pe=k._tileDebugTextIndexBuffer||l.quadTriangleIndexBuffer,de=k._tileDebugTextSegments||l.debugSegments;A.draw(h,m.TRIANGLES,S,U,s.ColorMode.alphaBlended,s.CullFaceMode.disabled,$o(v,s.Color.transparent,oe),G,le,pe,de,null,null,null,[k._globeTileDebugTextBuffer])}function wc(l,n,a,h){Sa(l,0,n+a/2,l.transform.width,a,h)}function Ko(l,n,a,h){Sa(l,n-a/2,0,a,l.transform.height,h)}function Sa(l,n,a,h,d,m){const g=l.context,y=g.gl;y.enable(y.SCISSOR_TEST),y.scissor(n*s.exported.devicePixelRatio,a*s.exported.devicePixelRatio,h*s.exported.devicePixelRatio,d*s.exported.devicePixelRatio),g.clear({color:m}),y.disable(y.SCISSOR_TEST)}const Tc=s.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Ec}=Tc;function Rr(l,n,a,h){l.emplaceBack(n,a,h)}class Jo{constructor(n){this.vertexArray=new s.StructArrayLayout3f12,this.indices=new s.StructArrayLayout3ui6,Rr(this.vertexArray,-1,-1,1),Rr(this.vertexArray,1,-1,1),Rr(this.vertexArray,-1,1,1),Rr(this.vertexArray,1,1,1),Rr(this.vertexArray,-1,-1,-1),Rr(this.vertexArray,1,-1,-1),Rr(this.vertexArray,-1,1,-1),Rr(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=n.createVertexBuffer(this.vertexArray,Ec),this.indexBuffer=n.createIndexBuffer(this.indices),this.segment=s.SegmentVector.simpleSegment(0,0,36,12)}}function tr(l,n,a,h,d,m){const g=l.gl,y=n.paint.get("sky-atmosphere-color"),v=n.paint.get("sky-atmosphere-halo-color"),A=n.paint.get("sky-atmosphere-sun-intensity"),k={u_matrix_3f:s.fromMat4(s.create$1(),h),u_sun_direction:d,u_sun_intensity:A,u_color_tint_r:[(G=y).r,G.g,G.b,G.a],u_color_tint_m:[(Z=v).r,Z.g,Z.b,Z.a],u_luminance:5e-5};var G,Z;g.framebufferTexture2D(g.FRAMEBUFFER,g.COLOR_ATTACHMENT0,g.TEXTURE_CUBE_MAP_POSITIVE_X+m,n.skyboxTexture,0),a.draw(l,g.TRIANGLES,s.DepthMode.disabled,s.StencilMode.disabled,s.ColorMode.unblended,s.CullFaceMode.frontCW,k,"skyboxCapture",n.skyboxGeometry.vertexBuffer,n.skyboxGeometry.indexBuffer,n.skyboxGeometry.segment)}const mo=s.createLayout([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class kc{constructor(n){const a=new s.StructArrayLayout5f20;a.emplaceBack(-1,1,1,0,0),a.emplaceBack(1,1,1,1,0),a.emplaceBack(1,-1,1,1,1),a.emplaceBack(-1,-1,1,0,1);const h=new s.StructArrayLayout3ui6;h.emplaceBack(0,1,2),h.emplaceBack(2,3,0),this.vertexBuffer=n.createVertexBuffer(a,mo.members),this.indexBuffer=n.createIndexBuffer(h),this.segments=s.SegmentVector.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const ua={symbol:function(l,n,a,h,d){if("translucent"!==l.renderPass)return;const m=s.StencilMode.disabled,g=l.colorModeForRenderPass();a.layout.get("text-variable-anchor")&&function(y,v,A,k,S,U,j){const G=v.transform,Z="map"===S,$="map"===U;for(const P of y){const N=k.getTile(P),X=N.getBucket(A);if(!X||!X.text||!X.text.segments.get().length)continue;const J=s.evaluateSizeForZoom(X.textSizeData,G.zoom),oe=Ii(P,X.getProjection(),G),ce=G.calculatePixelsToTileUnitsMatrix(N),le=ke(oe,N.tileID.canonical,$,Z,G,X.getProjection(),ce),pe="none"!==A.layout.get("icon-text-fit")&&X.hasIconData();if(J){const de=Math.pow(2,G.zoom-N.tileID.overscaledZ);Rh(X,Z,$,j,s.symbolSize,G,le,P,de,J,pe)}}}(h,l,a,n,a.layout.get("text-rotation-alignment"),a.layout.get("text-pitch-alignment"),d),0!==a.paint.get("icon-opacity").constantOr(1)&&xc(l,n,a,h,!1,a.paint.get("icon-translate"),a.paint.get("icon-translate-anchor"),a.layout.get("icon-rotation-alignment"),a.layout.get("icon-pitch-alignment"),a.layout.get("icon-keep-upright"),m,g),0!==a.paint.get("text-opacity").constantOr(1)&&xc(l,n,a,h,!0,a.paint.get("text-translate"),a.paint.get("text-translate-anchor"),a.layout.get("text-rotation-alignment"),a.layout.get("text-pitch-alignment"),a.layout.get("text-keep-upright"),m,g),n.map.showCollisionBoxes&&(uo(l,n,a,h,a.paint.get("text-translate"),a.paint.get("text-translate-anchor"),!0),uo(l,n,a,h,a.paint.get("icon-translate"),a.paint.get("icon-translate-anchor"),!1))},circle:function(l,n,a,h){if("translucent"!==l.renderPass)return;const d=a.paint.get("circle-opacity"),m=a.paint.get("circle-stroke-width"),g=a.paint.get("circle-stroke-opacity"),y=void 0!==a.layout.get("circle-sort-key").constantOr(1);if(0===d.constantOr(1)&&(0===m.constantOr(1)||0===g.constantOr(1)))return;const v=l.context,A=v.gl,k=l.transform,S=l.depthModeForSublayer(0,s.DepthMode.ReadOnly),U=s.StencilMode.disabled,j=l.colorModeForRenderPass(),G="globe"===k.projection.name,Z=[s.mercatorXfromLng(k.center.lng),s.mercatorYfromLat(k.center.lat)],$=[];for(let N=0;N<h.length;N++){const X=h[N],J=n.getTile(X),oe=J.getBucket(a);if(!oe||oe.projection.name!==k.projection.name)continue;const ce=oe.programConfigurations.get(a.id),le=Qs(a);G&&le.push("PROJECTION_GLOBE_VIEW");const pe=l.useProgram("circle",ce,le),de=oe.layoutVertexBuffer,ve=oe.globeExtVertexBuffer,qe=oe.indexBuffer,_e=k.projection.createInversionMatrix(k,X.canonical),Le={programConfiguration:ce,program:pe,layoutVertexBuffer:de,globeExtVertexBuffer:ve,indexBuffer:qe,uniformValues:Js(l,X,J,_e,Z,a),tile:J};if(y){const we=oe.segments.get();for(const Ze of we)$.push({segments:new s.SegmentVector([Ze]),sortKey:Ze.sortKey,state:Le})}else $.push({segments:oe.segments,sortKey:0,state:Le})}y&&$.sort((N,X)=>N.sortKey-X.sortKey);const P={useDepthForOcclusion:!G};for(const N of $){const{programConfiguration:X,program:J,layoutVertexBuffer:oe,globeExtVertexBuffer:ce,indexBuffer:le,uniformValues:pe,tile:de}=N.state,ve=N.segments;l.terrain&&l.terrain.setupElevationDraw(de,J,P),l.prepareDrawProgram(v,J,de.tileID.toUnwrapped()),J.draw(v,A.TRIANGLES,S,U,j,s.CullFaceMode.disabled,pe,a.id,oe,le,ve,a.paint,k.zoom,X,[ce])}},heatmap:function(l,n,a,h){if(0!==a.paint.get("heatmap-opacity"))if("offscreen"===l.renderPass){const d=l.context,m=d.gl,g=s.StencilMode.disabled,y=new s.ColorMode([m.ONE,m.ONE],s.Color.transparent,[!0,!0,!0,!0]);(function(j,G,Z,$){const P=j.gl,N=G.width*$,X=G.height*$;j.activeTexture.set(P.TEXTURE1),j.viewport.set([0,0,N,X]);let J=Z.heatmapFbo;if(!J||J&&(J.width!==N||J.height!==X)){J&&J.destroy();const oe=P.createTexture();P.bindTexture(P.TEXTURE_2D,oe),P.texParameteri(P.TEXTURE_2D,P.TEXTURE_WRAP_S,P.CLAMP_TO_EDGE),P.texParameteri(P.TEXTURE_2D,P.TEXTURE_WRAP_T,P.CLAMP_TO_EDGE),P.texParameteri(P.TEXTURE_2D,P.TEXTURE_MIN_FILTER,P.LINEAR),P.texParameteri(P.TEXTURE_2D,P.TEXTURE_MAG_FILTER,P.LINEAR),J=Z.heatmapFbo=j.createFramebuffer(N,X,!1),function(ce,le,pe,de,ve,qe){const _e=ce.gl;_e.texImage2D(_e.TEXTURE_2D,0,ce.isWebGL2&&ce.extRenderToTextureHalfFloat?_e.RGBA16F:_e.RGBA,ve,qe,0,_e.RGBA,ce.extRenderToTextureHalfFloat?ce.isWebGL2?_e.HALF_FLOAT:ce.extTextureHalfFloat.HALF_FLOAT_OES:_e.UNSIGNED_BYTE,null),de.colorAttachment.set(pe)}(j,0,oe,J,N,X)}else P.bindTexture(P.TEXTURE_2D,J.colorAttachment.get()),j.bindFramebuffer.set(J.framebuffer)})(d,l,a,"globe"===l.transform.projection.name?.5:.25),d.clear({color:s.Color.transparent});const v=l.transform,A="globe"===v.projection.name,k=A?["PROJECTION_GLOBE_VIEW"]:null,S=A?s.CullFaceMode.frontCCW:s.CullFaceMode.disabled,U=[s.mercatorXfromLng(v.center.lng),s.mercatorYfromLat(v.center.lat)];for(let j=0;j<h.length;j++){const G=h[j];if(n.hasRenderableParent(G))continue;const Z=n.getTile(G),$=Z.getBucket(a);if(!$||$.projection.name!==v.projection.name)continue;const P=$.programConfigurations.get(a.id),N=l.useProgram("heatmap",P,k),{zoom:X}=l.transform;l.terrain&&l.terrain.setupElevationDraw(Z,N),l.prepareDrawProgram(d,N,G.toUnwrapped());const J=v.projection.createInversionMatrix(v,G.canonical);N.draw(d,m.TRIANGLES,s.DepthMode.disabled,g,y,S,_c(l,G,Z,J,U,X,a.paint.get("heatmap-intensity")),a.id,$.layoutVertexBuffer,$.indexBuffer,$.segments,a.paint,l.transform.zoom,P,A?[$.globeExtVertexBuffer]:null)}d.viewport.set([0,0,l.width,l.height])}else"translucent"===l.renderPass&&(l.context.setColorMode(l.colorModeForRenderPass()),function(d,m){const g=d.context,y=g.gl,v=m.heatmapFbo;if(!v)return;g.activeTexture.set(y.TEXTURE0),y.bindTexture(y.TEXTURE_2D,v.colorAttachment.get()),g.activeTexture.set(y.TEXTURE1);let A=m.colorRampTexture;A||(A=m.colorRampTexture=new s.Texture(g,m.colorRamp,y.RGBA)),A.bind(y.LINEAR,y.CLAMP_TO_EDGE),d.useProgram("heatmapTexture").draw(g,y.TRIANGLES,s.DepthMode.disabled,s.StencilMode.disabled,d.colorModeForRenderPass(),s.CullFaceMode.disabled,{u_image:0,u_color_ramp:1,u_opacity:m.paint.get("heatmap-opacity")},m.id,d.viewportBuffer,d.quadTriangleIndexBuffer,d.viewportSegments,m.paint,d.transform.zoom)}(l,a))},line:function(l,n,a,h){if("translucent"!==l.renderPass)return;const d=a.paint.get("line-opacity"),m=a.paint.get("line-width");if(0===d.constantOr(1)||0===m.constantOr(1))return;const g=l.depthModeForSublayer(0,s.DepthMode.ReadOnly),y=l.colorModeForRenderPass(),v=l.terrain&&l.terrain.renderingToTexture?1:s.exported.devicePixelRatio,A=a.paint.get("line-dasharray"),k=A.constantOr(1),S=a.layout.get("line-cap"),U=a.paint.get("line-pattern"),j=U.constantOr(1),G=a.paint.get("line-gradient"),Z=j?"linePattern":"line",$=l.context,P=$.gl,N=(J=>{const oe=[];ho(J)&&oe.push("RENDER_LINE_DASH"),J.paint.get("line-gradient")&&oe.push("RENDER_LINE_GRADIENT");const ce=J.paint.get("line-trim-offset");0===ce[0]&&0===ce[1]||oe.push("RENDER_LINE_TRIM_OFFSET");const le=J.paint.get("line-pattern").constantOr(1),pe=1!==J.paint.get("line-opacity").constantOr(1);return!le&&pe&&oe.push("RENDER_LINE_ALPHA_DISCARD"),oe})(a);let X=N.includes("RENDER_LINE_ALPHA_DISCARD");l.terrain&&l.terrain.clipOrMaskOverlapStencilType()&&(X=!1);for(const J of h){const oe=n.getTile(J);if(j&&!oe.patternsLoaded())continue;const ce=oe.getBucket(a);if(!ce)continue;l.prepareDrawTile();const le=ce.programConfigurations.get(a.id),pe=l.useProgram(Z,le,N),de=U.constantOr(null);if(de&&oe.imageAtlas){const ze=oe.imageAtlas.patternPositions[de.toString()];ze&&le.setConstantPatternPositions(ze)}const ve=A.constantOr(null),qe=S.constantOr(null);if(!j&&ve&&qe&&oe.lineAtlas){const ze=oe.lineAtlas.getDash(ve,qe);ze&&le.setConstantPatternPositions(ze)}let[_e,Le]=a.paint.get("line-trim-offset");("round"===qe||"square"===qe)&&_e!==Le&&(0===_e&&(_e-=1),1===Le&&(Le+=1));const we=l.terrain?J.projMatrix:null,Ze=j?co(l,oe,a,we,v):zh(l,oe,a,we,ce.lineClipsArray.length,v,[_e,Le]);if(G){const ze=ce.gradients[a.id];let We=ze.texture;if(a.gradientVersion!==ze.version){let Be=256;if(a.stepInterpolant){const He=n.getSource().maxzoom,gt=J.canonical.z===He?Math.ceil(1<<l.transform.maxZoom-J.canonical.z):1;Be=s.clamp(s.nextPowerOfTwo(ce.maxLineLength/s.EXTENT*1024*gt),256,$.maxTextureSize)}ze.gradient=s.renderColorRamp({expression:a.gradientExpression(),evaluationKey:"lineProgress",resolution:Be,image:ze.gradient||void 0,clips:ce.lineClipsArray}),ze.texture?ze.texture.update(ze.gradient):ze.texture=new s.Texture($,ze.gradient,P.RGBA),ze.version=a.gradientVersion,We=ze.texture}$.activeTexture.set(P.TEXTURE1),We.bind(a.stepInterpolant?P.NEAREST:P.LINEAR,P.CLAMP_TO_EDGE)}k&&($.activeTexture.set(P.TEXTURE0),oe.lineAtlasTexture.bind(P.LINEAR,P.REPEAT),le.updatePaintBuffers()),j&&($.activeTexture.set(P.TEXTURE0),oe.imageAtlasTexture.bind(P.LINEAR,P.CLAMP_TO_EDGE),le.updatePaintBuffers()),l.prepareDrawProgram($,pe,J.toUnwrapped());const ye=ze=>{pe.draw($,P.TRIANGLES,g,ze,y,s.CullFaceMode.disabled,Ze,a.id,ce.layoutVertexBuffer,ce.indexBuffer,ce.segments,a.paint,l.transform.zoom,le,[ce.layoutVertexBuffer2])};if(X){const ze=l.stencilModeForClipping(J).ref;0===ze&&l.terrain&&$.clear({stencil:0});const We={func:P.EQUAL,mask:255};Ze.u_alpha_discard_threshold=.8,ye(new s.StencilMode(We,ze,255,P.KEEP,P.KEEP,P.INVERT)),Ze.u_alpha_discard_threshold=0,ye(new s.StencilMode(We,ze,255,P.KEEP,P.KEEP,P.KEEP))}else ye(l.stencilModeForClipping(J))}X&&(l.resetStencilClippingMasks(),l.terrain&&$.clear({stencil:0}))},fill:function(l,n,a,h){const d=a.paint.get("fill-color"),m=a.paint.get("fill-opacity");if(0===m.constantOr(1))return;const g=l.colorModeForRenderPass(),y=a.paint.get("fill-pattern"),v=l.opaquePassEnabledForLayer()&&!y.constantOr(1)&&1===d.constantOr(s.Color.transparent).a&&1===m.constantOr(0)?"opaque":"translucent";if(l.renderPass===v){const A=l.depthModeForSublayer(1,"opaque"===l.renderPass?s.DepthMode.ReadWrite:s.DepthMode.ReadOnly);vc(l,n,a,h,A,g,!1)}if("translucent"===l.renderPass&&a.paint.get("fill-antialias")){const A=l.depthModeForSublayer(a.getPaintProperty("fill-outline-color")?2:0,s.DepthMode.ReadOnly);vc(l,n,a,h,A,g,!0)}},"fill-extrusion":function(l,n,a,h){const d=a.paint.get("fill-extrusion-opacity");if(0!==d&&"translucent"===l.renderPass){const m=new s.DepthMode(l.context.gl.LEQUAL,s.DepthMode.ReadWrite,l.depthRangeFor3D);if(1!==d||a.paint.get("fill-extrusion-pattern").constantOr(1))Xo(l,n,a,h,m,s.StencilMode.disabled,s.ColorMode.disabled),Xo(l,n,a,h,m,l.stencilModeFor3D(),l.colorModeForRenderPass()),l.resetStencilClippingMasks();else{const g=l.colorModeForRenderPass();Xo(l,n,a,h,m,s.StencilMode.disabled,g)}}},hillshade:function(l,n,a,h){if("offscreen"!==l.renderPass&&"translucent"!==l.renderPass)return;const d=l.context,m=l.depthModeForSublayer(0,s.DepthMode.ReadOnly),g=l.colorModeForRenderPass(),y=l.terrain&&l.terrain.renderingToTexture,[v,A]="translucent"!==l.renderPass||y?[{},h]:l.stencilConfigForOverlap(h);for(const k of A){const S=n.getTile(k);if(S.needsHillshadePrepare&&"offscreen"===l.renderPass)uc(l,S,a,m,s.StencilMode.disabled,g);else if("translucent"===l.renderPass){const U=y&&l.terrain?l.terrain.stencilModeForRTTOverlap(k):v[k.overscaledZ];hc(l,k,S,a,m,U,g)}}d.viewport.set([0,0,l.width,l.height]),l.resetStencilClippingMasks()},raster:function(l,n,a,h,d,m){if("translucent"!==l.renderPass||0===a.paint.get("raster-opacity")||!h.length)return;const g=l.context,y=g.gl,v=n.getSource(),A=l.useProgram("raster"),k=l.colorModeForRenderPass(),S=l.terrain&&l.terrain.renderingToTexture,[U,j]=v instanceof Ft||S?[{},h]:l.stencilConfigForOverlap(h),G=j[j.length-1].overscaledZ,Z=!l.options.moving;for(const $ of j){const P=S?s.DepthMode.disabled:l.depthModeForSublayer($.overscaledZ-G,1===a.paint.get("raster-opacity")?s.DepthMode.ReadWrite:s.DepthMode.ReadOnly,y.LESS),N=$.toUnwrapped(),X=n.getTile($);if(S&&(!X||!X.hasData()))continue;const J=S?$.projMatrix:l.transform.calculateProjMatrix(N,Z),oe=l.terrain&&S?l.terrain.stencilModeForRTTOverlap($):U[$.overscaledZ],ce=m?0:a.paint.get("raster-fade-duration");X.registerFadeDuration(ce);const le=n.findLoadedParent($,0),pe=Ws(X,le,n,l.transform,ce);let de,ve;l.terrain&&l.terrain.prepareDrawTile();const qe="nearest"===a.paint.get("raster-resampling")?y.NEAREST:y.LINEAR;g.activeTexture.set(y.TEXTURE0),X.texture.bind(qe,y.CLAMP_TO_EDGE),g.activeTexture.set(y.TEXTURE1),le?(le.texture.bind(qe,y.CLAMP_TO_EDGE),de=Math.pow(2,le.tileID.overscaledZ-X.tileID.overscaledZ),ve=[X.tileID.canonical.x*de%1,X.tileID.canonical.y*de%1]):X.texture.bind(qe,y.CLAMP_TO_EDGE),X.texture.useMipmap&&g.extTextureFilterAnisotropic&&l.transform.pitch>20&&y.texParameterf(y.TEXTURE_2D,g.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,g.extTextureFilterAnisotropicMax);const _e=il(J,ve||[0,0],de||1,pe,a,v instanceof Ft?v.perspectiveTransform:[0,0]);if(l.prepareDrawProgram(g,A,N),v instanceof Ft)v.boundsBuffer&&v.boundsSegments&&A.draw(g,y.TRIANGLES,P,s.StencilMode.disabled,k,s.CullFaceMode.disabled,_e,a.id,v.boundsBuffer,l.quadTriangleIndexBuffer,v.boundsSegments);else{const{tileBoundsBuffer:Le,tileBoundsIndexBuffer:we,tileBoundsSegments:Ze}=l.getTileBoundsBuffers(X);A.draw(g,y.TRIANGLES,P,oe,k,s.CullFaceMode.disabled,_e,a.id,Le,we,Ze)}}l.resetStencilClippingMasks()},background:function(l,n,a,h){const d=a.paint.get("background-color"),m=a.paint.get("background-opacity");if(0===m)return;const g=l.context,y=g.gl,v=l.transform,A=v.tileSize,k=a.paint.get("background-pattern");if(l.isPatternMissing(k))return;const S=!k&&1===d.a&&1===m&&l.opaquePassEnabledForLayer()?"opaque":"translucent";if(l.renderPass!==S)return;const U=s.StencilMode.disabled,j=l.depthModeForSublayer(0,"opaque"===S?s.DepthMode.ReadWrite:s.DepthMode.ReadOnly),G=l.colorModeForRenderPass(),Z=l.useProgram(k?"backgroundPattern":"background");let $,P=h;P||($=l.getBackgroundTiles(),P=Object.values($).map(N=>N.tileID)),k&&(g.activeTexture.set(y.TEXTURE0),l.imageManager.bind(l.context));for(const N of P){const X=N.toUnwrapped(),J=h?N.projMatrix:l.transform.calculateProjMatrix(X);l.prepareDrawTile();const oe=n?n.getTile(N):$?$[N.key]:new s.Tile(N,A,v.zoom,l),ce=k?Lh(J,m,l,k,{tileID:N,tileSize:A}):rl(J,m,d);l.prepareDrawProgram(g,Z,X);const{tileBoundsBuffer:le,tileBoundsIndexBuffer:pe,tileBoundsSegments:de}=l.getTileBoundsBuffers(oe);Z.draw(g,y.TRIANGLES,j,U,G,s.CullFaceMode.disabled,ce,a.id,le,pe,de)}},sky:function(l,n,a){const h=l.transform,d="mercator"===h.projection.name||"globe"===h.projection.name?1:s.smoothstep(7,8,h.zoom),m=a.paint.get("sky-opacity")*d;if(0===m)return;const g=l.context,y=a.paint.get("sky-type"),v=new s.DepthMode(g.gl.LEQUAL,s.DepthMode.ReadOnly,[0,1]),A=l.frameCounter/1e3%1;"atmosphere"===y?"offscreen"===l.renderPass?a.needsSkyboxCapture(l)&&(function(k,S,U,j){const G=k.context,Z=G.gl;let $=S.skyboxFbo;if(!$){$=S.skyboxFbo=G.createFramebuffer(32,32,!1),S.skyboxGeometry=new Jo(G),S.skyboxTexture=G.gl.createTexture(),Z.bindTexture(Z.TEXTURE_CUBE_MAP,S.skyboxTexture),Z.texParameteri(Z.TEXTURE_CUBE_MAP,Z.TEXTURE_WRAP_S,Z.CLAMP_TO_EDGE),Z.texParameteri(Z.TEXTURE_CUBE_MAP,Z.TEXTURE_WRAP_T,Z.CLAMP_TO_EDGE),Z.texParameteri(Z.TEXTURE_CUBE_MAP,Z.TEXTURE_MIN_FILTER,Z.LINEAR),Z.texParameteri(Z.TEXTURE_CUBE_MAP,Z.TEXTURE_MAG_FILTER,Z.LINEAR);for(let J=0;J<6;++J)Z.texImage2D(Z.TEXTURE_CUBE_MAP_POSITIVE_X+J,0,Z.RGBA,32,32,0,Z.RGBA,Z.UNSIGNED_BYTE,null)}G.bindFramebuffer.set($.framebuffer),G.viewport.set([0,0,32,32]);const P=S.getCenter(k,!0),N=k.useProgram("skyboxCapture"),X=new Float64Array(16);s.identity(X),s.rotateY(X,X,.5*-Math.PI),tr(G,S,N,X,P,0),s.identity(X),s.rotateY(X,X,.5*Math.PI),tr(G,S,N,X,P,1),s.identity(X),s.rotateX(X,X,.5*-Math.PI),tr(G,S,N,X,P,2),s.identity(X),s.rotateX(X,X,.5*Math.PI),tr(G,S,N,X,P,3),s.identity(X),tr(G,S,N,X,P,4),s.identity(X),s.rotateY(X,X,Math.PI),tr(G,S,N,X,P,5),G.viewport.set([0,0,k.width,k.height])}(l,a),a.markSkyboxValid(l)):"sky"===l.renderPass&&function(k,S,U,j,G){const Z=k.context,$=Z.gl,P=k.transform,N=k.useProgram("skybox");Z.activeTexture.set($.TEXTURE0),$.bindTexture($.TEXTURE_CUBE_MAP,S.skyboxTexture);const X={u_matrix:P.skyboxMatrix,u_sun_direction:S.getCenter(k,!1),u_cubemap:0,u_opacity:j,u_temporal_offset:G};k.prepareDrawProgram(Z,N),N.draw(Z,$.TRIANGLES,U,s.StencilMode.disabled,k.colorModeForRenderPass(),s.CullFaceMode.backCW,X,"skybox",S.skyboxGeometry.vertexBuffer,S.skyboxGeometry.indexBuffer,S.skyboxGeometry.segment)}(l,a,v,m,A):"gradient"===y&&"sky"===l.renderPass&&function(k,S,U,j,G){const Z=k.context,$=Z.gl,P=k.transform,N=k.useProgram("skyboxGradient");S.skyboxGeometry||(S.skyboxGeometry=new Jo(Z)),Z.activeTexture.set($.TEXTURE0);let X=S.colorRampTexture;X||(X=S.colorRampTexture=new s.Texture(Z,S.colorRamp,$.RGBA)),X.bind($.LINEAR,$.CLAMP_TO_EDGE);const J=(oe=P.skyboxMatrix,ce=S.getCenter(k,!1),le=S.paint.get("sky-gradient-radius"),pe=j,de=G,{u_matrix:oe,u_color_ramp:0,u_center_direction:ce,u_radius:s.degToRad(le),u_opacity:pe,u_temporal_offset:de});var oe,ce,le,pe,de;k.prepareDrawProgram(Z,N),N.draw(Z,$.TRIANGLES,U,s.StencilMode.disabled,k.colorModeForRenderPass(),s.CullFaceMode.backCW,J,"skyboxGradient",S.skyboxGeometry.vertexBuffer,S.skyboxGeometry.indexBuffer,S.skyboxGeometry.segment)}(l,a,v,m,A)},debug:function(l,n,a){for(let h=0;h<a.length;h++)Vh(l,n,a[h])},custom:function(l,n,a,h){const d=l.context,m=a.implementation;if(!l.transform.projection.unsupportedLayers||!l.transform.projection.unsupportedLayers.includes("custom")||l.terrain&&(l.terrain.renderingToTexture||"offscreen"===l.renderPass)&&a.isLayerDraped()){if("offscreen"===l.renderPass){const g=m.prerender;if(g){if(l.setCustomLayerDefaults(),d.setColorMode(l.colorModeForRenderPass()),"globe"===l.transform.projection.name){const y=l.transform.pointMerc;g.call(m,d.gl,l.transform.customLayerMatrix(),l.transform.getProjection(),l.transform.globeToMercatorMatrix(),s.globeToMercatorTransition(l.transform.zoom),[y.x,y.y],l.transform.pixelsPerMeterRatio)}else g.call(m,d.gl,l.transform.customLayerMatrix());d.setDirty(),l.setBaseState()}}else if("translucent"===l.renderPass){if(l.terrain&&l.terrain.renderingToTexture){const y=m.renderToTile;if(y){const v=h[0].canonical,A=new s.MercatorCoordinate(v.x+h[0].wrap*(1<<v.z),v.y,v.z);d.setDepthMode(s.DepthMode.disabled),d.setStencilMode(s.StencilMode.disabled),d.setColorMode(l.colorModeForRenderPass()),l.setCustomLayerDefaults(),y.call(m,d.gl,A),d.setDirty(),l.setBaseState()}return}l.setCustomLayerDefaults(),d.setColorMode(l.colorModeForRenderPass()),d.setStencilMode(s.StencilMode.disabled);const g="3d"===m.renderingMode?new s.DepthMode(l.context.gl.LEQUAL,s.DepthMode.ReadWrite,l.depthRangeFor3D):l.depthModeForSublayer(0,s.DepthMode.ReadOnly);if(d.setDepthMode(g),"globe"===l.transform.projection.name){const y=l.transform.pointMerc;m.render(d.gl,l.transform.customLayerMatrix(),l.transform.getProjection(),l.transform.globeToMercatorMatrix(),s.globeToMercatorTransition(l.transform.zoom),[y.x,y.y],l.transform.pixelsPerMeterRatio)}else m.render(d.gl,l.transform.customLayerMatrix());d.setDirty(),l.setBaseState(),d.bindFramebuffer.set(null)}}else s.warnOnce("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")}};class Pa{constructor(n,a,h=!1){this.context=new Ge(n,h),this.transform=a,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=s.SourceCache.maxUnderzooming+s.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(n,a){const h=!!n&&!!n.terrain&&this.transform.projection.supportsTerrain;if(!(h||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Ys(this,n));const d=this._terrain;this.transform.elevation=h?d:null,d.update(n,this.transform,a)}_updateFog(n){const a=n.fog;if(!a||"globe"===this.transform.projection.name||a.getOpacity(this.transform.pitch)<1||a.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[h,d]=a.getFovAdjustedRange(this.transform._fov);if(h>d)return void(this.transform.fogCullDistSq=null);const m=h+.78*(d-h);this.transform.fogCullDistSq=m*m}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(n,a){if(this.width=n*s.exported.devicePixelRatio,this.height=a*s.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const h of this.style.order)this.style._layers[h].resize()}setup(){const n=this.context,a=new s.StructArrayLayout2i4;a.emplaceBack(0,0),a.emplaceBack(s.EXTENT,0),a.emplaceBack(0,s.EXTENT),a.emplaceBack(s.EXTENT,s.EXTENT),this.tileExtentBuffer=n.createVertexBuffer(a,s.posAttributes.members),this.tileExtentSegments=s.SegmentVector.simpleSegment(0,0,4,2);const h=new s.StructArrayLayout2i4;h.emplaceBack(0,0),h.emplaceBack(s.EXTENT,0),h.emplaceBack(0,s.EXTENT),h.emplaceBack(s.EXTENT,s.EXTENT),this.debugBuffer=n.createVertexBuffer(h,s.posAttributes.members),this.debugSegments=s.SegmentVector.simpleSegment(0,0,4,5);const d=new s.StructArrayLayout2i4;d.emplaceBack(-1,-1),d.emplaceBack(1,-1),d.emplaceBack(-1,1),d.emplaceBack(1,1),this.viewportBuffer=n.createVertexBuffer(d,s.posAttributes.members),this.viewportSegments=s.SegmentVector.simpleSegment(0,0,4,2);const m=new s.StructArrayLayout4i8;m.emplaceBack(0,0,0,0),m.emplaceBack(s.EXTENT,0,s.EXTENT,0),m.emplaceBack(0,s.EXTENT,0,s.EXTENT),m.emplaceBack(s.EXTENT,s.EXTENT,s.EXTENT,s.EXTENT),this.mercatorBoundsBuffer=n.createVertexBuffer(m,s.boundsAttributes.members),this.mercatorBoundsSegments=s.SegmentVector.simpleSegment(0,0,4,2);const g=new s.StructArrayLayout3ui6;g.emplaceBack(0,1,2),g.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=n.createIndexBuffer(g);const y=new s.StructArrayLayout1ui2;for(const A of[0,1,3,2,0])y.emplaceBack(A);this.debugIndexBuffer=n.createIndexBuffer(y),this.emptyTexture=new s.Texture(n,new s.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),n.gl.RGBA),this.identityMat=s.create();const v=this.context.gl;this.stencilClearMode=new s.StencilMode({func:v.ALWAYS,mask:0},0,255,v.ZERO,v.ZERO,v.ZERO),this.loadTimeStamps.push(s.window.performance.now()),this.atmosphereBuffer=new kc(this.context)}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(n){return n._makeTileBoundsBuffers(this.context,this.transform.projection),n._tileBoundsBuffer?{tileBoundsBuffer:n._tileBoundsBuffer,tileBoundsIndexBuffer:n._tileBoundsIndexBuffer,tileBoundsSegments:n._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const n=this.context,a=n.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(n,a.TRIANGLES,s.DepthMode.disabled,this.stencilClearMode,s.ColorMode.disabled,s.CullFaceMode.disabled,so(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(n,a,h){if(!a||this.currentStencilSource===a.id||!n.isTileClipped()||!h||0===h.length)return;if(this._tileClippingMaskIDs&&!this.terrain){let y=!1;for(const v of h)if(void 0===this._tileClippingMaskIDs[v.key]){y=!0;break}if(!y)return}this.currentStencilSource=a.id;const d=this.context,m=d.gl;this.nextStencilID+h.length>256&&this.clearStencil(),d.setColorMode(s.ColorMode.disabled),d.setDepthMode(s.DepthMode.disabled);const g=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const y of h){const v=a.getTile(y),A=this._tileClippingMaskIDs[y.key]=this.nextStencilID++,{tileBoundsBuffer:k,tileBoundsIndexBuffer:S,tileBoundsSegments:U}=this.getTileBoundsBuffers(v);g.draw(d,m.TRIANGLES,s.DepthMode.disabled,new s.StencilMode({func:m.ALWAYS,mask:0},A,255,m.KEEP,m.KEEP,m.REPLACE),s.ColorMode.disabled,s.CullFaceMode.disabled,so(y.projMatrix),"$clipping",k,S,U)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const n=this.nextStencilID++,a=this.context.gl;return new s.StencilMode({func:a.NOTEQUAL,mask:255},n,255,a.KEEP,a.KEEP,a.REPLACE)}stencilModeForClipping(n){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(n);const a=this.context.gl;return new s.StencilMode({func:a.EQUAL,mask:255},this._tileClippingMaskIDs[n.key],0,a.KEEP,a.KEEP,a.REPLACE)}stencilConfigForOverlap(n){const a=this.context.gl,h=n.sort((g,y)=>y.overscaledZ-g.overscaledZ),d=h[h.length-1].overscaledZ,m=h[0].overscaledZ-d+1;if(m>1){this.currentStencilSource=void 0,this.nextStencilID+m>256&&this.clearStencil();const g={};for(let y=0;y<m;y++)g[y+d]=new s.StencilMode({func:a.GEQUAL,mask:255},y+this.nextStencilID,255,a.KEEP,a.KEEP,a.REPLACE);return this.nextStencilID+=m,[g,h]}return[{[d]:s.StencilMode.disabled},h]}colorModeForRenderPass(){const n=this.context.gl;return this._showOverdrawInspector?new s.ColorMode([n.CONSTANT_COLOR,n.ONE],new s.Color(.125,.125,.125,0),[!0,!0,!0,!0]):"opaque"===this.renderPass?s.ColorMode.unblended:s.ColorMode.alphaBlended}depthModeForSublayer(n,a,h){if(!this.opaquePassEnabledForLayer())return s.DepthMode.disabled;const d=1-((1+this.currentLayer)*this.numSublayers+n)*this.depthEpsilon;return new s.DepthMode(h||this.context.gl.LEQUAL,a,[d,d])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(n,a){this.style=n,this.options=a,this.imageManager=n.imageManager,this.glyphManager=n.glyphManager,this.symbolFadeChange=n.placement.symbolFadeChange(s.exported.now()),this.imageManager.beginFrame();const h=this.style.order,d=this.style._sourceCaches;for(const A in d){const k=d[A];k.used&&k.prepare(this.context)}const m={},g={},y={};for(const A in d){const k=d[A];m[A]=k.getVisibleCoordinates(),g[A]=m[A].slice().reverse(),y[A]=k.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let A=0;A<h.length;A++)if(this.style._layers[h[A]].is3D()){this.opaquePassCutoff=A;break}if(this.terrain&&(this.terrain.updateTileBinding(y),this.opaquePassCutoff=0),"globe"!==this.transform.projection.name||this.globeSharedBuffers||(this.globeSharedBuffers=new s.GlobeSharedBuffers(this.context)),!s.isMapAuthenticated(this.context.gl))return;this.renderPass="offscreen";for(const A of h){const k=this.style._layers[A],S=n._getLayerSourceCache(k);if(!k.hasOffscreenPass()||k.isHidden(this.transform.zoom))continue;const U=S?g[S.id]:void 0;("custom"===k.type||k.isSky()||U&&U.length)&&this.renderLayer(this,S,k,U)}this.depthRangeFor3D=[0,1-(n.order.length+2)*this.numSublayers*this.depthEpsilon];const v=this.terrain;if(v&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&v.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]),this.context.clear({color:a.showOverdrawInspector?s.Color.black:s.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=a.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=h.length-1;this.currentLayer>=0;this.currentLayer--){const A=this.style._layers[h[this.currentLayer]],k=n._getLayerSourceCache(A);if(A.isSky())continue;const S=k?g[k.id]:void 0;this._renderTileClippingMasks(A,k,S),this.renderLayer(this,k,A,S)}if(this.style.fog&&this.transform.projection.supportsFog&&function(A,k){const S=A.context,U=S.gl,j=A.transform,G=new s.DepthMode(U.LEQUAL,s.DepthMode.ReadOnly,[0,1]),Z=A.useProgram("globeAtmosphere",null,"globe"===j.projection.name?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"]),$=s.globeToMercatorTransition(j.zoom),P=k.properties.get("color").toArray01(),N=k.properties.get("high-color").toArray01(),X=k.properties.get("space-color").toArray01PremultipliedAlpha(),J=s.identity$1([]);s.rotateY$1(J,J,-s.degToRad(j._center.lng)),s.rotateX$1(J,J,s.degToRad(j._center.lat)),s.rotateZ$1(J,J,j.angle),s.rotateX$1(J,J,-j._pitch);const oe=s.fromQuat(new Float32Array(16),J),ce=s.mapValue(k.properties.get("star-intensity"),0,1,0,.25),pe=s.mapValue(k.properties.get("horizon-blend"),0,1,5e-4,.25),de=s.globeUseCustomAntiAliasing(A,S,j)&&5e-4===pe?j.worldSize/(2*Math.PI*1.025)-1:j.globeRadius,ve=A.frameCounter/1e3%1,qe=s.length(j.globeCenterInViewSpace),_e=Math.sqrt(Math.pow(qe,2)-Math.pow(de,2)),Le=Math.acos(_e/qe),we={u_frustum_tl:j.frustumCorners.TL,u_frustum_tr:j.frustumCorners.TR,u_frustum_br:j.frustumCorners.BR,u_frustum_bl:j.frustumCorners.BL,u_horizon:j.frustumCorners.horizon,u_transition:$,u_fadeout_range:pe,u_color:P,u_high_color:N,u_space_color:X,u_star_intensity:ce,u_star_size:5*s.exported.devicePixelRatio,u_star_density:0,u_temporal_offset:ve,u_horizon_angle:Le,u_rotation_matrix:oe};A.prepareDrawProgram(S,Z);const Ze=A.atmosphereBuffer;Ze&&Z.draw(S,U.TRIANGLES,G,s.StencilMode.disabled,s.ColorMode.alphaBlended,s.CullFaceMode.backCW,we,"skybox",Ze.vertexBuffer,Ze.indexBuffer,Ze.segments)}(this,this.style.fog),this.renderPass="sky",(s.globeToMercatorTransition(this.transform.zoom)>0||"globe"!==this.transform.projection.name)&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<h.length;this.currentLayer++){const A=this.style._layers[h[this.currentLayer]],k=n._getLayerSourceCache(A);A.isSky()&&this.renderLayer(this,k,A,k?g[k.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<h.length;){const A=this.style._layers[h[this.currentLayer]],k=n._getLayerSourceCache(A);if(A.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(A)){if(A.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const S=k?("symbol"===A.type?y:g)[k.id]:void 0;this._renderTileClippingMasks(A,k,k?m[k.id]:void 0),this.renderLayer(this,k,A,S),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let A=null;s.values(this.style._layers).forEach(k=>{const S=n._getLayerSourceCache(k);S&&!k.isHidden(this.transform.zoom)&&(!A||A.getSource().maxzoom<S.getSource().maxzoom)&&(A=S)}),A&&this.options.showTileBoundaries&&ua.debug(this,A,A.getVisibleCoordinates())}this.options.showPadding&&function(A){const k=A.transform.padding;wc(A,A.transform.height-(k.top||0),3,Ia),wc(A,k.bottom||0,3,Oh),Ko(A,k.left||0,3,Bh),Ko(A,A.transform.width-(k.right||0),3,Fh);const S=A.transform.centerPoint;var U,j,G,Z;Sa(U=A,(j=S.x)-1,(G=A.transform.height-S.y)-10,2,20,Z=Uh),Sa(U,j-10,G-1,20,2,Z)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(s.window.performance.now()),this.saveCanvasCopy())}renderLayer(n,a,h,d){h.isHidden(this.transform.zoom)||("background"===h.type||"sky"===h.type||"custom"===h.type||d&&d.length)&&(this.id=h.id,this.gpuTimingStart(h),(!n.transform.projection.unsupportedLayers||!n.transform.projection.unsupportedLayers.includes(h.type)||n.terrain&&"custom"===h.type)&&ua[h.type](n,a,h,d,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(n){if(!this.options.gpuTiming)return;const a=this.context.extTimerQuery;let h=this.gpuTimers[n.id];h||(h=this.gpuTimers[n.id]={calls:0,cpuTime:0,query:a.createQueryEXT()}),h.calls++,a.beginQueryEXT(a.TIME_ELAPSED_EXT,h.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const n=this.context.extTimerQuery,a=n.createQueryEXT();this.deferredRenderGpuTimeQueries.push(a),n.beginQueryEXT(n.TIME_ELAPSED_EXT,a)}}gpuTimingDeferredRenderEnd(){if(!this.options.gpuTimingDeferredRender)return;const n=this.context.extTimerQuery;n.endQueryEXT(n.TIME_ELAPSED_EXT)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const n=this.context.extTimerQuery;n.endQueryEXT(n.TIME_ELAPSED_EXT)}collectGpuTimers(){const n=this.gpuTimers;return this.gpuTimers={},n}collectDeferredRenderGpuQueries(){const n=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],n}queryGpuTimers(n){const a={};for(const h in n){const d=n[h],m=this.context.extTimerQuery,g=m.getQueryObjectEXT(d.query,m.QUERY_RESULT_EXT)/1e6;m.deleteQueryEXT(d.query),a[h]=g}return a}queryGpuTimeDeferredRender(n){if(!this.options.gpuTimingDeferredRender)return 0;const a=this.context.extTimerQuery;let h=0;for(const d of n)h+=a.getQueryObjectEXT(d,a.QUERY_RESULT_EXT)/1e6,a.deleteQueryEXT(d);return h}translatePosMatrix(n,a,h,d,m){if(!h[0]&&!h[1])return n;const g=m?"map"===d?this.transform.angle:0:"viewport"===d?-this.transform.angle:0;if(g){const A=Math.sin(g),k=Math.cos(g);h=[h[0]*k-h[1]*A,h[0]*A+h[1]*k]}const y=[m?h[0]:jt(a,h[0],this.transform.zoom),m?h[1]:jt(a,h[1],this.transform.zoom),0],v=new Float32Array(16);return s.translate(v,n,y),v}saveTileTexture(n){const a=this._tileTextures[n.size[0]];a?a.push(n):this._tileTextures[n.size[0]]=[n]}getTileTexture(n){const a=this._tileTextures[n];return a&&a.length>0?a.pop():null}isPatternMissing(n){return null===n||void 0!==n&&!this.imageManager.getPattern(n.toString())}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}currentGlobalDefines(){const n=this.terrain&&this.terrain.renderingToTexture,a=this.terrain&&0===this.terrain.exaggeration(),h=this.style&&this.style.fog,d=[];return this.terrainRenderModeElevated()&&d.push("TERRAIN"),"globe"===this.transform.projection.name&&d.push("GLOBE"),a&&d.push("ZERO_EXAGGERATION"),h&&!n&&0!==h.getOpacity(this.transform.pitch)&&d.push("FOG"),n&&d.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&d.push("OVERDRAW_INSPECTOR"),d}useProgram(n,a,h){this.cache=this.cache||{};const d=h||[],m=this.currentGlobalDefines().concat(d),g=ei.cacheKey(Zs[n],n,m,a);return this.cache[g]||(this.cache[g]=new ei(this.context,n,Zs[n],a,al[n],m)),this.cache[g]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const n=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(n.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=s.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new s.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.atmosphereBuffer&&this.atmosphereBuffer.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(n,a,h){if(this.terrain&&this.terrain.renderingToTexture)return;const d=this.style.fog;if(d){const m=d.getOpacity(this.transform.pitch),g=((y,v,A,k,S,U,j,G,Z,$,P)=>{const N=y.transform,X=v.properties.get("color").toArray01();X[3]=k;const J=y.frameCounter/1e3%1;return{u_fog_matrix:A?N.calculateFogTileMatrix(A):y.identityMat,u_fog_range:v.getFovAdjustedRange(N._fov),u_fog_color:X,u_fog_horizon_blend:v.properties.get("horizon-blend"),u_fog_temporal_offset:J,u_frustum_tl:S,u_frustum_tr:U,u_frustum_br:j,u_frustum_bl:G,u_globe_pos:Z,u_globe_radius:$,u_viewport:P,u_globe_transition:s.globeToMercatorTransition(N.zoom),u_is_globe:+("globe"===N.projection.name)}})(this,d,h,m,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*s.exported.devicePixelRatio,this.transform.height*s.exported.devicePixelRatio]);a.setFogUniformValues(n,g)}}setTileLoadedFlag(n){this.tileLoaded=n}saveCanvasCopy(){const n=this.canvasCopy();n&&(this.frameCopies.push(n),this.tileLoaded=!1)}canvasCopy(){const n=this.context.gl,a=n.createTexture();return n.bindTexture(n.TEXTURE_2D,a),n.copyTexImage2D(n.TEXTURE_2D,0,n.RGBA,0,0,n.drawingBufferWidth,n.drawingBufferHeight,0),a}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const n=this.style&&this.style.fog;return!!n&&0!==n.getOpacity(this.transform.pitch)}getBackgroundTiles(){const n=this._backgroundTiles,a=this._backgroundTiles={},h=this.transform.coveringTiles({tileSize:512});for(const d of h)a[d.key]=n[d.key]||new s.Tile(d,512,this.transform.tileZoom,this);return a}clearBackgroundTiles(){this._backgroundTiles={}}}class Qo{constructor(n=0,a=0,h=0,d=0){if(isNaN(n)||n<0||isNaN(a)||a<0||isNaN(h)||h<0||isNaN(d)||d<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=n,this.bottom=a,this.left=h,this.right=d}interpolate(n,a,h){return null!=a.top&&null!=n.top&&(this.top=s.number(n.top,a.top,h)),null!=a.bottom&&null!=n.bottom&&(this.bottom=s.number(n.bottom,a.bottom,h)),null!=a.left&&null!=n.left&&(this.left=s.number(n.left,a.left,h)),null!=a.right&&null!=n.right&&(this.right=s.number(n.right,a.right,h)),this}getCenter(n,a){const h=s.clamp((this.left+n-this.right)/2,0,n),d=s.clamp((this.top+a-this.bottom)/2,0,a);return new s.Point(h,d)}equals(n){return this.top===n.top&&this.bottom===n.bottom&&this.left===n.left&&this.right===n.right}clone(){return new Qo(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function es(l,n){const a=s.getColumn(l,3);s.fromQuat(l,n),s.setColumn(l,3,a)}function ni(l,n){const a=s.identity$1([]);return s.rotateZ$1(a,a,-n),s.rotateX$1(a,a,-l),a}function fo(l,n){const a=[l[0],l[1],0],h=[n[0],n[1],0];if(s.length(a)>=1e-15){const g=s.normalize([],a);s.scale$2(h,g,s.dot(h,g)),n[0]=h[0],n[1]=h[1]}const d=s.cross([],n,l);if(s.len(d)<1e-15)return null;const m=Math.atan2(-d[1],d[0]);return ni(Math.atan2(Math.sqrt(l[0]*l[0]+l[1]*l[1]),-l[2]),m)}class Ac{constructor(n,a){this.position=n,this.orientation=a}get position(){return this._position}set position(n){if(n){const a=n instanceof s.MercatorCoordinate?n:new s.MercatorCoordinate(n[0],n[1],n[2]);this._renderWorldCopies&&(a.x=s.wrap(a.x,0,1)),this._position=a}else this._position=null}lookAtPoint(n,a){if(this.orientation=null,!this.position)return;const h=this.position,d=this._elevation?this._elevation.getAtPointOrZero(s.MercatorCoordinate.fromLngLat(n)):0,m=s.MercatorCoordinate.fromLngLat(n,d),g=[m.x-h.x,m.y-h.y,m.z-h.z];a||(a=[0,0,1]),a[2]=Math.abs(a[2]),this.orientation=fo(g,a)}setPitchBearing(n,a){this.orientation=ni(s.degToRad(n),s.degToRad(-a))}}class ts{constructor(n,a){this._transform=s.identity([]),this.orientation=a,this.position=n}get mercatorPosition(){const n=this.position;return new s.MercatorCoordinate(n[0],n[1],n[2])}get position(){const n=s.getColumn(this._transform,3);return[n[0],n[1],n[2]]}set position(n){var a;n&&s.setColumn(this._transform,3,[(a=n)[0],a[1],a[2],1])}get orientation(){return this._orientation}set orientation(n){this._orientation=n||s.identity$1([]),n&&es(this._transform,this._orientation)}getPitchBearing(){const n=this.forward(),a=this.right();return{bearing:Math.atan2(-a[1],a[0]),pitch:Math.atan2(Math.sqrt(n[0]*n[0]+n[1]*n[1]),-n[2])}}setPitchBearing(n,a){this._orientation=ni(n,a),es(this._transform,this._orientation)}forward(){const n=s.getColumn(this._transform,2);return[-n[0],-n[1],-n[2]]}up(){const n=s.getColumn(this._transform,1);return[-n[0],-n[1],-n[2]]}right(){const n=s.getColumn(this._transform,0);return[n[0],n[1],n[2]]}getCameraToWorld(n,a){const h=new Float64Array(16);return s.invert(h,this.getWorldToCamera(n,a)),h}getWorldToCameraPosition(n,a,h){const d=this.position;s.scale$2(d,d,-n);const m=new Float64Array(16);return s.fromScaling(m,[h,h,h]),s.translate(m,m,d),m[10]*=a,m}getWorldToCamera(n,a){const h=new Float64Array(16),d=new Float64Array(4),m=this.position;return s.conjugate(d,this._orientation),s.scale$2(m,m,-n),s.fromQuat(h,d),s.translate(h,h,m),h[1]*=-1,h[5]*=-1,h[9]*=-1,h[13]*=-1,h[8]*=a,h[9]*=a,h[10]*=a,h[11]*=a,h}getCameraToClipPerspective(n,a,h,d){const m=new Float64Array(16);return s.perspective(m,n,a,h,d),m}getDistanceToElevation(n,a=!1){const h=0===n?0:s.mercatorZfromAltitude(n,a?s.latFromMercatorY(this.position[1]):this.position[1]),d=this.forward();return(h-this.position[2])/d[2]}clone(){return new ts([...this.position],[...this.orientation])}}function za(l,n){const a=is(l.projection,l.zoom,l.width,l.height),h=function(m,g,y,v,A){const k=new s.LngLat(y.lng-180*Or,y.lat),S=new s.LngLat(y.lng+180*Or,y.lat),U=m.project(k.lng,k.lat),j=m.project(S.lng,S.lat),G=-Math.atan2(j.y-U.y,j.x-U.x),Z=s.MercatorCoordinate.fromLngLat(y);Z.y=s.clamp(Z.y,-1+Or,1-Or);const $=Z.toLngLat(),P=m.project($.lng,$.lat),N=s.MercatorCoordinate.fromLngLat($);N.x+=Or;const X=N.toLngLat(),J=m.project(X.lng,X.lat),oe=ns(J.x-P.x,J.y-P.y,G),ce=s.MercatorCoordinate.fromLngLat($);ce.y+=Or;const le=ce.toLngLat(),pe=m.project(le.lng,le.lat),de=ns(pe.x-P.x,pe.y-P.y,G),ve=Math.abs(oe.x)/Math.abs(de.y),qe=s.identity([]);s.rotateZ(qe,qe,-G*(1-(A?0:v)));const _e=s.identity([]);return s.scale(_e,_e,[1,1-(1-ve)*v,1]),_e[4]=-de.x/de.y*v,s.rotateZ(_e,_e,G),s.multiply(_e,qe,_e),_e}(l.projection,0,l.center,a,n),d=Cc(l);return s.scale(h,h,[d,d,1]),h}function Cc(l){const n=l.projection,a=is(l.projection,l.zoom,l.width,l.height),h=Mc(n,l.center),d=Mc(n,s.LngLat.convert(n.center));return Math.pow(2,h*a+(1-a)*d)}function is(l,n,a,h,d=1/0){const m=l.range;if(!m)return 0;const g=Math.min(d,Math.max(a,h)),y=Math.log(g/1024)/Math.LN2;return s.smoothstep(m[0]+y,m[1]+y,n)}const Or=1/4e4;function Mc(l,n){const a=s.clamp(n.lat,-s.MAX_MERCATOR_LATITUDE,s.MAX_MERCATOR_LATITUDE),h=new s.LngLat(n.lng-180*Or,a),d=new s.LngLat(n.lng+180*Or,a),m=l.project(h.lng,a),g=l.project(d.lng,a),y=s.MercatorCoordinate.fromLngLat(h),v=s.MercatorCoordinate.fromLngLat(d),A=g.x-m.x,k=g.y-m.y,S=v.x-y.x,U=v.y-y.y,j=Math.sqrt((S*S+U*U)/(A*A+k*k));return Math.log(j)/Math.LN2}function ns(l,n,a){const h=Math.cos(a),d=Math.sin(a);return{x:l*h-n*d,y:l*d+n*h}}class La{constructor(n,a,h,d,m,g,y){this.tileSize=512,this._renderWorldCopies=void 0===m||m,this._minZoom=n||0,this._maxZoom=a||22,this._minPitch=h??0,this._maxPitch=d??60,this.setProjection(g),this.setMaxBounds(y),this.width=0,this.height=0,this._center=new s.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Qo,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new ts,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1}clone(){const n=new La(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return n._elevation=this._elevation,n._centerAltitude=this._centerAltitude,n._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,n.tileSize=this.tileSize,n.mercatorFromTransition=this.mercatorFromTransition,n.width=this.width,n.height=this.height,n.cameraElevationReference=this.cameraElevationReference,n._center=this._center,n._setZoom(this.zoom),n._seaLevelZoom=this._seaLevelZoom,n.angle=this.angle,n._fov=this._fov,n._pitch=this._pitch,n._nearZ=this._nearZ,n._farZ=this._farZ,n._averageElevation=this._averageElevation,n._unmodified=this._unmodified,n._edgeInsets=this._edgeInsets.clone(),n._camera=this._camera.clone(),n._calcMatrices(),n.freezeTileCoverage=this.freezeTileCoverage,n.frustumCorners=this.frustumCorners,n}get elevation(){return this._elevation}set elevation(n){this._elevation!==n&&(this._elevation=n,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(n,a=!1){const h=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(null==this._seaLevelZoom||h)&&this._updateCameraOnTerrain(),(n||h)&&this._constrainCamera(a),this._calcMatrices()}getProjection(){return s.pick(this.projection,["name","center","parallels"])}setProjection(n){this.projectionOptions=n||{name:"mercator"};const a=this.projection?this.getProjection():void 0;this.projection=s.getProjection(this.projectionOptions);const h=!M(a,this.getProjection());return h&&this._calcMatrices(),this.mercatorFromTransition=!1,h}setMercatorFromTransition(){const n=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=s.getProjection({name:"mercator"});const a=n!==this.projection.name;return a&&this._calcMatrices(),a}get minZoom(){return this._minZoom}set minZoom(n){this._minZoom!==n&&(this._minZoom=n,this.zoom=Math.max(this.zoom,n))}get maxZoom(){return this._maxZoom}set maxZoom(n){this._maxZoom!==n&&(this._maxZoom=n,this.zoom=Math.min(this.zoom,n))}get minPitch(){return this._minPitch}set minPitch(n){this._minPitch!==n&&(this._minPitch=n,this.pitch=Math.max(this.pitch,n))}get maxPitch(){return this._maxPitch}set maxPitch(n){this._maxPitch!==n&&(this._maxPitch=n,this.pitch=Math.min(this.pitch,n))}get renderWorldCopies(){return this._renderWorldCopies&&!0===this.projection.supportsWorldCopies}set renderWorldCopies(n){void 0===n?n=!0:null===n&&(n=!1),this._renderWorldCopies=n}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const n=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(n))}get cameraWorldSize(){const n=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(n))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return s.mercatorZfromAltitude(this.center.lat,this.cameraWorldSizeForFog)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new s.Point(this.width,this.height)}get bearing(){return s.wrap(this.rotation,-180,180)}set bearing(n){this.rotation=n}get rotation(){return-this.angle/Math.PI*180}set rotation(n){const a=-n*Math.PI/180;var h,d,m,g,y,v,A,k,S,U;this.angle!==a&&(this._unmodified=!1,this.angle=a,this._calcMatrices(),this.rotationMatrix=(h=new s.ARRAY_TYPE(4),s.ARRAY_TYPE!=Float32Array&&(h[1]=0,h[2]=0),h[0]=1,h[3]=1,h),d=this.rotationMatrix,g=this.angle,y=(m=this.rotationMatrix)[0],v=m[1],A=m[2],k=m[3],S=Math.sin(g),U=Math.cos(g),d[0]=y*U+A*S,d[1]=v*U+k*S,d[2]=y*-S+A*U,d[3]=v*-S+k*U)}get pitch(){return this._pitch/Math.PI*180}set pitch(n){const a=s.clamp(n,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==a&&(this._unmodified=!1,this._pitch=a,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const n=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/n)}set fov(n){n=Math.max(.01,Math.min(60,n)),this._fov!==n&&(this._unmodified=!1,this._fov=s.degToRad(n),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(n){this._averageElevation=n,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(n){const a=Math.min(Math.max(n,this.minZoom),this.maxZoom);this._zoom!==a&&(this._unmodified=!1,this._setZoom(a),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(n){this._zoom=n,this.scale=this.zoomScale(n),this.tileZoom=Math.floor(n),this.zoomFraction=n-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const n=this._elevation;this._centerAltitude=n.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=n.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){void 0!==this._centerAltitudeValidForExaggeration&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const n=this._elevation,a=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],h=this.horizonLineFromTop();let d=0,m=0;for(let g=0;g<a.length;g++){const y=new s.Point(a[g][0]*this.width,h+a[g][1]*(this.height-h)),v=n.pointCoordinate(y);if(!v)continue;const A=1/Math.hypot(v[0]-this._camera.position[0],v[1]-this._camera.position[1]);d+=v[3]*A,m+=A}return 0===m?NaN:d/m}get center(){return this._center}set center(n){n.lat===this._center.lat&&n.lng===this._center.lng||(this._unmodified=!1,this._center=n,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._seaLevelZoom||!this._elevation)return;const n=this._seaLevelZoom,a=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),h=this.pixelsPerMeter/this.worldSize*a,d=this._mercatorZfromZoom(n),m=this._mercatorZfromZoom(this._maxZoom),g=Math.max(d-h,m);this._setZoom(this._zoomFromMercatorZ(g))}get padding(){return this._edgeInsets.toJSON()}set padding(n){this._edgeInsets.equals(n)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,n,1),this._calcMatrices())}computeZoomRelativeTo(n){const a=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,n.toAltitude()));let h;h=n.z<this._camera.position[2]?[a.x,a.y,a.z]:[n.x,n.y,n.z];const d=s.length(s.sub([],this._camera.position,h));return s.clamp(this._zoomFromMercatorZ(d),this._minZoom,this._maxZoom)}setFreeCameraOptions(n){if(!this.height||!n.position&&!n.orientation)return;this._updateCameraState();let a=!1;if(n.orientation&&!s.exactEquals(n.orientation,this._camera.orientation)&&(a=this._setCameraOrientation(n.orientation)),n.position){const h=[n.position.x,n.position.y,n.position.z];s.exactEquals$1(h,this._camera.position)||(this._setCameraPosition(h),a=!0)}a&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const n=this._camera.position,a=new Ac;return a.position=new s.MercatorCoordinate(n[0],n[1],n[2]),a.orientation=this._camera.orientation,a._elevation=this.elevation,a._renderWorldCopies=this.renderWorldCopies,a}_setCameraOrientation(n){if(!s.length$1(n))return!1;s.normalize$1(n,n);const a=s.transformQuat([],[0,0,-1],n),h=s.transformQuat([],[0,-1,0],n);if(h[2]<0)return!1;const d=fo(a,h);return!!d&&(this._camera.orientation=d,!0)}_setCameraPosition(n){const a=this.zoomScale(this.minZoom)*this.tileSize,h=this.zoomScale(this.maxZoom)*this.tileSize,d=this.cameraToCenterDistance;n[2]=s.clamp(n[2],d/h,d/a),this._camera.position=n}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(n){return this._edgeInsets.equals(n)}interpolatePadding(n,a,h){this._unmodified=!1,this._edgeInsets.interpolate(n,a,h),this._constrain(),this._calcMatrices()}coveringZoomLevel(n){const a=(n.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/n.tileSize));return Math.max(0,a)}getVisibleUnwrappedCoordinates(n){const a=[new s.UnwrappedTileID(0,n)];if(this.renderWorldCopies){const h=this.pointCoordinate(new s.Point(0,0)),d=this.pointCoordinate(new s.Point(this.width,0)),m=this.pointCoordinate(new s.Point(this.width,this.height)),g=this.pointCoordinate(new s.Point(0,this.height)),y=Math.floor(Math.min(h.x,d.x,m.x,g.x)),v=Math.floor(Math.max(h.x,d.x,m.x,g.x)),A=1;for(let k=y-A;k<=v+A;k++)0!==k&&a.push(new s.UnwrappedTileID(k,n))}return a}coveringTiles(n){let a=this.coveringZoomLevel(n);const h=a,d=this.elevation&&!n.isTerrainDEM,m="mercator"===this.projection.name;if(void 0!==n.minzoom&&a<n.minzoom)return[];void 0!==n.maxzoom&&a>n.maxzoom&&(a=n.maxzoom);const g=this.locationCoordinate(this.center),y=this.center.lat,v=1<<a,A=[v*g.x,v*g.y,0],k="globe"===this.projection.name,S=!k,U=s.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,a,S),j=k?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),G=v*s.mercatorZfromAltitude(1,this.center.lat),Z=this._camera.position[2]/s.mercatorZfromAltitude(1,this.center.lat),$=[v*j.x,v*j.y,Z*(S?1:G)],P=this.cameraToCenterDistance/n.tileSize*(n.roundZoom?1:.502),N=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?a:0,X=n.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,J=n.isTerrainDEM?-X:this._elevation?this._elevation.getMinElevationBelowMSL():0,oe=this.projection.isReprojectedInTileSpace?Cc(this):1,ce=ye=>{const We=new s.MercatorCoordinate(ye.x+25e-6,ye.y,ye.z),Be=new s.MercatorCoordinate(ye.x,ye.y+25e-6,ye.z),He=ye.toLngLat(),gt=We.toLngLat(),St=Be.toLngLat(),ht=this.locationCoordinate(He),Et=this.locationCoordinate(gt),Wt=this.locationCoordinate(St),qt=Math.hypot(Et.x-ht.x,Et.y-ht.y),pt=Math.hypot(Wt.x-ht.x,Wt.y-ht.y);return Math.sqrt(qt*pt)*oe/25e-6},le=ye=>{const ze=X,We=J;return{aabb:s.tileAABB(this,v,0,0,0,ye,We,ze,this.projection),zoom:0,x:0,y:0,minZ:We,maxZ:ze,wrap:ye,fullyVisible:!1}},pe=[];let de=[];const ve=a,qe=n.reparseOverscaled?h:a,_e=ye=>ye*ye,Le=_e((Z-this._centerAltitude)*G),we=ye=>{if(!this._elevation||!ye.tileID||!m)return;const ze=this._elevation.getMinMaxForTile(ye.tileID),We=ye.aabb;ze?(We.min[2]=ze.min,We.max[2]=ze.max,We.center[2]=(We.min[2]+We.max[2])/2):(ye.shouldSplit=Ze(ye),ye.shouldSplit||(We.min[2]=We.max[2]=We.center[2]=this._centerAltitude))},Ze=ye=>{if(ye.zoom<N)return!0;if(ye.zoom===ve)return!1;if(null!=ye.shouldSplit)return ye.shouldSplit;const ze=ye.aabb.distanceX($),We=ye.aabb.distanceY($);let Be=Le,He=1;if(k){Be=_e(ye.aabb.distanceZ($));const ht=Math.pow(2,ye.zoom),Et=s.latFromMercatorY((ye.y+1)/ht),Wt=s.latFromMercatorY(ye.y/ht),qt=Math.min(Math.max(y,Et),Wt),pt=s.circumferenceAtLatitude(qt)/s.circumferenceAtLatitude(y);if(He=qt===y?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,pt/this._mercatorScaleRatio),this.zoom<=s.GLOBE_ZOOM_THRESHOLD_MIN&&ye.zoom===ve-1&&pt>=.9)return!0}else if(d&&(Be=_e(ye.aabb.distanceZ($)*G)),this.projection.isReprojectedInTileSpace&&h<=5){const ht=Math.pow(2,ye.zoom),Et=ce(new s.MercatorCoordinate((ye.x+.5)/ht,(ye.y+.5)/ht));He=Et>.85?1:Et}const gt=ze*ze+We*We+Be;return gt<_e((1<<ve-ye.zoom)*P*He*((ht,Et)=>{if(Et*_e(.707)<ht)return 1;const Wt=Math.sqrt(Et/ht);return Wt/(1.4144271570014144+(Math.pow(1.1,Wt-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(Be,Le),gt))};if(this.renderWorldCopies)for(let ye=1;ye<=3;ye++)pe.push(le(-ye)),pe.push(le(ye));for(pe.push(le(0));pe.length>0;){const ye=pe.pop(),ze=ye.x,We=ye.y;let Be=ye.fullyVisible;if(!Be){const He=ye.aabb.intersects(U);if(0===He)continue;Be=2===He}if(ye.zoom!==ve&&Ze(ye))for(let He=0;He<4;He++){const gt=(ze<<1)+He%2,St=(We<<1)+(He>>1),ht={aabb:m?ye.aabb.quadrant(He):s.tileAABB(this,v,ye.zoom+1,gt,St,ye.wrap,ye.minZ,ye.maxZ,this.projection),zoom:ye.zoom+1,x:gt,y:St,wrap:ye.wrap,fullyVisible:Be,tileID:void 0,shouldSplit:void 0,minZ:ye.minZ,maxZ:ye.maxZ};d&&!k&&(ht.tileID=new s.OverscaledTileID(ye.zoom+1===ve?qe:ye.zoom+1,ye.wrap,ye.zoom+1,gt,St),we(ht)),pe.push(ht)}else{const He=ye.zoom===ve?qe:ye.zoom;if(n.minzoom&&n.minzoom>He)continue;const gt=A[0]-(.5+ze+(ye.wrap<<ye.zoom))*(1<<a-ye.zoom),St=A[1]-.5-We,ht=ye.tileID?ye.tileID:new s.OverscaledTileID(He,ye.wrap,ye.zoom,ze,We);de.push({tileID:ht,distanceSq:gt*gt+St*St})}}if(this.fogCullDistSq){const ye=this.fogCullDistSq,ze=this.horizonLineFromTop();de=de.filter(We=>{const Be=[0,0,0,1],He=[s.EXTENT,s.EXTENT,0,1],gt=this.calculateFogTileMatrix(We.tileID.toUnwrapped());s.transformMat4$1(Be,Be,gt),s.transformMat4$1(He,He,gt);const St=s.getAABBPointSquareDist(Be,He);if(0===St)return!0;let ht=!1;const Et=this._elevation;if(Et&&St>ye&&0!==ze){const Wt=this.calculateProjMatrix(We.tileID.toUnwrapped());let qt;n.isTerrainDEM||(qt=Et.getMinMaxForTile(We.tileID)),qt||(qt={min:J,max:X});const pt=s.furthestTileCorner(this.rotation),hi=[pt[0]*s.EXTENT,pt[1]*s.EXTENT,qt.max];s.transformMat4(hi,hi,Wt),ht=(1-hi[1])*this.height*.5<ze}return St<ye||ht})}return de.sort((ye,ze)=>ye.distanceSq-ze.distanceSq).map(ye=>ye.tileID)}resize(n,a){this.width=n,this.height=a,this.pixelsToGLUnits=[2/n,-2/a],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(n){return Math.pow(2,n)}scaleZoom(n){return Math.log(n)/Math.LN2}project(n){const a=s.clamp(n.lat,-s.MAX_MERCATOR_LATITUDE,s.MAX_MERCATOR_LATITUDE),h=this.projection.project(n.lng,a);return new s.Point(h.x*this.worldSize,h.y*this.worldSize)}unproject(n){return this.projection.unproject(n.x/this.worldSize,n.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/s.mercatorZfromAltitude(1,this.center.lat)/this.worldSize}setLocationAtPoint(n,a){let h,d;const m=this.centerPoint;if("globe"===this.projection.name){const y=this.worldSize;h=(a.x-m.x)/y,d=(a.y-m.y)/y}else{const y=this.pointCoordinate(a),v=this.pointCoordinate(m);h=y.x-v.x,d=y.y-v.y}const g=this.locationCoordinate(n);this.setLocation(new s.MercatorCoordinate(g.x-h,g.y-d))}setLocation(n){this.center=this.coordinateLocation(n),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(n){return this.projection.locationPoint(this,n)}locationPoint3D(n){return this.projection.locationPoint(this,n,!0)}pointLocation(n){return this.coordinateLocation(this.pointCoordinate(n))}pointLocation3D(n){return this.coordinateLocation(this.pointCoordinate3D(n))}locationCoordinate(n,a){const h=a?s.mercatorZfromAltitude(a,n.lat):void 0,d=this.projection.project(n.lng,n.lat);return new s.MercatorCoordinate(d.x,d.y,h)}coordinateLocation(n){return this.projection.unproject(n.x,n.y)}pointRayIntersection(n,a){const h=a??this._centerAltitude,d=[n.x,n.y,0,1],m=[n.x,n.y,1,1];s.transformMat4$1(d,d,this.pixelMatrixInverse),s.transformMat4$1(m,m,this.pixelMatrixInverse);const g=m[3];s.scale$1(d,d,1/d[3]),s.scale$1(m,m,1/g);const y=d[2],v=m[2];return{p0:d,p1:m,t:y===v?0:(h-y)/(v-y)}}screenPointToMercatorRay(n){const a=[n.x,n.y,0,1],h=[n.x,n.y,1,1];return s.transformMat4$1(a,a,this.pixelMatrixInverse),s.transformMat4$1(h,h,this.pixelMatrixInverse),s.scale$1(a,a,1/a[3]),s.scale$1(h,h,1/h[3]),a[2]=s.mercatorZfromAltitude(a[2],this._center.lat)*this.worldSize,h[2]=s.mercatorZfromAltitude(h[2],this._center.lat)*this.worldSize,s.scale$1(a,a,1/this.worldSize),s.scale$1(h,h,1/this.worldSize),new s.Ray([a[0],a[1],a[2]],s.normalize([],s.sub([],h,a)))}rayIntersectionCoordinate(n){const{p0:a,p1:h,t:d}=n,m=s.mercatorZfromAltitude(a[2],this._center.lat),g=s.mercatorZfromAltitude(h[2],this._center.lat);return new s.MercatorCoordinate(s.number(a[0],h[0],d)/this.worldSize,s.number(a[1],h[1],d)/this.worldSize,s.number(m,g,d))}pointCoordinate(n,a=this._centerAltitude){return this.projection.pointCoordinate(this,n.x,n.y,a)}pointCoordinate3D(n){if(!this.elevation)return this.pointCoordinate(n);let a=this.projection.pointCoordinate3D(this,n.x,n.y);if(a)return new s.MercatorCoordinate(a[0],a[1],a[2]);let h=0,d=this.horizonLineFromTop();if(n.y>d)return this.pointCoordinate(n);const m=.02*d,g=n.clone();for(let y=0;y<10&&d-h>m;y++){g.y=s.number(h,d,.66);const v=this.projection.pointCoordinate3D(this,g.x,g.y);v?(d=g.y,a=v):h=g.y}return a?new s.MercatorCoordinate(a[0],a[1],a[2]):this.pointCoordinate(n)}isPointAboveHorizon(n){return this.projection.isPointAboveHorizon(this,n)}isPointOnSurface(n){if(n.y<0||n.y>this.height||n.x<0||n.x>this.width)return!1;if(this.elevation||this.zoom>=s.GLOBE_ZOOM_THRESHOLD_MAX)return!this.isPointAboveHorizon(n);const a=this.pointCoordinate(n);return a.y>=0&&a.y<=1}_coordinatePoint(n,a){const h=a&&this.elevation?this.elevation.getAtPointOrZero(n,this._centerAltitude):this._centerAltitude,d=[n.x*this.worldSize,n.y*this.worldSize,h+n.toAltitude(),1];return s.transformMat4$1(d,d,this.pixelMatrix),d[3]>0?new s.Point(d[0]/d[3],d[1]/d[3]):new s.Point(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:n,left:a}=this._edgeInsets,h=this.height-this._edgeInsets.bottom,d=this.width-this._edgeInsets.right,m=this.pointLocation3D(new s.Point(a,n)),g=this.pointLocation3D(new s.Point(d,n)),y=this.pointLocation3D(new s.Point(d,h)),v=this.pointLocation3D(new s.Point(a,h));let A=Math.min(m.lng,g.lng,y.lng,v.lng),k=Math.max(m.lng,g.lng,y.lng,v.lng),S=Math.min(m.lat,g.lat,y.lat,v.lat),U=Math.max(m.lat,g.lat,y.lat,v.lat);const j=Math.pow(2,-this.zoom)/16*270,G="globe"===this.projection.name?1:4,Z=($,P,N,X,J)=>{const oe=($+N)/2,ce=(P+X)/2,le=new s.Point(oe,ce),{lng:pe,lat:de}=this.pointLocation3D(le),ve=Math.max(0,A-pe,S-de,pe-k,de-U);A=Math.min(A,pe),k=Math.max(k,pe),S=Math.min(S,de),U=Math.max(U,de),(J<G||ve>j)&&(Z($,P,oe,ce,J+1),Z(oe,ce,N,X,J+1))};if(Z(a,n,d,n,1),Z(d,n,d,h,1),Z(d,h,a,h,1),Z(a,h,a,n,1),"globe"===this.projection.name){const[$,P]=s.polesInViewport(this);$?(U=90,k=180,A=-180):P&&(S=-90,k=180,A=-180)}return new s.LngLatBounds(new s.LngLat(A,S),new s.LngLat(k,U))}_getBoundsRectangular(n,a){const{top:h,left:d}=this._edgeInsets,m=this.height-this._edgeInsets.bottom,g=this.width-this._edgeInsets.right,y=new s.Point(d,h),v=new s.Point(g,h),A=new s.Point(g,m),k=new s.Point(d,m);let S=this.pointCoordinate(y,n),U=this.pointCoordinate(v,n);const j=this.pointCoordinate(A,a),G=this.pointCoordinate(k,a),Z=($,P)=>(P.y-$.y)/(P.x-$.x);return S.y>1&&U.y>=0?S=new s.MercatorCoordinate((1-G.y)/Z(G,S)+G.x,1):S.y<0&&U.y<=1&&(S=new s.MercatorCoordinate(-G.y/Z(G,S)+G.x,0)),U.y>1&&S.y>=0?U=new s.MercatorCoordinate((1-j.y)/Z(j,U)+j.x,1):U.y<0&&S.y<=1&&(U=new s.MercatorCoordinate(-j.y/Z(j,U)+j.x,0)),(new s.LngLatBounds).extend(this.coordinateLocation(S)).extend(this.coordinateLocation(U)).extend(this.coordinateLocation(G)).extend(this.coordinateLocation(j))}_getBoundsRectangularTerrain(){const n=this.elevation;if(!n.visibleDemTiles.length||n.isUsingMockSource())return this._getBoundsRectangular(0,0);const a=n.visibleDemTiles.reduce((h,d)=>{if(d.dem){const m=d.dem.tree;h.min=Math.min(h.min,m.minimums[0]),h.max=Math.max(h.max,m.maximums[0])}return h},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(a.min*n.exaggeration(),a.max*n.exaggeration())}getBounds(){return"mercator"===this.projection.name||"equirectangular"===this.projection.name?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(n=!0){const a=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,h=this.height/2-a*(1-this._horizonShift);return n?Math.max(0,h):h}getMaxBounds(){return this.maxBounds}setMaxBounds(n){this.maxBounds=n,this.minLat=-s.MAX_MERCATOR_LATITUDE,this.maxLat=s.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,n&&(this.minLat=n.getSouth(),this.maxLat=n.getNorth(),this.minLng=n.getWest(),this.maxLng=n.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=s.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=s.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=s.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=s.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(n,a){return this.projection.createTileMatrix(this,a,n)}calculateDistanceTileData(n){const a=n.key,h=this._distanceTileDataCache;if(h[a])return h[a];const d=n.canonical,m=1/this.height,g=this.cameraWorldSize,y=g/this.zoomScale(d.z),v=(d.x+Math.pow(2,d.z)*n.wrap)*y,A=d.y*y,k=this.point;k.x*=g/this.worldSize,k.y*=g/this.worldSize;const S=this.angle,U=Math.sin(-S),j=-Math.cos(-S);return h[a]={bearing:[U,j],center:[(k.x-v)*m,(k.y-A)*m],scale:y/s.EXTENT*m},h[a]}calculateFogTileMatrix(n){const a=n.key,h=this._fogTileMatrixCache;if(h[a])return h[a];const d=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,n);return s.multiply(d,this.worldToFogMatrix,d),h[a]=new Float32Array(d),h[a]}calculateProjMatrix(n,a=!1){const h=n.key,d=a?this._alignedProjMatrixCache:this._projMatrixCache;if(d[h])return d[h];const m=this.calculatePosMatrix(n,this.worldSize);return s.multiply(m,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:a?this.alignedProjMatrix:this.projMatrix,m),d[h]=new Float32Array(m),d[h]}calculatePixelsToTileUnitsMatrix(n){const a=n.tileID.key,h=this._pixelsToTileUnitsCache;if(h[a])return h[a];const d=function(m,g){const{scale:y}=m.tileTransform,v=y*s.EXTENT/(m.tileSize*Math.pow(2,g.zoom-m.tileID.overscaledZ+m.tileID.canonical.z));return A=new Float32Array(4),U=(k=g.inverseAdjustmentMatrix)[1],j=k[2],G=k[3],$=(S=[v,v])[1],A[0]=k[0]*(Z=S[0]),A[1]=U*Z,A[2]=j*$,A[3]=G*$,A;var A,k,S,U,j,G,Z,$}(n,this);return h[a]=d,h[a]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if("globe"===this.projection.name){const n=1/this.worldSize,a=s.fromScaling([],[n,n,n]);return s.multiply(a,a,this.globeMatrix),a}}recenterOnTerrain(){if(!this._elevation||"globe"===this.projection.name)return;const n=this._elevation;this._updateCameraState();const a=s.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,h=this._computeCameraPosition(a),d=this._camera.forward(),m=s.mercatorZfromAltitude(1,this._center.lat);h[2]/=m,d[2]/=m,s.normalize(d,d);const g=n.raycast(h,d,n.exaggeration());if(g){const y=s.scaleAndAdd([],h,d,g),v=new s.MercatorCoordinate(y[0],y[1],s.mercatorZfromAltitude(y[2],s.latFromMercatorY(y[1]))),A=(v.z+s.length([v.x-h[0],v.y-h[1],v.z-h[2]*m]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(A),this._centerAltitude=v.toAltitude(),this._center=this.coordinateLocation(v),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(n=!1){if(!this._elevation)return;const a=this._elevation,h=s.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,d=this._computeCameraPosition(h),m=a.getAtPointOrZero(new s.MercatorCoordinate(...d)),g=this.pixelsPerMeter/this.worldSize*m,y=this._minimumHeightOverTerrain(),v=d[2]-g;if(v<=y)if(v<0||n){const A=this.locationCoordinate(this._center,this._centerAltitude),k=[d[0],d[1],A.z-d[2]],S=s.length(k);k[2]-=(y-v)/this._pixelsPerMercatorPixel;const U=s.length(k);if(0===U)return;s.scale$2(k,k,S/U*this._pixelsPerMercatorPixel),this._camera.position=[d[0],d[1],A.z*this._pixelsPerMercatorPixel-k[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const n="globe"===this.projection.name||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||n){const U=this.center;return U.lat=s.clamp(U.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!n)&&(U.lng=s.clamp(U.lng,this.minLng,this.maxLng)),this.center=U,void(this._constraining=!1)}const a=this._unmodified,{x:h,y:d}=this.point;let m=0,g=h,y=d;const v=this.width/2,A=this.height/2,k=this.worldMinY*this.scale,S=this.worldMaxY*this.scale;if(d-A<k&&(y=k+A),d+A>S&&(y=S-A),S-k<this.height&&(m=Math.max(m,this.height/(S-k)),y=(S+k)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const U=this.worldMinX*this.scale,j=this.worldMaxX*this.scale,G=this.worldSize/2-(U+j)/2;g=(h+G+this.worldSize)%this.worldSize-G,g-v<U&&(g=U+v),g+v>j&&(g=j-v),j-U<this.width&&(m=Math.max(m,this.width/(j-U)),g=(j+U)/2)}g===h&&y===d||(this.center=this.unproject(new s.Point(g,y))),m&&(this.zoom+=this.scaleZoom(m)),this._constrainCamera(),this._unmodified=a,this._constraining=!1}_minZoomForBounds(){let n=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(n=Math.max(n,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),n}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const n=this.centerOffset,a=this.pixelsPerMeter;"globe"===this.projection.name&&(this._mercatorScaleRatio=s.mercatorZfromAltitude(1,this.center.lat)/s.mercatorZfromAltitude(1,s.GLOBE_SCALE_MATCH_LATITUDE));const h=is(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,h),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const d="meters"===this.projection.zAxisUnit?a:1,m=this._camera.getWorldToCamera(this.worldSize,d),g=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);g[8]=2*-n.x/this.width,g[9]=2*n.y/this.height;let y=s.mul([],g,m);if(this.projection.isReprojectedInTileSpace){const ce=this.locationCoordinate(this.center),le=s.identity([]);s.translate(le,le,[ce.x*this.worldSize,ce.y*this.worldSize,0]),s.multiply(le,le,za(this)),s.translate(le,le,[-ce.x*this.worldSize,-ce.y*this.worldSize,0]),s.multiply(y,y,le),this.inverseAdjustmentMatrix=function(pe){const de=za(pe,!0);return Pe([],[de[0],de[1],de[4],de[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=s.scale([],y,[this.worldSize,this.worldSize,this.worldSize/d,1]),this.projMatrix=y,this.invProjMatrix=s.invert(new Float64Array(16),this.projMatrix);const v=s.invert([],g);this.frustumCorners=s.FrustumCorners.fromInvProjectionMatrix(v,this.horizonLineFromTop(),this.height);const A=new Float32Array(16);s.identity(A),s.scale(A,A,[1,-1,1]),s.rotateX(A,A,this._pitch),s.rotateZ(A,A,this.angle);const k=s.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),S=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;k[8]=2*-n.x/this.width,k[9]=2*(n.y+S)/this.height,this.skyboxMatrix=s.multiply(A,k,A);const U=this.point,j=U.x,G=U.y,Z=this.width%2/2,$=this.height%2/2,P=Math.cos(this.angle),N=Math.sin(this.angle),X=j-Math.round(j)+P*Z+N*$,J=G-Math.round(G)+P*$+N*Z,oe=new Float64Array(y);if(s.translate(oe,oe,[X>.5?X-1:X,J>.5?J-1:J,0]),this.alignedProjMatrix=oe,y=s.create(),s.scale(y,y,[this.width/2,-this.height/2,1]),s.translate(y,y,[1,-1,0]),this.labelPlaneMatrix=y,y=s.create(),s.scale(y,y,[1,-1,1]),s.translate(y,y,[-1,-1,0]),s.scale(y,y,[2/this.width,2/this.height,1]),this.glCoordMatrix=y,this.pixelMatrix=s.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},y=s.invert(new Float64Array(16),this.pixelMatrix),!y)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=y,"globe"===this.projection.name||this.mercatorFromTransition){this.globeMatrix=s.calculateGlobeMatrix(this);const ce=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=s.transformMat4(ce,ce,m),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=y;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const n=this.cameraWorldSizeForFog,a=this.cameraPixelsPerMeter,h=this._camera.position,d=1/this.height/this._pixelsPerMercatorPixel,m=[n,n,a];s.scale$2(m,m,d),s.scale$2(h,h,-1),s.multiply$2(h,h,m);const g=s.create();s.translate(g,g,h),s.scale(g,g,m),this.mercatorFogMatrix=g,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(n,a,d)}_computeCameraPosition(n){const a=(n=n||this.pixelsPerMeter)/this.pixelsPerMeter,h=this._camera.forward(),d=this.point,m=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*a-n/this.worldSize*this._centerAltitude;return[d.x/this.worldSize-h[0]*m,d.y/this.worldSize-h[1]*m,n/this.worldSize*this._centerAltitude-h[2]*m]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(n){const a=this._maxCameraBoundsDistance()*Math.cos(this._pitch),h=this._camera.position[2],d=n[2];let m=1;this.projection.wrap&&(this.center=this.center.wrap()),d>0&&(m=Math.min((a-h)/d,1)),this._camera.position=s.scaleAndAdd([],this._camera.position,n,m),this._updateStateFromCamera()}_updateStateFromCamera(){const n=this._camera.position,a=this._camera.forward(),{pitch:h,bearing:d}=this._camera.getPitchBearing(),m=s.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,g=this._mercatorZfromZoom(this._maxZoom)*Math.cos(s.degToRad(this._maxPitch)),y=Math.max((n[2]-m)/Math.cos(h),g),v=this._zoomFromMercatorZ(y);s.scaleAndAdd(n,n,a,y),this._pitch=s.clamp(h,s.degToRad(this.minPitch),s.degToRad(this.maxPitch)),this.angle=s.wrap(d,-Math.PI,Math.PI),this._setZoom(s.clamp(v,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new s.MercatorCoordinate(n[0],n[1],n[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(n){return Math.pow(2,n)*this.tileSize}_mercatorZfromZoom(n){return this.cameraToCenterDistance/this._worldSizeFromZoom(n)}_minimumHeightOverTerrain(){const n=Math.min((null!=this._seaLevelZoom?this._seaLevelZoom:this._zoom)+4,this._maxZoom);return this._mercatorZfromZoom(n)}_zoomFromMercatorZ(n){return this.scaleZoom(this.cameraToCenterDistance/(n*this.tileSize))}zoomFromMercatorZAdjusted(n){let a=0,h=s.GLOBE_ZOOM_THRESHOLD_MAX,d=0,m=1/0;for(;h-a>1e-6&&h>a;){const g=a+.5*(h-a),y=this.tileSize*Math.pow(2,g),v=this.getCameraToCenterDistance(this.projection,g,y),A=this.scaleZoom(v/(n*this.tileSize)),k=Math.abs(g-A);k<m&&(m=k,d=g),g<A?a=g:h=g}return d}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(s.warnOnce("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(n,a){const h=Math.min(n.x,a.x),d=Math.max(n.x,a.x),m=Math.min(n.y,a.y),g=Math.max(n.y,a.y);if(m<this.horizonLineFromTop(!1))return!0;if("mercator"!==this.projection.name)return!1;const y=[new s.Point(h,m),new s.Point(d,g),new s.Point(h,g),new s.Point(d,m)],v=this.renderWorldCopies?-3:0,A=this.renderWorldCopies?4:1;for(const k of y){const S=this.pointRayIntersection(k);if(S.t<0)return!0;const U=this.rayIntersectionCoordinate(S);if(U.x<v||U.y<0||U.x>A||U.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+s.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new s.Point(0,0),new s.Point(this.width,this.height))}zoomDeltaToMovement(n,a){const h=s.length(s.sub([],this._camera.position,n)),d=this._zoomFromMercatorZ(h)+a;return h-this._mercatorZfromZoom(d)}getCameraPoint(){if("globe"===this.projection.name){const n=function([a,h,d],m){const g=[a,h,d,1];s.transformMat4$1(g,g,m);const y=g[3]=Math.max(g[3],1e-6);return g[0]/=y,g[1]/=y,g[2]/=y,g}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new s.Point(n[0],n[1])}{const n=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new s.Point(0,n))}}getCameraToCenterDistance(n,a=this.zoom,h=this.worldSize){const d=is(n,a,this.width,this.height,1024),m=n.pixelSpaceConversion(this.center.lat,h,d);return.5/Math.tan(.5*this._fov)*this.height*m}getWorldToCameraMatrix(){const n=this._camera.getWorldToCamera(this.worldSize,"meters"===this.projection.zAxisUnit?this.pixelsPerMeter:1);return"globe"===this.projection.name&&s.multiply(n,n,this.globeMatrix),n}}function Ra(l,n){let a=!1,h=null;const d=()=>{h=null,a&&(l(),h=setTimeout(d,n),a=!1)};return()=>(a=!0,h||d(),h)}class ll{constructor(n){this._hashName=n&&encodeURIComponent(n),s.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Ra(this._updateHashUnthrottled.bind(this),300)}addTo(n){return this._map=n,s.window.addEventListener("hashchange",this._onHashChange,!1),n.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),s.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const n=this._map;if(!n)return"";const a=_o(n);if(this._hashName){const h=this._hashName;let d=!1;const m=s.window.location.hash.slice(1).split("&").map(g=>{const y=g.split("=")[0];return y===h?(d=!0,`${y}=${a}`):g}).filter(g=>g);return d||m.push(`${h}=${a}`),`#${m.join("&")}`}return`#${a}`}_getCurrentHash(){const n=s.window.location.hash.replace("#","");if(this._hashName){let a;return n.split("&").map(h=>h.split("=")).forEach(h=>{h[0]===this._hashName&&(a=h)}),(a&&a[1]||"").split("/")}return n.split("/")}_onHashChange(){const n=this._map;if(!n)return!1;const a=this._getCurrentHash();if(a.length>=3&&!a.some(h=>isNaN(h))){const h=n.dragRotate.isEnabled()&&n.touchZoomRotate.isEnabled()?+(a[3]||0):n.getBearing();return n.jumpTo({center:[+a[2],+a[1]],zoom:+a[0],bearing:h,pitch:+(a[4]||0)}),!0}return!1}_updateHashUnthrottled(){const n=s.window.location.href.replace(/(#.+)?$/,this.getHashString());s.window.history.replaceState(s.window.history.state,null,n)}}function _o(l,n){const a=l.getCenter(),h=Math.round(100*l.getZoom())/100,d=Math.ceil((h*Math.LN2+Math.log(512/360/.5))/Math.LN10),m=Math.pow(10,d),g=Math.round(a.lng*m)/m,y=Math.round(a.lat*m)/m,v=l.getBearing(),A=l.getPitch();let k=n?`/${g}/${y}/${h}`:`${h}/${y}/${g}`;return(v||A)&&(k+="/"+Math.round(10*v)/10),A&&(k+=`/${Math.round(A)}`),k}const go={linearity:.3,easing:s.bezier(0,0,.3,1)},rs=s.extend({deceleration:2500,maxSpeed:1400},go),as=s.extend({deceleration:20,maxSpeed:1400},go),ot=s.extend({deceleration:1e3,maxSpeed:360},go),hr=s.extend({deceleration:1e3,maxSpeed:90},go);class Dc{constructor(n){this._map=n,this.clear()}clear(){this._inertiaBuffer=[]}record(n){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:s.exported.now(),settings:n})}_drainInertiaBuffer(){const n=this._inertiaBuffer,a=s.exported.now();for(;n.length>0&&a-n[0].time>160;)n.shift()}_onMoveEnd(n){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const a={zoom:0,bearing:0,pitch:0,pan:new s.Point(0,0),pinchAround:void 0,around:void 0};for(const{settings:m}of this._inertiaBuffer)a.zoom+=m.zoomDelta||0,a.bearing+=m.bearingDelta||0,a.pitch+=m.pitchDelta||0,m.panDelta&&a.pan._add(m.panDelta),m.around&&(a.around=m.around),m.pinchAround&&(a.pinchAround=m.pinchAround);const h=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,d={};if(a.pan.mag()){const m=xo(a.pan.mag(),h,s.extend({},rs,n||{}));d.offset=a.pan.mult(m.amount/a.pan.mag()),d.center=this._map.transform.center,yo(d,m)}if(a.zoom){const m=xo(a.zoom,h,as);d.zoom=this._map.transform.zoom+m.amount,yo(d,m)}if(a.bearing){const m=xo(a.bearing,h,ot);d.bearing=this._map.transform.bearing+s.clamp(m.amount,-179,179),yo(d,m)}if(a.pitch){const m=xo(a.pitch,h,hr);d.pitch=this._map.transform.pitch+m.amount,yo(d,m)}if(d.zoom||d.bearing){const m=void 0===a.pinchAround?a.around:a.pinchAround;d.around=m?this._map.unproject(m):this._map.getCenter()}return this.clear(),d.noMoveStart=!0,d}}function yo(l,n){(!l.duration||l.duration<n.duration)&&(l.duration=n.duration,l.easing=n.easing)}function xo(l,n,a){const{maxSpeed:h,linearity:d,deceleration:m}=a,g=s.clamp(l*d/(n/1e3),-h,h),y=Math.abs(g)/(m*d);return{easing:a.easing,duration:1e3*y,amount:g*(y/2)}}class on extends s.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,a,h,d={}){const m=bt(a.getCanvasContainer(),h),g=a.unproject(m);super(n,s.extend({point:m,lngLat:g,originalEvent:h},d)),this._defaultPrevented=!1,this.target=a}}class vo extends s.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,a,h){const d="touchend"===n?h.changedTouches:h.touches,m=Gt(a.getCanvasContainer(),d),g=m.map(v=>a.unproject(v)),y=m.reduce((v,A,k,S)=>v.add(A.div(S.length)),new s.Point(0,0));super(n,{points:m,point:y,lngLats:g,lngLat:a.unproject(y),originalEvent:h}),this._defaultPrevented=!1}}class os extends s.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,a,h){super(n,{originalEvent:h}),this._defaultPrevented=!1}}class cl{constructor(n,a){this._map=n,this._clickTolerance=a.clickTolerance}reset(){this._mousedownPos=void 0}wheel(n){return this._firePreventable(new os(n.type,this._map,n))}mousedown(n,a){return this._mousedownPos=a,this._firePreventable(new on(n.type,this._map,n))}mouseup(n){this._map.fire(new on(n.type,this._map,n))}preclick(n){const a=s.extend({},n);a.type="preclick",this._map.fire(new on(a.type,this._map,a))}click(n,a){this._mousedownPos&&this._mousedownPos.dist(a)>=this._clickTolerance||(this.preclick(n),this._map.fire(new on(n.type,this._map,n)))}dblclick(n){return this._firePreventable(new on(n.type,this._map,n))}mouseover(n){this._map.fire(new on(n.type,this._map,n))}mouseout(n){this._map.fire(new on(n.type,this._map,n))}touchstart(n){return this._firePreventable(new vo(n.type,this._map,n))}touchmove(n){this._map.fire(new vo(n.type,this._map,n))}touchend(n){this._map.fire(new vo(n.type,this._map,n))}touchcancel(n){this._map.fire(new vo(n.type,this._map,n))}_firePreventable(n){if(this._map.fire(n),n.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class ss{constructor(n){this._map=n}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(n){this._map.fire(new on(n.type,this._map,n))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new on("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(n){this._delayContextMenu?this._contextMenuEvent=n:this._map.fire(new on(n.type,this._map,n)),this._map.listens("contextmenu")&&n.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ic{constructor(n,a){this._map=n,this._el=n.getCanvasContainer(),this._container=n.getContainer(),this._clickTolerance=a.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(n,a){this.isEnabled()&&n.shiftKey&&0===n.button&&(Bt(),this._startPos=this._lastPos=a,this._active=!0)}mousemoveWindow(n,a){if(!this._active)return;const h=a,d=this._startPos,m=this._lastPos;if(!d||!m||m.equals(h)||!this._box&&h.dist(d)<this._clickTolerance)return;this._lastPos=h,this._box||(this._box=dt("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",n));const g=Math.min(d.x,h.x),y=Math.max(d.x,h.x),v=Math.min(d.y,h.y),A=Math.max(d.y,h.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${g}px,${v}px)`,this._box.style.width=y-g+"px",this._box.style.height=A-v+"px")})}mouseupWindow(n,a){if(!this._active)return;const h=this._startPos,d=a;if(h&&0===n.button){if(this.reset(),ft(),h.x!==d.x||h.y!==d.y)return this._map.fire(new s.Event("boxzoomend",{originalEvent:n})),{cameraAnimation:m=>m.fitScreenCoordinates(h,d,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",n)}}keydown(n){this._active&&27===n.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",n))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),Jt(),delete this._startPos,delete this._lastPos}_fireEvent(n,a){return this._map.fire(new s.Event(n,{originalEvent:a}))}}function ls(l,n){const a={};for(let h=0;h<l.length;h++)a[l[h].identifier]=n[h];return a}class Oa{constructor(n){this.reset(),this.numTouches=n.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(n,a,h){(this.centroid||h.length>this.numTouches)&&(this.aborted=!0),this.aborted||(0===this.startTime&&(this.startTime=n.timeStamp),h.length===this.numTouches&&(this.centroid=function(d){const m=new s.Point(0,0);for(const g of d)m._add(g);return m.div(d.length)}(a),this.touches=ls(h,a)))}touchmove(n,a,h){if(this.aborted||!this.centroid)return;const d=ls(h,a);for(const m in this.touches){const g=d[m];(!g||g.dist(this.touches[m])>30)&&(this.aborted=!0)}}touchend(n,a,h){if((!this.centroid||n.timeStamp-this.startTime>500)&&(this.aborted=!0),0===h.length){const d=!this.aborted&&this.centroid;if(this.reset(),d)return d}}}class hl{constructor(n){this.singleTap=new Oa(n),this.numTaps=n.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(n,a,h){this.singleTap.touchstart(n,a,h)}touchmove(n,a,h){this.singleTap.touchmove(n,a,h)}touchend(n,a,h){const d=this.singleTap.touchend(n,a,h);if(d){const m=n.timeStamp-this.lastTime<500,g=!this.lastTap||this.lastTap.dist(d)<30;if(m&&g||this.reset(),this.count++,this.lastTime=n.timeStamp,this.lastTap=d,this.count===this.numTaps)return this.reset(),d}}}class Nh{constructor(){this._zoomIn=new hl({numTouches:1,numTaps:2}),this._zoomOut=new hl({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(n,a,h){this._zoomIn.touchstart(n,a,h),this._zoomOut.touchstart(n,a,h)}touchmove(n,a,h){this._zoomIn.touchmove(n,a,h),this._zoomOut.touchmove(n,a,h)}touchend(n,a,h){const d=this._zoomIn.touchend(n,a,h),m=this._zoomOut.touchend(n,a,h);return d?(this._active=!0,n.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:g=>g.easeTo({duration:300,zoom:g.getZoom()+1,around:g.unproject(d)},{originalEvent:n})}):m?(this._active=!0,n.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:g=>g.easeTo({duration:300,zoom:g.getZoom()-1,around:g.unproject(m)},{originalEvent:n})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Sc={0:1,2:2};class Ba{constructor(n){this.reset(),this._clickTolerance=n.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(n,a){return!1}_move(n,a){return{}}mousedown(n,a){if(this._lastPoint)return;const h=Tt(n);this._correctButton(n,h)&&(this._lastPoint=a,this._eventButton=h)}mousemoveWindow(n,a){const h=this._lastPoint;if(h)if(n.preventDefault(),null!=this._eventButton&&function(d,m){const g=Sc[m];return void 0===d.buttons||(d.buttons&g)!==g}(n,this._eventButton))this.reset();else if(this._moved||!(a.dist(h)<this._clickTolerance))return this._moved=!0,this._lastPoint=a,this._move(h,a)}mouseupWindow(n){this._lastPoint&&Tt(n)===this._eventButton&&(this._moved&&ft(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ul extends Ba{mousedown(n,a){super.mousedown(n,a),this._lastPoint&&(this._active=!0)}_correctButton(n,a){return 0===a&&!n.ctrlKey}_move(n,a){return{around:a,panDelta:a.sub(n)}}}class dl extends Ba{_correctButton(n,a){return 0===a&&n.ctrlKey||2===a}_move(n,a){const h=.8*(a.x-n.x);if(h)return this._active=!0,{bearingDelta:h}}contextmenu(n){n.preventDefault()}}class pl extends Ba{_correctButton(n,a){return 0===a&&n.ctrlKey||2===a}_move(n,a){const h=-.5*(a.y-n.y);if(h)return this._active=!0,{pitchDelta:h}}contextmenu(n){n.preventDefault()}}class cs{constructor(n,a){this._map=n,this._el=n.getCanvasContainer(),this._minTouches=1,this._clickTolerance=a.clickTolerance||1,this.reset(),s.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new s.Point(0,0)}touchstart(n,a,h){return this._calculateTransform(n,a,h)}touchmove(n,a,h){if(this._active&&!(h.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(1===h.length&&!s.isFullscreen())return void this._showTouchPanBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return n.cancelable&&n.preventDefault(),this._calculateTransform(n,a,h)}}touchend(n,a,h){this._calculateTransform(n,a,h),this._active&&h.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(n,a,h){h.length>0&&(this._active=!0);const d=ls(h,a),m=new s.Point(0,0),g=new s.Point(0,0);let y=0;for(const A in d){const k=d[A],S=this._touches[A];S&&(m._add(k),g._add(k.sub(S)),y++,d[A]=k)}if(this._touches=d,y<this._minTouches||!g.mag())return;const v=g.div(y);return this._sum._add(v),this._sum.mag()<this._clickTolerance?void 0:{around:m.div(y),panDelta:v}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=dt("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")},500)}}class bo{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(n){}_move(n,a,h){return{}}touchstart(n,a,h){this._firstTwoTouches||h.length<2||(this._firstTwoTouches=[h[0].identifier,h[1].identifier],this._start([a[0],a[1]]))}touchmove(n,a,h){const d=this._firstTwoTouches;if(!d)return;n.preventDefault();const[m,g]=d,y=wo(h,a,m),v=wo(h,a,g);if(!y||!v)return;const A=this._aroundCenter?null:y.add(v).div(2);return this._move([y,v],A,n)}touchend(n,a,h){if(!this._firstTwoTouches)return;const[d,m]=this._firstTwoTouches,g=wo(h,a,d),y=wo(h,a,m);g&&y||(this._active&&ft(),this.reset())}touchcancel(){this.reset()}enable(n){this._enabled=!0,this._aroundCenter=!!n&&"center"===n.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function wo(l,n,a){for(let h=0;h<l.length;h++)if(l[h].identifier===a)return n[h]}function ml(l,n){return Math.log(l/n)/Math.LN2}class Pc extends bo{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(n){this._startDistance=this._distance=n[0].dist(n[1])}_move(n,a){const h=this._distance;if(this._distance=n[0].dist(n[1]),this._active||!(Math.abs(ml(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:ml(this._distance,h),pinchAround:a}}}function fl(l,n){return 180*l.angleWith(n)/Math.PI}class zc extends bo{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(n){this._startVector=this._vector=n[0].sub(n[1]),this._minDiameter=n[0].dist(n[1])}_move(n,a){const h=this._vector;if(this._vector=n[0].sub(n[1]),h&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:fl(this._vector,h),pinchAround:a}}_isBelowThreshold(n){this._minDiameter=Math.min(this._minDiameter,n.mag());const a=25/(Math.PI*this._minDiameter)*360,h=this._startVector;if(!h)return!1;const d=fl(n,h);return Math.abs(d)<a}}function Yr(l){return Math.abs(l.y)>Math.abs(l.x)}class Lc extends bo{constructor(n){super(),this._map=n}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(n){this._lastPoints=n,Yr(n[0].sub(n[1]))&&(this._valid=!1)}_move(n,a,h){const d=this._lastPoints;if(!d)return;const m=n[0].sub(d[0]),g=n[1].sub(d[1]);return this._map._cooperativeGestures&&!s.isFullscreen()&&h.touches.length<3||(this._valid=this.gestureBeginsVertically(m,g,h.timeStamp),!this._valid)?void 0:(this._lastPoints=n,this._active=!0,{pitchDelta:(m.y+g.y)/2*-.5})}gestureBeginsVertically(n,a,h){if(void 0!==this._valid)return this._valid;const d=n.mag()>=2,m=a.mag()>=2;if(!d&&!m)return;if(!d||!m)return null==this._firstMove&&(this._firstMove=h),h-this._firstMove<100&&void 0;const g=n.y>0==a.y>0;return Yr(n)&&Yr(a)&&g}}const Rc={panStep:100,bearingStep:15,pitchStep:10};class jh{constructor(){const n=Rc;this._panStep=n.panStep,this._bearingStep=n.bearingStep,this._pitchStep=n.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(n){if(n.altKey||n.ctrlKey||n.metaKey)return;let a=0,h=0,d=0,m=0,g=0;switch(n.keyCode){case 61:case 107:case 171:case 187:a=1;break;case 189:case 109:case 173:a=-1;break;case 37:n.shiftKey?h=-1:(n.preventDefault(),m=-1);break;case 39:n.shiftKey?h=1:(n.preventDefault(),m=1);break;case 38:n.shiftKey?d=1:(n.preventDefault(),g=-1);break;case 40:n.shiftKey?d=-1:(n.preventDefault(),g=1);break;default:return}return this._rotationDisabled&&(h=0,d=0),{cameraAnimation:y=>{const v=y.getZoom();y.easeTo({duration:300,easeId:"keyboardHandler",easing:Oc,zoom:a?Math.round(v)+a*(n.shiftKey?2:1):v,bearing:y.getBearing()+h*this._bearingStep,pitch:y.getPitch()+d*this._pitchStep,offset:[-m*this._panStep,-g*this._panStep],center:y.getCenter()},{originalEvent:n})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Oc(l){return l*(2-l)}const _l=4.000244140625;class Bc{constructor(n,a){this._map=n,this._el=n.getCanvasContainer(),this._handler=a,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,s.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(n){this._defaultZoomRate=n}setWheelZoomRate(n){this._wheelZoomRate=n}isEnabled(){return!!this._enabled}isActive(){return this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(n){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!n&&"center"===n.around,this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(n){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(n.ctrlKey||n.metaKey||this.isZooming()||s.isFullscreen()))return void this._showBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let a=n.deltaMode===s.window.WheelEvent.DOM_DELTA_LINE?40*n.deltaY:n.deltaY;const h=s.exported.now(),d=h-(this._lastWheelEventTime||0);this._lastWheelEventTime=h,0!==a&&a%_l==0?this._type="wheel":0!==a&&Math.abs(a)<4?this._type="trackpad":d>400?(this._type=null,this._lastValue=a,this._timeout=setTimeout(this._onTimeout,40,n)):this._type||(this._type=Math.abs(d*a)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,a+=this._lastValue)),n.shiftKey&&a&&(a/=4),this._type&&(this._lastWheelEvent=n,this._delta-=a,this._active||this._start(n)),n.preventDefault()}_onTimeout(n){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(n)}_start(n){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const a=bt(this._el,n);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:a,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const n=this._map.transform;"wheel"===this._type&&n.projection.wrap&&(n._center.lng>=180||n._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const a=()=>n._terrainEnabled()&&this._aroundCoord?n.computeZoomRelativeTo(this._aroundCoord):n.zoom;if(0!==this._delta){const v="wheel"===this._type&&Math.abs(this._delta)>_l?this._wheelZoomRate:this._defaultZoomRate;let A=2/(1+Math.exp(-Math.abs(this._delta*v)));this._delta<0&&0!==A&&(A=1/A);const k=a(),S=Math.pow(2,k),U="number"==typeof this._targetZoom?n.zoomScale(this._targetZoom):S;this._targetZoom=Math.min(n.maxZoom,Math.max(n.minZoom,n.scaleZoom(U*A))),"wheel"===this._type&&(this._startZoom=k,this._easing=this._smoothOutEasing(200)),this._delta=0}const h="number"==typeof this._targetZoom?this._targetZoom:a(),d=this._startZoom,m=this._easing;let g,y=!1;if("wheel"===this._type&&d&&m){const v=Math.min((s.exported.now()-this._lastWheelEventTime)/200,1),A=m(v);g=s.number(d,h,A),v<1?this._frameId||(this._frameId=!0):y=!0}else g=h,y=!0;return this._active=!0,y&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!y,zoomDelta:g-a(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(n){let a=s.ease;if(this._prevEase){const h=this._prevEase,d=(s.exported.now()-h.start)/h.duration,m=h.easing(d+.01)-h.easing(d),g=.27/Math.sqrt(m*m+1e-4)*.01,y=Math.sqrt(.0729-g*g);a=s.bezier(g,y,.25,1)}return this._prevEase={start:s.exported.now(),duration:n,easing:a},a}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=dt("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(s.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")},200)}}class Fc{constructor(n,a){this._clickZoom=n,this._tapZoom=a}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class gn{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(n,a){return n.preventDefault(),{cameraAnimation:h=>{h.easeTo({duration:300,zoom:h.getZoom()+(n.shiftKey?-1:1),around:h.unproject(a)},{originalEvent:n})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Zh{constructor(){this._tap=new hl({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(n,a,h){this._swipePoint||(this._tapTime&&n.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?h.length>0&&(this._swipePoint=a[0],this._swipeTouch=h[0].identifier):this._tap.touchstart(n,a,h))}touchmove(n,a,h){if(this._tapTime){if(this._swipePoint){if(h[0].identifier!==this._swipeTouch)return;const d=a[0],m=d.y-this._swipePoint.y;return this._swipePoint=d,n.preventDefault(),this._active=!0,{zoomDelta:m/128}}}else this._tap.touchmove(n,a,h)}touchend(n,a,h){this._tapTime?this._swipePoint&&0===h.length&&this.reset():this._tap.touchend(n,a,h)&&(this._tapTime=n.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Uc{constructor(n,a,h){this._el=n,this._mousePan=a,this._touchPan=h}enable(n){this._inertiaOptions=n||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Gh{constructor(n,a,h){this._pitchWithRotate=n.pitchWithRotate,this._mouseRotate=a,this._mousePitch=h}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class qh{constructor(n,a,h,d){this._el=n,this._touchZoom=a,this._touchRotate=h,this._tapDragZoom=d,this._rotationDisabled=!1,this._enabled=!0}enable(n){this._touchZoom.enable(n),this._rotationDisabled||this._touchRotate.enable(n),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const ir=l=>l.zoom||l.drag||l.pitch||l.rotate;class Vc extends s.Event{}class $h{constructor(){this.constants=[1,1,.01],this.radius=0}setup(n,a){const h=s.sub([],a,n);this.radius=s.length(h[2]<0?s.div([],h,this.constants):[h[0],h[1],0])}projectRay(n){s.div(n,n,this.constants),s.normalize(n,n),s.mul$1(n,n,this.constants);const a=s.scale$2([],n,this.radius);if(a[2]>0){const h=s.scale$2([],[0,0,1],s.dot(a,[0,0,1])),d=s.scale$2([],s.normalize([],[a[0],a[1],0]),this.radius),m=s.add([],a,s.scale$2([],s.sub([],s.add([],d,h),a),2));a[0]=m[0],a[1]=m[1]}return a}}function ur(l){return l.panDelta&&l.panDelta.mag()||l.zoomDelta||l.bearingDelta||l.pitchDelta}class vr{constructor(n,a){this._map=n,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Dc(n),this._bearingSnap=a.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new $h,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(a),s.bindAll(["handleEvent","handleWindowEvent"],this);const h=this._el;this._listeners=[[h,"touchstart",{passive:!0}],[h,"touchmove",{passive:!1}],[h,"touchend",void 0],[h,"touchcancel",void 0],[h,"mousedown",void 0],[h,"mousemove",void 0],[h,"mouseup",void 0],[s.window.document,"mousemove",{capture:!0}],[s.window.document,"mouseup",void 0],[h,"mouseover",void 0],[h,"mouseout",void 0],[h,"dblclick",void 0],[h,"click",void 0],[h,"keydown",{capture:!1}],[h,"keyup",void 0],[h,"wheel",{passive:!1}],[h,"contextmenu",void 0],[s.window,"blur",void 0]];for(const[d,m,g]of this._listeners)d.addEventListener(m,d===s.window.document?this.handleWindowEvent:this.handleEvent,g)}destroy(){for(const[n,a,h]of this._listeners)n.removeEventListener(a,n===s.window.document?this.handleWindowEvent:this.handleEvent,h)}_addDefaultHandlers(n){const a=this._map,h=a.getCanvasContainer();this._add("mapEvent",new cl(a,n));const d=a.boxZoom=new Ic(a,n);this._add("boxZoom",d);const m=new Nh,g=new gn;a.doubleClickZoom=new Fc(g,m),this._add("tapZoom",m),this._add("clickZoom",g);const y=new Zh;this._add("tapDragZoom",y);const v=a.touchPitch=new Lc(a);this._add("touchPitch",v);const A=new dl(n),k=new pl(n);a.dragRotate=new Gh(n,A,k),this._add("mouseRotate",A,["mousePitch"]),this._add("mousePitch",k,["mouseRotate"]);const S=new ul(n),U=new cs(a,n);a.dragPan=new Uc(h,S,U),this._add("mousePan",S),this._add("touchPan",U,["touchZoom","touchRotate"]);const j=new zc,G=new Pc;a.touchZoomRotate=new qh(h,G,j,y),this._add("touchRotate",j,["touchPan","touchZoom"]),this._add("touchZoom",G,["touchPan","touchRotate"]),this._add("blockableMapEvent",new ss(a));const Z=a.scrollZoom=new Bc(a,this);this._add("scrollZoom",Z,["mousePan"]);const $=a.keyboard=new jh;this._add("keyboard",$);for(const P of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])n.interactive&&n[P]&&a[P].enable(n[P])}_add(n,a,h){this._handlers.push({handlerName:n,handler:a,allowed:h}),this._handlersById[n]=a}stop(n){if(!this._updatingCamera){for(const{handler:a}of this._handlers)a.reset();this._inertia.clear(),this._fireEvents({},{},n),this._changes=[]}}isActive(){for(const{handler:n}of this._handlers)if(n.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!ir(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(n,a,h){for(const d in n)if(d!==h&&(!a||a.indexOf(d)<0))return!0;return!1}handleWindowEvent(n){this.handleEvent(n,`${n.type}Window`)}_getMapTouches(n){const a=[];for(const h of n)this._el.contains(h.target)&&a.push(h);return a}handleEvent(n,a){this._updatingCamera=!0;const h="renderFrame"===n.type,d=h?void 0:n,m={needsRenderFrame:!1},g={},y={},v=n.touches?this._getMapTouches(n.touches):void 0,A=v?Gt(this._el,v):h?void 0:bt(this._el,n);for(const{handlerName:U,handler:j,allowed:G}of this._handlers){if(!j.isEnabled())continue;let Z;this._blockedByActive(y,G,U)?j.reset():j[a||n.type]&&(Z=j[a||n.type](n,A,v),this.mergeHandlerResult(m,g,Z,U,d),Z&&Z.needsRenderFrame&&this._triggerRenderFrame()),(Z||j.isActive())&&(y[U]=j)}const k={};for(const U in this._previousActiveHandlers)y[U]||(k[U]=d);this._previousActiveHandlers=y,(Object.keys(k).length||ur(m))&&(this._changes.push([m,g,k]),this._triggerRenderFrame()),(Object.keys(y).length||ur(m))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:S}=m;S&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],S(this._map))}mergeHandlerResult(n,a,h,d,m){if(!h)return;s.extend(n,h);const g={handlerName:d,originalEvent:h.originalEvent||m};void 0!==h.zoomDelta&&(a.zoom=g),void 0!==h.panDelta&&(a.drag=g),void 0!==h.pitchDelta&&(a.pitch=g),void 0!==h.bearingDelta&&(a.rotate=g)}_applyChanges(){const n={},a={},h={};for(const[d,m,g]of this._changes)d.panDelta&&(n.panDelta=(n.panDelta||new s.Point(0,0))._add(d.panDelta)),d.zoomDelta&&(n.zoomDelta=(n.zoomDelta||0)+d.zoomDelta),d.bearingDelta&&(n.bearingDelta=(n.bearingDelta||0)+d.bearingDelta),d.pitchDelta&&(n.pitchDelta=(n.pitchDelta||0)+d.pitchDelta),void 0!==d.around&&(n.around=d.around),void 0!==d.aroundCoord&&(n.aroundCoord=d.aroundCoord),void 0!==d.pinchAround&&(n.pinchAround=d.pinchAround),d.noInertia&&(n.noInertia=d.noInertia),s.extend(a,m),s.extend(h,g);this._updateMapTransform(n,a,h),this._changes=[]}_updateMapTransform(n,a,h){const d=this._map,m=d.transform,g=N=>[N.x,N.y,N.z];if((N=>{const X=this._eventsInProgress.drag;return X&&!this._handlersById[X.handlerName].isActive()})()&&!ur(n)){const N=m.zoom;m.cameraElevationReference="sea",m.recenterOnTerrain(),m.cameraElevationReference="ground",N!==m.zoom&&this._map._update(!0)}if(m._isCameraConstrained&&d._stop(!0),!ur(n))return void this._fireEvents(a,h,!0);let{panDelta:y,zoomDelta:v,bearingDelta:A,pitchDelta:k,around:S,aroundCoord:U,pinchAround:j}=n;m._isCameraConstrained&&(v>0&&(v=0),m._isCameraConstrained=!1),void 0!==j&&(S=j),(v||(N=>a[N]&&!this._eventsInProgress[N])("drag"))&&S&&(this._dragOrigin=g(m.pointCoordinate3D(S)),this._trackingEllipsoid.setup(m._camera.position,this._dragOrigin)),m.cameraElevationReference="sea",d._stop(!0),S=S||d.transform.centerPoint,A&&(m.bearing+=A),k&&(m.pitch+=k),m._updateCameraState();const G=[0,0,0];if(y)if("mercator"===m.projection.name){const N=this._trackingEllipsoid.projectRay(m.screenPointToMercatorRay(S).dir),X=this._trackingEllipsoid.projectRay(m.screenPointToMercatorRay(S.sub(y)).dir);G[0]=X[0]-N[0],G[1]=X[1]-N[1]}else{const N=m.pointCoordinate(S);if("globe"===m.projection.name){y=y.rotate(-m.angle);const X=m._pixelsPerMercatorPixel/m.worldSize;G[0]=-y.x*s.mercatorScale(s.latFromMercatorY(N.y))*X,G[1]=-y.y*s.mercatorScale(m.center.lat)*X}else{const X=m.pointCoordinate(S.sub(y));N&&X&&(G[0]=X.x-N.x,G[1]=X.y-N.y)}}const Z=m.zoom,$=[0,0,0];if(v){const N=g(U||m.pointCoordinate3D(S)),X={dir:s.normalize([],s.sub([],N,m._camera.position))};if(X.dir[2]<0){const J=m.zoomDeltaToMovement(N,v);s.scale$2($,X.dir,J)}}const P=s.add(G,G,$);m._translateCameraConstrained(P),v&&Math.abs(m.zoom-Z)>1e-4&&m.recenterOnTerrain(),m.cameraElevationReference="ground",this._map._update(),n.noInertia||this._inertia.record(n),this._fireEvents(a,h,!0)}_fireEvents(n,a,h){const d=ir(this._eventsInProgress),m=ir(n),g={};for(const k in n){const{originalEvent:S}=n[k];this._eventsInProgress[k]||(g[`${k}start`]=S),this._eventsInProgress[k]=n[k]}!d&&m&&this._fireEvent("movestart",m.originalEvent);for(const k in g)this._fireEvent(k,g[k]);m&&this._fireEvent("move",m.originalEvent);for(const k in n){const{originalEvent:S}=n[k];this._fireEvent(k,S)}const y={};let v;for(const k in this._eventsInProgress){const{handlerName:S,originalEvent:U}=this._eventsInProgress[k];this._handlersById[S].isActive()||(delete this._eventsInProgress[k],v=a[S]||U,y[`${k}end`]=v)}for(const k in y)this._fireEvent(k,y[k]);const A=ir(this._eventsInProgress);if(h&&(d||m)&&!A){this._updatingCamera=!0;const k=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),S=U=>0!==U&&-this._bearingSnap<U&&U<this._bearingSnap;k?(S(k.bearing||this._map.getBearing())&&(k.bearing=0),this._map.easeTo(k,{originalEvent:v})):(this._map.fire(new s.Event("moveend",{originalEvent:v})),S(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(n,a){this._map.fire(new s.Event(n,a?{originalEvent:a}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(n=>{this._frameId=void 0,this.handleEvent(new Vc("renderFrame",{timeStamp:n})),this._applyChanges()})}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}const da="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class hs extends s.Evented{constructor(n,a){super(),this._moving=!1,this._zooming=!1,this.transform=n,this._bearingSnap=a.bearingSnap,this._respectPrefersReducedMotion=!1!==a.respectPrefersReducedMotion,s.bindAll(["_renderFrameCallback"],this)}getCenter(){return new s.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(n,a){return this.jumpTo({center:n},a)}panBy(n,a,h){return n=s.Point.convert(n).mult(-1),this.panTo(this.transform.center,s.extend({offset:n},a),h)}panTo(n,a,h){return this.easeTo(s.extend({center:n},a),h)}getZoom(){return this.transform.zoom}setZoom(n,a){return this.jumpTo({zoom:n},a),this}zoomTo(n,a,h){return this.easeTo(s.extend({zoom:n},a),h)}zoomIn(n,a){return this.zoomTo(this.getZoom()+1,n,a),this}zoomOut(n,a){return this.zoomTo(this.getZoom()-1,n,a),this}getBearing(){return this.transform.bearing}setBearing(n,a){return this.jumpTo({bearing:n},a),this}getPadding(){return this.transform.padding}setPadding(n,a){return this.jumpTo({padding:n},a),this}rotateTo(n,a,h){return this.easeTo(s.extend({bearing:n},a),h)}resetNorth(n,a){return this.rotateTo(0,s.extend({duration:1e3},n),a),this}resetNorthPitch(n,a){return this.easeTo(s.extend({bearing:0,pitch:0,duration:1e3},n),a),this}snapToNorth(n,a){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(n,a):this}getPitch(){return this.transform.pitch}setPitch(n,a){return this.jumpTo({pitch:n},a),this}cameraForBounds(n,a){n=s.LngLatBounds.convert(n);const h=a&&a.bearing||0,d=a&&a.pitch||0,m=n.getNorthWest(),g=n.getSouthEast();return this._cameraForBounds(this.transform,m,g,h,d,a)}_extendCameraOptions(n){const a={top:0,bottom:0,right:0,left:0};if("number"==typeof(n=s.extend({padding:a,offset:[0,0],maxZoom:this.transform.maxZoom},n)).padding){const h=n.padding;n.padding={top:h,bottom:h,right:h,left:h}}return n.padding=s.extend(a,n.padding),n}_minimumAABBFrustumDistance(n,a){const h=a.max[0]-a.min[0],d=a.max[1]-a.min[1];return h/d>n.aspect?h/(2*Math.tan(.5*n.fovX)*n.aspect):d/(2*Math.tan(.5*n.fovY)*n.aspect)}_cameraForBoundsOnGlobe(n,a,h,d,m,g){const y=n.clone(),v=this._extendCameraOptions(g);y.bearing=d,y.pitch=m;const A=s.LngLat.convert(a),k=s.LngLat.convert(h),S=.5*(A.lat+k.lat),U=.5*(A.lng+k.lng),j=s.latLngToECEF(S,U),G=s.normalize([],j),Z=s.normalize([],s.cross([],G,[0,1,0])),$=s.cross([],Z,G),P=[Z[0],Z[1],Z[2],0,$[0],$[1],$[2],0,G[0],G[1],G[2],0,0,0,0,1],N=[j,s.latLngToECEF(A.lat,A.lng),s.latLngToECEF(k.lat,A.lng),s.latLngToECEF(k.lat,k.lng),s.latLngToECEF(A.lat,k.lng),s.latLngToECEF(S,A.lng),s.latLngToECEF(S,k.lng),s.latLngToECEF(A.lat,U),s.latLngToECEF(k.lat,U)];let X=s.Aabb.fromPoints(N.map(Be=>[s.dot(Z,Be),s.dot($,Be),s.dot(G,Be)]));const J=s.transformMat4([],X.center,P);0===s.squaredLength(J)&&s.set(J,0,0,1),s.normalize(J,J),s.scale$2(J,J,s.GLOBE_RADIUS),y.center=s.ecefToLatLng(J);const oe=y.getWorldToCameraMatrix(),ce=s.invert(new Float64Array(16),oe);X=s.Aabb.applyTransform(X,s.multiply([],oe,P)),s.transformMat4(J,J,oe);const le=.5*(X.max[2]-X.min[2]),pe=this._minimumAABBFrustumDistance(y,X),de=s.scale$2([],[0,0,1],le),ve=s.add(de,J,de),qe=pe+(0===y.pitch?0:s.distance(J,ve)),_e=y.globeCenterInViewSpace,Le=s.sub([],J,[_e[0],_e[1],_e[2]]);s.normalize(Le,Le),s.scale$2(Le,Le,qe);const we=s.add([],J,Le);s.transformMat4(we,we,ce);const Ze=s.earthRadius/s.GLOBE_RADIUS,ye=s.length(we),ze=s.mercatorZfromAltitude(Math.max(ye*Ze-s.earthRadius,Number.EPSILON),0),We=Math.min(y.zoomFromMercatorZAdjusted(ze),v.maxZoom);return We>.5*(s.GLOBE_ZOOM_THRESHOLD_MIN+s.GLOBE_ZOOM_THRESHOLD_MAX)?(y.setProjection({name:"mercator"}),y.zoom=We,this._cameraForBounds(y,a,h,d,m,g)):{center:y.center,zoom:We,bearing:d,pitch:m}}queryTerrainElevation(n,a){const h=this.transform.elevation;return h?(a=s.extend({},{exaggerated:!0},a),h.getAtPoint(s.MercatorCoordinate.fromLngLat(n),null,a.exaggerated)):null}_cameraForBounds(n,a,h,d,m,g){if("globe"===n.projection.name)return this._cameraForBoundsOnGlobe(n,a,h,d,m,g);const y=n.clone(),v=this._extendCameraOptions(g),A=y.padding;y.bearing=d,y.pitch=m;const k=s.LngLat.convert(a),S=s.LngLat.convert(h),U=new s.LngLat(k.lng,S.lat),j=new s.LngLat(S.lng,k.lat),G=y.project(k),Z=y.project(S),$=this.queryTerrainElevation(k),P=this.queryTerrainElevation(S),N=this.queryTerrainElevation(U),X=this.queryTerrainElevation(j),J=[[G.x,G.y,Math.min($||0,P||0,N||0,X||0)],[Z.x,Z.y,Math.max($||0,P||0,N||0,X||0)]];let oe=s.Aabb.fromPoints(J);const ce=y.getWorldToCameraMatrix(),le=s.invert(new Float64Array(16),ce);oe=s.Aabb.applyTransform(oe,ce);const pe=s.sub([],oe.max,oe.min),de=A.left||0,ve=A.right||0,qe=A.bottom||0,_e=A.top||0,{left:Le,right:we,top:Ze,bottom:ye}=v.padding,ze=.5*(de+ve),We=.5*(_e+qe),Be=Math.min(y.scaleZoom(y.scale*Math.min((y.width-(de+ve+Le+we))/pe[0],(y.height-(qe+_e+ye+Ze))/pe[1])),v.maxZoom),He=y.scale/y.zoomScale(Be);oe=new s.Aabb([oe.min[0]-(Le+ze)*He,oe.min[1]-(ye+We)*He,oe.min[2]],[oe.max[0]+(we+ze)*He,oe.max[1]+(Ze+We)*He,oe.max[2]]);const gt=.5*pe[2],St=this._minimumAABBFrustumDistance(y,oe),ht=[0,0,1,0];s.transformMat4$1(ht,ht,ce),s.normalize$2(ht,ht);const Et=s.scale$2([],ht,St+gt),Wt=s.add([],oe.center,Et),qt=("number"==typeof v.offset.x&&"number"==typeof v.offset.y?new s.Point(v.offset.x,v.offset.y):s.Point.convert(v.offset)).rotate(-s.degToRad(d));oe.center[0]-=qt.x*He,oe.center[1]+=qt.y*He,s.transformMat4(oe.center,oe.center,le),s.transformMat4(Wt,Wt,le);const pt=[oe.center[0],oe.center[1],Wt[2]*y.pixelsPerMeter];s.scale$2(pt,pt,1/y.worldSize);const hi=s.lngFromMercatorX(pt[0]),fi=s.latFromMercatorY(pt[1]),_i=Math.min(y._zoomFromMercatorZ(pt[2]),v.maxZoom),gi=new s.LngLat(hi,fi);return y.mercatorFromTransition&&_i<.5*(s.GLOBE_ZOOM_THRESHOLD_MIN+s.GLOBE_ZOOM_THRESHOLD_MAX)?(y.setProjection({name:"globe"}),y.zoom=_i,this._cameraForBounds(y,a,h,d,m,g)):{center:gi,zoom:_i,bearing:d,pitch:m}}fitBounds(n,a,h){const d=this.cameraForBounds(n,a);return this._fitInternal(d,a,h)}fitScreenCoordinates(n,a,h,d,m){const g=s.Point.convert(n),y=s.Point.convert(a),v=new s.Point(Math.min(g.x,y.x),Math.min(g.y,y.y)),A=new s.Point(Math.max(g.x,y.x),Math.max(g.y,y.y));if("mercator"===this.transform.projection.name&&this.transform.anyCornerOffEdge(g,y))return this;const k=this.transform.pointLocation3D(v),S=this.transform.pointLocation3D(A),U=this.transform.pointLocation3D(new s.Point(v.x,A.y)),j=this.transform.pointLocation3D(new s.Point(A.x,v.y)),G=[Math.min(k.lng,S.lng,U.lng,j.lng),Math.min(k.lat,S.lat,U.lat,j.lat)],Z=[Math.max(k.lng,S.lng,U.lng,j.lng),Math.max(k.lat,S.lat,U.lat,j.lat)],$=d&&d.pitch?d.pitch:this.getPitch(),P=this._cameraForBounds(this.transform,G,Z,h,$,d);return this._fitInternal(P,d,m)}_fitInternal(n,a,h){return n?(delete(a=s.extend(n,a)).padding,a.linear?this.easeTo(a,h):this.flyTo(a,h)):this}jumpTo(n,a){this.stop();const h=n.preloadOnly?this.transform.clone():this.transform;let d=!1,m=!1,g=!1;return"zoom"in n&&h.zoom!==+n.zoom&&(d=!0,h.zoom=+n.zoom),void 0!==n.center&&(h.center=s.LngLat.convert(n.center)),"bearing"in n&&h.bearing!==+n.bearing&&(m=!0,h.bearing=+n.bearing),"pitch"in n&&h.pitch!==+n.pitch&&(g=!0,h.pitch=+n.pitch),null==n.padding||h.isPaddingEqual(n.padding)||(h.padding=n.padding),n.preloadOnly?(this._preloadTiles(h),this):(this.fire(new s.Event("movestart",a)).fire(new s.Event("move",a)),d&&this.fire(new s.Event("zoomstart",a)).fire(new s.Event("zoom",a)).fire(new s.Event("zoomend",a)),m&&this.fire(new s.Event("rotatestart",a)).fire(new s.Event("rotate",a)).fire(new s.Event("rotateend",a)),g&&this.fire(new s.Event("pitchstart",a)).fire(new s.Event("pitch",a)).fire(new s.Event("pitchend",a)),this.fire(new s.Event("moveend",a)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||s.warnOnce(da),this.transform.getFreeCameraOptions()}setFreeCameraOptions(n,a){const h=this.transform;if(!h.projection.supportsFreeCamera)return s.warnOnce(da),this;this.stop();const d=h.zoom,m=h.pitch,g=h.bearing;h.setFreeCameraOptions(n);const y=d!==h.zoom,v=m!==h.pitch,A=g!==h.bearing;return this.fire(new s.Event("movestart",a)).fire(new s.Event("move",a)),y&&this.fire(new s.Event("zoomstart",a)).fire(new s.Event("zoom",a)).fire(new s.Event("zoomend",a)),A&&this.fire(new s.Event("rotatestart",a)).fire(new s.Event("rotate",a)).fire(new s.Event("rotateend",a)),v&&this.fire(new s.Event("pitchstart",a)).fire(new s.Event("pitch",a)).fire(new s.Event("pitchend",a)),this.fire(new s.Event("moveend",a)),this}easeTo(n,a){this._stop(!1,n.easeId),(!1===(n=s.extend({offset:[0,0],duration:500,easing:s.ease},n)).animate||this._prefersReducedMotion(n))&&(n.duration=0);const h=this.transform,d=this.getZoom(),m=this.getBearing(),g=this.getPitch(),y=this.getPadding(),v="zoom"in n?+n.zoom:d,A="bearing"in n?this._normalizeBearing(n.bearing,m):m,k="pitch"in n?+n.pitch:g,S="padding"in n?n.padding:h.padding,U=s.Point.convert(n.offset);let j,G,Z;if("globe"===h.projection.name){const de=s.MercatorCoordinate.fromLngLat(h.center),ve=U.rotate(-h.angle);de.x+=ve.x/h.worldSize,de.y+=ve.y/h.worldSize;const qe=de.toLngLat(),_e=s.LngLat.convert(n.center||qe);this._normalizeCenter(_e),j=h.centerPoint.add(ve),G=new s.Point(de.x,de.y).mult(h.worldSize),Z=new s.Point(s.mercatorXfromLng(_e.lng),s.mercatorYfromLat(_e.lat)).mult(h.worldSize).sub(G)}else{j=h.centerPoint.add(U);const de=h.pointLocation(j),ve=s.LngLat.convert(n.center||de);this._normalizeCenter(ve),G=h.project(de),Z=h.project(ve).sub(G)}const $=h.zoomScale(v-d);let P,N;n.around&&(P=s.LngLat.convert(n.around),N=h.locationPoint(P));const X=this._zooming||v!==d,J=this._rotating||m!==A,oe=this._pitching||k!==g,ce=!h.isPaddingEqual(S),le=de=>ve=>{if(X&&(de.zoom=s.number(d,v,ve)),J&&(de.bearing=s.number(m,A,ve)),oe&&(de.pitch=s.number(g,k,ve)),ce&&(de.interpolatePadding(y,S,ve),j=de.centerPoint.add(U)),P)de.setLocationAtPoint(P,N);else{const qe=de.zoomScale(de.zoom-d),_e=v>d?Math.min(2,$):Math.max(.5,$),Le=Math.pow(_e,1-ve),we=de.unproject(G.add(Z.mult(ve*Le)).mult(qe));de.setLocationAtPoint(de.renderWorldCopies?we.wrap():we,j)}return n.preloadOnly||this._fireMoveEvents(a),de};if(n.preloadOnly){const de=this._emulate(le,n.duration,h);return this._preloadTiles(de),this}const pe={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=X,this._rotating=J,this._pitching=oe,this._padding=ce,this._easeId=n.easeId,this._prepareEase(a,n.noMoveStart,pe),this._ease(le(h),de=>{h.recenterOnTerrain(),this._afterEase(a,de)},n),this}_prepareEase(n,a,h={}){this._moving=!0,this.transform.cameraElevationReference="sea",a||h.moving||this.fire(new s.Event("movestart",n)),this._zooming&&!h.zooming&&this.fire(new s.Event("zoomstart",n)),this._rotating&&!h.rotating&&this.fire(new s.Event("rotatestart",n)),this._pitching&&!h.pitching&&this.fire(new s.Event("pitchstart",n))}_fireMoveEvents(n){this.fire(new s.Event("move",n)),this._zooming&&this.fire(new s.Event("zoom",n)),this._rotating&&this.fire(new s.Event("rotate",n)),this._pitching&&this.fire(new s.Event("pitch",n))}_afterEase(n,a){if(this._easeId&&a&&this._easeId===a)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const h=this._zooming,d=this._rotating,m=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,h&&this.fire(new s.Event("zoomend",n)),d&&this.fire(new s.Event("rotateend",n)),m&&this.fire(new s.Event("pitchend",n)),this.fire(new s.Event("moveend",n))}flyTo(n,a){if(this._prefersReducedMotion(n)){const Be=s.pick(n,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Be,a)}this.stop(),n=s.extend({offset:[0,0],speed:1.2,curve:1.42,easing:s.ease},n);const h=this.transform,d=this.getZoom(),m=this.getBearing(),g=this.getPitch(),y=this.getPadding(),v="zoom"in n?s.clamp(+n.zoom,h.minZoom,h.maxZoom):d,A="bearing"in n?this._normalizeBearing(n.bearing,m):m,k="pitch"in n?+n.pitch:g,S="padding"in n?n.padding:h.padding,U=h.zoomScale(v-d),j=s.Point.convert(n.offset);let G=h.centerPoint.add(j);const Z=h.pointLocation(G),$=s.LngLat.convert(n.center||Z);this._normalizeCenter($);const P=h.project(Z),N=h.project($).sub(P);let X=n.curve;const J=Math.max(h.width,h.height),oe=J/U,ce=N.mag();if("minZoom"in n){const Be=s.clamp(Math.min(n.minZoom,d,v),h.minZoom,h.maxZoom),He=J/h.zoomScale(Be-d);X=Math.sqrt(He/ce*2)}const le=X*X;function pe(Be){const He=(oe*oe-J*J+(Be?-1:1)*le*le*ce*ce)/(2*(Be?oe:J)*le*ce);return Math.log(Math.sqrt(He*He+1)-He)}function de(Be){return(Math.exp(Be)-Math.exp(-Be))/2}function ve(Be){return(Math.exp(Be)+Math.exp(-Be))/2}const qe=pe(0);let _e=function(Be){return ve(qe)/ve(qe+X*Be)},Le=function(Be){return J*((ve(qe)*(de(He=qe+X*Be)/ve(He))-de(qe))/le)/ce;var He},we=(pe(1)-qe)/X;if(Math.abs(ce)<1e-6||!isFinite(we)){if(Math.abs(J-oe)<1e-6)return this.easeTo(n,a);const Be=oe<J?-1:1;we=Math.abs(Math.log(oe/J))/X,Le=function(){return 0},_e=function(He){return Math.exp(Be*X*He)}}n.duration="duration"in n?+n.duration:1e3*we/("screenSpeed"in n?+n.screenSpeed/X:+n.speed),n.maxDuration&&n.duration>n.maxDuration&&(n.duration=0);const Ze=m!==A,ye=k!==g,ze=!h.isPaddingEqual(S),We=Be=>He=>{const gt=He*we,St=1/_e(gt);Be.zoom=1===He?v:d+Be.scaleZoom(St),Ze&&(Be.bearing=s.number(m,A,He)),ye&&(Be.pitch=s.number(g,k,He)),ze&&(Be.interpolatePadding(y,S,He),G=Be.centerPoint.add(j));const ht=1===He?$:Be.unproject(P.add(N.mult(Le(gt))).mult(St));return Be.setLocationAtPoint(Be.renderWorldCopies?ht.wrap():ht,G),Be._updateCameraOnTerrain(),n.preloadOnly||this._fireMoveEvents(a),Be};if(n.preloadOnly){const Be=this._emulate(We,n.duration,h);return this._preloadTiles(Be),this}return this._zooming=!0,this._rotating=Ze,this._pitching=ye,this._padding=ze,this._prepareEase(a,!1),this._ease(We(h),()=>this._afterEase(a),n),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(n,a){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const h=this._onEaseEnd;this._onEaseEnd=void 0,h.call(this,a)}if(!n){const h=this.handlers;h&&h.stop(!1)}return this}_ease(n,a,h){!1===h.animate||0===h.duration?(n(1),a()):(this._easeStart=s.exported.now(),this._easeOptions=h,this._onEaseFrame=n,this._onEaseEnd=a,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const n=Math.min((s.exported.now()-this._easeStart)/this._easeOptions.duration,1),a=this._onEaseFrame;a&&a(this._easeOptions.easing(n)),n<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(n,a){n=s.wrap(n,-180,180);const h=Math.abs(n-a);return Math.abs(n-360-a)<h&&(n-=360),Math.abs(n+360-a)<h&&(n+=360),n}_normalizeCenter(n){const a=this.transform;if(!a.renderWorldCopies||a.maxBounds)return;const h=n.lng-a.center.lng;n.lng+=h>180?-360:h<-180?360:0}_prefersReducedMotion(n){return this._respectPrefersReducedMotion&&s.exported.prefersReducedMotion&&!(n&&n.essential)}_emulate(n,a,h){const d=Math.ceil(15*a/1e3),m=[],g=n(h.clone());for(let y=0;y<=d;y++){const v=g(y/d);m.push(v.clone())}return m}}class ct{constructor(n={}){this.options=n,s.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(n){const a=this.options&&this.options.compact;return this._map=n,this._container=dt("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=dt("button","mapboxgl-ctrl-attrib-button",this._container),dt("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=dt("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),a&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===a&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(n,a){const h=this._map._getUIString(`AttributionControl.${a}`);n.setAttribute("aria-label",h),n.removeAttribute("title"),n.firstElementChild&&n.firstElementChild.setAttribute("title",h)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let n=this._editLink;n||(n=this._editLink=this._container.querySelector(".mapbox-improve-map"));const a=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||s.config.ACCESS_TOKEN}];if(n){const h=a.reduce((d,m,g)=>(m.value&&(d+=`${m.key}=${m.value}${g<a.length-1?"&":""}`),d),"?");n.href=`${s.config.FEEDBACK_URL}/${h}#${_o(this._map,!0)}`,n.rel="noopener nofollow",this._setElementTitle(n,"MapFeedback")}}_updateData(n){!n||"metadata"!==n.sourceDataType&&"visibility"!==n.sourceDataType&&"style"!==n.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let n=[];if(this._map.style.stylesheet){const d=this._map.style.stylesheet;this.styleOwner=d.owner,this.styleId=d.id}const a=this._map.style._sourceCaches;for(const d in a){const m=a[d];if(m.used){const g=m.getSource();g.attribution&&n.indexOf(g.attribution)<0&&n.push(g.attribution)}}n.sort((d,m)=>d.length-m.length),n=n.filter((d,m)=>{for(let g=m+1;g<n.length;g++)if(n[g].indexOf(d)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?n=[...this.options.customAttribution,...n]:n.unshift(this.options.customAttribution));const h=n.join(" | ");h!==this._attribHTML&&(this._attribHTML=h,n.length?(this._innerContainer.innerHTML=h,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class gl{constructor(){s.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(n){this._map=n,this._container=dt("div","mapboxgl-ctrl");const a=dt("a","mapboxgl-ctrl-logo");return a.target="_blank",a.rel="noopener nofollow",a.href="https://www.mapbox.com/",a.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),a.setAttribute("rel","noopener nofollow"),this._container.appendChild(a),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(n){n&&"metadata"!==n.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const n=this._map.style._sourceCaches;if(0===Object.entries(n).length)return!0;for(const a in n){const h=n[a].getSource();if(h.hasOwnProperty("mapbox_logo")&&!h.mapbox_logo)return!1}return!0}_updateCompact(){const n=this._container.children;if(n.length){const a=n[0];this._map.getCanvasContainer().offsetWidth<250?a.classList.add("mapboxgl-compact"):a.classList.remove("mapboxgl-compact")}}}class yl{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(n){const a=++this._id;return this._queue.push({callback:n,id:a,cancelled:!1}),a}remove(n){const a=this._currentlyRunning,h=a?this._queue.concat(a):this._queue;for(const d of h)if(d.id===n)return void(d.cancelled=!0)}run(n=0){const a=this._currentlyRunning=this._queue;this._queue=[];for(const h of a)if(!h.cancelled&&(h.callback(n),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function Fa(l,n,a){if(l=new s.LngLat(l.lng,l.lat),n){const h=new s.LngLat(l.lng-360,l.lat),d=new s.LngLat(l.lng+360,l.lat),m=360*Math.ceil(Math.abs(l.lng-a.center.lng)/360),g=a.locationPoint(l).distSqr(n),y=n.x<0||n.y<0||n.x>a.width||n.y>a.height;a.locationPoint(h).distSqr(n)<g&&(y||Math.abs(h.lng-a.center.lng)<m)?l=h:a.locationPoint(d).distSqr(n)<g&&(y||Math.abs(d.lng-a.center.lng)<m)&&(l=d)}for(;Math.abs(l.lng-a.center.lng)>180;){const h=a.locationPoint(l);if(h.x>=0&&h.y>=0&&h.x<=a.width&&h.y<=a.height)break;l.lng>a.center.lng?l.lng-=360:l.lng+=360}return l}const pa={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class it extends s.Evented{constructor(n,a){if(super(),(n instanceof s.window.HTMLElement||a)&&(n=s.extend({element:n},a)),s.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=n&&n.anchor||"center",this._color=n&&n.color||"#3FB1CE",this._scale=n&&n.scale||1,this._draggable=n&&n.draggable||!1,this._clickTolerance=n&&n.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=n&&n.rotation||0,this._rotationAlignment=n&&n.rotationAlignment||"auto",this._pitchAlignment=n&&n.pitchAlignment&&n.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=n&&n.occludedOpacity||.2,n&&n.element)this._element=n.element,this._offset=s.Point.convert(n&&n.offset||[0,0]);else{this._defaultMarker=!0,this._element=dt("div");const d=41,m=27,g=zt("svg",{display:"block",height:d*this._scale+"px",width:m*this._scale+"px",viewBox:`0 0 ${m} ${d}`},this._element),y=zt("radialGradient",{id:"shadowGradient"},zt("defs",{},g));zt("stop",{offset:"10%","stop-opacity":.4},y),zt("stop",{offset:"100%","stop-opacity":.05},y),zt("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},g),zt("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},g),zt("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},g),zt("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},g),this._offset=s.Point.convert(n&&n.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",d=>{d.preventDefault()}),this._element.addEventListener("mousedown",d=>{d.preventDefault()});const h=this._element.classList;for(const d in pa)h.remove(`mapboxgl-marker-anchor-${d}`);h.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(n){return n===this._map||(this.remove(),this._map=n,n.getCanvasContainer().appendChild(this._element),n.on("move",this._updateMoving),n.on("moveend",this._update),n.on("remove",this._clearFadeTimer),n._addMarker(this),this.setDraggable(this._draggable),this._update(),n.on("click",this._onMapClick)),this}remove(){const n=this._map;return n&&(n.off("click",this._onMapClick),n.off("move",this._updateMoving),n.off("moveend",this._update),n.off("mousedown",this._addDragHandler),n.off("touchstart",this._addDragHandler),n.off("mouseup",this._onUp),n.off("touchend",this._onUp),n.off("mousemove",this._onMove),n.off("touchmove",this._onMove),n.off("remove",this._clearFadeTimer),n._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(n){return this._lngLat=s.LngLat.convert(n),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(n){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),n){if(!("offset"in n.options)){const d=Math.sqrt(Math.pow(13.5,2)/2);n.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[d,-1*(24.6+d)],"bottom-right":[-d,-1*(24.6+d)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=n,n._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(n){const a=n.code,h=n.charCode||n.keyCode;"Space"!==a&&"Enter"!==a&&32!==h&&13!==h||this.togglePopup()}_onMapClick(n){const a=n.originalEvent.target,h=this._element;this._popup&&(a===h||h.contains(a))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const n=this._popup;return n?(n.isOpen()?(n.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(n.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const n=this._map,a=this._pos;if(!n||!a)return!1;const h=n.unproject(a),d=n.getFreeCameraOptions();if(!d.position)return!1;const m=d.position.toLngLat();return m.distanceTo(h)<.9*m.distanceTo(this._lngLat)}_evaluateOpacity(){const n=this._map;if(!n)return;const a=this._pos;if(!a||a.x<0||a.x>n.transform.width||a.y<0||a.y>n.transform.height)return void this._clearFadeTimer();const h=n.unproject(a);let d;n._showingGlobe()&&s.isLngLatBehindGlobe(n.transform,this._lngLat)?d=0:(d=1-n._queryFogOpacity(h),n.transform._terrainEnabled()&&n.getTerrain()&&this._behindTerrain()&&(d*=this._occludedOpacity)),this._element.style.opacity=`${d}`,this._element.style.pointerEvents=d>0?"auto":"none",this._popup&&this._popup._setOpacity(d),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const n=this._pos;if(!n||!this._map)return;const a=this._offset.mult(this._scale);this._element.style.transform=`\n            translate(${n.x}px,${n.y}px)\n            ${pa[this._anchor]}\n            ${this._calculateXYTransform()} ${this._calculateZTransform()}\n            translate(${a.x}px,${a.y}px)\n        `}_calculateXYTransform(){const n=this._pos,a=this._map,h=this.getPitchAlignment();if(!a||!n||"map"!==h)return"";if(!a._showingGlobe()){const v=a.getPitch();return v?`rotateX(${v}deg)`:""}const d=s.radToDeg(s.globeTiltAtLngLat(a.transform,this._lngLat)),m=n.sub(s.globeCenterToScreenPoint(a.transform)),g=Math.abs(m.x)+Math.abs(m.y);if(0===g)return"";const y=d/g;return`rotateX(${-m.y*y}deg) rotateY(${m.x*y}deg)`}_calculateZTransform(){const n=this._pos,a=this._map;if(!a||!n)return"";let h=0;const d=this.getRotationAlignment();if("map"===d)if(a._showingGlobe()){const m=a.project(new s.LngLat(this._lngLat.lng,this._lngLat.lat+.001)),g=a.project(new s.LngLat(this._lngLat.lng,this._lngLat.lat-.001)).sub(m);h=s.radToDeg(Math.atan2(g.y,g.x))-90}else h=-a.getBearing();else if("horizon"===d){const m=s.smoothstep(4,6,a.getZoom()),g=s.globeCenterToScreenPoint(a.transform);g.y+=m*a.transform.height;const y=n.sub(g),v=s.radToDeg(Math.atan2(y.y,y.x));h=(v>90?v-270:v+90)*(1-m)}return h+=this._rotation,h?`rotateZ(${h}deg)`:""}_update(n){s.window.cancelAnimationFrame(this._updateFrameId);const a=this._map;a&&(a.transform.renderWorldCopies&&(this._lngLat=Fa(this._lngLat,this._pos,a.transform)),this._pos=a.project(this._lngLat),!0===n?this._updateFrameId=s.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),a._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(a._showingGlobe()||a.getTerrain()||a.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(n){return this._offset=s.Point.convert(n),this._update(),this}_onMove(n){const a=this._map;if(!a)return;const h=this._pointerdownPos,d=this._positionDelta;if(h&&d){if(!this._isDragging){const m=this._clickTolerance||a._clickTolerance;if(n.point.dist(h)<m)return;this._isDragging=!0}this._pos=n.point.sub(d),this._lngLat=a.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new s.Event("dragstart"))),this.fire(new s.Event("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const n=this._map;n&&(n.off("mousemove",this._onMove),n.off("touchmove",this._onMove)),"active"===this._state&&this.fire(new s.Event("dragend")),this._state="inactive"}_addDragHandler(n){const a=this._map,h=this._pos;a&&h&&this._element.contains(n.originalEvent.target)&&(n.preventDefault(),this._positionDelta=n.point.sub(h),this._pointerdownPos=n.point,this._state="pending",a.on("mousemove",this._onMove),a.on("touchmove",this._onMove),a.once("mouseup",this._onUp),a.once("touchend",this._onUp))}setDraggable(n){this._draggable=!!n;const a=this._map;return a&&(n?(a.on("mousedown",this._addDragHandler),a.on("touchstart",this._addDragHandler)):(a.off("mousedown",this._addDragHandler),a.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(n){return this._rotation=n||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(n){return this._rotationAlignment=n||"auto",this._update(),this}getRotationAlignment(){return"auto"===this._rotationAlignment||"horizon"===this._rotationAlignment&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(n){return this._pitchAlignment=n||"auto",this._update(),this}getPitchAlignment(){return"auto"===this._pitchAlignment?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(n){return this._occludedOpacity=n||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const xl={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Wh=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Nc(l=new s.Point(0,0),n="bottom"){if("number"==typeof l){const a=Math.round(Math.sqrt(.5*Math.pow(l,2)));switch(n){case"top":return new s.Point(0,l);case"top-left":return new s.Point(a,a);case"top-right":return new s.Point(-a,a);case"bottom":return new s.Point(0,-l);case"bottom-left":return new s.Point(a,-a);case"bottom-right":return new s.Point(-a,-a);case"left":return new s.Point(l,0);case"right":return new s.Point(-l,0)}return new s.Point(0,0)}return l instanceof s.Point||Array.isArray(l)?s.Point.convert(l):s.Point.convert(l[n]||[0,0])}class vl{constructor(n){this.jumpTo(n)}getValue(n){if(n<=this._startTime)return this._start;if(n>=this._endTime)return this._end;const a=s.easeCubicInOut((n-this._startTime)/(this._endTime-this._startTime));return this._start*(1-a)+this._end*a}isEasing(n){return n>=this._startTime&&n<=this._endTime}jumpTo(n){this._startTime=-1/0,this._endTime=-1/0,this._start=n,this._end=n}easeTo(n,a,h){this._start=this.getValue(a),this._end=n,this._startTime=a,this._endTime=a+h}}const jc={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},Zc={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0},Hh={showCompass:!0,showZoom:!0,visualizePitch:!1};class Yh{constructor(n,a,h=!1){this._clickTolerance=10,this.element=a,this.mouseRotate=new dl({clickTolerance:n.dragRotate._mouseRotate._clickTolerance}),this.map=n,h&&(this.mousePitch=new pl({clickTolerance:n.dragRotate._mousePitch._clickTolerance})),s.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),a.addEventListener("mousedown",this.mousedown),a.addEventListener("touchstart",this.touchstart,{passive:!1}),a.addEventListener("touchmove",this.touchmove),a.addEventListener("touchend",this.touchend),a.addEventListener("touchcancel",this.reset)}down(n,a){this.mouseRotate.mousedown(n,a),this.mousePitch&&this.mousePitch.mousedown(n,a),Bt()}move(n,a){const h=this.map,d=this.mouseRotate.mousemoveWindow(n,a),m=d&&d.bearingDelta;if(m&&h.setBearing(h.getBearing()+m),this.mousePitch){const g=this.mousePitch.mousemoveWindow(n,a),y=g&&g.pitchDelta;y&&h.setPitch(h.getPitch()+y)}}off(){const n=this.element;n.removeEventListener("mousedown",this.mousedown),n.removeEventListener("touchstart",this.touchstart,{passive:!1}),n.removeEventListener("touchmove",this.touchmove),n.removeEventListener("touchend",this.touchend),n.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){Jt(),s.window.removeEventListener("mousemove",this.mousemove),s.window.removeEventListener("mouseup",this.mouseup)}mousedown(n){this.down(s.extend({},n,{ctrlKey:!0,preventDefault:()=>n.preventDefault()}),bt(this.element,n)),s.window.addEventListener("mousemove",this.mousemove),s.window.addEventListener("mouseup",this.mouseup)}mousemove(n){this.move(n,bt(this.element,n))}mouseup(n){this.mouseRotate.mouseupWindow(n),this.mousePitch&&this.mousePitch.mouseupWindow(n),this.offTemp()}touchstart(n){1!==n.targetTouches.length?this.reset():(this._startPos=this._lastPos=Gt(this.element,n.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>n.preventDefault()},this._startPos))}touchmove(n){1!==n.targetTouches.length?this.reset():(this._lastPos=Gt(this.element,n.targetTouches)[0],this.move({preventDefault:()=>n.preventDefault()},this._lastPos))}touchend(n){0===n.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const bl={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},wl={maxWidth:100,unit:"metric"},Tl={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},Ua={version:s.version,supported:wt,setRTLTextPlugin:s.setRTLTextPlugin,getRTLTextPluginStatus:s.getRTLTextPluginStatus,Map:class extends hs{constructor(l){if(s.LivePerformanceUtils.mark(s.PerformanceMarkers.create),null!=(l=s.extend({},Zc,l)).minZoom&&null!=l.maxZoom&&l.minZoom>l.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=l.minPitch&&null!=l.maxPitch&&l.minPitch>l.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=l.minPitch&&l.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=l.maxPitch&&l.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(l.antialias&&s.isSafariWithAntialiasingBug(s.window)&&(l.antialias=!1,s.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new La(l.minZoom,l.maxZoom,l.minPitch,l.maxPitch,l.renderWorldCopies),l),this._interactive=l.interactive,this._minTileCacheSize=l.minTileCacheSize,this._maxTileCacheSize=l.maxTileCacheSize,this._failIfMajorPerformanceCaveat=l.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=l.preserveDrawingBuffer,this._antialias=l.antialias,this._useWebGL2=l.useWebGL2,this._trackResize=l.trackResize,this._bearingSnap=l.bearingSnap,this._refreshExpiredTiles=l.refreshExpiredTiles,this._fadeDuration=l.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=l.crossSourceCollisions,this._collectResourceTiming=l.collectResourceTiming,this._optimizeForTerrain=l.optimizeForTerrain,this._language=this._parseLanguage(l.language),this._worldview=l.worldview,this._renderTaskQueue=new yl,this._domRenderTaskQueue=new yl,this._controls=[],this._markers=[],this._popups=[],this._mapId=s.uniqueId(),this._locale=s.extend({},jc,l.locale),this._clickTolerance=l.clickTolerance,this._cooperativeGestures=l.cooperativeGestures,this._performanceMetricsCollection=l.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new vl(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new s.RequestManager(l.transformRequest,l.accessToken,l.testMode),this._silenceAuthErrors=!!l.testMode,"string"==typeof l.container){if(this._container=s.window.document.getElementById(l.container),!this._container)throw new Error(`Container '${l.container}' not found.`)}else{if(!(l.container instanceof s.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=l.container}if(this._container.childNodes.length>0&&s.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),l.maxBounds&&this.setMaxBounds(l.maxBounds),s.bindAll(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),void 0!==s.window&&(s.window.addEventListener("online",this._onWindowOnline,!1),s.window.addEventListener("resize",this._onWindowResize,!1),s.window.addEventListener("orientationchange",this._onWindowResize,!1),s.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1),s.window.addEventListener("visibilitychange",this._onVisibilityChange,!1)),this.handlers=new vr(this,l),this._localFontFamily=l.localFontFamily,this._localIdeographFontFamily=l.localIdeographFontFamily,l.style&&this.setStyle(l.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),l.projection&&this.setProjection(l.projection),this._hash=l.hash&&new ll("string"==typeof l.hash&&l.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:l.center,zoom:l.zoom,bearing:l.bearing,pitch:l.pitch}),l.bounds&&(this.resize(),this.fitBounds(l.bounds,s.extend({},l.fitBoundsOptions,{duration:0})))),this.resize(),l.attributionControl&&this.addControl(new ct({customAttribution:l.customAttribution})),this._logoControl=new gl,this.addControl(this._logoControl,l.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",n=>{this._update("style"===n.dataType),this.fire(new s.Event(`${n.dataType}data`,n))}),this.on("dataloading",n=>{this.fire(new s.Event(`${n.dataType}dataloading`,n))})}_getMapId(){return this._mapId}addControl(l,n){if(void 0===n&&(n=l.getDefaultPosition?l.getDefaultPosition():"top-right"),!l||!l.onAdd)return this.fire(new s.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const a=l.onAdd(this);this._controls.push(l);const h=this._controlPositions[n];return-1!==n.indexOf("bottom")?h.insertBefore(a,h.firstChild):h.appendChild(a),this}removeControl(l){if(!l||!l.onRemove)return this.fire(new s.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const n=this._controls.indexOf(l);return n>-1&&this._controls.splice(n,1),l.onRemove(this),this}hasControl(l){return this._controls.indexOf(l)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(l){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const n=!this._moving;return n&&this.fire(new s.Event("movestart",l)).fire(new s.Event("move",l)),this.fire(new s.Event("resize",l)),n&&this.fire(new s.Event("moveend",l)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(l){return this.transform.setMaxBounds(s.LngLatBounds.convert(l)),this._update()}setMinZoom(l){if((l=l??-2)>=-2&&l<=this.transform.maxZoom)return this.transform.minZoom=l,this._update(),this.getZoom()<l?this.setZoom(l):this.fire(new s.Event("zoomstart")).fire(new s.Event("zoom")).fire(new s.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(l){if((l=l??22)>=this.transform.minZoom)return this.transform.maxZoom=l,this._update(),this.getZoom()>l?this.setZoom(l):this.fire(new s.Event("zoomstart")).fire(new s.Event("zoom")).fire(new s.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(l){if((l=l??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(l>=0&&l<=this.transform.maxPitch)return this.transform.minPitch=l,this._update(),this.getPitch()<l?this.setPitch(l):this.fire(new s.Event("pitchstart")).fire(new s.Event("pitch")).fire(new s.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(l){if((l=l??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(l>=this.transform.minPitch)return this.transform.maxPitch=l,this._update(),this.getPitch()>l?this.setPitch(l):this.fire(new s.Event("pitchstart")).fire(new s.Event("pitch")).fire(new s.Event("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(l){return this.transform.renderWorldCopies=l,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(l){return"auto"===l?s.window.navigator.language:Array.isArray(l)?0===l.length?void 0:l.map(n=>"auto"===n?s.window.navigator.language:n):l}setLanguage(l){const n=this._parseLanguage(l);if(!this.style||n===this._language)return this;this._language=n,this.style._reloadSources();for(const a of this._controls)a._setLanguage&&a._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(l){return this.style&&l!==this._worldview?(this._worldview=l,this.style._reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return"globe"===this.transform.projection.name}setProjection(l){return this._lazyInitEmptyStyle(),l?"string"==typeof l&&(l={name:l}):l=null,this._useExplicitProjection=!!l,this._prioritizeAndUpdateProjection(l,this.style.stylesheet?this.style.stylesheet.projection:null)}_updateProjectionTransition(){if("globe"!==this.getProjection().name)return;const l=this.transform,n=l.projection.name;let a;"globe"===n&&l.zoom>=s.GLOBE_ZOOM_THRESHOLD_MAX?(l.setMercatorFromTransition(),a=!0):"mercator"===n&&l.zoom<s.GLOBE_ZOOM_THRESHOLD_MAX&&(l.setProjection({name:"globe"}),a=!0),a&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(l,n){return this._updateProjection(l||n||{name:"mercator"})}_updateProjection(l){let n;if(n="globe"===l.name&&this.transform.zoom>=s.GLOBE_ZOOM_THRESHOLD_MAX?this.transform.setMercatorFromTransition():this.transform.setProjection(l),this.style.applyProjectionUpdate(),n){this.painter.clearBackgroundTiles();for(const a in this.style._sourceCaches)this.style._sourceCaches[a].clearTiles();this._update(!0),this._forceMarkerAndPopupUpdate(!0)}return this}project(l){return this.transform.locationPoint3D(s.LngLat.convert(l))}unproject(l){return this.transform.pointLocation3D(s.Point.convert(l))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(l,n,a){if("mouseenter"===l||"mouseover"===l){let h=!1;const d=g=>{const y=n.filter(A=>this.getLayer(A)),v=y.length?this.queryRenderedFeatures(g.point,{layers:y}):[];v.length?h||(h=!0,a.call(this,new on(l,this,g.originalEvent,{features:v}))):h=!1},m=()=>{h=!1};return{layers:new Set(n),listener:a,delegates:{mousemove:d,mouseout:m}}}if("mouseleave"===l||"mouseout"===l){let h=!1;const d=g=>{const y=n.filter(v=>this.getLayer(v));(y.length?this.queryRenderedFeatures(g.point,{layers:y}):[]).length?h=!0:h&&(h=!1,a.call(this,new on(l,this,g.originalEvent)))},m=g=>{h&&(h=!1,a.call(this,new on(l,this,g.originalEvent)))};return{layers:new Set(n),listener:a,delegates:{mousemove:d,mouseout:m}}}{const h=d=>{const m=n.filter(y=>this.getLayer(y)),g=m.length?this.queryRenderedFeatures(d.point,{layers:m}):[];g.length&&(d.features=g,a.call(this,d),delete d.features)};return{layers:new Set(n),listener:a,delegates:{[l]:h}}}}on(l,n,a){if(void 0===a)return super.on(l,n);Array.isArray(n)||(n=[n]);const h=this._createDelegatedListener(l,n,a);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[l]=this._delegatedListeners[l]||[],this._delegatedListeners[l].push(h);for(const d in h.delegates)this.on(d,h.delegates[d]);return this}once(l,n,a){if(void 0===a)return super.once(l,n);Array.isArray(n)||(n=[n]);const h=this._createDelegatedListener(l,n,a);for(const d in h.delegates)this.once(d,h.delegates[d]);return this}off(l,n,a){if(void 0===a)return super.off(l,n);n=new Set(Array.isArray(n)?n:[n]);const h=(m,g)=>{if(m.size!==g.size)return!1;for(const y of m)if(!g.has(y))return!1;return!0},d=this._delegatedListeners?this._delegatedListeners[l]:void 0;return d&&(m=>{for(let g=0;g<m.length;g++){const y=m[g];if(y.listener===a&&h(y.layers,n)){for(const v in y.delegates)this.off(v,y.delegates[v]);return m.splice(g,1),this}}})(d),this}queryRenderedFeatures(l,n){return this.style?(void 0!==n||void 0===l||l instanceof s.Point||Array.isArray(l)||(n=l,l=void 0),this.style.queryRenderedFeatures(l=l||[[0,0],[this.transform.width,this.transform.height]],n=n||{},this.transform)):[]}querySourceFeatures(l,n){return this.style.querySourceFeatures(l,n)}isPointOnSurface(l){const{name:n}=this.transform.projection;return"globe"!==n&&"mercator"!==n&&s.warnOnce(`${n} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(s.Point.convert(l))}setStyle(l,n){return!1!==(n=s.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},n)).diff&&n.localIdeographFontFamily===this._localIdeographFontFamily&&n.localFontFamily===this._localFontFamily&&this.style&&l?(this._diffStyle(l,n),this):(this._localIdeographFontFamily=n.localIdeographFontFamily,this._localFontFamily=n.localFontFamily,this._updateStyle(l,n))}_getUIString(l){const n=this._locale[l];if(null==n)throw new Error(`Missing UI string '${l}'`);return n}_updateStyle(l,n){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),l&&(this.style=new yr(this,n||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof l?this.style.loadURL(l):this.style.loadJSON(l)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new yr(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(l,n){if("string"==typeof l){const a=this._requestManager.normalizeStyleURL(l),h=this._requestManager.transformRequest(a,s.ResourceType.Style);s.getJSON(h,(d,m)=>{d?this.fire(new s.ErrorEvent(d)):m&&this._updateDiff(m,n)})}else"object"==typeof l&&this._updateDiff(l,n)}_updateDiff(l,n){try{this.style.setState(l)&&this._update(!0)}catch(a){s.warnOnce(`Unable to perform style diff: ${a.message||a.error||a}.  Rebuilding the style from scratch.`),this._updateStyle(l,n)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(s.warnOnce("There is no style added to the map."),!1)}addSource(l,n){return this._lazyInitEmptyStyle(),this.style.addSource(l,n),this._update(!0)}isSourceLoaded(l){return!!this.style&&this.style._isSourceCacheLoaded(l)}areTilesLoaded(){const l=this.style&&this.style._sourceCaches;for(const n in l){const a=l[n]._tiles;for(const h in a){const d=a[h];if("loaded"!==d.state&&"errored"!==d.state)return!1}}return!0}addSourceType(l,n,a){this._lazyInitEmptyStyle(),this.style.addSourceType(l,n,a)}removeSource(l){return this.style.removeSource(l),this._updateTerrain(),this._update(!0)}getSource(l){return this.style.getSource(l)}addImage(l,n,{pixelRatio:a=1,sdf:h=!1,stretchX:d,stretchY:m,content:g}={}){if(this._lazyInitEmptyStyle(),n instanceof s.window.HTMLImageElement||s.window.ImageBitmap&&n instanceof s.window.ImageBitmap){const{width:y,height:v,data:A}=s.exported.getImageData(n);this.style.addImage(l,{data:new s.RGBAImage({width:y,height:v},A),pixelRatio:a,stretchX:d,stretchY:m,content:g,sdf:h,version:0})}else if(void 0===n.width||void 0===n.height)this.fire(new s.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:y,height:v}=n,A=n;this.style.addImage(l,{data:new s.RGBAImage({width:y,height:v},new Uint8Array(A.data)),pixelRatio:a,stretchX:d,stretchY:m,content:g,sdf:h,version:0,userImage:A}),A.onAdd&&A.onAdd(this,l)}}updateImage(l,n){const a=this.style.getImage(l);if(!a)return void this.fire(new s.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const h=n instanceof s.window.HTMLImageElement||s.window.ImageBitmap&&n instanceof s.window.ImageBitmap?s.exported.getImageData(n):n,{width:d,height:m}=h;void 0!==d&&void 0!==m?d===a.data.width&&m===a.data.height?(a.data.replace(h.data,!(n instanceof s.window.HTMLImageElement||s.window.ImageBitmap&&n instanceof s.window.ImageBitmap)),this.style.updateImage(l,a)):this.fire(new s.ErrorEvent(new Error(`The width and height of the updated image (${d}, ${m})\n                must be that same as the previous version of the image\n                (${a.data.width}, ${a.data.height})`))):this.fire(new s.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(l){return l?!!this.style.getImage(l):(this.fire(new s.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(l){this.style.removeImage(l)}loadImage(l,n){s.getImage(this._requestManager.transformRequest(l,s.ResourceType.Image),(a,h)=>{n(a,h instanceof s.window.HTMLImageElement?s.exported.getImageData(h):h)})}listImages(){return this.style.listImages()}addLayer(l,n){return this._lazyInitEmptyStyle(),this.style.addLayer(l,n),this._update(!0)}moveLayer(l,n){return this.style.moveLayer(l,n),this._update(!0)}removeLayer(l){return this.style.removeLayer(l),this._update(!0)}getLayer(l){return this.style.getLayer(l)}setLayerZoomRange(l,n,a){return this.style.setLayerZoomRange(l,n,a),this._update(!0)}setFilter(l,n,a={}){return this.style.setFilter(l,n,a),this._update(!0)}getFilter(l){return this.style.getFilter(l)}setPaintProperty(l,n,a,h={}){return this.style.setPaintProperty(l,n,a,h),this._update(!0)}getPaintProperty(l,n){return this.style.getPaintProperty(l,n)}setLayoutProperty(l,n,a,h={}){return this.style.setLayoutProperty(l,n,a,h),this._update(!0)}getLayoutProperty(l,n){return this.style.getLayoutProperty(l,n)}setLight(l,n={}){return this._lazyInitEmptyStyle(),this.style.setLight(l,n),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(l){return this._lazyInitEmptyStyle(),!l&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(l),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(l){return this._lazyInitEmptyStyle(),this.style.setFog(l),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(l){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(s.LngLat.convert(l),this.transform):0}setFeatureState(l,n){return this.style.setFeatureState(l,n),this._update()}removeFeatureState(l,n){return this.style.removeFeatureState(l,n),this._update()}getFeatureState(l){return this.style.getFeatureState(l)}_updateContainerDimensions(){if(!this._container)return;const l=this._container.getBoundingClientRect().width||400,n=this._container.getBoundingClientRect().height||300;let a,h,d,m=this._container;for(;m&&(!h||!d);){const g=s.window.getComputedStyle(m).transform;g&&"none"!==g&&(a=g.match(/matrix.*\((.+)\)/)[1].split(", "),a[0]&&"0"!==a[0]&&"1"!==a[0]&&(h=a[0]),a[3]&&"0"!==a[3]&&"1"!==a[3]&&(d=a[3])),m=m.parentElement}this._containerWidth=h?Math.abs(l/h):l,this._containerHeight=d?Math.abs(n/d):n}_detectMissingCSS(){"rgb(250, 128, 114)"!==s.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&s.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const l=this._container;l.classList.add("mapboxgl-map"),(this._missingCSSCanary=dt("div","mapboxgl-canary",l)).style.visibility="hidden",this._detectMissingCSS();const n=this._canvasContainer=dt("div","mapboxgl-canvas-container",l);this._interactive&&n.classList.add("mapboxgl-interactive"),this._canvas=dt("canvas","mapboxgl-canvas",n),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const a=this._controlContainer=dt("div","mapboxgl-control-container",l),h=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(d=>{h[d]=dt("div",`mapboxgl-ctrl-${d}`,a)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(l,n){const a=s.exported.devicePixelRatio||1;this._canvas.width=a*Math.ceil(l),this._canvas.height=a*Math.ceil(n),this._canvas.style.width=`${l}px`,this._canvas.style.height=`${n}px`}_addMarker(l){this._markers.push(l)}_removeMarker(l){const n=this._markers.indexOf(l);-1!==n&&this._markers.splice(n,1)}_addPopup(l){this._popups.push(l)}_removePopup(l){const n=this._popups.indexOf(l);-1!==n&&this._popups.splice(n,1)}_setupPainter(){const l=s.extend({},wt.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),n=this._useWebGL2&&this._canvas.getContext("webgl2",l),a=n||this._canvas.getContext("webgl",l)||this._canvas.getContext("experimental-webgl",l);a?(this._useWebGL2&&!n&&s.warnOnce("Failed to create WebGL 2 context. Using WebGL 1."),s.storeAuthState(a,!0),this.painter=new Pa(a,this.transform,!!n),this.on("data",h=>{"source"===h.dataType&&this.painter.setTileLoadedFlag(!0)}),s.exported$1.testSupport(a)):this.fire(new s.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(l){l.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new s.Event("webglcontextlost",{originalEvent:l}))}_contextRestored(l){this._setupPainter(),this.resize(),this._update(),this.fire(new s.Event("webglcontextrestored",{originalEvent:l}))}_onMapScroll(l){if(l.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(l){return this.style?(this._styleDirty=this._styleDirty||l,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(l){return this._update(),this._renderTaskQueue.add(l)}_cancelRenderFrame(l){this._renderTaskQueue.remove(l)}_requestDomTask(l){!this.loaded()||this.loaded()&&!this.isMoving()?l():this._domRenderTaskQueue.add(l)}_render(l){let n;const a=this.painter.context.extTimerQuery,h=s.exported.now();if(this.listens("gpu-timing-frame")&&(n=a.createQueryEXT(),a.beginQueryEXT(a.TIME_ELAPSED_EXT,n)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],s.window.performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],s.window.performance.now())),this._renderTaskQueue.run(l),this._domRenderTaskQueue.run(l),this._removed)return;this._updateProjectionTransition();const d=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const y=this.transform.zoom,v=this.transform.pitch,A=s.exported.now(),k=new s.EvaluationParameters(y,{now:A,fadeDuration:d,pitch:v,transition:this.style.getTransition()});this.style.update(k)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let m=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),m=this._updateAverageElevation(h),this.style._updateSources(this.transform),this._forceMarkerAndPopupUpdate()):m=this._updateAverageElevation(h),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,d,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:d,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new s.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new s.Event("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),n){const y=s.exported.now()-h;a.endQueryEXT(a.TIME_ELAPSED_EXT,n),setTimeout(()=>{const v=a.getQueryObjectEXT(n,a.QUERY_RESULT_EXT)/1e6;a.deleteQueryEXT(n),this.fire(new s.Event("gpu-timing-frame",{cpuTime:y,gpuTime:v})),s.window.performance.mark("frame-gpu",{startTime:h,detail:{gpuTime:v}})},50)}if(this.listens("gpu-timing-layer")){const y=this.painter.collectGpuTimers();setTimeout(()=>{const v=this.painter.queryGpuTimers(y);this.fire(new s.Event("gpu-timing-layer",{layerTimes:v}))},50)}if(this.listens("gpu-timing-deferred-render")){const y=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const v=this.painter.queryGpuTimeDeferredRender(y);this.fire(new s.Event("gpu-timing-deferred-render",{gpuTime:v}))},50)}const g=this._sourcesDirty||this._styleDirty||this._placementDirty||m;if(g||this._repaint)this.triggerRepaint();else{const y=!this.isMoving()&&this.loaded();if(y&&(m=this._updateAverageElevation(h,!0)),m)this.triggerRepaint();else if(this._triggerFrame(!1),y&&(this.fire(new s.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const v=this._calculateSpeedIndex();this.fire(new s.Event("speedindexcompleted",{speedIndex:v})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||g||(this._fullyLoaded=!0,s.LivePerformanceUtils.mark(s.PerformanceMarkers.fullLoad),this._performanceMetricsCollection&&s.postPerformanceEvent(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(l){for(const n of this._markers)l&&!this.getRenderWorldCopies()&&(n._lngLat=n._lngLat.wrap()),n._update();for(const n of this._popups)!l||this.getRenderWorldCopies()||n._trackPointer||(n._lngLat=n._lngLat.wrap()),n._update()}_updateAverageElevation(l,n=!1){const a=h=>(this.transform.averageElevation=h,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&a(0);if((n||l-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(l)){const h=this.transform.averageElevation;let d=this.transform.sampleAverageElevation(),m=!1;this.transform.elevation&&(m=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(d)?d=0:this._averageElevationLastSampledAt=l;const g=Math.abs(h-d);if(g>1){if(this._isInitialLoad||m)return this._averageElevation.jumpTo(d),a(d);this._averageElevation.easeTo(d,l,300)}else if(g>1e-4)return this._averageElevation.jumpTo(d),a(d)}return!!this._averageElevation.isEasing(l)&&a(this._averageElevation.getValue(l))}_authenticate(){s.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,l=>{if(l&&(l.message===s.AUTH_ERR_MSG||401===l.status)){const n=this.painter.context.gl;s.storeAuthState(n,!1),this._logoControl instanceof gl&&this._logoControl._updateLogo(),n&&n.clear(n.DEPTH_BUFFER_BIT|n.COLOR_BUFFER_BIT|n.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new s.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),s.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){const l=this._isDragging();this.painter.updateTerrain(this.style,l)}_calculateSpeedIndex(){const l=this.painter.canvasCopy(),n=this.painter.getCanvasCopiesAndTimestamps();n.timeStamps.push(performance.now());const a=this.painter.context.gl,h=a.createFramebuffer();function d(m){a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,m,0);const g=new Uint8Array(a.drawingBufferWidth*a.drawingBufferHeight*4);return a.readPixels(0,0,a.drawingBufferWidth,a.drawingBufferHeight,a.RGBA,a.UNSIGNED_BYTE,g),g}return a.bindFramebuffer(a.FRAMEBUFFER,h),this._canvasPixelComparison(d(l),n.canvasCopies.map(d),n.timeStamps)}_canvasPixelComparison(l,n,a){let h=a[1]-a[0];const d=l.length/4;for(let m=0;m<n.length;m++){const g=n[m];let y=0;for(let v=0;v<g.length;v+=4)g[v]===l[v]&&g[v+1]===l[v+1]&&g[v+2]===l[v+2]&&g[v+3]===l[v+3]&&(y+=1);h+=(a[m+2]-a[m+1])*(1-y/d)}return h}remove(){this._hash&&this._hash.remove();for(const n of this._controls)n.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),void 0!==s.window&&(s.window.removeEventListener("resize",this._onWindowResize,!1),s.window.removeEventListener("orientationchange",this._onWindowResize,!1),s.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),s.window.removeEventListener("online",this._onWindowOnline,!1),s.window.removeEventListener("visibilitychange",this._onVisibilityChange,!1));const l=this.painter.context.gl.getExtension("WEBGL_lose_context");l&&l.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),s.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new s.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(l){this._renderNextFrame=this._renderNextFrame||l,this.style&&!this._frame&&(this._frame=s.exported.frame(n=>{const a=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,a&&this._render(n)}))}_preloadTiles(l){const n=this.style?Object.values(this.style._sourceCaches):[];return s.asyncAll(n,(a,h)=>a._preloadTiles(l,h),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(l){this._trackResize&&this.resize({originalEvent:l})._update()}_onVisibilityChange(){"hidden"===s.window.document.visibilityState&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(l){this._showTileBoundaries!==l&&(this._showTileBoundaries=l,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(l){this._showTerrainWireframe!==l&&(this._showTerrainWireframe=l,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(l){this._speedIndexTiming!==l&&(this._speedIndexTiming=l,this._update())}get showPadding(){return!!this._showPadding}set showPadding(l){this._showPadding!==l&&(this._showPadding=l,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(l){this._showCollisionBoxes!==l&&(this._showCollisionBoxes=l,l?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(l){this._showOverdrawInspector!==l&&(this._showOverdrawInspector=l,this._update())}get repaint(){return!!this._repaint}set repaint(l){this._repaint!==l&&(this._repaint=l,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(l){this._vertices=l,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(l){this._showTileAABBs!==l&&(this._showTileAABBs=l,l&&this._update())}_setCacheLimits(l,n){s.setCacheLimits(l,n)}get version(){return s.version}},NavigationControl:class{constructor(l){this.options=s.extend({},Hh,l),this._container=dt("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",n=>n.preventDefault()),this.options.showZoom&&(s.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",n=>{this._map&&this._map.zoomIn({},{originalEvent:n})}),dt("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",n=>{this._map&&this._map.zoomOut({},{originalEvent:n})}),dt("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(s.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",n=>{const a=this._map;a&&(this.options.visualizePitch?a.resetNorthPitch({},{originalEvent:n}):a.resetNorth({},{originalEvent:n}))}),this._compassIcon=dt("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const l=this._map;if(!l)return;const n=l.getZoom(),a=n===l.getMaxZoom(),h=n===l.getMinZoom();this._zoomInButton.disabled=a,this._zoomOutButton.disabled=h,this._zoomInButton.setAttribute("aria-disabled",a.toString()),this._zoomOutButton.setAttribute("aria-disabled",h.toString())}_rotateCompassArrow(){const l=this._map;if(!l)return;const n=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(l.transform.pitch*(Math.PI/180)),.5)}) rotateX(${l.transform.pitch}deg) rotateZ(${l.transform.angle*(180/Math.PI)}deg)`:`rotate(${l.transform.angle*(180/Math.PI)}deg)`;l._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=n)})}onAdd(l){return this._map=l,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),l.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&l.on("pitch",this._rotateCompassArrow),l.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Yh(l,this._compass,this.options.visualizePitch)),this._container}onRemove(){const l=this._map;l&&(this._container.remove(),this.options.showZoom&&l.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&l.off("pitch",this._rotateCompassArrow),l.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(l,n){const a=dt("button",l,this._container);return a.type="button",a.addEventListener("click",n),a}_setButtonTitle(l,n){if(!this._map)return;const a=this._map._getUIString(`NavigationControl.${n}`);l.setAttribute("aria-label",a),l.firstElementChild&&l.firstElementChild.setAttribute("title",a)}},GeolocateControl:class extends s.Evented{constructor(l){super(),this.options=s.extend({geolocation:s.window.navigator.geolocation},bl,l),s.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Ra(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(l){return this._map=l,this._container=dt("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){void 0!==this._geolocationWatchID&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(l){const n=(a=!!this.options.geolocation)=>{this._supportsGeolocation=a,l(a)};void 0!==this._supportsGeolocation?l(this._supportsGeolocation):void 0!==s.window.navigator.permissions?s.window.navigator.permissions.query({name:"geolocation"}).then(a=>n("denied"!==a.state)).catch(()=>n()):n()}_isOutOfMapMaxBounds(l){const n=this._map.getMaxBounds(),a=l.coords;return!!n&&(a.longitude<n.getWest()||a.longitude>n.getEast()||a.latitude<n.getSouth()||a.latitude>n.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(l){if(this._map){if(this._isOutOfMapMaxBounds(l))return this._setErrorState(),this.fire(new s.Event("outofmaxbounds",l)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=l,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(l),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(l),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new s.Event("geolocate",l)),this._finish()}}_updateCamera(l){const n=new s.LngLat(l.coords.longitude,l.coords.latitude),a=l.coords.accuracy,h=this._map.getBearing(),d=s.extend({bearing:h},this.options.fitBoundsOptions);this._map.fitBounds(n.toBounds(a),d,{geolocateSource:!0})}_updateMarker(l){if(l){const n=new s.LngLat(l.coords.longitude,l.coords.latitude);this._accuracyCircleMarker.setLngLat(n).addTo(this._map),this._userLocationDotMarker.setLngLat(n).addTo(this._map),this._accuracy=l.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const l=this._map.transform,n=s.mercatorZfromAltitude(1,l._center.lat)*l.worldSize,a=Math.ceil(2*this._accuracy*n);this._circleElement.style.width=`${a}px`,this._circleElement.style.height=`${a}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(l){if(this._map){if(this.options.trackUserLocation)if(1===l.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===l.code&&this._noTimeout)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new s.Event("error",l)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(l){if(void 0!==this._map){if(this._container.addEventListener("contextmenu",n=>n.preventDefault()),this._geolocateButton=dt("button","mapboxgl-ctrl-geolocate",this._container),dt("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",!1===l){s.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n)}else{const n=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=dt("div","mapboxgl-user-location"),this._dotElement.appendChild(dt("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(dt("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new it({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=dt("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new it({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",n=>{n.geolocateSource||"ACTIVE_LOCK"!==this._watchState||n.originalEvent&&"resize"===n.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new s.Event("trackuserlocationend")))})}}_onDeviceOrientation(l){this._userLocationDotMarker&&(l.webkitCompassHeading?this._heading=l.webkitCompassHeading:!0===l.absolute&&(this._heading=-1*l.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return s.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new s.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new s.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new s.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let l;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(l={maximumAge:6e5,timeout:0},this._noTimeout=!0):(l=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,l),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const l=()=>{s.window.addEventListener("ondeviceorientationabsolute"in s.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};void 0!==s.window.DeviceMotionEvent&&"function"==typeof s.window.DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(n=>{"granted"===n&&l()}).catch(console.error):l()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),s.window.removeEventListener("deviceorientation",this._onDeviceOrientation),s.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:ct,ScaleControl:class{constructor(l){this.options=s.extend({},wl,l),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),s.bindAll(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const l=this.options.maxWidth||100,n=this._map,a=n._containerHeight/2,h=n._containerWidth/2-l/2,d=n.unproject([h,a]),m=n.unproject([h+l,a]),g=d.distanceTo(m);if("imperial"===this.options.unit){const y=3.2808*g;y>5280?this._setScale(l,y/5280,"mile"):this._setScale(l,y,"foot")}else"nautical"===this.options.unit?this._setScale(l,g/1852,"nautical-mile"):g>=1e3?this._setScale(l,g/1e3,"kilometer"):this._setScale(l,g,"meter")}_setScale(l,n,a){this._map._requestDomTask(()=>{const h=function(m){const g=Math.pow(10,`${Math.floor(m)}`.length-1);let y=m/g;return y=y>=10?10:y>=5?5:y>=3?3:y>=2?2:y>=1?1:function(v){const A=Math.pow(10,Math.ceil(-Math.log(v)/Math.LN10));return Math.round(v*A)/A}(y),g*y}(n),d=h/n;this._container.innerHTML=this._isNumberFormatSupported&&"nautical-mile"!==a?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:a}).format(h):`${h}&nbsp;${Tl[a]}`,this._container.style.width=l*d+"px"})}onAdd(l){return this._map=l,this._language=l.getLanguage(),this._container=dt("div","mapboxgl-ctrl mapboxgl-ctrl-scale",l.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(l){this._language=l,this._update()}setUnit(l){this.options.unit=l,this._update()}},FullscreenControl:class{constructor(l){this._fullscreen=!1,l&&l.container&&(l.container instanceof s.window.HTMLElement?this._container=l.container:s.warnOnce("Full screen control 'container' must be a DOM element.")),s.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in s.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in s.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(l){return this._map=l,this._container||(this._container=this._map.getContainer()),this._controlContainer=dt("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",s.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,s.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!s.window.document.fullscreenEnabled&&!s.window.document.webkitFullscreenEnabled)}_setupUI(){const l=this._fullscreenButton=dt("button","mapboxgl-ctrl-fullscreen",this._controlContainer);dt("span","mapboxgl-ctrl-icon",l).setAttribute("aria-hidden","true"),l.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),s.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const l=this._getTitle();this._fullscreenButton.setAttribute("aria-label",l),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",l)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(s.window.document.fullscreenElement||s.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?s.window.document.exitFullscreen?s.window.document.exitFullscreen():s.window.document.webkitCancelFullScreen&&s.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends s.Evented{constructor(l){super(),this.options=s.extend(Object.create(xl),l),s.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(l&&l.className?l.className.trim().split(/\s+/):[])}addTo(l){return this._map&&this.remove(),this._map=l,this.options.closeOnClick&&l.on("preclick",this._onClose),this.options.closeOnMove&&l.on("move",this._onClose),l.on("remove",this.remove),this._update(),l._addPopup(this),this._focusFirstElement(),this._trackPointer?(l.on("mousemove",this._onMouseEvent),l.on("mouseup",this._onMouseEvent),l._canvasContainer.classList.add("mapboxgl-track-pointer")):l.on("move",this._update),this.fire(new s.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const l=this._map;return l&&(l.off("move",this._update),l.off("move",this._onClose),l.off("preclick",this._onClose),l.off("click",this._onClose),l.off("remove",this.remove),l.off("mousemove",this._onMouseEvent),l.off("mouseup",this._onMouseEvent),l.off("drag",this._onMouseEvent),l._canvasContainer&&l._canvasContainer.classList.remove("mapboxgl-track-pointer"),l._removePopup(this),this._map=void 0),this.fire(new s.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(l){this._lngLat=s.LngLat.convert(l),this._pos=null,this._trackPointer=!1,this._update();const n=this._map;return n&&(n.on("move",this._update),n.off("mousemove",this._onMouseEvent),n._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const l=this._map;return l&&(l.off("move",this._update),l.on("mousemove",this._onMouseEvent),l.on("drag",this._onMouseEvent),l._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(l){return this.setDOMContent(s.window.document.createTextNode(l))}setHTML(l){const n=s.window.document.createDocumentFragment(),a=s.window.document.createElement("body");let h;for(a.innerHTML=l;h=a.firstChild,h;)n.appendChild(h);return this.setDOMContent(n)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(l){return this.options.maxWidth=l,this._update(),this}setDOMContent(l){let n=this._content;if(n)for(;n.hasChildNodes();)n.firstChild&&n.removeChild(n.firstChild);else n=this._content=dt("div","mapboxgl-popup-content",this._container||void 0);if(n.appendChild(l),this.options.closeButton){const a=this._closeButton=dt("button","mapboxgl-popup-close-button",n);a.type="button",a.setAttribute("aria-label","Close popup"),a.setAttribute("aria-hidden","true"),a.innerHTML="&#215;",a.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(l){return this._classList.add(l),this._updateClassList(),this}removeClassName(l){return this._classList.delete(l),this._updateClassList(),this}setOffset(l){return this.options.offset=l,this._update(),this}toggleClassName(l){let n;return this._classList.delete(l)?n=!1:(this._classList.add(l),n=!0),this._updateClassList(),n}_onMouseEvent(l){this._update(l.point)}_getAnchor(l){if(this.options.anchor)return this.options.anchor;const n=this._map,a=this._container,h=this._pos;if(!n||!a||!h)return"bottom";const d=a.offsetWidth,m=a.offsetHeight,g=h.x<d/2,y=h.x>n.transform.width-d/2;if(h.y+l<m)return g?"top-left":y?"top-right":"top";if(h.y>n.transform.height-m){if(g)return"bottom-left";if(y)return"bottom-right"}return g?"left":y?"right":"bottom"}_updateClassList(){const l=this._container;if(!l)return;const n=[...this._classList];n.push("mapboxgl-popup"),this._anchor&&n.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&n.push("mapboxgl-popup-track-pointer"),l.className=n.join(" ")}_update(l){const n=this._map,a=this._content;if(!n||!this._lngLat&&!this._trackPointer||!a)return;let h=this._container;if(h||(h=this._container=dt("div","mapboxgl-popup",n.getContainer()),this._tip=dt("div","mapboxgl-popup-tip",h),h.appendChild(a)),this.options.maxWidth&&h.style.maxWidth!==this.options.maxWidth&&(h.style.maxWidth=this.options.maxWidth),n.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Fa(this._lngLat,this._pos,n.transform)),!this._trackPointer||l){const d=this._pos=this._trackPointer&&l?l:n.project(this._lngLat),m=Nc(this.options.offset),g=this._anchor=this._getAnchor(m.y),y=Nc(this.options.offset,g),v=d.add(y).round();n._requestDomTask(()=>{this._container&&g&&(this._container.style.transform=`${pa[g]} translate(${v.x}px,${v.y}px)`)})}if(!this._marker&&n._showingGlobe()){const d=s.isLngLatBehindGlobe(n.transform,this._lngLat)?0:1;this._setOpacity(d)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const l=this._container.querySelector(Wh);l&&l.focus()}_onClose(){this.remove()}_setOpacity(l){this._container&&(this._container.style.opacity=`${l}`),this._content&&(this._content.style.pointerEvents=l?"auto":"none")}},Marker:it,Style:yr,LngLat:s.LngLat,LngLatBounds:s.LngLatBounds,Point:s.Point,MercatorCoordinate:s.MercatorCoordinate,FreeCameraOptions:Ac,Evented:s.Evented,config:s.config,prewarm:function(){Vn().acquire(an)},clearPrewarmedResources:function(){const l=Bi;l&&(l.isPreloaded()&&1===l.numActive()?(l.release(an),Bi=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return s.config.ACCESS_TOKEN},set accessToken(l){s.config.ACCESS_TOKEN=l},get baseApiUrl(){return s.config.API_URL},set baseApiUrl(l){s.config.API_URL=l},get workerCount(){return Ri.workerCount},set workerCount(l){Ri.workerCount=l},get maxParallelImageRequests(){return s.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(l){s.config.MAX_PARALLEL_IMAGE_REQUESTS=l},clearStorage(l){s.clearTileCache(l)},workerUrl:"",workerClass:null,setNow:s.exported.setNow,restoreNow:s.exported.restoreNow};return Ua}),T}()},5986:(zn,Pi,Ne)=>{"use strict";Ne.d(Pi,{oG:()=>Xt,p9:()=>Tt});var T=Ne(5879),mt=Ne(6223),ai=Ne(3680),s=Ne(2495);const M=["input"],wt=["label"],nt=["*"],Fe=new T.OlP("mat-checkbox-default-options",{providedIn:"root",factory:dt});function dt(){return{color:"accent",clickAction:"check-indeterminate"}}const zt={provide:mt.JU,useExisting:(0,T.Gpc)(()=>Xt),multi:!0};class Ht{}let ti=0;const lt=dt(),Bt=(0,ai.sb)((0,ai.pj)((0,ai.Kr)((0,ai.Id)(class{constructor(Qe){this._elementRef=Qe}}))));let Jt=(()=>{var Qe;class Pe extends Bt{get inputId(){return`${this.id||this._uniqueId}-input`}get required(){return this._required}set required(rt){this._required=(0,s.Ig)(rt)}constructor(rt,De,at,Ie,Je,Ce,Ue){super(De),this._changeDetectorRef=at,this._ngZone=Ie,this._animationMode=Ce,this._options=Ue,this.ariaLabel="",this.ariaLabelledby=null,this.labelPosition="after",this.name=null,this.change=new T.vpe,this.indeterminateChange=new T.vpe,this._onTouched=()=>{},this._currentAnimationClass="",this._currentCheckState=0,this._controlValueAccessorChangeFn=()=>{},this._checked=!1,this._disabled=!1,this._indeterminate=!1,this._options=this._options||lt,this.color=this.defaultColor=this._options.color||lt.color,this.tabIndex=parseInt(Je)||0,this.id=this._uniqueId=`${rt}${++ti}`}ngAfterViewInit(){this._syncIndeterminate(this._indeterminate)}get checked(){return this._checked}set checked(rt){const De=(0,s.Ig)(rt);De!=this.checked&&(this._checked=De,this._changeDetectorRef.markForCheck())}get disabled(){return this._disabled}set disabled(rt){const De=(0,s.Ig)(rt);De!==this.disabled&&(this._disabled=De,this._changeDetectorRef.markForCheck())}get indeterminate(){return this._indeterminate}set indeterminate(rt){const De=rt!=this._indeterminate;this._indeterminate=(0,s.Ig)(rt),De&&(this._transitionCheckState(this._indeterminate?3:this.checked?1:2),this.indeterminateChange.emit(this._indeterminate)),this._syncIndeterminate(this._indeterminate)}_isRippleDisabled(){return this.disableRipple||this.disabled}_onLabelTextChange(){this._changeDetectorRef.detectChanges()}writeValue(rt){this.checked=!!rt}registerOnChange(rt){this._controlValueAccessorChangeFn=rt}registerOnTouched(rt){this._onTouched=rt}setDisabledState(rt){this.disabled=rt}_transitionCheckState(rt){let De=this._currentCheckState,at=this._getAnimationTargetElement();if(De!==rt&&at&&(this._currentAnimationClass&&at.classList.remove(this._currentAnimationClass),this._currentAnimationClass=this._getAnimationClassForCheckStateTransition(De,rt),this._currentCheckState=rt,this._currentAnimationClass.length>0)){at.classList.add(this._currentAnimationClass);const Ie=this._currentAnimationClass;this._ngZone.runOutsideAngular(()=>{setTimeout(()=>{at.classList.remove(Ie)},1e3)})}}_emitChangeEvent(){this._controlValueAccessorChangeFn(this.checked),this.change.emit(this._createChangeEvent(this.checked)),this._inputElement&&(this._inputElement.nativeElement.checked=this.checked)}toggle(){this.checked=!this.checked,this._controlValueAccessorChangeFn(this.checked)}_handleInputClick(){const rt=this._options?.clickAction;this.disabled||"noop"===rt?!this.disabled&&"noop"===rt&&(this._inputElement.nativeElement.checked=this.checked,this._inputElement.nativeElement.indeterminate=this.indeterminate):(this.indeterminate&&"check"!==rt&&Promise.resolve().then(()=>{this._indeterminate=!1,this.indeterminateChange.emit(this._indeterminate)}),this._checked=!this._checked,this._transitionCheckState(this._checked?1:2),this._emitChangeEvent())}_onInteractionEvent(rt){rt.stopPropagation()}_onBlur(){Promise.resolve().then(()=>{this._onTouched(),this._changeDetectorRef.markForCheck()})}_getAnimationClassForCheckStateTransition(rt,De){if("NoopAnimations"===this._animationMode)return"";switch(rt){case 0:if(1===De)return this._animationClasses.uncheckedToChecked;if(3==De)return this._checked?this._animationClasses.checkedToIndeterminate:this._animationClasses.uncheckedToIndeterminate;break;case 2:return 1===De?this._animationClasses.uncheckedToChecked:this._animationClasses.uncheckedToIndeterminate;case 1:return 2===De?this._animationClasses.checkedToUnchecked:this._animationClasses.checkedToIndeterminate;case 3:return 1===De?this._animationClasses.indeterminateToChecked:this._animationClasses.indeterminateToUnchecked}return""}_syncIndeterminate(rt){const De=this._inputElement;De&&(De.nativeElement.indeterminate=rt)}}return(Qe=Pe).\u0275fac=function(rt){T.$Z()},Qe.\u0275dir=T.lG2({type:Qe,viewQuery:function(rt,De){if(1&rt&&(T.Gf(M,5),T.Gf(wt,5),T.Gf(ai.wG,5)),2&rt){let at;T.iGM(at=T.CRH())&&(De._inputElement=at.first),T.iGM(at=T.CRH())&&(De._labelElement=at.first),T.iGM(at=T.CRH())&&(De.ripple=at.first)}},inputs:{ariaLabel:["aria-label","ariaLabel"],ariaLabelledby:["aria-labelledby","ariaLabelledby"],ariaDescribedby:["aria-describedby","ariaDescribedby"],id:"id",required:"required",labelPosition:"labelPosition",name:"name",value:"value",checked:"checked",disabled:"disabled",indeterminate:"indeterminate"},outputs:{change:"change",indeterminateChange:"indeterminateChange"},features:[T.qOj]}),Pe})(),Xt=(()=>{var Qe;class Pe extends Jt{constructor(rt,De,at,Ie,Je,Ce){super("mat-mdc-checkbox-",rt,De,at,Ie,Je,Ce),this._animationClasses={uncheckedToChecked:"mdc-checkbox--anim-unchecked-checked",uncheckedToIndeterminate:"mdc-checkbox--anim-unchecked-indeterminate",checkedToUnchecked:"mdc-checkbox--anim-checked-unchecked",checkedToIndeterminate:"mdc-checkbox--anim-checked-indeterminate",indeterminateToChecked:"mdc-checkbox--anim-indeterminate-checked",indeterminateToUnchecked:"mdc-checkbox--anim-indeterminate-unchecked"}}focus(){this._inputElement.nativeElement.focus()}_createChangeEvent(rt){const De=new Ht;return De.source=this,De.checked=rt,De}_getAnimationTargetElement(){return this._inputElement?.nativeElement}_onInputClick(){super._handleInputClick()}_onTouchTargetClick(){super._handleInputClick(),this.disabled||this._inputElement.nativeElement.focus()}_preventBubblingFromLabel(rt){rt.target&&this._labelElement.nativeElement.contains(rt.target)&&rt.stopPropagation()}}return(Qe=Pe).\u0275fac=function(rt){return new(rt||Qe)(T.Y36(T.SBq),T.Y36(T.sBO),T.Y36(T.R0b),T.$8M("tabindex"),T.Y36(T.QbO,8),T.Y36(Fe,8))},Qe.\u0275cmp=T.Xpm({type:Qe,selectors:[["mat-checkbox"]],hostAttrs:[1,"mat-mdc-checkbox"],hostVars:12,hostBindings:function(rt,De){2&rt&&(T.Ikx("id",De.id),T.uIk("tabindex",null)("aria-label",null)("aria-labelledby",null),T.ekj("_mat-animation-noopable","NoopAnimations"===De._animationMode)("mdc-checkbox--disabled",De.disabled)("mat-mdc-checkbox-disabled",De.disabled)("mat-mdc-checkbox-checked",De.checked))},inputs:{disableRipple:"disableRipple",color:"color",tabIndex:"tabIndex"},exportAs:["matCheckbox"],features:[T._Bn([zt]),T.qOj],ngContentSelectors:nt,decls:15,vars:19,consts:[[1,"mdc-form-field",3,"click"],[1,"mdc-checkbox"],["checkbox",""],[1,"mat-mdc-checkbox-touch-target",3,"click"],["type","checkbox",1,"mdc-checkbox__native-control",3,"checked","indeterminate","disabled","id","required","tabIndex","blur","click","change"],["input",""],[1,"mdc-checkbox__ripple"],[1,"mdc-checkbox__background"],["focusable","false","viewBox","0 0 24 24","aria-hidden","true",1,"mdc-checkbox__checkmark"],["fill","none","d","M1.73,12.91 8.1,19.28 22.79,4.59",1,"mdc-checkbox__checkmark-path"],[1,"mdc-checkbox__mixedmark"],["mat-ripple","",1,"mat-mdc-checkbox-ripple","mat-mdc-focus-indicator",3,"matRippleTrigger","matRippleDisabled","matRippleCentered"],[1,"mdc-label",3,"for"],["label",""]],template:function(rt,De){if(1&rt&&(T.F$t(),T.TgZ(0,"div",0),T.NdJ("click",function(Ie){return De._preventBubblingFromLabel(Ie)}),T.TgZ(1,"div",1,2)(3,"div",3),T.NdJ("click",function(){return De._onTouchTargetClick()}),T.qZA(),T.TgZ(4,"input",4,5),T.NdJ("blur",function(){return De._onBlur()})("click",function(){return De._onInputClick()})("change",function(Ie){return De._onInteractionEvent(Ie)}),T.qZA(),T._UZ(6,"div",6),T.TgZ(7,"div",7),T.O4$(),T.TgZ(8,"svg",8),T._UZ(9,"path",9),T.qZA(),T.kcU(),T._UZ(10,"div",10),T.qZA(),T._UZ(11,"div",11),T.qZA(),T.TgZ(12,"label",12,13),T.Hsn(14),T.qZA()()),2&rt){const at=T.MAs(2);T.ekj("mdc-form-field--align-end","before"==De.labelPosition),T.xp6(4),T.ekj("mdc-checkbox--selected",De.checked),T.Q6J("checked",De.checked)("indeterminate",De.indeterminate)("disabled",De.disabled)("id",De.inputId)("required",De.required)("tabIndex",De.tabIndex),T.uIk("aria-label",De.ariaLabel||null)("aria-labelledby",De.ariaLabelledby)("aria-describedby",De.ariaDescribedby)("name",De.name)("value",De.value),T.xp6(7),T.Q6J("matRippleTrigger",at)("matRippleDisabled",De.disableRipple||De.disabled)("matRippleCentered",!0),T.xp6(1),T.Q6J("for",De.inputId)}},dependencies:[ai.wG],styles:['.mdc-touch-target-wrapper{display:inline}@keyframes mdc-checkbox-unchecked-checked-checkmark-path{0%,50%{stroke-dashoffset:29.7833385}50%{animation-timing-function:cubic-bezier(0, 0, 0.2, 1)}100%{stroke-dashoffset:0}}@keyframes mdc-checkbox-unchecked-indeterminate-mixedmark{0%,68.2%{transform:scaleX(0)}68.2%{animation-timing-function:cubic-bezier(0, 0, 0, 1)}100%{transform:scaleX(1)}}@keyframes mdc-checkbox-checked-unchecked-checkmark-path{from{animation-timing-function:cubic-bezier(0.4, 0, 1, 1);opacity:1;stroke-dashoffset:0}to{opacity:0;stroke-dashoffset:-29.7833385}}@keyframes mdc-checkbox-checked-indeterminate-checkmark{from{animation-timing-function:cubic-bezier(0, 0, 0.2, 1);transform:rotate(0deg);opacity:1}to{transform:rotate(45deg);opacity:0}}@keyframes mdc-checkbox-indeterminate-checked-checkmark{from{animation-timing-function:cubic-bezier(0.14, 0, 0, 1);transform:rotate(45deg);opacity:0}to{transform:rotate(360deg);opacity:1}}@keyframes mdc-checkbox-checked-indeterminate-mixedmark{from{animation-timing-function:mdc-animation-deceleration-curve-timing-function;transform:rotate(-45deg);opacity:0}to{transform:rotate(0deg);opacity:1}}@keyframes mdc-checkbox-indeterminate-checked-mixedmark{from{animation-timing-function:cubic-bezier(0.14, 0, 0, 1);transform:rotate(0deg);opacity:1}to{transform:rotate(315deg);opacity:0}}@keyframes mdc-checkbox-indeterminate-unchecked-mixedmark{0%{animation-timing-function:linear;transform:scaleX(1);opacity:1}32.8%,100%{transform:scaleX(0);opacity:0}}.mdc-checkbox{display:inline-block;position:relative;flex:0 0 18px;box-sizing:content-box;width:18px;height:18px;line-height:0;white-space:nowrap;cursor:pointer;vertical-align:bottom}.mdc-checkbox[hidden]{display:none}.mdc-checkbox.mdc-ripple-upgraded--background-focused .mdc-checkbox__focus-ring,.mdc-checkbox:not(.mdc-ripple-upgraded):focus .mdc-checkbox__focus-ring{pointer-events:none;border:2px solid rgba(0,0,0,0);border-radius:6px;box-sizing:content-box;position:absolute;top:50%;left:50%;transform:translate(-50%, -50%);height:100%;width:100%}@media screen and (forced-colors: active){.mdc-checkbox.mdc-ripple-upgraded--background-focused .mdc-checkbox__focus-ring,.mdc-checkbox:not(.mdc-ripple-upgraded):focus .mdc-checkbox__focus-ring{border-color:CanvasText}}.mdc-checkbox.mdc-ripple-upgraded--background-focused .mdc-checkbox__focus-ring::after,.mdc-checkbox:not(.mdc-ripple-upgraded):focus .mdc-checkbox__focus-ring::after{content:"";border:2px solid rgba(0,0,0,0);border-radius:8px;display:block;position:absolute;top:50%;left:50%;transform:translate(-50%, -50%);height:calc(100% + 4px);width:calc(100% + 4px)}@media screen and (forced-colors: active){.mdc-checkbox.mdc-ripple-upgraded--background-focused .mdc-checkbox__focus-ring::after,.mdc-checkbox:not(.mdc-ripple-upgraded):focus .mdc-checkbox__focus-ring::after{border-color:CanvasText}}@media all and (-ms-high-contrast: none){.mdc-checkbox .mdc-checkbox__focus-ring{display:none}}@media screen and (forced-colors: active),(-ms-high-contrast: active){.mdc-checkbox__mixedmark{margin:0 1px}}.mdc-checkbox--disabled{cursor:default;pointer-events:none}.mdc-checkbox__background{display:inline-flex;position:absolute;align-items:center;justify-content:center;box-sizing:border-box;width:18px;height:18px;border:2px solid currentColor;border-radius:2px;background-color:rgba(0,0,0,0);pointer-events:none;will-change:background-color,border-color;transition:background-color 90ms 0ms cubic-bezier(0.4, 0, 0.6, 1),border-color 90ms 0ms cubic-bezier(0.4, 0, 0.6, 1)}.mdc-checkbox__checkmark{position:absolute;top:0;right:0;bottom:0;left:0;width:100%;opacity:0;transition:opacity 180ms 0ms cubic-bezier(0.4, 0, 0.6, 1)}.mdc-checkbox--upgraded .mdc-checkbox__checkmark{opacity:1}.mdc-checkbox__checkmark-path{transition:stroke-dashoffset 180ms 0ms cubic-bezier(0.4, 0, 0.6, 1);stroke:currentColor;stroke-width:3.12px;stroke-dashoffset:29.7833385;stroke-dasharray:29.7833385}.mdc-checkbox__mixedmark{width:100%;height:0;transform:scaleX(0) rotate(0deg);border-width:1px;border-style:solid;opacity:0;transition:opacity 90ms 0ms cubic-bezier(0.4, 0, 0.6, 1),transform 90ms 0ms cubic-bezier(0.4, 0, 0.6, 1)}.mdc-checkbox--anim-unchecked-checked .mdc-checkbox__background,.mdc-checkbox--anim-unchecked-indeterminate .mdc-checkbox__background,.mdc-checkbox--anim-checked-unchecked .mdc-checkbox__background,.mdc-checkbox--anim-indeterminate-unchecked .mdc-checkbox__background{animation-duration:180ms;animation-timing-function:linear}.mdc-checkbox--anim-unchecked-checked .mdc-checkbox__checkmark-path{animation:mdc-checkbox-unchecked-checked-checkmark-path 180ms linear 0s;transition:none}.mdc-checkbox--anim-unchecked-indeterminate .mdc-checkbox__mixedmark{animation:mdc-checkbox-unchecked-indeterminate-mixedmark 90ms linear 0s;transition:none}.mdc-checkbox--anim-checked-unchecked .mdc-checkbox__checkmark-path{animation:mdc-checkbox-checked-unchecked-checkmark-path 90ms linear 0s;transition:none}.mdc-checkbox--anim-checked-indeterminate .mdc-checkbox__checkmark{animation:mdc-checkbox-checked-indeterminate-checkmark 90ms linear 0s;transition:none}.mdc-checkbox--anim-checked-indeterminate .mdc-checkbox__mixedmark{animation:mdc-checkbox-checked-indeterminate-mixedmark 90ms linear 0s;transition:none}.mdc-checkbox--anim-indeterminate-checked .mdc-checkbox__checkmark{animation:mdc-checkbox-indeterminate-checked-checkmark 500ms linear 0s;transition:none}.mdc-checkbox--anim-indeterminate-checked .mdc-checkbox__mixedmark{animation:mdc-checkbox-indeterminate-checked-mixedmark 500ms linear 0s;transition:none}.mdc-checkbox--anim-indeterminate-unchecked .mdc-checkbox__mixedmark{animation:mdc-checkbox-indeterminate-unchecked-mixedmark 300ms linear 0s;transition:none}.mdc-checkbox__native-control:checked~.mdc-checkbox__background,.mdc-checkbox__native-control:indeterminate~.mdc-checkbox__background,.mdc-checkbox__native-control[data-indeterminate=true]~.mdc-checkbox__background{transition:border-color 90ms 0ms cubic-bezier(0, 0, 0.2, 1),background-color 90ms 0ms cubic-bezier(0, 0, 0.2, 1)}.mdc-checkbox__native-control:checked~.mdc-checkbox__background .mdc-checkbox__checkmark-path,.mdc-checkbox__native-control:indeterminate~.mdc-checkbox__background .mdc-checkbox__checkmark-path,.mdc-checkbox__native-control[data-indeterminate=true]~.mdc-checkbox__background .mdc-checkbox__checkmark-path{stroke-dashoffset:0}.mdc-checkbox__native-control{position:absolute;margin:0;padding:0;opacity:0;cursor:inherit}.mdc-checkbox__native-control:disabled{cursor:default;pointer-events:none}.mdc-checkbox--touch{margin:calc((var(--mdc-checkbox-state-layer-size) - var(--mdc-checkbox-state-layer-size)) / 2)}.mdc-checkbox--touch .mdc-checkbox__native-control{top:calc((var(--mdc-checkbox-state-layer-size) - var(--mdc-checkbox-state-layer-size)) / 2);right:calc((var(--mdc-checkbox-state-layer-size) - var(--mdc-checkbox-state-layer-size)) / 2);left:calc((var(--mdc-checkbox-state-layer-size) - var(--mdc-checkbox-state-layer-size)) / 2);width:var(--mdc-checkbox-state-layer-size);height:var(--mdc-checkbox-state-layer-size)}.mdc-checkbox__native-control:checked~.mdc-checkbox__background .mdc-checkbox__checkmark{transition:opacity 180ms 0ms cubic-bezier(0, 0, 0.2, 1),transform 180ms 0ms cubic-bezier(0, 0, 0.2, 1);opacity:1}.mdc-checkbox__native-control:checked~.mdc-checkbox__background .mdc-checkbox__mixedmark{transform:scaleX(1) rotate(-45deg)}.mdc-checkbox__native-control:indeterminate~.mdc-checkbox__background .mdc-checkbox__checkmark,.mdc-checkbox__native-control[data-indeterminate=true]~.mdc-checkbox__background .mdc-checkbox__checkmark{transform:rotate(45deg);opacity:0;transition:opacity 90ms 0ms cubic-bezier(0.4, 0, 0.6, 1),transform 90ms 0ms cubic-bezier(0.4, 0, 0.6, 1)}.mdc-checkbox__native-control:indeterminate~.mdc-checkbox__background .mdc-checkbox__mixedmark,.mdc-checkbox__native-control[data-indeterminate=true]~.mdc-checkbox__background .mdc-checkbox__mixedmark{transform:scaleX(1) rotate(0deg);opacity:1}.mdc-checkbox.mdc-checkbox--upgraded .mdc-checkbox__background,.mdc-checkbox.mdc-checkbox--upgraded .mdc-checkbox__checkmark,.mdc-checkbox.mdc-checkbox--upgraded .mdc-checkbox__checkmark-path,.mdc-checkbox.mdc-checkbox--upgraded .mdc-checkbox__mixedmark{transition:none}.mdc-form-field{display:inline-flex;align-items:center;vertical-align:middle}.mdc-form-field[hidden]{display:none}.mdc-form-field>label{margin-left:0;margin-right:auto;padding-left:4px;padding-right:0;order:0}[dir=rtl] .mdc-form-field>label,.mdc-form-field>label[dir=rtl]{margin-left:auto;margin-right:0}[dir=rtl] .mdc-form-field>label,.mdc-form-field>label[dir=rtl]{padding-left:0;padding-right:4px}.mdc-form-field--nowrap>label{text-overflow:ellipsis;overflow:hidden;white-space:nowrap}.mdc-form-field--align-end>label{margin-left:auto;margin-right:0;padding-left:0;padding-right:4px;order:-1}[dir=rtl] .mdc-form-field--align-end>label,.mdc-form-field--align-end>label[dir=rtl]{margin-left:0;margin-right:auto}[dir=rtl] .mdc-form-field--align-end>label,.mdc-form-field--align-end>label[dir=rtl]{padding-left:4px;padding-right:0}.mdc-form-field--space-between{justify-content:space-between}.mdc-form-field--space-between>label{margin:0}[dir=rtl] .mdc-form-field--space-between>label,.mdc-form-field--space-between>label[dir=rtl]{margin:0}.mdc-checkbox{padding:calc((var(--mdc-checkbox-state-layer-size) - 18px) / 2);margin:calc((var(--mdc-checkbox-state-layer-size) - var(--mdc-checkbox-state-layer-size)) / 2)}.mdc-checkbox .mdc-checkbox__native-control[disabled]:not(:checked):not(:indeterminate):not([data-indeterminate=true])~.mdc-checkbox__background{border-color:var(--mdc-checkbox-disabled-unselected-icon-color);background-color:transparent}.mdc-checkbox .mdc-checkbox__native-control[disabled]:checked~.mdc-checkbox__background,.mdc-checkbox .mdc-checkbox__native-control[disabled]:indeterminate~.mdc-checkbox__background,.mdc-checkbox .mdc-checkbox__native-control[data-indeterminate=true][disabled]~.mdc-checkbox__background{border-color:transparent;background-color:var(--mdc-checkbox-disabled-selected-icon-color)}.mdc-checkbox .mdc-checkbox__native-control:enabled~.mdc-checkbox__background .mdc-checkbox__checkmark{color:var(--mdc-checkbox-selected-checkmark-color)}.mdc-checkbox .mdc-checkbox__native-control:enabled~.mdc-checkbox__background .mdc-checkbox__mixedmark{border-color:var(--mdc-checkbox-selected-checkmark-color)}.mdc-checkbox .mdc-checkbox__native-control:disabled~.mdc-checkbox__background .mdc-checkbox__checkmark{color:var(--mdc-checkbox-disabled-selected-checkmark-color)}.mdc-checkbox .mdc-checkbox__native-control:disabled~.mdc-checkbox__background .mdc-checkbox__mixedmark{border-color:var(--mdc-checkbox-disabled-selected-checkmark-color)}.mdc-checkbox .mdc-checkbox__native-control:enabled:not(:checked):not(:indeterminate):not([data-indeterminate=true])~.mdc-checkbox__background{border-color:var(--mdc-checkbox-unselected-icon-color);background-color:transparent}.mdc-checkbox .mdc-checkbox__native-control:enabled:checked~.mdc-checkbox__background,.mdc-checkbox .mdc-checkbox__native-control:enabled:indeterminate~.mdc-checkbox__background,.mdc-checkbox .mdc-checkbox__native-control[data-indeterminate=true]:enabled~.mdc-checkbox__background{border-color:var(--mdc-checkbox-selected-icon-color);background-color:var(--mdc-checkbox-selected-icon-color)}@keyframes mdc-checkbox-fade-in-background-8A000000FFF4433600000000FFF44336{0%{border-color:var(--mdc-checkbox-unselected-icon-color);background-color:transparent}50%{border-color:var(--mdc-checkbox-selected-icon-color);background-color:var(--mdc-checkbox-selected-icon-color)}}@keyframes mdc-checkbox-fade-out-background-8A000000FFF4433600000000FFF44336{0%,80%{border-color:var(--mdc-checkbox-selected-icon-color);background-color:var(--mdc-checkbox-selected-icon-color)}100%{border-color:var(--mdc-checkbox-unselected-icon-color);background-color:transparent}}.mdc-checkbox.mdc-checkbox--anim-unchecked-checked .mdc-checkbox__native-control:enabled~.mdc-checkbox__background,.mdc-checkbox.mdc-checkbox--anim-unchecked-indeterminate .mdc-checkbox__native-control:enabled~.mdc-checkbox__background{animation-name:mdc-checkbox-fade-in-background-8A000000FFF4433600000000FFF44336}.mdc-checkbox.mdc-checkbox--anim-checked-unchecked .mdc-checkbox__native-control:enabled~.mdc-checkbox__background,.mdc-checkbox.mdc-checkbox--anim-indeterminate-unchecked .mdc-checkbox__native-control:enabled~.mdc-checkbox__background{animation-name:mdc-checkbox-fade-out-background-8A000000FFF4433600000000FFF44336}.mdc-checkbox:hover .mdc-checkbox__native-control:enabled:not(:checked):not(:indeterminate):not([data-indeterminate=true])~.mdc-checkbox__background{border-color:var(--mdc-checkbox-unselected-hover-icon-color);background-color:transparent}.mdc-checkbox:hover .mdc-checkbox__native-control:enabled:checked~.mdc-checkbox__background,.mdc-checkbox:hover .mdc-checkbox__native-control:enabled:indeterminate~.mdc-checkbox__background,.mdc-checkbox:hover .mdc-checkbox__native-control[data-indeterminate=true]:enabled~.mdc-checkbox__background{border-color:var(--mdc-checkbox-selected-hover-icon-color);background-color:var(--mdc-checkbox-selected-hover-icon-color)}@keyframes mdc-checkbox-fade-in-background-FF212121FFF4433600000000FFF44336{0%{border-color:var(--mdc-checkbox-unselected-hover-icon-color);background-color:transparent}50%{border-color:var(--mdc-checkbox-selected-hover-icon-color);background-color:var(--mdc-checkbox-selected-hover-icon-color)}}@keyframes mdc-checkbox-fade-out-background-FF212121FFF4433600000000FFF44336{0%,80%{border-color:var(--mdc-checkbox-selected-hover-icon-color);background-color:var(--mdc-checkbox-selected-hover-icon-color)}100%{border-color:var(--mdc-checkbox-unselected-hover-icon-color);background-color:transparent}}.mdc-checkbox:hover.mdc-checkbox--anim-unchecked-checked .mdc-checkbox__native-control:enabled~.mdc-checkbox__background,.mdc-checkbox:hover.mdc-checkbox--anim-unchecked-indeterminate .mdc-checkbox__native-control:enabled~.mdc-checkbox__background{animation-name:mdc-checkbox-fade-in-background-FF212121FFF4433600000000FFF44336}.mdc-checkbox:hover.mdc-checkbox--anim-checked-unchecked .mdc-checkbox__native-control:enabled~.mdc-checkbox__background,.mdc-checkbox:hover.mdc-checkbox--anim-indeterminate-unchecked .mdc-checkbox__native-control:enabled~.mdc-checkbox__background{animation-name:mdc-checkbox-fade-out-background-FF212121FFF4433600000000FFF44336}.mdc-checkbox:not(:disabled):active .mdc-checkbox__native-control:enabled:not(:checked):not(:indeterminate):not([data-indeterminate=true])~.mdc-checkbox__background{border-color:var(--mdc-checkbox-unselected-pressed-icon-color);background-color:transparent}.mdc-checkbox:not(:disabled):active .mdc-checkbox__native-control:enabled:checked~.mdc-checkbox__background,.mdc-checkbox:not(:disabled):active .mdc-checkbox__native-control:enabled:indeterminate~.mdc-checkbox__background,.mdc-checkbox:not(:disabled):active .mdc-checkbox__native-control[data-indeterminate=true]:enabled~.mdc-checkbox__background{border-color:var(--mdc-checkbox-selected-pressed-icon-color);background-color:var(--mdc-checkbox-selected-pressed-icon-color)}@keyframes mdc-checkbox-fade-in-background-8A000000FFF4433600000000FFF44336{0%{border-color:var(--mdc-checkbox-unselected-pressed-icon-color);background-color:transparent}50%{border-color:var(--mdc-checkbox-selected-pressed-icon-color);background-color:var(--mdc-checkbox-selected-pressed-icon-color)}}@keyframes mdc-checkbox-fade-out-background-8A000000FFF4433600000000FFF44336{0%,80%{border-color:var(--mdc-checkbox-selected-pressed-icon-color);background-color:var(--mdc-checkbox-selected-pressed-icon-color)}100%{border-color:var(--mdc-checkbox-unselected-pressed-icon-color);background-color:transparent}}.mdc-checkbox:not(:disabled):active.mdc-checkbox--anim-unchecked-checked .mdc-checkbox__native-control:enabled~.mdc-checkbox__background,.mdc-checkbox:not(:disabled):active.mdc-checkbox--anim-unchecked-indeterminate .mdc-checkbox__native-control:enabled~.mdc-checkbox__background{animation-name:mdc-checkbox-fade-in-background-8A000000FFF4433600000000FFF44336}.mdc-checkbox:not(:disabled):active.mdc-checkbox--anim-checked-unchecked .mdc-checkbox__native-control:enabled~.mdc-checkbox__background,.mdc-checkbox:not(:disabled):active.mdc-checkbox--anim-indeterminate-unchecked .mdc-checkbox__native-control:enabled~.mdc-checkbox__background{animation-name:mdc-checkbox-fade-out-background-8A000000FFF4433600000000FFF44336}.mdc-checkbox .mdc-checkbox__background{top:calc((var(--mdc-checkbox-state-layer-size) - 18px) / 2);left:calc((var(--mdc-checkbox-state-layer-size) - 18px) / 2)}.mdc-checkbox .mdc-checkbox__native-control{top:calc((var(--mdc-checkbox-state-layer-size) - var(--mdc-checkbox-state-layer-size)) / 2);right:calc((var(--mdc-checkbox-state-layer-size) - var(--mdc-checkbox-state-layer-size)) / 2);left:calc((var(--mdc-checkbox-state-layer-size) - var(--mdc-checkbox-state-layer-size)) / 2);width:var(--mdc-checkbox-state-layer-size);height:var(--mdc-checkbox-state-layer-size)}.mdc-checkbox .mdc-checkbox__native-control:enabled:focus:focus:not(:checked):not(:indeterminate)~.mdc-checkbox__background{border-color:var(--mdc-checkbox-unselected-focus-icon-color)}.mdc-checkbox .mdc-checkbox__native-control:enabled:focus:checked~.mdc-checkbox__background,.mdc-checkbox .mdc-checkbox__native-control:enabled:focus:indeterminate~.mdc-checkbox__background{border-color:var(--mdc-checkbox-selected-focus-icon-color);background-color:var(--mdc-checkbox-selected-focus-icon-color)}.mdc-checkbox:hover .mdc-checkbox__ripple{opacity:var(--mdc-checkbox-unselected-hover-state-layer-opacity);background-color:var(--mdc-checkbox-unselected-hover-state-layer-color)}.mdc-checkbox:hover .mat-mdc-checkbox-ripple .mat-ripple-element{background-color:var(--mdc-checkbox-unselected-hover-state-layer-color)}.mdc-checkbox .mdc-checkbox__native-control:focus~.mdc-checkbox__ripple{opacity:var(--mdc-checkbox-unselected-focus-state-layer-opacity);background-color:var(--mdc-checkbox-unselected-focus-state-layer-color)}.mdc-checkbox .mdc-checkbox__native-control:focus~.mat-mdc-checkbox-ripple .mat-ripple-element{background-color:var(--mdc-checkbox-unselected-focus-state-layer-color)}.mdc-checkbox:active .mdc-checkbox__native-control~.mdc-checkbox__ripple{opacity:var(--mdc-checkbox-unselected-pressed-state-layer-opacity);background-color:var(--mdc-checkbox-unselected-pressed-state-layer-color)}.mdc-checkbox:active .mdc-checkbox__native-control~.mat-mdc-checkbox-ripple .mat-ripple-element{background-color:var(--mdc-checkbox-unselected-pressed-state-layer-color)}.mdc-checkbox:hover .mdc-checkbox__native-control:checked~.mdc-checkbox__ripple{opacity:var(--mdc-checkbox-selected-hover-state-layer-opacity);background-color:var(--mdc-checkbox-selected-hover-state-layer-color)}.mdc-checkbox:hover .mdc-checkbox__native-control:checked~.mat-mdc-checkbox-ripple .mat-ripple-element{background-color:var(--mdc-checkbox-selected-hover-state-layer-color)}.mdc-checkbox .mdc-checkbox__native-control:focus:checked~.mdc-checkbox__ripple{opacity:var(--mdc-checkbox-selected-focus-state-layer-opacity);background-color:var(--mdc-checkbox-selected-focus-state-layer-color)}.mdc-checkbox .mdc-checkbox__native-control:focus:checked~.mat-mdc-checkbox-ripple .mat-ripple-element{background-color:var(--mdc-checkbox-selected-focus-state-layer-color)}.mdc-checkbox:active .mdc-checkbox__native-control:checked~.mdc-checkbox__ripple{opacity:var(--mdc-checkbox-selected-pressed-state-layer-opacity);background-color:var(--mdc-checkbox-selected-pressed-state-layer-color)}.mdc-checkbox:active .mdc-checkbox__native-control:checked~.mat-mdc-checkbox-ripple .mat-ripple-element{background-color:var(--mdc-checkbox-selected-pressed-state-layer-color)}html{--mdc-checkbox-disabled-selected-checkmark-color:#fff;--mdc-checkbox-selected-focus-state-layer-opacity:0.16;--mdc-checkbox-selected-hover-state-layer-opacity:0.04;--mdc-checkbox-selected-pressed-state-layer-opacity:0.16;--mdc-checkbox-unselected-focus-state-layer-opacity:0.16;--mdc-checkbox-unselected-hover-state-layer-opacity:0.04;--mdc-checkbox-unselected-pressed-state-layer-opacity:0.16}.mat-mdc-checkbox{display:inline-block;position:relative;-webkit-tap-highlight-color:rgba(0,0,0,0)}.mat-mdc-checkbox .mdc-checkbox__background{-webkit-print-color-adjust:exact;color-adjust:exact}.mat-mdc-checkbox._mat-animation-noopable *,.mat-mdc-checkbox._mat-animation-noopable *::before{transition:none !important;animation:none !important}.mat-mdc-checkbox label{cursor:pointer}.mat-mdc-checkbox.mat-mdc-checkbox-disabled label{cursor:default}.mat-mdc-checkbox label:empty{display:none}.cdk-high-contrast-active .mat-mdc-checkbox.mat-mdc-checkbox-disabled{opacity:.5}.cdk-high-contrast-active .mat-mdc-checkbox .mdc-checkbox__checkmark{--mdc-checkbox-selected-checkmark-color: CanvasText;--mdc-checkbox-disabled-selected-checkmark-color: CanvasText}.mat-mdc-checkbox .mdc-checkbox__ripple{opacity:0}.mat-mdc-checkbox-ripple,.mdc-checkbox__ripple{top:0;left:0;right:0;bottom:0;position:absolute;border-radius:50%;pointer-events:none}.mat-mdc-checkbox-ripple:not(:empty),.mdc-checkbox__ripple:not(:empty){transform:translateZ(0)}.mat-mdc-checkbox-ripple .mat-ripple-element{opacity:.1}.mat-mdc-checkbox-touch-target{position:absolute;top:50%;height:48px;left:50%;width:48px;transform:translate(-50%, -50%)}.mat-mdc-checkbox-ripple::before{border-radius:50%}.mdc-checkbox__native-control:focus~.mat-mdc-focus-indicator::before{content:""}'],encapsulation:2,changeDetection:0}),Pe})(),Gt=(()=>{var Qe;class Pe{}return(Qe=Pe).\u0275fac=function(rt){return new(rt||Qe)},Qe.\u0275mod=T.oAB({type:Qe}),Qe.\u0275inj=T.cJS({}),Pe})(),Tt=(()=>{var Qe;class Pe{}return(Qe=Pe).\u0275fac=function(rt){return new(rt||Qe)},Qe.\u0275mod=T.oAB({type:Qe}),Qe.\u0275inj=T.cJS({imports:[ai.BQ,ai.si,Gt,ai.BQ,Gt]}),Pe})()},8034:(zn,Pi,Ne)=>{"use strict";Ne.d(Pi,{FA:()=>F,Mq:()=>di,_H:()=>xe,hl:()=>Bi,nW:()=>Ka});var T=Ne(4300),mt=Ne(3651),ai=Ne(8484),s=Ne(6814),M=Ne(5879),wt=Ne(2296),nt=Ne(9829),Fe=Ne(3680),dt=Ne(8645),zt=Ne(7394),Ht=Ne(3019),ti=Ne(2096),lt=Ne(6028),Bt=Ne(9388),Jt=Ne(2831),Xt=Ne(8180),ft=Ne(7921),bt=Ne(2181),Gt=Ne(2495),Tt=Ne(6825),Qe=Ne(6223),Pe=Ne(4170),ui=Ne(2032);const rt=["mat-calendar-body",""];function De(R,ie){if(1&R&&(M.TgZ(0,"tr",3)(1,"td",4),M._uU(2),M.qZA()()),2&R){const q=M.oxw();M.xp6(1),M.Udp("padding-top",q._cellPadding)("padding-bottom",q._cellPadding),M.uIk("colspan",q.numCols),M.xp6(1),M.hij(" ",q.label," ")}}function at(R,ie){if(1&R&&(M.TgZ(0,"td",4),M._uU(1),M.qZA()),2&R){const q=M.oxw(2);M.Udp("padding-top",q._cellPadding)("padding-bottom",q._cellPadding),M.uIk("colspan",q._firstRowOffset),M.xp6(1),M.hij(" ",q._firstRowOffset>=q.labelMinRequiredCells?q.label:""," ")}}function Ie(R,ie){if(1&R){const q=M.EpF();M.TgZ(0,"td",8)(1,"button",9),M.NdJ("click",function(I){const W=M.CHM(q).$implicit,se=M.oxw(2);return M.KtG(se._cellClicked(W,I))})("focus",function(I){const W=M.CHM(q).$implicit,se=M.oxw(2);return M.KtG(se._emitActiveDateChange(W,I))}),M.TgZ(2,"span",10),M._uU(3),M.qZA(),M._UZ(4,"span",11),M.qZA()()}if(2&R){const q=ie.$implicit,b=ie.index,I=M.oxw().index,z=M.oxw();M.Udp("width",z._cellWidth)("padding-top",z._cellPadding)("padding-bottom",z._cellPadding),M.uIk("data-mat-row",I)("data-mat-col",b),M.xp6(1),M.ekj("mat-calendar-body-disabled",!q.enabled)("mat-calendar-body-active",z._isActiveCell(I,b))("mat-calendar-body-range-start",z._isRangeStart(q.compareValue))("mat-calendar-body-range-end",z._isRangeEnd(q.compareValue))("mat-calendar-body-in-range",z._isInRange(q.compareValue))("mat-calendar-body-comparison-bridge-start",z._isComparisonBridgeStart(q.compareValue,I,b))("mat-calendar-body-comparison-bridge-end",z._isComparisonBridgeEnd(q.compareValue,I,b))("mat-calendar-body-comparison-start",z._isComparisonStart(q.compareValue))("mat-calendar-body-comparison-end",z._isComparisonEnd(q.compareValue))("mat-calendar-body-in-comparison-range",z._isInComparisonRange(q.compareValue))("mat-calendar-body-preview-start",z._isPreviewStart(q.compareValue))("mat-calendar-body-preview-end",z._isPreviewEnd(q.compareValue))("mat-calendar-body-in-preview",z._isInPreview(q.compareValue)),M.Q6J("ngClass",q.cssClasses)("tabindex",z._isActiveCell(I,b)?0:-1),M.uIk("aria-label",q.ariaLabel)("aria-disabled",!q.enabled||null)("aria-pressed",z._isSelected(q.compareValue))("aria-current",z.todayValue===q.compareValue?"date":null)("aria-describedby",z._getDescribedby(q.compareValue)),M.xp6(1),M.ekj("mat-calendar-body-selected",z._isSelected(q.compareValue))("mat-calendar-body-comparison-identical",z._isComparisonIdentical(q.compareValue))("mat-calendar-body-today",z.todayValue===q.compareValue),M.xp6(1),M.hij(" ",q.displayValue," ")}}function Je(R,ie){if(1&R&&(M.TgZ(0,"tr",5),M.YNc(1,at,2,6,"td",6),M.YNc(2,Ie,5,48,"td",7),M.qZA()),2&R){const q=ie.$implicit,b=ie.index,I=M.oxw();M.xp6(1),M.Q6J("ngIf",0===b&&I._firstRowOffset),M.xp6(1),M.Q6J("ngForOf",q)}}function Ce(R,ie){if(1&R&&(M.TgZ(0,"th",5)(1,"span",6),M._uU(2),M.qZA(),M.TgZ(3,"span",7),M._uU(4),M.qZA()()),2&R){const q=ie.$implicit;M.xp6(2),M.Oqu(q.long),M.xp6(2),M.Oqu(q.narrow)}}const Ue=["*"];function Ee(R,ie){}function Me(R,ie){if(1&R){const q=M.EpF();M.TgZ(0,"mat-month-view",5),M.NdJ("activeDateChange",function(I){M.CHM(q);const z=M.oxw();return M.KtG(z.activeDate=I)})("_userSelection",function(I){M.CHM(q);const z=M.oxw();return M.KtG(z._dateSelected(I))})("dragStarted",function(I){M.CHM(q);const z=M.oxw();return M.KtG(z._dragStarted(I))})("dragEnded",function(I){M.CHM(q);const z=M.oxw();return M.KtG(z._dragEnded(I))}),M.qZA()}if(2&R){const q=M.oxw();M.Q6J("activeDate",q.activeDate)("selected",q.selected)("dateFilter",q.dateFilter)("maxDate",q.maxDate)("minDate",q.minDate)("dateClass",q.dateClass)("comparisonStart",q.comparisonStart)("comparisonEnd",q.comparisonEnd)("startDateAccessibleName",q.startDateAccessibleName)("endDateAccessibleName",q.endDateAccessibleName)("activeDrag",q._activeDrag)}}function st(R,ie){if(1&R){const q=M.EpF();M.TgZ(0,"mat-year-view",6),M.NdJ("activeDateChange",function(I){M.CHM(q);const z=M.oxw();return M.KtG(z.activeDate=I)})("monthSelected",function(I){M.CHM(q);const z=M.oxw();return M.KtG(z._monthSelectedInYearView(I))})("selectedChange",function(I){M.CHM(q);const z=M.oxw();return M.KtG(z._goToDateInView(I,"month"))}),M.qZA()}if(2&R){const q=M.oxw();M.Q6J("activeDate",q.activeDate)("selected",q.selected)("dateFilter",q.dateFilter)("maxDate",q.maxDate)("minDate",q.minDate)("dateClass",q.dateClass)}}function jt(R,ie){if(1&R){const q=M.EpF();M.TgZ(0,"mat-multi-year-view",7),M.NdJ("activeDateChange",function(I){M.CHM(q);const z=M.oxw();return M.KtG(z.activeDate=I)})("yearSelected",function(I){M.CHM(q);const z=M.oxw();return M.KtG(z._yearSelectedInMultiYearView(I))})("selectedChange",function(I){M.CHM(q);const z=M.oxw();return M.KtG(z._goToDateInView(I,"year"))}),M.qZA()}if(2&R){const q=M.oxw();M.Q6J("activeDate",q.activeDate)("selected",q.selected)("dateFilter",q.dateFilter)("maxDate",q.maxDate)("minDate",q.minDate)("dateClass",q.dateClass)}}function Pt(R,ie){}const Mt=["button"];function Dt(R,ie){1&R&&(M.O4$(),M.TgZ(0,"svg",3),M._UZ(1,"path",4),M.qZA())}const Qt=[[["","matDatepickerToggleIcon",""]]],zi=["[matDatepickerToggleIcon]"];let yt=(()=>{var R;class ie{constructor(){this.changes=new dt.x,this.calendarLabel="Calendar",this.openCalendarLabel="Open calendar",this.closeCalendarLabel="Close calendar",this.prevMonthLabel="Previous month",this.nextMonthLabel="Next month",this.prevYearLabel="Previous year",this.nextYearLabel="Next year",this.prevMultiYearLabel="Previous 24 years",this.nextMultiYearLabel="Next 24 years",this.switchToMonthViewLabel="Choose date",this.switchToMultiYearViewLabel="Choose month and year",this.startDateLabel="Start date",this.endDateLabel="End date"}formatYearRange(b,I){return`${b} \u2013 ${I}`}formatYearRangeLabel(b,I){return`${b} to ${I}`}}return(R=ie).\u0275fac=function(b){return new(b||R)},R.\u0275prov=M.Yz7({token:R,factory:R.\u0275fac,providedIn:"root"}),ie})();class en{constructor(ie,q,b,I,z={},W=ie,se){this.value=ie,this.displayValue=q,this.ariaLabel=b,this.enabled=I,this.cssClasses=z,this.compareValue=W,this.rawValue=se}}let Di=1;const lr=(0,Jt.i$)({passive:!1,capture:!0}),ii=(0,Jt.i$)({passive:!0,capture:!0}),qi=(0,Jt.i$)({passive:!0});let bn=(()=>{var R;class ie{ngAfterViewChecked(){this._focusActiveCellAfterViewChecked&&(this._focusActiveCell(),this._focusActiveCellAfterViewChecked=!1)}constructor(b,I){this._elementRef=b,this._ngZone=I,this._platform=(0,M.f3M)(Jt.t4),this._focusActiveCellAfterViewChecked=!1,this.numCols=7,this.activeCell=0,this.isRange=!1,this.cellAspectRatio=1,this.previewStart=null,this.previewEnd=null,this.selectedValueChange=new M.vpe,this.previewChange=new M.vpe,this.activeDateChange=new M.vpe,this.dragStarted=new M.vpe,this.dragEnded=new M.vpe,this._didDragSinceMouseDown=!1,this._enterHandler=z=>{if(this._skipNextFocus&&"focus"===z.type)this._skipNextFocus=!1;else if(z.target&&this.isRange){const W=this._getCellFromElement(z.target);W&&this._ngZone.run(()=>this.previewChange.emit({value:W.enabled?W:null,event:z}))}},this._touchmoveHandler=z=>{if(!this.isRange)return;const W=On(z),se=W?this._getCellFromElement(W):null;W!==z.target&&(this._didDragSinceMouseDown=!0),tn(z.target)&&z.preventDefault(),this._ngZone.run(()=>this.previewChange.emit({value:se?.enabled?se:null,event:z}))},this._leaveHandler=z=>{null!==this.previewEnd&&this.isRange&&("blur"!==z.type&&(this._didDragSinceMouseDown=!0),z.target&&this._getCellFromElement(z.target)&&(!z.relatedTarget||!this._getCellFromElement(z.relatedTarget))&&this._ngZone.run(()=>this.previewChange.emit({value:null,event:z})))},this._mousedownHandler=z=>{if(!this.isRange)return;this._didDragSinceMouseDown=!1;const W=z.target&&this._getCellFromElement(z.target);!W||!this._isInRange(W.rawValue)||this._ngZone.run(()=>{this.dragStarted.emit({value:W.rawValue,event:z})})},this._mouseupHandler=z=>{if(!this.isRange)return;const W=tn(z.target);W?W.closest(".mat-calendar-body")===this._elementRef.nativeElement&&this._ngZone.run(()=>{const se=this._getCellFromElement(W);this.dragEnded.emit({value:se?.rawValue??null,event:z})}):this._ngZone.run(()=>{this.dragEnded.emit({value:null,event:z})})},this._touchendHandler=z=>{const W=On(z);W&&this._mouseupHandler({target:W})},this._id="mat-calendar-body-"+Di++,this._startDateLabelId=`${this._id}-start-date`,this._endDateLabelId=`${this._id}-end-date`,I.runOutsideAngular(()=>{const z=b.nativeElement;z.addEventListener("touchmove",this._touchmoveHandler,lr),z.addEventListener("mouseenter",this._enterHandler,ii),z.addEventListener("focus",this._enterHandler,ii),z.addEventListener("mouseleave",this._leaveHandler,ii),z.addEventListener("blur",this._leaveHandler,ii),z.addEventListener("mousedown",this._mousedownHandler,qi),z.addEventListener("touchstart",this._mousedownHandler,qi),this._platform.isBrowser&&(window.addEventListener("mouseup",this._mouseupHandler),window.addEventListener("touchend",this._touchendHandler))})}_cellClicked(b,I){this._didDragSinceMouseDown||b.enabled&&this.selectedValueChange.emit({value:b.value,event:I})}_emitActiveDateChange(b,I){b.enabled&&this.activeDateChange.emit({value:b.value,event:I})}_isSelected(b){return this.startValue===b||this.endValue===b}ngOnChanges(b){const I=b.numCols,{rows:z,numCols:W}=this;(b.rows||I)&&(this._firstRowOffset=z&&z.length&&z[0].length?W-z[0].length:0),(b.cellAspectRatio||I||!this._cellPadding)&&(this._cellPadding=50*this.cellAspectRatio/W+"%"),(I||!this._cellWidth)&&(this._cellWidth=100/W+"%")}ngOnDestroy(){const b=this._elementRef.nativeElement;b.removeEventListener("touchmove",this._touchmoveHandler,lr),b.removeEventListener("mouseenter",this._enterHandler,ii),b.removeEventListener("focus",this._enterHandler,ii),b.removeEventListener("mouseleave",this._leaveHandler,ii),b.removeEventListener("blur",this._leaveHandler,ii),b.removeEventListener("mousedown",this._mousedownHandler,qi),b.removeEventListener("touchstart",this._mousedownHandler,qi),this._platform.isBrowser&&(window.removeEventListener("mouseup",this._mouseupHandler),window.removeEventListener("touchend",this._touchendHandler))}_isActiveCell(b,I){let z=b*this.numCols+I;return b&&(z-=this._firstRowOffset),z==this.activeCell}_focusActiveCell(b=!0){this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.pipe((0,Xt.q)(1)).subscribe(()=>{setTimeout(()=>{const I=this._elementRef.nativeElement.querySelector(".mat-calendar-body-active");I&&(b||(this._skipNextFocus=!0),I.focus())})})})}_scheduleFocusActiveCellAfterViewChecked(){this._focusActiveCellAfterViewChecked=!0}_isRangeStart(b){return Gn(b,this.startValue,this.endValue)}_isRangeEnd(b){return Rn(b,this.startValue,this.endValue)}_isInRange(b){return En(b,this.startValue,this.endValue,this.isRange)}_isComparisonStart(b){return Gn(b,this.comparisonStart,this.comparisonEnd)}_isComparisonBridgeStart(b,I,z){if(!this._isComparisonStart(b)||this._isRangeStart(b)||!this._isInRange(b))return!1;let W=this.rows[I][z-1];if(!W){const se=this.rows[I-1];W=se&&se[se.length-1]}return W&&!this._isRangeEnd(W.compareValue)}_isComparisonBridgeEnd(b,I,z){if(!this._isComparisonEnd(b)||this._isRangeEnd(b)||!this._isInRange(b))return!1;let W=this.rows[I][z+1];if(!W){const se=this.rows[I+1];W=se&&se[0]}return W&&!this._isRangeStart(W.compareValue)}_isComparisonEnd(b){return Rn(b,this.comparisonStart,this.comparisonEnd)}_isInComparisonRange(b){return En(b,this.comparisonStart,this.comparisonEnd,this.isRange)}_isComparisonIdentical(b){return this.comparisonStart===this.comparisonEnd&&b===this.comparisonStart}_isPreviewStart(b){return Gn(b,this.previewStart,this.previewEnd)}_isPreviewEnd(b){return Rn(b,this.previewStart,this.previewEnd)}_isInPreview(b){return En(b,this.previewStart,this.previewEnd,this.isRange)}_getDescribedby(b){return this.isRange?this.startValue===b&&this.endValue===b?`${this._startDateLabelId} ${this._endDateLabelId}`:this.startValue===b?this._startDateLabelId:this.endValue===b?this._endDateLabelId:null:null}_getCellFromElement(b){const I=tn(b);if(I){const z=I.getAttribute("data-mat-row"),W=I.getAttribute("data-mat-col");if(z&&W)return this.rows[parseInt(z)][parseInt(W)]}return null}}return(R=ie).\u0275fac=function(b){return new(b||R)(M.Y36(M.SBq),M.Y36(M.R0b))},R.\u0275cmp=M.Xpm({type:R,selectors:[["","mat-calendar-body",""]],hostAttrs:[1,"mat-calendar-body"],inputs:{label:"label",rows:"rows",todayValue:"todayValue",startValue:"startValue",endValue:"endValue",labelMinRequiredCells:"labelMinRequiredCells",numCols:"numCols",activeCell:"activeCell",isRange:"isRange",cellAspectRatio:"cellAspectRatio",comparisonStart:"comparisonStart",comparisonEnd:"comparisonEnd",previewStart:"previewStart",previewEnd:"previewEnd",startDateAccessibleName:"startDateAccessibleName",endDateAccessibleName:"endDateAccessibleName"},outputs:{selectedValueChange:"selectedValueChange",previewChange:"previewChange",activeDateChange:"activeDateChange",dragStarted:"dragStarted",dragEnded:"dragEnded"},exportAs:["matCalendarBody"],features:[M.TTD],attrs:rt,decls:6,vars:6,consts:[["aria-hidden","true",4,"ngIf"],["role","row",4,"ngFor","ngForOf"],[1,"mat-calendar-body-hidden-label",3,"id"],["aria-hidden","true"],[1,"mat-calendar-body-label"],["role","row"],["class","mat-calendar-body-label",3,"paddingTop","paddingBottom",4,"ngIf"],["role","gridcell","class","mat-calendar-body-cell-container",3,"width","paddingTop","paddingBottom",4,"ngFor","ngForOf"],["role","gridcell",1,"mat-calendar-body-cell-container"],["type","button",1,"mat-calendar-body-cell",3,"ngClass","tabindex","click","focus"],[1,"mat-calendar-body-cell-content","mat-focus-indicator"],["aria-hidden","true",1,"mat-calendar-body-cell-preview"]],template:function(b,I){1&b&&(M.YNc(0,De,3,6,"tr",0),M.YNc(1,Je,3,2,"tr",1),M.TgZ(2,"label",2),M._uU(3),M.qZA(),M.TgZ(4,"label",2),M._uU(5),M.qZA()),2&b&&(M.Q6J("ngIf",I._firstRowOffset<I.labelMinRequiredCells),M.xp6(1),M.Q6J("ngForOf",I.rows),M.xp6(1),M.Q6J("id",I._startDateLabelId),M.xp6(1),M.hij(" ",I.startDateAccessibleName,"\n"),M.xp6(1),M.Q6J("id",I._endDateLabelId),M.xp6(1),M.hij(" ",I.endDateAccessibleName,"\n"))},dependencies:[s.mk,s.sg,s.O5],styles:['.mat-calendar-body{min-width:224px}.mat-calendar-body-today:not(.mat-calendar-body-selected):not(.mat-calendar-body-comparison-identical){border-color:var(--mat-datepicker-calendar-date-today-outline-color)}.mat-calendar-body-label{height:0;line-height:0;text-align:left;padding-left:4.7142857143%;padding-right:4.7142857143%;font-size:var(--mat-datepicker-calendar-body-label-text-size);font-weight:var(--mat-datepicker-calendar-body-label-text-weight);color:var(--mat-datepicker-calendar-body-label-text-color)}.mat-calendar-body-hidden-label{display:none}.mat-calendar-body-cell-container{position:relative;height:0;line-height:0}.mat-calendar-body-cell{-webkit-user-select:none;user-select:none;cursor:pointer;outline:none;border:none;-webkit-tap-highlight-color:rgba(0,0,0,0);position:absolute;top:0;left:0;width:100%;height:100%;background:none;text-align:center;outline:none;font-family:inherit;margin:0}.mat-calendar-body-cell::-moz-focus-inner{border:0}.mat-calendar-body-cell::before,.mat-calendar-body-cell::after,.mat-calendar-body-cell-preview{content:"";position:absolute;top:5%;left:0;z-index:0;box-sizing:border-box;display:block;height:90%;width:100%}.mat-calendar-body-range-start:not(.mat-calendar-body-in-comparison-range)::before,.mat-calendar-body-range-start::after,.mat-calendar-body-comparison-start:not(.mat-calendar-body-comparison-bridge-start)::before,.mat-calendar-body-comparison-start::after,.mat-calendar-body-preview-start .mat-calendar-body-cell-preview{left:5%;width:95%;border-top-left-radius:999px;border-bottom-left-radius:999px}[dir=rtl] .mat-calendar-body-range-start:not(.mat-calendar-body-in-comparison-range)::before,[dir=rtl] .mat-calendar-body-range-start::after,[dir=rtl] .mat-calendar-body-comparison-start:not(.mat-calendar-body-comparison-bridge-start)::before,[dir=rtl] .mat-calendar-body-comparison-start::after,[dir=rtl] .mat-calendar-body-preview-start .mat-calendar-body-cell-preview{left:0;border-radius:0;border-top-right-radius:999px;border-bottom-right-radius:999px}.mat-calendar-body-range-end:not(.mat-calendar-body-in-comparison-range)::before,.mat-calendar-body-range-end::after,.mat-calendar-body-comparison-end:not(.mat-calendar-body-comparison-bridge-end)::before,.mat-calendar-body-comparison-end::after,.mat-calendar-body-preview-end .mat-calendar-body-cell-preview{width:95%;border-top-right-radius:999px;border-bottom-right-radius:999px}[dir=rtl] .mat-calendar-body-range-end:not(.mat-calendar-body-in-comparison-range)::before,[dir=rtl] .mat-calendar-body-range-end::after,[dir=rtl] .mat-calendar-body-comparison-end:not(.mat-calendar-body-comparison-bridge-end)::before,[dir=rtl] .mat-calendar-body-comparison-end::after,[dir=rtl] .mat-calendar-body-preview-end .mat-calendar-body-cell-preview{left:5%;border-radius:0;border-top-left-radius:999px;border-bottom-left-radius:999px}[dir=rtl] .mat-calendar-body-comparison-bridge-start.mat-calendar-body-range-end::after,[dir=rtl] .mat-calendar-body-comparison-bridge-end.mat-calendar-body-range-start::after{width:95%;border-top-right-radius:999px;border-bottom-right-radius:999px}.mat-calendar-body-comparison-start.mat-calendar-body-range-end::after,[dir=rtl] .mat-calendar-body-comparison-start.mat-calendar-body-range-end::after,.mat-calendar-body-comparison-end.mat-calendar-body-range-start::after,[dir=rtl] .mat-calendar-body-comparison-end.mat-calendar-body-range-start::after{width:90%}.mat-calendar-body-in-preview{color:var(--mat-datepicker-calendar-date-preview-state-outline-color)}.mat-calendar-body-in-preview .mat-calendar-body-cell-preview{border-top:dashed 1px;border-bottom:dashed 1px}.mat-calendar-body-preview-start .mat-calendar-body-cell-preview{border-left:dashed 1px}[dir=rtl] .mat-calendar-body-preview-start .mat-calendar-body-cell-preview{border-left:0;border-right:dashed 1px}.mat-calendar-body-preview-end .mat-calendar-body-cell-preview{border-right:dashed 1px}[dir=rtl] .mat-calendar-body-preview-end .mat-calendar-body-cell-preview{border-right:0;border-left:dashed 1px}.mat-calendar-body-disabled{cursor:default}.mat-calendar-body-disabled>.mat-calendar-body-cell-content:not(.mat-calendar-body-selected):not(.mat-calendar-body-comparison-identical){color:var(--mat-datepicker-calendar-date-disabled-state-text-color)}.mat-calendar-body-disabled>.mat-calendar-body-today:not(.mat-calendar-body-selected):not(.mat-calendar-body-comparison-identical){border-color:var(--mat-datepicker-calendar-date-today-disabled-state-outline-color)}.cdk-high-contrast-active .mat-calendar-body-disabled{opacity:.5}.mat-calendar-body-cell-content{top:5%;left:5%;z-index:1;display:flex;align-items:center;justify-content:center;box-sizing:border-box;width:90%;height:90%;line-height:1;border-width:1px;border-style:solid;border-radius:999px;color:var(--mat-datepicker-calendar-date-text-color);border-color:var(--mat-datepicker-calendar-date-outline-color)}.mat-calendar-body-cell-content.mat-focus-indicator{position:absolute}.cdk-high-contrast-active .mat-calendar-body-cell-content{border:none}.cdk-keyboard-focused .mat-calendar-body-active>.mat-calendar-body-cell-content:not(.mat-calendar-body-selected):not(.mat-calendar-body-comparison-identical),.cdk-program-focused .mat-calendar-body-active>.mat-calendar-body-cell-content:not(.mat-calendar-body-selected):not(.mat-calendar-body-comparison-identical){background-color:var(--mat-datepicker-calendar-date-focus-state-background-color)}@media(hover: hover){.mat-calendar-body-cell:not(.mat-calendar-body-disabled):hover>.mat-calendar-body-cell-content:not(.mat-calendar-body-selected):not(.mat-calendar-body-comparison-identical){background-color:var(--mat-datepicker-calendar-date-hover-state-background-color)}}.mat-calendar-body-selected{background-color:var(--mat-datepicker-calendar-date-selected-state-background-color);color:var(--mat-datepicker-calendar-date-selected-state-text-color)}.mat-calendar-body-disabled>.mat-calendar-body-selected{background-color:var(--mat-datepicker-calendar-date-selected-disabled-state-background-color)}.mat-calendar-body-selected.mat-calendar-body-today{box-shadow:inset 0 0 0 1px var(--mat-datepicker-calendar-date-today-selected-state-outline-color)}.mat-calendar-body-in-range::before{background:var(--mat-datepicker-calendar-date-in-range-state-background-color)}.mat-calendar-body-comparison-identical,.mat-calendar-body-in-comparison-range::before{background:var(--mat-datepicker-calendar-date-in-comparison-range-state-background-color)}.mat-calendar-body-comparison-identical,.mat-calendar-body-in-comparison-range::before{background:var(--mat-datepicker-calendar-date-in-comparison-range-state-background-color)}.mat-calendar-body-comparison-bridge-start::before,[dir=rtl] .mat-calendar-body-comparison-bridge-end::before{background:linear-gradient(to right, var(--mat-datepicker-calendar-date-in-range-state-background-color) 50%, var(--mat-datepicker-calendar-date-in-comparison-range-state-background-color) 50%)}.mat-calendar-body-comparison-bridge-end::before,[dir=rtl] .mat-calendar-body-comparison-bridge-start::before{background:linear-gradient(to left, var(--mat-datepicker-calendar-date-in-range-state-background-color) 50%, var(--mat-datepicker-calendar-date-in-comparison-range-state-background-color) 50%)}.mat-calendar-body-in-range>.mat-calendar-body-comparison-identical,.mat-calendar-body-in-comparison-range.mat-calendar-body-in-range::after{background:var(--mat-datepicker-calendar-date-in-overlap-range-state-background-color)}.mat-calendar-body-comparison-identical.mat-calendar-body-selected,.mat-calendar-body-in-comparison-range>.mat-calendar-body-selected{background:var(--mat-datepicker-calendar-date-in-overlap-range-selected-state-background-color)}.cdk-high-contrast-active .mat-datepicker-popup:not(:empty),.cdk-high-contrast-active .mat-calendar-body-cell:not(.mat-calendar-body-in-range) .mat-calendar-body-selected{outline:solid 1px}.cdk-high-contrast-active .mat-calendar-body-today{outline:dotted 1px}.cdk-high-contrast-active .mat-calendar-body-cell::before,.cdk-high-contrast-active .mat-calendar-body-cell::after,.cdk-high-contrast-active .mat-calendar-body-selected{background:none}.cdk-high-contrast-active .mat-calendar-body-in-range::before,.cdk-high-contrast-active .mat-calendar-body-comparison-bridge-start::before,.cdk-high-contrast-active .mat-calendar-body-comparison-bridge-end::before{border-top:solid 1px;border-bottom:solid 1px}.cdk-high-contrast-active .mat-calendar-body-range-start::before{border-left:solid 1px}[dir=rtl] .cdk-high-contrast-active .mat-calendar-body-range-start::before{border-left:0;border-right:solid 1px}.cdk-high-contrast-active .mat-calendar-body-range-end::before{border-right:solid 1px}[dir=rtl] .cdk-high-contrast-active .mat-calendar-body-range-end::before{border-right:0;border-left:solid 1px}.cdk-high-contrast-active .mat-calendar-body-in-comparison-range::before{border-top:dashed 1px;border-bottom:dashed 1px}.cdk-high-contrast-active .mat-calendar-body-comparison-start::before{border-left:dashed 1px}[dir=rtl] .cdk-high-contrast-active .mat-calendar-body-comparison-start::before{border-left:0;border-right:dashed 1px}.cdk-high-contrast-active .mat-calendar-body-comparison-end::before{border-right:dashed 1px}[dir=rtl] .cdk-high-contrast-active .mat-calendar-body-comparison-end::before{border-right:0;border-left:dashed 1px}[dir=rtl] .mat-calendar-body-label{text-align:right}'],encapsulation:2,changeDetection:0}),ie})();function wn(R){return"TD"===R?.nodeName}function tn(R){let ie;return wn(R)?ie=R:wn(R.parentNode)?ie=R.parentNode:wn(R.parentNode?.parentNode)&&(ie=R.parentNode.parentNode),null!=ie?.getAttribute("data-mat-row")?ie:null}function Gn(R,ie,q){return null!==q&&ie!==q&&R<q&&R===ie}function Rn(R,ie,q){return null!==ie&&ie!==q&&R>=ie&&R===q}function En(R,ie,q,b){return b&&null!==ie&&null!==q&&ie!==q&&R>=ie&&R<=q}function On(R){const ie=R.changedTouches[0];return document.elementFromPoint(ie.clientX,ie.clientY)}class Li{constructor(ie,q){this.start=ie,this.end=q}}let mn=(()=>{var R;class ie{constructor(b,I){this.selection=b,this._adapter=I,this._selectionChanged=new dt.x,this.selectionChanged=this._selectionChanged,this.selection=b}updateSelection(b,I){const z=this.selection;this.selection=b,this._selectionChanged.next({selection:b,source:I,oldValue:z})}ngOnDestroy(){this._selectionChanged.complete()}_isValidDateInstance(b){return this._adapter.isDateInstance(b)&&this._adapter.isValid(b)}}return(R=ie).\u0275fac=function(b){M.$Z()},R.\u0275prov=M.Yz7({token:R,factory:R.\u0275fac}),ie})(),fr=(()=>{var R;class ie extends mn{constructor(b){super(null,b)}add(b){super.updateSelection(b,this)}isValid(){return null!=this.selection&&this._isValidDateInstance(this.selection)}isComplete(){return null!=this.selection}clone(){const b=new ie(this._adapter);return b.updateSelection(this.selection,this),b}}return(R=ie).\u0275fac=function(b){return new(b||R)(M.LFG(Fe._A))},R.\u0275prov=M.Yz7({token:R,factory:R.\u0275fac}),ie})();const _r={provide:mn,deps:[[new M.FiY,new M.tp0,mn],Fe._A],useFactory:function qn(R,ie){return R||new fr(ie)}},$n=new M.OlP("MAT_DATE_RANGE_SELECTION_STRATEGY");let Hn=(()=>{var R;class ie{get activeDate(){return this._activeDate}set activeDate(b){const I=this._activeDate,z=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(b))||this._dateAdapter.today();this._activeDate=this._dateAdapter.clampDate(z,this.minDate,this.maxDate),this._hasSameMonthAndYear(I,this._activeDate)||this._init()}get selected(){return this._selected}set selected(b){this._selected=b instanceof Li?b:this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(b)),this._setRanges(this._selected)}get minDate(){return this._minDate}set minDate(b){this._minDate=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(b))}get maxDate(){return this._maxDate}set maxDate(b){this._maxDate=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(b))}constructor(b,I,z,W,se){this._changeDetectorRef=b,this._dateFormats=I,this._dateAdapter=z,this._dir=W,this._rangeStrategy=se,this._rerenderSubscription=zt.w0.EMPTY,this.activeDrag=null,this.selectedChange=new M.vpe,this._userSelection=new M.vpe,this.dragStarted=new M.vpe,this.dragEnded=new M.vpe,this.activeDateChange=new M.vpe,this._activeDate=this._dateAdapter.today()}ngAfterContentInit(){this._rerenderSubscription=this._dateAdapter.localeChanges.pipe((0,ft.O)(null)).subscribe(()=>this._init())}ngOnChanges(b){const I=b.comparisonStart||b.comparisonEnd;I&&!I.firstChange&&this._setRanges(this.selected),b.activeDrag&&!this.activeDrag&&this._clearPreview()}ngOnDestroy(){this._rerenderSubscription.unsubscribe()}_dateSelected(b){const I=b.value,z=this._getDateFromDayOfMonth(I);let W,se;this._selected instanceof Li?(W=this._getDateInCurrentMonth(this._selected.start),se=this._getDateInCurrentMonth(this._selected.end)):W=se=this._getDateInCurrentMonth(this._selected),(W!==I||se!==I)&&this.selectedChange.emit(z),this._userSelection.emit({value:z,event:b.event}),this._clearPreview(),this._changeDetectorRef.markForCheck()}_updateActiveDate(b){const z=this._activeDate;this.activeDate=this._getDateFromDayOfMonth(b.value),this._dateAdapter.compareDate(z,this.activeDate)&&this.activeDateChange.emit(this._activeDate)}_handleCalendarBodyKeydown(b){const I=this._activeDate,z=this._isRtl();switch(b.keyCode){case lt.oh:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,z?1:-1);break;case lt.SV:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,z?-1:1);break;case lt.LH:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,-7);break;case lt.JH:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,7);break;case lt.Sd:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,1-this._dateAdapter.getDate(this._activeDate));break;case lt.uR:this.activeDate=this._dateAdapter.addCalendarDays(this._activeDate,this._dateAdapter.getNumDaysInMonth(this._activeDate)-this._dateAdapter.getDate(this._activeDate));break;case lt.Ku:this.activeDate=b.altKey?this._dateAdapter.addCalendarYears(this._activeDate,-1):this._dateAdapter.addCalendarMonths(this._activeDate,-1);break;case lt.VM:this.activeDate=b.altKey?this._dateAdapter.addCalendarYears(this._activeDate,1):this._dateAdapter.addCalendarMonths(this._activeDate,1);break;case lt.K5:case lt.L_:return this._selectionKeyPressed=!0,void(this._canSelect(this._activeDate)&&b.preventDefault());case lt.hY:return void(null!=this._previewEnd&&!(0,lt.Vb)(b)&&(this._clearPreview(),this.activeDrag?this.dragEnded.emit({value:null,event:b}):(this.selectedChange.emit(null),this._userSelection.emit({value:null,event:b})),b.preventDefault(),b.stopPropagation()));default:return}this._dateAdapter.compareDate(I,this.activeDate)&&(this.activeDateChange.emit(this.activeDate),this._focusActiveCellAfterViewChecked()),b.preventDefault()}_handleCalendarBodyKeyup(b){(b.keyCode===lt.L_||b.keyCode===lt.K5)&&(this._selectionKeyPressed&&this._canSelect(this._activeDate)&&this._dateSelected({value:this._dateAdapter.getDate(this._activeDate),event:b}),this._selectionKeyPressed=!1)}_init(){this._setRanges(this.selected),this._todayDate=this._getCellCompareValue(this._dateAdapter.today()),this._monthLabel=this._dateFormats.display.monthLabel?this._dateAdapter.format(this.activeDate,this._dateFormats.display.monthLabel):this._dateAdapter.getMonthNames("short")[this._dateAdapter.getMonth(this.activeDate)].toLocaleUpperCase();let b=this._dateAdapter.createDate(this._dateAdapter.getYear(this.activeDate),this._dateAdapter.getMonth(this.activeDate),1);this._firstWeekOffset=(7+this._dateAdapter.getDayOfWeek(b)-this._dateAdapter.getFirstDayOfWeek())%7,this._initWeekdays(),this._createWeekCells(),this._changeDetectorRef.markForCheck()}_focusActiveCell(b){this._matCalendarBody._focusActiveCell(b)}_focusActiveCellAfterViewChecked(){this._matCalendarBody._scheduleFocusActiveCellAfterViewChecked()}_previewChanged({event:b,value:I}){if(this._rangeStrategy){const z=I?I.rawValue:null,W=this._rangeStrategy.createPreview(z,this.selected,b);if(this._previewStart=this._getCellCompareValue(W.start),this._previewEnd=this._getCellCompareValue(W.end),this.activeDrag&&z){const se=this._rangeStrategy.createDrag?.(this.activeDrag.value,this.selected,z,b);se&&(this._previewStart=this._getCellCompareValue(se.start),this._previewEnd=this._getCellCompareValue(se.end))}this._changeDetectorRef.detectChanges()}}_dragEnded(b){if(this.activeDrag)if(b.value){const I=this._rangeStrategy?.createDrag?.(this.activeDrag.value,this.selected,b.value,b.event);this.dragEnded.emit({value:I??null,event:b.event})}else this.dragEnded.emit({value:null,event:b.event})}_getDateFromDayOfMonth(b){return this._dateAdapter.createDate(this._dateAdapter.getYear(this.activeDate),this._dateAdapter.getMonth(this.activeDate),b)}_initWeekdays(){const b=this._dateAdapter.getFirstDayOfWeek(),I=this._dateAdapter.getDayOfWeekNames("narrow");let W=this._dateAdapter.getDayOfWeekNames("long").map((se,_t)=>({long:se,narrow:I[_t]}));this._weekdays=W.slice(b).concat(W.slice(0,b))}_createWeekCells(){const b=this._dateAdapter.getNumDaysInMonth(this.activeDate),I=this._dateAdapter.getDateNames();this._weeks=[[]];for(let z=0,W=this._firstWeekOffset;z<b;z++,W++){7==W&&(this._weeks.push([]),W=0);const se=this._dateAdapter.createDate(this._dateAdapter.getYear(this.activeDate),this._dateAdapter.getMonth(this.activeDate),z+1),_t=this._shouldEnableDate(se),Kt=this._dateAdapter.format(se,this._dateFormats.display.dateA11yLabel),At=this.dateClass?this.dateClass(se,"month"):void 0;this._weeks[this._weeks.length-1].push(new en(z+1,I[z],Kt,_t,At,this._getCellCompareValue(se),se))}}_shouldEnableDate(b){return!!b&&(!this.minDate||this._dateAdapter.compareDate(b,this.minDate)>=0)&&(!this.maxDate||this._dateAdapter.compareDate(b,this.maxDate)<=0)&&(!this.dateFilter||this.dateFilter(b))}_getDateInCurrentMonth(b){return b&&this._hasSameMonthAndYear(b,this.activeDate)?this._dateAdapter.getDate(b):null}_hasSameMonthAndYear(b,I){return!(!b||!I||this._dateAdapter.getMonth(b)!=this._dateAdapter.getMonth(I)||this._dateAdapter.getYear(b)!=this._dateAdapter.getYear(I))}_getCellCompareValue(b){if(b){const I=this._dateAdapter.getYear(b),z=this._dateAdapter.getMonth(b),W=this._dateAdapter.getDate(b);return new Date(I,z,W).getTime()}return null}_isRtl(){return this._dir&&"rtl"===this._dir.value}_setRanges(b){b instanceof Li?(this._rangeStart=this._getCellCompareValue(b.start),this._rangeEnd=this._getCellCompareValue(b.end),this._isRange=!0):(this._rangeStart=this._rangeEnd=this._getCellCompareValue(b),this._isRange=!1),this._comparisonRangeStart=this._getCellCompareValue(this.comparisonStart),this._comparisonRangeEnd=this._getCellCompareValue(this.comparisonEnd)}_canSelect(b){return!this.dateFilter||this.dateFilter(b)}_clearPreview(){this._previewStart=this._previewEnd=null}}return(R=ie).\u0275fac=function(b){return new(b||R)(M.Y36(M.sBO),M.Y36(Fe.sG,8),M.Y36(Fe._A,8),M.Y36(Bt.Is,8),M.Y36($n,8))},R.\u0275cmp=M.Xpm({type:R,selectors:[["mat-month-view"]],viewQuery:function(b,I){if(1&b&&M.Gf(bn,5),2&b){let z;M.iGM(z=M.CRH())&&(I._matCalendarBody=z.first)}},inputs:{activeDate:"activeDate",selected:"selected",minDate:"minDate",maxDate:"maxDate",dateFilter:"dateFilter",dateClass:"dateClass",comparisonStart:"comparisonStart",comparisonEnd:"comparisonEnd",startDateAccessibleName:"startDateAccessibleName",endDateAccessibleName:"endDateAccessibleName",activeDrag:"activeDrag"},outputs:{selectedChange:"selectedChange",_userSelection:"_userSelection",dragStarted:"dragStarted",dragEnded:"dragEnded",activeDateChange:"activeDateChange"},exportAs:["matMonthView"],features:[M.TTD],decls:7,vars:15,consts:[["role","grid",1,"mat-calendar-table"],[1,"mat-calendar-table-header"],["scope","col",4,"ngFor","ngForOf"],["aria-hidden","true","colspan","7",1,"mat-calendar-table-header-divider"],["mat-calendar-body","",3,"label","rows","todayValue","startValue","endValue","comparisonStart","comparisonEnd","previewStart","previewEnd","isRange","labelMinRequiredCells","activeCell","startDateAccessibleName","endDateAccessibleName","selectedValueChange","activeDateChange","previewChange","dragStarted","dragEnded","keyup","keydown"],["scope","col"],[1,"cdk-visually-hidden"],["aria-hidden","true"]],template:function(b,I){1&b&&(M.TgZ(0,"table",0)(1,"thead",1)(2,"tr"),M.YNc(3,Ce,5,2,"th",2),M.qZA(),M.TgZ(4,"tr"),M._UZ(5,"th",3),M.qZA()(),M.TgZ(6,"tbody",4),M.NdJ("selectedValueChange",function(W){return I._dateSelected(W)})("activeDateChange",function(W){return I._updateActiveDate(W)})("previewChange",function(W){return I._previewChanged(W)})("dragStarted",function(W){return I.dragStarted.emit(W)})("dragEnded",function(W){return I._dragEnded(W)})("keyup",function(W){return I._handleCalendarBodyKeyup(W)})("keydown",function(W){return I._handleCalendarBodyKeydown(W)}),M.qZA()()),2&b&&(M.xp6(3),M.Q6J("ngForOf",I._weekdays),M.xp6(3),M.Q6J("label",I._monthLabel)("rows",I._weeks)("todayValue",I._todayDate)("startValue",I._rangeStart)("endValue",I._rangeEnd)("comparisonStart",I._comparisonRangeStart)("comparisonEnd",I._comparisonRangeEnd)("previewStart",I._previewStart)("previewEnd",I._previewEnd)("isRange",I._isRange)("labelMinRequiredCells",3)("activeCell",I._dateAdapter.getDate(I.activeDate)-1)("startDateAccessibleName",I.startDateAccessibleName)("endDateAccessibleName",I.endDateAccessibleName))},dependencies:[s.sg,bn],encapsulation:2,changeDetection:0}),ie})();const $i=24;let O=(()=>{var R;class ie{get activeDate(){return this._activeDate}set activeDate(b){let I=this._activeDate;const z=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(b))||this._dateAdapter.today();this._activeDate=this._dateAdapter.clampDate(z,this.minDate,this.maxDate),B(this._dateAdapter,I,this._activeDate,this.minDate,this.maxDate)||this._init()}get selected(){return this._selected}set selected(b){this._selected=b instanceof Li?b:this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(b)),this._setSelectedYear(b)}get minDate(){return this._minDate}set minDate(b){this._minDate=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(b))}get maxDate(){return this._maxDate}set maxDate(b){this._maxDate=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(b))}constructor(b,I,z){this._changeDetectorRef=b,this._dateAdapter=I,this._dir=z,this._rerenderSubscription=zt.w0.EMPTY,this.selectedChange=new M.vpe,this.yearSelected=new M.vpe,this.activeDateChange=new M.vpe,this._activeDate=this._dateAdapter.today()}ngAfterContentInit(){this._rerenderSubscription=this._dateAdapter.localeChanges.pipe((0,ft.O)(null)).subscribe(()=>this._init())}ngOnDestroy(){this._rerenderSubscription.unsubscribe()}_init(){this._todayYear=this._dateAdapter.getYear(this._dateAdapter.today());const I=this._dateAdapter.getYear(this._activeDate)-K(this._dateAdapter,this.activeDate,this.minDate,this.maxDate);this._years=[];for(let z=0,W=[];z<$i;z++)W.push(I+z),4==W.length&&(this._years.push(W.map(se=>this._createCellForYear(se))),W=[]);this._changeDetectorRef.markForCheck()}_yearSelected(b){const I=b.value,z=this._dateAdapter.createDate(I,0,1),W=this._getDateFromYear(I);this.yearSelected.emit(z),this.selectedChange.emit(W)}_updateActiveDate(b){const z=this._activeDate;this.activeDate=this._getDateFromYear(b.value),this._dateAdapter.compareDate(z,this.activeDate)&&this.activeDateChange.emit(this.activeDate)}_handleCalendarBodyKeydown(b){const I=this._activeDate,z=this._isRtl();switch(b.keyCode){case lt.oh:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,z?1:-1);break;case lt.SV:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,z?-1:1);break;case lt.LH:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,-4);break;case lt.JH:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,4);break;case lt.Sd:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,-K(this._dateAdapter,this.activeDate,this.minDate,this.maxDate));break;case lt.uR:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,$i-K(this._dateAdapter,this.activeDate,this.minDate,this.maxDate)-1);break;case lt.Ku:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,b.altKey?10*-$i:-$i);break;case lt.VM:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,b.altKey?10*$i:$i);break;case lt.K5:case lt.L_:this._selectionKeyPressed=!0;break;default:return}this._dateAdapter.compareDate(I,this.activeDate)&&this.activeDateChange.emit(this.activeDate),this._focusActiveCellAfterViewChecked(),b.preventDefault()}_handleCalendarBodyKeyup(b){(b.keyCode===lt.L_||b.keyCode===lt.K5)&&(this._selectionKeyPressed&&this._yearSelected({value:this._dateAdapter.getYear(this._activeDate),event:b}),this._selectionKeyPressed=!1)}_getActiveCell(){return K(this._dateAdapter,this.activeDate,this.minDate,this.maxDate)}_focusActiveCell(){this._matCalendarBody._focusActiveCell()}_focusActiveCellAfterViewChecked(){this._matCalendarBody._scheduleFocusActiveCellAfterViewChecked()}_getDateFromYear(b){const I=this._dateAdapter.getMonth(this.activeDate),z=this._dateAdapter.getNumDaysInMonth(this._dateAdapter.createDate(b,I,1));return this._dateAdapter.createDate(b,I,Math.min(this._dateAdapter.getDate(this.activeDate),z))}_createCellForYear(b){const I=this._dateAdapter.createDate(b,0,1),z=this._dateAdapter.getYearName(I),W=this.dateClass?this.dateClass(I,"multi-year"):void 0;return new en(b,z,z,this._shouldEnableYear(b),W)}_shouldEnableYear(b){if(null==b||this.maxDate&&b>this._dateAdapter.getYear(this.maxDate)||this.minDate&&b<this._dateAdapter.getYear(this.minDate))return!1;if(!this.dateFilter)return!0;for(let z=this._dateAdapter.createDate(b,0,1);this._dateAdapter.getYear(z)==b;z=this._dateAdapter.addCalendarDays(z,1))if(this.dateFilter(z))return!0;return!1}_isRtl(){return this._dir&&"rtl"===this._dir.value}_setSelectedYear(b){if(this._selectedYear=null,b instanceof Li){const I=b.start||b.end;I&&(this._selectedYear=this._dateAdapter.getYear(I))}else b&&(this._selectedYear=this._dateAdapter.getYear(b))}}return(R=ie).\u0275fac=function(b){return new(b||R)(M.Y36(M.sBO),M.Y36(Fe._A,8),M.Y36(Bt.Is,8))},R.\u0275cmp=M.Xpm({type:R,selectors:[["mat-multi-year-view"]],viewQuery:function(b,I){if(1&b&&M.Gf(bn,5),2&b){let z;M.iGM(z=M.CRH())&&(I._matCalendarBody=z.first)}},inputs:{activeDate:"activeDate",selected:"selected",minDate:"minDate",maxDate:"maxDate",dateFilter:"dateFilter",dateClass:"dateClass"},outputs:{selectedChange:"selectedChange",yearSelected:"yearSelected",activeDateChange:"activeDateChange"},exportAs:["matMultiYearView"],decls:5,vars:7,consts:[["role","grid",1,"mat-calendar-table"],["aria-hidden","true",1,"mat-calendar-table-header"],["colspan","4",1,"mat-calendar-table-header-divider"],["mat-calendar-body","",3,"rows","todayValue","startValue","endValue","numCols","cellAspectRatio","activeCell","selectedValueChange","activeDateChange","keyup","keydown"]],template:function(b,I){1&b&&(M.TgZ(0,"table",0)(1,"thead",1)(2,"tr"),M._UZ(3,"th",2),M.qZA()(),M.TgZ(4,"tbody",3),M.NdJ("selectedValueChange",function(W){return I._yearSelected(W)})("activeDateChange",function(W){return I._updateActiveDate(W)})("keyup",function(W){return I._handleCalendarBodyKeyup(W)})("keydown",function(W){return I._handleCalendarBodyKeydown(W)}),M.qZA()()),2&b&&(M.xp6(4),M.Q6J("rows",I._years)("todayValue",I._todayYear)("startValue",I._selectedYear)("endValue",I._selectedYear)("numCols",4)("cellAspectRatio",4/7)("activeCell",I._getActiveCell()))},dependencies:[bn],encapsulation:2,changeDetection:0}),ie})();function B(R,ie,q,b,I){const z=R.getYear(ie),W=R.getYear(q),se=re(R,b,I);return Math.floor((z-se)/$i)===Math.floor((W-se)/$i)}function K(R,ie,q,b){return function ue(R,ie){return(R%ie+ie)%ie}(R.getYear(ie)-re(R,q,b),$i)}function re(R,ie,q){let b=0;return q?b=R.getYear(q)-$i+1:ie&&(b=R.getYear(ie)),b}let me=(()=>{var R;class ie{get activeDate(){return this._activeDate}set activeDate(b){let I=this._activeDate;const z=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(b))||this._dateAdapter.today();this._activeDate=this._dateAdapter.clampDate(z,this.minDate,this.maxDate),this._dateAdapter.getYear(I)!==this._dateAdapter.getYear(this._activeDate)&&this._init()}get selected(){return this._selected}set selected(b){this._selected=b instanceof Li?b:this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(b)),this._setSelectedMonth(b)}get minDate(){return this._minDate}set minDate(b){this._minDate=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(b))}get maxDate(){return this._maxDate}set maxDate(b){this._maxDate=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(b))}constructor(b,I,z,W){this._changeDetectorRef=b,this._dateFormats=I,this._dateAdapter=z,this._dir=W,this._rerenderSubscription=zt.w0.EMPTY,this.selectedChange=new M.vpe,this.monthSelected=new M.vpe,this.activeDateChange=new M.vpe,this._activeDate=this._dateAdapter.today()}ngAfterContentInit(){this._rerenderSubscription=this._dateAdapter.localeChanges.pipe((0,ft.O)(null)).subscribe(()=>this._init())}ngOnDestroy(){this._rerenderSubscription.unsubscribe()}_monthSelected(b){const I=b.value,z=this._dateAdapter.createDate(this._dateAdapter.getYear(this.activeDate),I,1);this.monthSelected.emit(z);const W=this._getDateFromMonth(I);this.selectedChange.emit(W)}_updateActiveDate(b){const z=this._activeDate;this.activeDate=this._getDateFromMonth(b.value),this._dateAdapter.compareDate(z,this.activeDate)&&this.activeDateChange.emit(this.activeDate)}_handleCalendarBodyKeydown(b){const I=this._activeDate,z=this._isRtl();switch(b.keyCode){case lt.oh:this.activeDate=this._dateAdapter.addCalendarMonths(this._activeDate,z?1:-1);break;case lt.SV:this.activeDate=this._dateAdapter.addCalendarMonths(this._activeDate,z?-1:1);break;case lt.LH:this.activeDate=this._dateAdapter.addCalendarMonths(this._activeDate,-4);break;case lt.JH:this.activeDate=this._dateAdapter.addCalendarMonths(this._activeDate,4);break;case lt.Sd:this.activeDate=this._dateAdapter.addCalendarMonths(this._activeDate,-this._dateAdapter.getMonth(this._activeDate));break;case lt.uR:this.activeDate=this._dateAdapter.addCalendarMonths(this._activeDate,11-this._dateAdapter.getMonth(this._activeDate));break;case lt.Ku:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,b.altKey?-10:-1);break;case lt.VM:this.activeDate=this._dateAdapter.addCalendarYears(this._activeDate,b.altKey?10:1);break;case lt.K5:case lt.L_:this._selectionKeyPressed=!0;break;default:return}this._dateAdapter.compareDate(I,this.activeDate)&&(this.activeDateChange.emit(this.activeDate),this._focusActiveCellAfterViewChecked()),b.preventDefault()}_handleCalendarBodyKeyup(b){(b.keyCode===lt.L_||b.keyCode===lt.K5)&&(this._selectionKeyPressed&&this._monthSelected({value:this._dateAdapter.getMonth(this._activeDate),event:b}),this._selectionKeyPressed=!1)}_init(){this._setSelectedMonth(this.selected),this._todayMonth=this._getMonthInCurrentYear(this._dateAdapter.today()),this._yearLabel=this._dateAdapter.getYearName(this.activeDate);let b=this._dateAdapter.getMonthNames("short");this._months=[[0,1,2,3],[4,5,6,7],[8,9,10,11]].map(I=>I.map(z=>this._createCellForMonth(z,b[z]))),this._changeDetectorRef.markForCheck()}_focusActiveCell(){this._matCalendarBody._focusActiveCell()}_focusActiveCellAfterViewChecked(){this._matCalendarBody._scheduleFocusActiveCellAfterViewChecked()}_getMonthInCurrentYear(b){return b&&this._dateAdapter.getYear(b)==this._dateAdapter.getYear(this.activeDate)?this._dateAdapter.getMonth(b):null}_getDateFromMonth(b){const I=this._dateAdapter.createDate(this._dateAdapter.getYear(this.activeDate),b,1),z=this._dateAdapter.getNumDaysInMonth(I);return this._dateAdapter.createDate(this._dateAdapter.getYear(this.activeDate),b,Math.min(this._dateAdapter.getDate(this.activeDate),z))}_createCellForMonth(b,I){const z=this._dateAdapter.createDate(this._dateAdapter.getYear(this.activeDate),b,1),W=this._dateAdapter.format(z,this._dateFormats.display.monthYearA11yLabel),se=this.dateClass?this.dateClass(z,"year"):void 0;return new en(b,I.toLocaleUpperCase(),W,this._shouldEnableMonth(b),se)}_shouldEnableMonth(b){const I=this._dateAdapter.getYear(this.activeDate);if(null==b||this._isYearAndMonthAfterMaxDate(I,b)||this._isYearAndMonthBeforeMinDate(I,b))return!1;if(!this.dateFilter)return!0;for(let W=this._dateAdapter.createDate(I,b,1);this._dateAdapter.getMonth(W)==b;W=this._dateAdapter.addCalendarDays(W,1))if(this.dateFilter(W))return!0;return!1}_isYearAndMonthAfterMaxDate(b,I){if(this.maxDate){const z=this._dateAdapter.getYear(this.maxDate),W=this._dateAdapter.getMonth(this.maxDate);return b>z||b===z&&I>W}return!1}_isYearAndMonthBeforeMinDate(b,I){if(this.minDate){const z=this._dateAdapter.getYear(this.minDate),W=this._dateAdapter.getMonth(this.minDate);return b<z||b===z&&I<W}return!1}_isRtl(){return this._dir&&"rtl"===this._dir.value}_setSelectedMonth(b){this._selectedMonth=b instanceof Li?this._getMonthInCurrentYear(b.start)||this._getMonthInCurrentYear(b.end):this._getMonthInCurrentYear(b)}}return(R=ie).\u0275fac=function(b){return new(b||R)(M.Y36(M.sBO),M.Y36(Fe.sG,8),M.Y36(Fe._A,8),M.Y36(Bt.Is,8))},R.\u0275cmp=M.Xpm({type:R,selectors:[["mat-year-view"]],viewQuery:function(b,I){if(1&b&&M.Gf(bn,5),2&b){let z;M.iGM(z=M.CRH())&&(I._matCalendarBody=z.first)}},inputs:{activeDate:"activeDate",selected:"selected",minDate:"minDate",maxDate:"maxDate",dateFilter:"dateFilter",dateClass:"dateClass"},outputs:{selectedChange:"selectedChange",monthSelected:"monthSelected",activeDateChange:"activeDateChange"},exportAs:["matYearView"],decls:5,vars:9,consts:[["role","grid",1,"mat-calendar-table"],["aria-hidden","true",1,"mat-calendar-table-header"],["colspan","4",1,"mat-calendar-table-header-divider"],["mat-calendar-body","",3,"label","rows","todayValue","startValue","endValue","labelMinRequiredCells","numCols","cellAspectRatio","activeCell","selectedValueChange","activeDateChange","keyup","keydown"]],template:function(b,I){1&b&&(M.TgZ(0,"table",0)(1,"thead",1)(2,"tr"),M._UZ(3,"th",2),M.qZA()(),M.TgZ(4,"tbody",3),M.NdJ("selectedValueChange",function(W){return I._monthSelected(W)})("activeDateChange",function(W){return I._updateActiveDate(W)})("keyup",function(W){return I._handleCalendarBodyKeyup(W)})("keydown",function(W){return I._handleCalendarBodyKeydown(W)}),M.qZA()()),2&b&&(M.xp6(4),M.Q6J("label",I._yearLabel)("rows",I._months)("todayValue",I._todayMonth)("startValue",I._selectedMonth)("endValue",I._selectedMonth)("labelMinRequiredCells",2)("numCols",4)("cellAspectRatio",4/7)("activeCell",I._dateAdapter.getMonth(I.activeDate)))},dependencies:[bn],encapsulation:2,changeDetection:0}),ie})(),fe=1,he=(()=>{var R;class ie{constructor(b,I,z,W,se){this._intl=b,this.calendar=I,this._dateAdapter=z,this._dateFormats=W,this._id="mat-calendar-header-"+fe++,this._periodButtonLabelId=`${this._id}-period-label`,this.calendar.stateChanges.subscribe(()=>se.markForCheck())}get periodButtonText(){return"month"==this.calendar.currentView?this._dateAdapter.format(this.calendar.activeDate,this._dateFormats.display.monthYearLabel).toLocaleUpperCase():"year"==this.calendar.currentView?this._dateAdapter.getYearName(this.calendar.activeDate):this._intl.formatYearRange(...this._formatMinAndMaxYearLabels())}get periodButtonDescription(){return"month"==this.calendar.currentView?this._dateAdapter.format(this.calendar.activeDate,this._dateFormats.display.monthYearLabel).toLocaleUpperCase():"year"==this.calendar.currentView?this._dateAdapter.getYearName(this.calendar.activeDate):this._intl.formatYearRangeLabel(...this._formatMinAndMaxYearLabels())}get periodButtonLabel(){return"month"==this.calendar.currentView?this._intl.switchToMultiYearViewLabel:this._intl.switchToMonthViewLabel}get prevButtonLabel(){return{month:this._intl.prevMonthLabel,year:this._intl.prevYearLabel,"multi-year":this._intl.prevMultiYearLabel}[this.calendar.currentView]}get nextButtonLabel(){return{month:this._intl.nextMonthLabel,year:this._intl.nextYearLabel,"multi-year":this._intl.nextMultiYearLabel}[this.calendar.currentView]}currentPeriodClicked(){this.calendar.currentView="month"==this.calendar.currentView?"multi-year":"month"}previousClicked(){this.calendar.activeDate="month"==this.calendar.currentView?this._dateAdapter.addCalendarMonths(this.calendar.activeDate,-1):this._dateAdapter.addCalendarYears(this.calendar.activeDate,"year"==this.calendar.currentView?-1:-$i)}nextClicked(){this.calendar.activeDate="month"==this.calendar.currentView?this._dateAdapter.addCalendarMonths(this.calendar.activeDate,1):this._dateAdapter.addCalendarYears(this.calendar.activeDate,"year"==this.calendar.currentView?1:$i)}previousEnabled(){return!this.calendar.minDate||!this.calendar.minDate||!this._isSameView(this.calendar.activeDate,this.calendar.minDate)}nextEnabled(){return!this.calendar.maxDate||!this._isSameView(this.calendar.activeDate,this.calendar.maxDate)}_isSameView(b,I){return"month"==this.calendar.currentView?this._dateAdapter.getYear(b)==this._dateAdapter.getYear(I)&&this._dateAdapter.getMonth(b)==this._dateAdapter.getMonth(I):"year"==this.calendar.currentView?this._dateAdapter.getYear(b)==this._dateAdapter.getYear(I):B(this._dateAdapter,b,I,this.calendar.minDate,this.calendar.maxDate)}_formatMinAndMaxYearLabels(){const I=this._dateAdapter.getYear(this.calendar.activeDate)-K(this._dateAdapter,this.calendar.activeDate,this.calendar.minDate,this.calendar.maxDate),z=I+$i-1;return[this._dateAdapter.getYearName(this._dateAdapter.createDate(I,0,1)),this._dateAdapter.getYearName(this._dateAdapter.createDate(z,0,1))]}}return(R=ie).\u0275fac=function(b){return new(b||R)(M.Y36(yt),M.Y36((0,M.Gpc)(()=>xe)),M.Y36(Fe._A,8),M.Y36(Fe.sG,8),M.Y36(M.sBO))},R.\u0275cmp=M.Xpm({type:R,selectors:[["mat-calendar-header"]],exportAs:["matCalendarHeader"],ngContentSelectors:Ue,decls:13,vars:11,consts:[[1,"mat-calendar-header"],[1,"mat-calendar-controls"],["mat-button","","type","button","aria-live","polite",1,"mat-calendar-period-button",3,"click"],["aria-hidden","true"],["viewBox","0 0 10 5","focusable","false","aria-hidden","true",1,"mat-calendar-arrow"],["points","0,0 5,5 10,0"],[1,"mat-calendar-spacer"],["mat-icon-button","","type","button",1,"mat-calendar-previous-button",3,"disabled","click"],["mat-icon-button","","type","button",1,"mat-calendar-next-button",3,"disabled","click"],[1,"mat-calendar-hidden-label",3,"id"]],template:function(b,I){1&b&&(M.F$t(),M.TgZ(0,"div",0)(1,"div",1)(2,"button",2),M.NdJ("click",function(){return I.currentPeriodClicked()}),M.TgZ(3,"span",3),M._uU(4),M.qZA(),M.O4$(),M.TgZ(5,"svg",4),M._UZ(6,"polygon",5),M.qZA()(),M.kcU(),M._UZ(7,"div",6),M.Hsn(8),M.TgZ(9,"button",7),M.NdJ("click",function(){return I.previousClicked()}),M.qZA(),M.TgZ(10,"button",8),M.NdJ("click",function(){return I.nextClicked()}),M.qZA()()(),M.TgZ(11,"label",9),M._uU(12),M.qZA()),2&b&&(M.xp6(2),M.uIk("aria-label",I.periodButtonLabel)("aria-describedby",I._periodButtonLabelId),M.xp6(2),M.Oqu(I.periodButtonText),M.xp6(1),M.ekj("mat-calendar-invert","month"!==I.calendar.currentView),M.xp6(4),M.Q6J("disabled",!I.previousEnabled()),M.uIk("aria-label",I.prevButtonLabel),M.xp6(1),M.Q6J("disabled",!I.nextEnabled()),M.uIk("aria-label",I.nextButtonLabel),M.xp6(1),M.Q6J("id",I._periodButtonLabelId),M.xp6(1),M.Oqu(I.periodButtonDescription))},dependencies:[wt.lW,wt.RK],encapsulation:2,changeDetection:0}),ie})(),xe=(()=>{var R;class ie{get startAt(){return this._startAt}set startAt(b){this._startAt=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(b))}get selected(){return this._selected}set selected(b){this._selected=b instanceof Li?b:this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(b))}get minDate(){return this._minDate}set minDate(b){this._minDate=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(b))}get maxDate(){return this._maxDate}set maxDate(b){this._maxDate=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(b))}get activeDate(){return this._clampedActiveDate}set activeDate(b){this._clampedActiveDate=this._dateAdapter.clampDate(b,this.minDate,this.maxDate),this.stateChanges.next(),this._changeDetectorRef.markForCheck()}get currentView(){return this._currentView}set currentView(b){const I=this._currentView!==b?b:null;this._currentView=b,this._moveFocusOnNextTick=!0,this._changeDetectorRef.markForCheck(),I&&this.viewChanged.emit(I)}constructor(b,I,z,W){this._dateAdapter=I,this._dateFormats=z,this._changeDetectorRef=W,this._moveFocusOnNextTick=!1,this.startView="month",this.selectedChange=new M.vpe,this.yearSelected=new M.vpe,this.monthSelected=new M.vpe,this.viewChanged=new M.vpe(!0),this._userSelection=new M.vpe,this._userDragDrop=new M.vpe,this._activeDrag=null,this.stateChanges=new dt.x,this._intlChanges=b.changes.subscribe(()=>{W.markForCheck(),this.stateChanges.next()})}ngAfterContentInit(){this._calendarHeaderPortal=new ai.C5(this.headerComponent||he),this.activeDate=this.startAt||this._dateAdapter.today(),this._currentView=this.startView}ngAfterViewChecked(){this._moveFocusOnNextTick&&(this._moveFocusOnNextTick=!1,this.focusActiveCell())}ngOnDestroy(){this._intlChanges.unsubscribe(),this.stateChanges.complete()}ngOnChanges(b){const I=b.minDate&&!this._dateAdapter.sameDate(b.minDate.previousValue,b.minDate.currentValue)?b.minDate:void 0,z=b.maxDate&&!this._dateAdapter.sameDate(b.maxDate.previousValue,b.maxDate.currentValue)?b.maxDate:void 0,W=I||z||b.dateFilter;if(W&&!W.firstChange){const se=this._getCurrentViewComponent();se&&(this._changeDetectorRef.detectChanges(),se._init())}this.stateChanges.next()}focusActiveCell(){this._getCurrentViewComponent()._focusActiveCell(!1)}updateTodaysDate(){this._getCurrentViewComponent()._init()}_dateSelected(b){const I=b.value;(this.selected instanceof Li||I&&!this._dateAdapter.sameDate(I,this.selected))&&this.selectedChange.emit(I),this._userSelection.emit(b)}_yearSelectedInMultiYearView(b){this.yearSelected.emit(b)}_monthSelectedInYearView(b){this.monthSelected.emit(b)}_goToDateInView(b,I){this.activeDate=b,this.currentView=I}_dragStarted(b){this._activeDrag=b}_dragEnded(b){this._activeDrag&&(b.value&&this._userDragDrop.emit(b),this._activeDrag=null)}_getCurrentViewComponent(){return this.monthView||this.yearView||this.multiYearView}}return(R=ie).\u0275fac=function(b){return new(b||R)(M.Y36(yt),M.Y36(Fe._A,8),M.Y36(Fe.sG,8),M.Y36(M.sBO))},R.\u0275cmp=M.Xpm({type:R,selectors:[["mat-calendar"]],viewQuery:function(b,I){if(1&b&&(M.Gf(Hn,5),M.Gf(me,5),M.Gf(O,5)),2&b){let z;M.iGM(z=M.CRH())&&(I.monthView=z.first),M.iGM(z=M.CRH())&&(I.yearView=z.first),M.iGM(z=M.CRH())&&(I.multiYearView=z.first)}},hostAttrs:[1,"mat-calendar"],inputs:{headerComponent:"headerComponent",startAt:"startAt",startView:"startView",selected:"selected",minDate:"minDate",maxDate:"maxDate",dateFilter:"dateFilter",dateClass:"dateClass",comparisonStart:"comparisonStart",comparisonEnd:"comparisonEnd",startDateAccessibleName:"startDateAccessibleName",endDateAccessibleName:"endDateAccessibleName"},outputs:{selectedChange:"selectedChange",yearSelected:"yearSelected",monthSelected:"monthSelected",viewChanged:"viewChanged",_userSelection:"_userSelection",_userDragDrop:"_userDragDrop"},exportAs:["matCalendar"],features:[M._Bn([_r]),M.TTD],decls:5,vars:5,consts:[[3,"cdkPortalOutlet"],["cdkMonitorSubtreeFocus","","tabindex","-1",1,"mat-calendar-content",3,"ngSwitch"],[3,"activeDate","selected","dateFilter","maxDate","minDate","dateClass","comparisonStart","comparisonEnd","startDateAccessibleName","endDateAccessibleName","activeDrag","activeDateChange","_userSelection","dragStarted","dragEnded",4,"ngSwitchCase"],[3,"activeDate","selected","dateFilter","maxDate","minDate","dateClass","activeDateChange","monthSelected","selectedChange",4,"ngSwitchCase"],[3,"activeDate","selected","dateFilter","maxDate","minDate","dateClass","activeDateChange","yearSelected","selectedChange",4,"ngSwitchCase"],[3,"activeDate","selected","dateFilter","maxDate","minDate","dateClass","comparisonStart","comparisonEnd","startDateAccessibleName","endDateAccessibleName","activeDrag","activeDateChange","_userSelection","dragStarted","dragEnded"],[3,"activeDate","selected","dateFilter","maxDate","minDate","dateClass","activeDateChange","monthSelected","selectedChange"],[3,"activeDate","selected","dateFilter","maxDate","minDate","dateClass","activeDateChange","yearSelected","selectedChange"]],template:function(b,I){1&b&&(M.YNc(0,Ee,0,0,"ng-template",0),M.TgZ(1,"div",1),M.YNc(2,Me,1,11,"mat-month-view",2),M.YNc(3,st,1,6,"mat-year-view",3),M.YNc(4,jt,1,6,"mat-multi-year-view",4),M.qZA()),2&b&&(M.Q6J("cdkPortalOutlet",I._calendarHeaderPortal),M.xp6(1),M.Q6J("ngSwitch",I.currentView),M.xp6(1),M.Q6J("ngSwitchCase","month"),M.xp6(1),M.Q6J("ngSwitchCase","year"),M.xp6(1),M.Q6J("ngSwitchCase","multi-year"))},dependencies:[s.RF,s.n9,T.kH,ai.Pl,Hn,me,O],styles:['.mat-calendar{display:block;font-family:var(--mat-datepicker-calendar-text-font);font-size:var(--mat-datepicker-calendar-text-size)}.mat-calendar-header{padding:8px 8px 0 8px}.mat-calendar-content{padding:0 8px 8px 8px;outline:none}.mat-calendar-controls{display:flex;align-items:center;margin:5% calc(4.7142857143% - 16px)}.mat-calendar-spacer{flex:1 1 auto}.mat-calendar-period-button{min-width:0;margin:0 8px;font-size:var(--mat-datepicker-calendar-period-button-text-size);font-weight:var(--mat-datepicker-calendar-period-button-text-weight)}.mat-calendar-arrow{display:inline-block;width:10px;height:5px;margin:0 0 0 5px;vertical-align:middle;fill:var(--mat-datepicker-calendar-period-button-icon-color)}.mat-calendar-arrow.mat-calendar-invert{transform:rotate(180deg)}[dir=rtl] .mat-calendar-arrow{margin:0 5px 0 0}.cdk-high-contrast-active .mat-calendar-arrow{fill:CanvasText}.mat-calendar-previous-button,.mat-calendar-next-button{position:relative}.mat-datepicker-content .mat-calendar-previous-button,.mat-datepicker-content .mat-calendar-next-button{color:var(--mat-datepicker-calendar-navigation-button-icon-color)}.mat-calendar-previous-button::after,.mat-calendar-next-button::after{top:0;left:0;right:0;bottom:0;position:absolute;content:"";margin:15.5px;border:0 solid currentColor;border-top-width:2px}[dir=rtl] .mat-calendar-previous-button,[dir=rtl] .mat-calendar-next-button{transform:rotate(180deg)}.mat-calendar-previous-button::after{border-left-width:2px;transform:translateX(2px) rotate(-45deg)}.mat-calendar-next-button::after{border-right-width:2px;transform:translateX(-2px) rotate(45deg)}.mat-calendar-table{border-spacing:0;border-collapse:collapse;width:100%}.mat-calendar-table-header th{text-align:center;padding:0 0 8px 0;color:var(--mat-datepicker-calendar-header-text-color);font-size:var(--mat-datepicker-calendar-header-text-size);font-weight:var(--mat-datepicker-calendar-header-text-weight)}.mat-calendar-table-header-divider{position:relative;height:1px}.mat-calendar-table-header-divider::after{content:"";position:absolute;top:0;left:-8px;right:-8px;height:1px;background:var(--mat-datepicker-calendar-header-divider-color)}.mat-calendar-body-cell-content::before{margin:calc(calc(var(--mat-focus-indicator-border-width, 3px) + 3px) * -1)}.mat-calendar-body-cell:focus .mat-focus-indicator::before{content:""}.mat-calendar-hidden-label{display:none}'],encapsulation:2,changeDetection:0}),ie})();const Ge={transformPanel:(0,Tt.X$)("transformPanel",[(0,Tt.eR)("void => enter-dropdown",(0,Tt.jt)("120ms cubic-bezier(0, 0, 0.2, 1)",(0,Tt.F4)([(0,Tt.oB)({opacity:0,transform:"scale(1, 0.8)"}),(0,Tt.oB)({opacity:1,transform:"scale(1, 1)"})]))),(0,Tt.eR)("void => enter-dialog",(0,Tt.jt)("150ms cubic-bezier(0, 0, 0.2, 1)",(0,Tt.F4)([(0,Tt.oB)({opacity:0,transform:"scale(0.7)"}),(0,Tt.oB)({transform:"none",opacity:1})]))),(0,Tt.eR)("* => void",(0,Tt.jt)("100ms linear",(0,Tt.oB)({opacity:0})))]),fadeInCalendar:(0,Tt.X$)("fadeInCalendar",[(0,Tt.SB)("void",(0,Tt.oB)({opacity:0})),(0,Tt.SB)("enter",(0,Tt.oB)({opacity:1})),(0,Tt.eR)("void => *",(0,Tt.jt)("120ms 100ms cubic-bezier(0.55, 0, 0.55, 0.2)"))])};let Ke=0;const je=new M.OlP("mat-datepicker-scroll-strategy"),Ft={provide:je,deps:[mt.aV],useFactory:function Ct(R){return()=>R.scrollStrategies.reposition()}},It=(0,Fe.pj)(class{constructor(R){this._elementRef=R}});let Ut=(()=>{var R;class ie extends It{constructor(b,I,z,W,se,_t){super(b),this._changeDetectorRef=I,this._globalModel=z,this._dateAdapter=W,this._rangeSelectionStrategy=se,this._subscriptions=new zt.w0,this._animationDone=new dt.x,this._isAnimating=!1,this._actionsPortal=null,this._closeButtonText=_t.closeCalendarLabel}ngOnInit(){this._animationState=this.datepicker.touchUi?"enter-dialog":"enter-dropdown"}ngAfterViewInit(){this._subscriptions.add(this.datepicker.stateChanges.subscribe(()=>{this._changeDetectorRef.markForCheck()})),this._calendar.focusActiveCell()}ngOnDestroy(){this._subscriptions.unsubscribe(),this._animationDone.complete()}_handleUserSelection(b){const I=this._model.selection,z=b.value,W=I instanceof Li;if(W&&this._rangeSelectionStrategy){const se=this._rangeSelectionStrategy.selectionFinished(z,I,b.event);this._model.updateSelection(se,this)}else z&&(W||!this._dateAdapter.sameDate(z,I))&&this._model.add(z);(!this._model||this._model.isComplete())&&!this._actionsPortal&&this.datepicker.close()}_handleUserDragDrop(b){this._model.updateSelection(b.value,this)}_startExitAnimation(){this._animationState="void",this._changeDetectorRef.markForCheck()}_handleAnimationEvent(b){this._isAnimating="start"===b.phaseName,this._isAnimating||this._animationDone.next()}_getSelected(){return this._model.selection}_applyPendingSelection(){this._model!==this._globalModel&&this._globalModel.updateSelection(this._model.selection,this)}_assignActions(b,I){this._model=b?this._globalModel.clone():this._globalModel,this._actionsPortal=b,I&&this._changeDetectorRef.detectChanges()}}return(R=ie).\u0275fac=function(b){return new(b||R)(M.Y36(M.SBq),M.Y36(M.sBO),M.Y36(mn),M.Y36(Fe._A),M.Y36($n,8),M.Y36(yt))},R.\u0275cmp=M.Xpm({type:R,selectors:[["mat-datepicker-content"]],viewQuery:function(b,I){if(1&b&&M.Gf(xe,5),2&b){let z;M.iGM(z=M.CRH())&&(I._calendar=z.first)}},hostAttrs:[1,"mat-datepicker-content"],hostVars:3,hostBindings:function(b,I){1&b&&M.WFA("@transformPanel.start",function(W){return I._handleAnimationEvent(W)})("@transformPanel.done",function(W){return I._handleAnimationEvent(W)}),2&b&&(M.d8E("@transformPanel",I._animationState),M.ekj("mat-datepicker-content-touch",I.datepicker.touchUi))},inputs:{color:"color"},exportAs:["matDatepickerContent"],features:[M.qOj],decls:5,vars:26,consts:[["cdkTrapFocus","","role","dialog",1,"mat-datepicker-content-container"],[3,"id","ngClass","startAt","startView","minDate","maxDate","dateFilter","headerComponent","selected","dateClass","comparisonStart","comparisonEnd","startDateAccessibleName","endDateAccessibleName","yearSelected","monthSelected","viewChanged","_userSelection","_userDragDrop"],[3,"cdkPortalOutlet"],["type","button","mat-raised-button","",1,"mat-datepicker-close-button",3,"color","focus","blur","click"]],template:function(b,I){if(1&b&&(M.TgZ(0,"div",0)(1,"mat-calendar",1),M.NdJ("yearSelected",function(W){return I.datepicker._selectYear(W)})("monthSelected",function(W){return I.datepicker._selectMonth(W)})("viewChanged",function(W){return I.datepicker._viewChanged(W)})("_userSelection",function(W){return I._handleUserSelection(W)})("_userDragDrop",function(W){return I._handleUserDragDrop(W)}),M.qZA(),M.YNc(2,Pt,0,0,"ng-template",2),M.TgZ(3,"button",3),M.NdJ("focus",function(){return I._closeButtonFocused=!0})("blur",function(){return I._closeButtonFocused=!1})("click",function(){return I.datepicker.close()}),M._uU(4),M.qZA()()),2&b){let z;M.ekj("mat-datepicker-content-container-with-custom-header",I.datepicker.calendarHeaderComponent)("mat-datepicker-content-container-with-actions",I._actionsPortal),M.uIk("aria-modal",!0)("aria-labelledby",null!==(z=I._dialogLabelId)&&void 0!==z?z:void 0),M.xp6(1),M.Q6J("id",I.datepicker.id)("ngClass",I.datepicker.panelClass)("startAt",I.datepicker.startAt)("startView",I.datepicker.startView)("minDate",I.datepicker._getMinDate())("maxDate",I.datepicker._getMaxDate())("dateFilter",I.datepicker._getDateFilter())("headerComponent",I.datepicker.calendarHeaderComponent)("selected",I._getSelected())("dateClass",I.datepicker.dateClass)("comparisonStart",I.comparisonStart)("comparisonEnd",I.comparisonEnd)("@fadeInCalendar","enter")("startDateAccessibleName",I.startDateAccessibleName)("endDateAccessibleName",I.endDateAccessibleName),M.xp6(1),M.Q6J("cdkPortalOutlet",I._actionsPortal),M.xp6(1),M.ekj("cdk-visually-hidden",!I._closeButtonFocused),M.Q6J("color",I.color||"primary"),M.xp6(1),M.Oqu(I._closeButtonText)}},dependencies:[s.mk,wt.lW,T.mK,ai.Pl,xe],styles:[".mat-datepicker-content{box-shadow:0px 2px 4px -1px rgba(0, 0, 0, 0.2), 0px 4px 5px 0px rgba(0, 0, 0, 0.14), 0px 1px 10px 0px rgba(0, 0, 0, 0.12);display:block;border-radius:4px;background-color:var(--mat-datepicker-calendar-container-background-color);color:var(--mat-datepicker-calendar-container-text-color)}.mat-datepicker-content .mat-calendar{width:296px;height:354px}.mat-datepicker-content .mat-datepicker-content-container-with-custom-header .mat-calendar{height:auto}.mat-datepicker-content .mat-datepicker-close-button{position:absolute;top:100%;left:0;margin-top:8px}.ng-animating .mat-datepicker-content .mat-datepicker-close-button{display:none}.mat-datepicker-content-container{display:flex;flex-direction:column;justify-content:space-between}.mat-datepicker-content-touch{box-shadow:0px 11px 15px -7px rgba(0, 0, 0, 0.2), 0px 24px 38px 3px rgba(0, 0, 0, 0.14), 0px 9px 46px 8px rgba(0, 0, 0, 0.12);display:block;max-height:80vh;position:relative;overflow:visible}.mat-datepicker-content-touch .mat-datepicker-content-container{min-height:312px;max-height:788px;min-width:250px;max-width:750px}.mat-datepicker-content-touch .mat-calendar{width:100%;height:auto}@media all and (orientation: landscape){.mat-datepicker-content-touch .mat-datepicker-content-container{width:64vh;height:80vh}}@media all and (orientation: portrait){.mat-datepicker-content-touch .mat-datepicker-content-container{width:80vw;height:100vw}.mat-datepicker-content-touch .mat-datepicker-content-container-with-actions{height:115vw}}"],encapsulation:2,data:{animation:[Ge.transformPanel,Ge.fadeInCalendar]},changeDetection:0}),ie})(),Zt=(()=>{var R;class ie{get startAt(){return this._startAt||(this.datepickerInput?this.datepickerInput.getStartValue():null)}set startAt(b){this._startAt=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(b))}get color(){return this._color||(this.datepickerInput?this.datepickerInput.getThemePalette():void 0)}set color(b){this._color=b}get touchUi(){return this._touchUi}set touchUi(b){this._touchUi=(0,Gt.Ig)(b)}get disabled(){return void 0===this._disabled&&this.datepickerInput?this.datepickerInput.disabled:!!this._disabled}set disabled(b){const I=(0,Gt.Ig)(b);I!==this._disabled&&(this._disabled=I,this.stateChanges.next(void 0))}get restoreFocus(){return this._restoreFocus}set restoreFocus(b){this._restoreFocus=(0,Gt.Ig)(b)}get panelClass(){return this._panelClass}set panelClass(b){this._panelClass=(0,Gt.du)(b)}get opened(){return this._opened}set opened(b){(0,Gt.Ig)(b)?this.open():this.close()}_getMinDate(){return this.datepickerInput&&this.datepickerInput.min}_getMaxDate(){return this.datepickerInput&&this.datepickerInput.max}_getDateFilter(){return this.datepickerInput&&this.datepickerInput.dateFilter}constructor(b,I,z,W,se,_t,Kt){this._overlay=b,this._ngZone=I,this._viewContainerRef=z,this._dateAdapter=se,this._dir=_t,this._model=Kt,this._inputStateChanges=zt.w0.EMPTY,this._document=(0,M.f3M)(s.K0),this.startView="month",this._touchUi=!1,this.xPosition="start",this.yPosition="below",this._restoreFocus=!0,this.yearSelected=new M.vpe,this.monthSelected=new M.vpe,this.viewChanged=new M.vpe(!0),this.openedStream=new M.vpe,this.closedStream=new M.vpe,this._opened=!1,this.id="mat-datepicker-"+Ke++,this._focusedElementBeforeOpen=null,this._backdropHarnessClass=`${this.id}-backdrop`,this.stateChanges=new dt.x,this._scrollStrategy=W}ngOnChanges(b){const I=b.xPosition||b.yPosition;if(I&&!I.firstChange&&this._overlayRef){const z=this._overlayRef.getConfig().positionStrategy;z instanceof mt._G&&(this._setConnectedPositions(z),this.opened&&this._overlayRef.updatePosition())}this.stateChanges.next(void 0)}ngOnDestroy(){this._destroyOverlay(),this.close(),this._inputStateChanges.unsubscribe(),this.stateChanges.complete()}select(b){this._model.add(b)}_selectYear(b){this.yearSelected.emit(b)}_selectMonth(b){this.monthSelected.emit(b)}_viewChanged(b){this.viewChanged.emit(b)}registerInput(b){return this._inputStateChanges.unsubscribe(),this.datepickerInput=b,this._inputStateChanges=b.stateChanges.subscribe(()=>this.stateChanges.next(void 0)),this._model}registerActions(b){this._actionsPortal=b,this._componentRef?.instance._assignActions(b,!0)}removeActions(b){b===this._actionsPortal&&(this._actionsPortal=null,this._componentRef?.instance._assignActions(null,!0))}open(){this._opened||this.disabled||this._componentRef?.instance._isAnimating||(this._focusedElementBeforeOpen=(0,Jt.ht)(),this._openOverlay(),this._opened=!0,this.openedStream.emit())}close(){if(!this._opened||this._componentRef?.instance._isAnimating)return;const b=this._restoreFocus&&this._focusedElementBeforeOpen&&"function"==typeof this._focusedElementBeforeOpen.focus,I=()=>{this._opened&&(this._opened=!1,this.closedStream.emit())};if(this._componentRef){const{instance:z,location:W}=this._componentRef;z._startExitAnimation(),z._animationDone.pipe((0,Xt.q)(1)).subscribe(()=>{const se=this._document.activeElement;b&&(!se||se===this._document.activeElement||W.nativeElement.contains(se))&&this._focusedElementBeforeOpen.focus(),this._focusedElementBeforeOpen=null,this._destroyOverlay()})}b?setTimeout(I):I()}_applyPendingSelection(){this._componentRef?.instance?._applyPendingSelection()}_forwardContentValues(b){b.datepicker=this,b.color=this.color,b._dialogLabelId=this.datepickerInput.getOverlayLabelId(),b._assignActions(this._actionsPortal,!1)}_openOverlay(){this._destroyOverlay();const b=this.touchUi,I=new ai.C5(Ut,this._viewContainerRef),z=this._overlayRef=this._overlay.create(new mt.X_({positionStrategy:b?this._getDialogStrategy():this._getDropdownStrategy(),hasBackdrop:!0,backdropClass:[b?"cdk-overlay-dark-backdrop":"mat-overlay-transparent-backdrop",this._backdropHarnessClass],direction:this._dir,scrollStrategy:b?this._overlay.scrollStrategies.block():this._scrollStrategy(),panelClass:"mat-datepicker-"+(b?"dialog":"popup")}));this._getCloseStream(z).subscribe(W=>{W&&W.preventDefault(),this.close()}),z.keydownEvents().subscribe(W=>{const se=W.keyCode;(se===lt.LH||se===lt.JH||se===lt.oh||se===lt.SV||se===lt.Ku||se===lt.VM)&&W.preventDefault()}),this._componentRef=z.attach(I),this._forwardContentValues(this._componentRef.instance),b||this._ngZone.onStable.pipe((0,Xt.q)(1)).subscribe(()=>z.updatePosition())}_destroyOverlay(){this._overlayRef&&(this._overlayRef.dispose(),this._overlayRef=this._componentRef=null)}_getDialogStrategy(){return this._overlay.position().global().centerHorizontally().centerVertically()}_getDropdownStrategy(){const b=this._overlay.position().flexibleConnectedTo(this.datepickerInput.getConnectedOverlayOrigin()).withTransformOriginOn(".mat-datepicker-content").withFlexibleDimensions(!1).withViewportMargin(8).withLockedPosition();return this._setConnectedPositions(b)}_setConnectedPositions(b){const I="end"===this.xPosition?"end":"start",z="start"===I?"end":"start",W="above"===this.yPosition?"bottom":"top",se="top"===W?"bottom":"top";return b.withPositions([{originX:I,originY:se,overlayX:I,overlayY:W},{originX:I,originY:W,overlayX:I,overlayY:se},{originX:z,originY:se,overlayX:z,overlayY:W},{originX:z,originY:W,overlayX:z,overlayY:se}])}_getCloseStream(b){const I=["ctrlKey","shiftKey","metaKey"];return(0,Ht.T)(b.backdropClick(),b.detachments(),b.keydownEvents().pipe((0,bt.h)(z=>z.keyCode===lt.hY&&!(0,lt.Vb)(z)||this.datepickerInput&&(0,lt.Vb)(z,"altKey")&&z.keyCode===lt.LH&&I.every(W=>!(0,lt.Vb)(z,W)))))}}return(R=ie).\u0275fac=function(b){return new(b||R)(M.Y36(mt.aV),M.Y36(M.R0b),M.Y36(M.s_b),M.Y36(je),M.Y36(Fe._A,8),M.Y36(Bt.Is,8),M.Y36(mn))},R.\u0275dir=M.lG2({type:R,inputs:{calendarHeaderComponent:"calendarHeaderComponent",startAt:"startAt",startView:"startView",color:"color",touchUi:"touchUi",disabled:"disabled",xPosition:"xPosition",yPosition:"yPosition",restoreFocus:"restoreFocus",dateClass:"dateClass",panelClass:"panelClass",opened:"opened"},outputs:{yearSelected:"yearSelected",monthSelected:"monthSelected",viewChanged:"viewChanged",openedStream:"opened",closedStream:"closed"},features:[M.TTD]}),ie})(),di=(()=>{var R;class ie extends Zt{}return(R=ie).\u0275fac=function(){let q;return function(I){return(q||(q=M.n5z(R)))(I||R)}}(),R.\u0275cmp=M.Xpm({type:R,selectors:[["mat-datepicker"]],exportAs:["matDatepicker"],features:[M._Bn([_r,{provide:Zt,useExisting:R}]),M.qOj],decls:0,vars:0,template:function(b,I){},encapsulation:2,changeDetection:0}),ie})();class pi{constructor(ie,q){this.target=ie,this.targetElement=q,this.value=this.target.value}}let nn=(()=>{var R;class ie{get value(){return this._model?this._getValueFromModel(this._model.selection):this._pendingValue}set value(b){this._assignValueProgrammatically(b)}get disabled(){return!!this._disabled||this._parentDisabled()}set disabled(b){const I=(0,Gt.Ig)(b),z=this._elementRef.nativeElement;this._disabled!==I&&(this._disabled=I,this.stateChanges.next(void 0)),I&&this._isInitialized&&z.blur&&z.blur()}_getValidators(){return[this._parseValidator,this._minValidator,this._maxValidator,this._filterValidator]}_registerModel(b){this._model=b,this._valueChangesSubscription.unsubscribe(),this._pendingValue&&this._assignValue(this._pendingValue),this._valueChangesSubscription=this._model.selectionChanged.subscribe(I=>{if(this._shouldHandleChangeEvent(I)){const z=this._getValueFromModel(I.selection);this._lastValueValid=this._isValidValue(z),this._cvaOnChange(z),this._onTouched(),this._formatValue(z),this.dateInput.emit(new pi(this,this._elementRef.nativeElement)),this.dateChange.emit(new pi(this,this._elementRef.nativeElement))}})}constructor(b,I,z){this._elementRef=b,this._dateAdapter=I,this._dateFormats=z,this.dateChange=new M.vpe,this.dateInput=new M.vpe,this.stateChanges=new dt.x,this._onTouched=()=>{},this._validatorOnChange=()=>{},this._cvaOnChange=()=>{},this._valueChangesSubscription=zt.w0.EMPTY,this._localeSubscription=zt.w0.EMPTY,this._parseValidator=()=>this._lastValueValid?null:{matDatepickerParse:{text:this._elementRef.nativeElement.value}},this._filterValidator=W=>{const se=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(W.value));return!se||this._matchesFilter(se)?null:{matDatepickerFilter:!0}},this._minValidator=W=>{const se=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(W.value)),_t=this._getMinDate();return!_t||!se||this._dateAdapter.compareDate(_t,se)<=0?null:{matDatepickerMin:{min:_t,actual:se}}},this._maxValidator=W=>{const se=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(W.value)),_t=this._getMaxDate();return!_t||!se||this._dateAdapter.compareDate(_t,se)>=0?null:{matDatepickerMax:{max:_t,actual:se}}},this._lastValueValid=!1,this._localeSubscription=I.localeChanges.subscribe(()=>{this._assignValueProgrammatically(this.value)})}ngAfterViewInit(){this._isInitialized=!0}ngOnChanges(b){(function ci(R,ie){const q=Object.keys(R);for(let b of q){const{previousValue:I,currentValue:z}=R[b];if(!ie.isDateInstance(I)||!ie.isDateInstance(z))return!0;if(!ie.sameDate(I,z))return!0}return!1})(b,this._dateAdapter)&&this.stateChanges.next(void 0)}ngOnDestroy(){this._valueChangesSubscription.unsubscribe(),this._localeSubscription.unsubscribe(),this.stateChanges.complete()}registerOnValidatorChange(b){this._validatorOnChange=b}validate(b){return this._validator?this._validator(b):null}writeValue(b){this._assignValueProgrammatically(b)}registerOnChange(b){this._cvaOnChange=b}registerOnTouched(b){this._onTouched=b}setDisabledState(b){this.disabled=b}_onKeydown(b){(0,lt.Vb)(b,"altKey")&&b.keyCode===lt.JH&&["ctrlKey","shiftKey","metaKey"].every(W=>!(0,lt.Vb)(b,W))&&!this._elementRef.nativeElement.readOnly&&(this._openPopup(),b.preventDefault())}_onInput(b){const I=this._lastValueValid;let z=this._dateAdapter.parse(b,this._dateFormats.parse.dateInput);this._lastValueValid=this._isValidValue(z),z=this._dateAdapter.getValidDateOrNull(z);const W=!this._dateAdapter.sameDate(z,this.value);!z||W?this._cvaOnChange(z):(b&&!this.value&&this._cvaOnChange(z),I!==this._lastValueValid&&this._validatorOnChange()),W&&(this._assignValue(z),this.dateInput.emit(new pi(this,this._elementRef.nativeElement)))}_onChange(){this.dateChange.emit(new pi(this,this._elementRef.nativeElement))}_onBlur(){this.value&&this._formatValue(this.value),this._onTouched()}_formatValue(b){this._elementRef.nativeElement.value=null!=b?this._dateAdapter.format(b,this._dateFormats.display.dateInput):""}_assignValue(b){this._model?(this._assignValueToModel(b),this._pendingValue=null):this._pendingValue=b}_isValidValue(b){return!b||this._dateAdapter.isValid(b)}_parentDisabled(){return!1}_assignValueProgrammatically(b){b=this._dateAdapter.deserialize(b),this._lastValueValid=this._isValidValue(b),b=this._dateAdapter.getValidDateOrNull(b),this._assignValue(b),this._formatValue(b)}_matchesFilter(b){const I=this._getDateFilter();return!I||I(b)}}return(R=ie).\u0275fac=function(b){return new(b||R)(M.Y36(M.SBq),M.Y36(Fe._A,8),M.Y36(Fe.sG,8))},R.\u0275dir=M.lG2({type:R,inputs:{value:"value",disabled:"disabled"},outputs:{dateChange:"dateChange",dateInput:"dateInput"},features:[M.TTD]}),ie})();const an={provide:Qe.JU,useExisting:(0,M.Gpc)(()=>Bi),multi:!0},Ri={provide:Qe.Cf,useExisting:(0,M.Gpc)(()=>Bi),multi:!0};let Bi=(()=>{var R;class ie extends nn{set matDatepicker(b){b&&(this._datepicker=b,this._closedSubscription=b.closedStream.subscribe(()=>this._onTouched()),this._registerModel(b.registerInput(this)))}get min(){return this._min}set min(b){const I=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(b));this._dateAdapter.sameDate(I,this._min)||(this._min=I,this._validatorOnChange())}get max(){return this._max}set max(b){const I=this._dateAdapter.getValidDateOrNull(this._dateAdapter.deserialize(b));this._dateAdapter.sameDate(I,this._max)||(this._max=I,this._validatorOnChange())}get dateFilter(){return this._dateFilter}set dateFilter(b){const I=this._matchesFilter(this.value);this._dateFilter=b,this._matchesFilter(this.value)!==I&&this._validatorOnChange()}constructor(b,I,z,W){super(b,I,z),this._formField=W,this._closedSubscription=zt.w0.EMPTY,this._validator=Qe.kI.compose(super._getValidators())}getConnectedOverlayOrigin(){return this._formField?this._formField.getConnectedOverlayOrigin():this._elementRef}getOverlayLabelId(){return this._formField?this._formField.getLabelId():this._elementRef.nativeElement.getAttribute("aria-labelledby")}getThemePalette(){return this._formField?this._formField.color:void 0}getStartValue(){return this.value}ngOnDestroy(){super.ngOnDestroy(),this._closedSubscription.unsubscribe()}_openPopup(){this._datepicker&&this._datepicker.open()}_getValueFromModel(b){return b}_assignValueToModel(b){this._model&&this._model.updateSelection(b,this)}_getMinDate(){return this._min}_getMaxDate(){return this._max}_getDateFilter(){return this._dateFilter}_shouldHandleChangeEvent(b){return b.source!==this}}return(R=ie).\u0275fac=function(b){return new(b||R)(M.Y36(M.SBq),M.Y36(Fe._A,8),M.Y36(Fe.sG,8),M.Y36(Pe.G_,8))},R.\u0275dir=M.lG2({type:R,selectors:[["input","matDatepicker",""]],hostAttrs:[1,"mat-datepicker-input"],hostVars:6,hostBindings:function(b,I){1&b&&M.NdJ("input",function(W){return I._onInput(W.target.value)})("change",function(){return I._onChange()})("blur",function(){return I._onBlur()})("keydown",function(W){return I._onKeydown(W)}),2&b&&(M.Ikx("disabled",I.disabled),M.uIk("aria-haspopup",I._datepicker?"dialog":null)("aria-owns",(null==I._datepicker?null:I._datepicker.opened)&&I._datepicker.id||null)("min",I.min?I._dateAdapter.toIso8601(I.min):null)("max",I.max?I._dateAdapter.toIso8601(I.max):null)("data-mat-calendar",I._datepicker?I._datepicker.id:null))},inputs:{matDatepicker:"matDatepicker",min:"min",max:"max",dateFilter:["matDatepickerFilter","dateFilter"]},exportAs:["matDatepickerInput"],features:[M._Bn([an,Ri,{provide:ui.Jk,useExisting:R}]),M.qOj]}),ie})(),Vn=(()=>{var R;class ie{}return(R=ie).\u0275fac=function(b){return new(b||R)},R.\u0275dir=M.lG2({type:R,selectors:[["","matDatepickerToggleIcon",""]]}),ie})(),Ka=(()=>{var R;class ie{get disabled(){return void 0===this._disabled&&this.datepicker?this.datepicker.disabled:!!this._disabled}set disabled(b){this._disabled=(0,Gt.Ig)(b)}constructor(b,I,z){this._intl=b,this._changeDetectorRef=I,this._stateChanges=zt.w0.EMPTY;const W=Number(z);this.tabIndex=W||0===W?W:null}ngOnChanges(b){b.datepicker&&this._watchStateChanges()}ngOnDestroy(){this._stateChanges.unsubscribe()}ngAfterContentInit(){this._watchStateChanges()}_open(b){this.datepicker&&!this.disabled&&(this.datepicker.open(),b.stopPropagation())}_watchStateChanges(){const b=this.datepicker?this.datepicker.stateChanges:(0,ti.of)(),I=this.datepicker&&this.datepicker.datepickerInput?this.datepicker.datepickerInput.stateChanges:(0,ti.of)(),z=this.datepicker?(0,Ht.T)(this.datepicker.openedStream,this.datepicker.closedStream):(0,ti.of)();this._stateChanges.unsubscribe(),this._stateChanges=(0,Ht.T)(this._intl.changes,b,I,z).subscribe(()=>this._changeDetectorRef.markForCheck())}}return(R=ie).\u0275fac=function(b){return new(b||R)(M.Y36(yt),M.Y36(M.sBO),M.$8M("tabindex"))},R.\u0275cmp=M.Xpm({type:R,selectors:[["mat-datepicker-toggle"]],contentQueries:function(b,I,z){if(1&b&&M.Suo(z,Vn,5),2&b){let W;M.iGM(W=M.CRH())&&(I._customIcon=W.first)}},viewQuery:function(b,I){if(1&b&&M.Gf(Mt,5),2&b){let z;M.iGM(z=M.CRH())&&(I._button=z.first)}},hostAttrs:[1,"mat-datepicker-toggle"],hostVars:8,hostBindings:function(b,I){1&b&&M.NdJ("click",function(W){return I._open(W)}),2&b&&(M.uIk("tabindex",null)("data-mat-calendar",I.datepicker?I.datepicker.id:null),M.ekj("mat-datepicker-toggle-active",I.datepicker&&I.datepicker.opened)("mat-accent",I.datepicker&&"accent"===I.datepicker.color)("mat-warn",I.datepicker&&"warn"===I.datepicker.color))},inputs:{datepicker:["for","datepicker"],tabIndex:"tabIndex",ariaLabel:["aria-label","ariaLabel"],disabled:"disabled",disableRipple:"disableRipple"},exportAs:["matDatepickerToggle"],features:[M.TTD],ngContentSelectors:zi,decls:4,vars:6,consts:[["mat-icon-button","","type","button",3,"disabled","disableRipple"],["button",""],["class","mat-datepicker-toggle-default-icon","viewBox","0 0 24 24","width","24px","height","24px","fill","currentColor","focusable","false","aria-hidden","true",4,"ngIf"],["viewBox","0 0 24 24","width","24px","height","24px","fill","currentColor","focusable","false","aria-hidden","true",1,"mat-datepicker-toggle-default-icon"],["d","M19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11zM7 10h5v5H7z"]],template:function(b,I){1&b&&(M.F$t(Qt),M.TgZ(0,"button",0,1),M.YNc(2,Dt,2,0,"svg",2),M.Hsn(3),M.qZA()),2&b&&(M.Q6J("disabled",I.disabled)("disableRipple",I.disableRipple),M.uIk("aria-haspopup",I.datepicker?"dialog":null)("aria-label",I.ariaLabel||I._intl.openCalendarLabel)("tabindex",I.disabled?-1:I.tabIndex),M.xp6(2),M.Q6J("ngIf",!I._customIcon))},dependencies:[s.O5,wt.RK],styles:[".mat-datepicker-toggle{pointer-events:auto;color:var(--mat-datepicker-toggle-icon-color)}.mat-datepicker-toggle-active{color:var(--mat-datepicker-toggle-active-state-icon-color)}.cdk-high-contrast-active .mat-datepicker-toggle-default-icon{color:CanvasText}"],encapsulation:2,changeDetection:0}),ie})(),F=(()=>{var R;class ie{}return(R=ie).\u0275fac=function(b){return new(b||R)},R.\u0275mod=M.oAB({type:R}),R.\u0275inj=M.cJS({providers:[yt,Ft],imports:[s.ez,wt.ot,mt.U8,T.rt,ai.eL,Fe.BQ,nt.ZD]}),ie})()}}]);